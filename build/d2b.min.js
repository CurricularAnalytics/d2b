!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.d2b=t.d2b||{})}(this,function(t){"use strict";function n(t){return"function"==typeof t?t:function(){return t}}function e(t){return null===t?NaN:+t}function r(t,r,o){var a=0,i=0;return o=n(o||1),r=n(r||function(t){return t}),t.filter(function(t){return!isNaN(e(o(t)))&&!isNaN(e(r(t)))}).forEach(function(t){var n=o(t),e=r(t);a+=n,i+=e*n}),t.length&&a?i/a:void 0}function o(t,o,a){a=n(a||1),o=n(o||function(t){return t});var i,l=[],c=t.filter(function(t){return 0!==a(t)&&!isNaN(e(a(t)))&&!isNaN(e(o(t)))}).sort(function(t,n){return d3.ascending(o(t),o(n))});i=Math.round(d3.sum(c,function(t){return a(t)})/2*1e12)/1e12;var u=0,d=!1;return c.forEach(function(t){d&&(l.push(o(t)),d=!1),u+=a(t),u===i&&(l.push(o(t)),d=!0),u>i&&0===l.length&&l.push(o(t))}),t.length?r(l):void 0}function a(t,o,a){a=n(a||1),o=n(o||function(t){return t});var i=[],l=0,c={};return t.forEach(function(t){var n=e(o(t));isNaN(o(t))||(c[n]=c[n]||0,c[n]+=a(t),c[n]>l?(l=c[o(t)],i=[o(t)]):c[o(t)]==l&&i.push(o(t)))}),t.length?r(i):void 0}function i(t,e){e=n(e||function(t){return t});var r=d3.extent(t,e);return t.length?r[1]-r[0]:void 0}function l(t,e){return e=n(e||function(t){return t}),t.length?d3.mean(d3.extent(t,e)):void 0}function c(t){return t*(Math.PI/180)}function u(t){return t*(180/Math.PI)}function d(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=arguments[2],a=function(n,e){return function(o){if(!arguments.length)return r[n];var a=r[n];return r[n]=o,e&&e(o,a),t}},i=function(t){return function(n){return r[t]}},l=function(e,o){return function(a){if(!arguments.length)return r[e];var i=r[e];return r[e]=n(a),o&&o(a,i),t}},c={base:function(){return t},values:function(){return r},removeProp:function(n){return-1!==o.indexOf(n)?(console.error("Cannot remove "+n+" property or value"),c):(r[n]=null,t[n]=null,c)},addProp:function(n){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],o=arguments.length<=2||void 0===arguments[2]?a(n):arguments[2],i=arguments[3];return r[n]||t[n]?(console.error(n+" property is already defined."),c):(o=o||a(n,i),r[n]=e,t[n]=o,i&&i(e),c)},addPropGet:function(n){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],o=arguments.length<=2||void 0===arguments[2]?i(n):arguments[2];return r[n]||t[n]?(console.error(n+" property is already defined."),c):(r[n]=e,t[n]=o,c)},addMethod:function(n,e){return t[n]?(console.error(n+" method is already defined."),c):(t[n]=e,c)},addPropFunctor:function(e){var o=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a=arguments.length<=2||void 0===arguments[2]?l(e):arguments[2],i=arguments[3];return r[e]||t[e]?(console.error(e+" property is already defined."),c):(a=a||l(e,i),o=n(o),i&&i(o),r[e]=o,t[e]=a,c)},addDispatcher:function(n){var o=arguments.length<=1||void 0===arguments[1]?"on":arguments[1],a=arguments.length<=2||void 0===arguments[2]?"dispatch":arguments[2];return t[o]?(console.error(o+" property is already defined."),c):r[a]?(console.error(a+" value is already defined."),c):(t[o]=function(n,e){return 0===arguments.length?r[a]:1===arguments.length?r[a].on(n):(r[a].on(n,e),t)},r[a]=d3.dispatch.apply(e,n),c)}};return c}function s(){function t(t,n){return i.empty.call(this,t,n)?0:1}function n(t,n){var e=i.size.call(this,t,n),r=i.empty.call(this,t,n);return c.size(r?e:2.5*e).call(this,t,n)}function e(t,n){var e=i.size.call(this,t,n),r=i.empty.call(this,t,n);return c.size(r?e/3:e).call(this,t,n)}function r(t,n){var e=i.size.call(this,t,n);return c.size(e).call(this,t,n)}function o(t,r){var o=(i.size.call(this,t,r),i.empty.call(this,t,r));d3.select(this).select("path.d2b-point-back").transition().duration(100).attr("d",n),d3.select(this).select("path.d2b-point-front").transition().duration(100).style("opacity",o?.5:1).attr("d",e)}function a(t,n){var o=(i.size.call(this,t,n),i.empty.call(this,t,n));d3.select(this).select("path.d2b-point-back").transition().duration(100).attr("d",r),d3.select(this).select("path.d2b-point-front").transition().duration(100).style("opacity",o?0:1).attr("d",e)}var i={},l=function u(n){var l=n.selection?n.selection():n,c=l.selectAll("path.d2b-point-back").data(function(t){return[t]});c.enter().append("path").attr("class","d2b-point-back").attr("d",r).style("fill-opacity",0).style("stroke",i.stroke).style("stroke-width",i.strokeWidth);n!==l&&(c=c.transition(n)),c.attr("d",r).style("stroke",i.stroke).style("stroke-width",i.strokeWidth);var d=l.selectAll("path.d2b-point-front").data(function(t){return[t]});d.enter().append("path").attr("class","d2b-point-front").attr("d",e).style("opacity",t).style("fill",i.fill).style("stroke",i.stroke).style("stroke-width",i.strokeWidth);return n!==l&&(d=d.transition(n)),d.attr("d",e).style("opacity",t).style("fill",i.fill).style("stroke",i.stroke).style("stroke-width",i.strokeWidth),l.each(function(t,n){var e=i.active.call(this,t,n);d3.select(this).on("mouseover.d2b-point",e?o:null).on("mouseout.d2b-point",e?a:null)}),u},c=d3.symbol();d(l,i).addPropFunctor("size",150,null,function(t){return c.size(t)}).addPropFunctor("type",d3.symbolCircle,null,function(t){return c.type(t)}).addPropFunctor("active",!1).addPropFunctor("empty",!1).addPropFunctor("fill","steelblue").addPropFunctor("stroke",function(t,n){return d3.rgb(i.fill.call(this,t,n)).darker(.3)}).addPropFunctor("strokeWidth","1px");return l}function p(t){var e=arguments.length<=1||void 0===arguments[1]?function(t){return t.label}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?1/0:arguments[2];e=n(e),t.each(function(t,n){for(var o=d3.select(this),a=e.call(this,t,n).split(/\s+/).reverse(),i=void 0,l=[],c=[a.pop()],u=1.1;i=a.pop();)c.join(" ").length+i.length>r&&(l.push(c),c=[]),c.push(i);l.push(c);var d=o.selectAll("tspan").data(l);d.merge(d.enter().append("tspan")).text(function(t){return t.join(" ")}).attr("x",0).attr("y",0).attr("dy",function(t,n){return n*u+"em"})})}function h(){function t(t,r){t.selectAll(".d2b-legend-item").on("click",function(e,o){n.call(this,e,o,t,r)}).on("dblclick",function(n,o){e.call(this,n,o,t,r)})}function n(t,n,e,o){var i=r.clickable.call(this,t,n),l=r.allowEmptied.call(e.node(),e.datum(),o),c=e.datum();e.node();if(i){t.__empty__=!t.__empty__;var u=d3.select(this),d=e.selectAll(".d2b-legend-item"),s=!0;c.forEach(function(t){return s=t.__empty__?s:!1}),s&&!l?(d.each(function(t){return t.__empty__=!1}).transition().duration(100).call(a),d.filter(function(n){return n!=t}).dispatch("change")):u.transition().duration(100).call(a),u.dispatch("change",{bubbles:!0})}}function e(t,n,e,o){var i=r.dblclickable.call(this,t,n),l=e.datum();if(i){l.forEach(function(t){return t.__empty__=!0}),t.__empty__=!1;var c=e.selectAll(".d2b-legend-item");c.transition().duration(100).call(a),c.filter(function(n){return n!=t}).dispatch("change"),d3.select(this).dispatch("change",{bubbles:!0})}}var r={},o=function l(n){return n.each(function(e,o){var l=d3.select(this),c=r.size.call(this,e,o),u=r.maxSize.call(this,e,o),d=r.orient.call(this,e,o),s=r.maxTextLength.call(this,e,o),h=r.items.call(this,e,o);a.size(1.5*Math.pow(c/2,2)).strokeWidth(.1*c);var f=l.selectAll(".d2b-legend").data([h]);f=f.merge(f.enter().append("g").attr("class","d2b-legend"));var v=f.selectAll(".d2b-legend-item").data(function(t){return t},r.key),y=v.enter().append("g").attr("class","d2b-legend-item").style("opacity",0);y.append("g").append("text");var _=v.exit();v=v.merge(y).style("cursor",function(t,n){var e=r.clickable.call(this,t,n),o=r.dblclickable.call(this,t,n);return e||o?"pointer":"auto"}),l.call(t,o);var b=v.select("g").attr("transform","translate("+c/2+", "+c/2+")"),g=v.select("text").attr("transform","translate("+c/1.5+", "+c/3+")").style("font-size",c+"px").call(p,r.label,s);n.selection&&(_=_.transition(n).style("opacity",0),v=v.transition(n),b=b.transition(n),g=g.transition(n)),_.remove(),b.call(a);var x=0;g.each(function(){x=Math.max(x,this.getBBox().width)}),x+=c;var m={x:c,y:5};y.call(i[d],this,m,c,u,x),this.computedWidth=0,this.computedHeight=0,v.style("opacity",1).call(i[d],this,m,c,u,x)}),l},a=s().empty(function(t){return t.__empty__}),i={horizontal:function(t,n,e,r,o,a){var i=0,l=0,c=0;t.attr("transform",function(){var t=d3.select(this),u=r*t.selectAll("tspan").size(),d=t.select("text").node().getBBox().width;i+a>o.width&&(i=0,l+=c+e.y,c=0);var s="translate("+i+", "+l+")";return c=Math.max(c,u),n.computedWidth=Math.max(n.computedWidth,i+d+1.5*r),i+=a+e.x,s}),n.computedHeight=l+c},vertical:function(t,n,e,r,o){var a=0,i=0,l=0;t.attr("transform",function(){var t=d3.select(this),c=r*t.selectAll("tspan").size(),u=t.select("text").node().getBBox().width;i+c>o.height&&(a+=l+e.x+r,i=0,l=0);var d="translate("+a+", "+i+")";return l=Math.max(l,u),n.computedHeight=Math.max(n.computedHeight,i+c),i+=c+e.y,d}),n.computedWidth=a+l+1.5*r}};d(o,r).addPropFunctor("items",function(t){return t}).addPropFunctor("size",12).addPropFunctor("maxSize",{width:960,height:500}).addPropFunctor("orient","vertical").addPropFunctor("maxTextLength",1/0).addPropFunctor("allowEmptied",!1).addPropFunctor("key",function(t,n){return n}).addPropFunctor("clickable",!1).addPropFunctor("dblclickable",!1).addPropFunctor("label",function(t){return t.label}).addPropFunctor("active",!1,null,function(t){return a.active(t)}).addPropFunctor("symbol",d3.symbolCircle,null,function(t){return a.type(t)}).addPropFunctor("color",function(t){return I(t.label)},null,function(t){return a.fill(t)}).addMethod("computedSize",function(t){var n=t.node?t.node():t;return n?{width:n.computedWidth,height:n.computedHeight}:{width:0,height:0}});return o}function f(t,n){var e={};for(var r in t)"function"!=typeof t[r]&&n.indexOf(r)<0&&(e[r]=t[r]);return e}function v(t,n){return t.selection?void t.attrTween("d",function(t){var e=this;t=f(t,["data"]),this.current=this.current||t;var r=d3.interpolate(this.current,t);return function(t){return e.current=r(t),n(e.current)}}):t.attr("d",function(t){return this.current=f(t,["data"]),n(t)})}function y(){function t(t,r,o){var a=void 0;return(a=n(t,r,o))?{startAngle:a.endAngle,endAngle:a.endAngle}:(a=e(t,r,o))?{startAngle:a.startAngle,endAngle:a.startAngle}:{startAngle:0,endAngle:0}}function n(t,n,e){for(var o=n.length;--t>=0;)for(var a=r.key(e[t].data,t),i=0;o>i;++i)if(r.key(n[i].data,i)===a)return n[i]}function e(t,n,e){for(var o=e.length,a=n.length;++t<o;)for(var i=r.key(e[t].data,t),l=0;a>l;++l)if(r.key(n[l].data,l)===i)return n[l]}var r={},o=function a(n){var e=n.selection?n.selection():n;return e.each(function(o,a){var i=d3.select(this),l=i.selectAll(".d2b-pie-arc"),c=l.data();l=l.data(r.values,function(t,n){return r.key(t.data,n)});var u=l.enter().append("g").attr("class","d2b-pie-arc"),d=l.exit(),s=l.merge(u).order();u.append("path").attr("fill",function(t,n){return r.color.call(this,t.data,n)});var p=s.data();u.select("path").each(function(n,e){this.current=t(e,c,p)}),d.datum(function(n,e){var r=t(e,p,c);return r.data=n.data,r}),n!==e&&(d=d.transition(n),s=s.transition(n)),s.select("path").call(v,r.arc).attr("fill",function(t,n){return r.color.call(this,t.data,n)}),d.remove().select("path").call(v,r.arc)}),a};d(o,r).addProp("key",function(t){return t.label}).addProp("arc",d3.arc().innerRadius(100).outerRadius(200)).addPropFunctor("values",function(t){return t}).addPropFunctor("color",function(t){return I(t.label)});return o}function _(){var t={},n=function e(n){var r=n.selection?n.selection():n,o=r.selectAll(".d2b-line-graph").data(function(t){return t},t.key),a=o.enter().append("g").attr("class","d2b-line-graph").style("opacity",0);a.append("path").attr("class","d2b-line");var i=o.merge(a).order(),l=o.exit(),c=i.select(".d2b-line");return n!==r&&(i=i.transition(n),l=l.transition(n),c=c.transition(n)),r.each(function(n,e){var r=t.tooltip.call(this,n,e);r&&r.clear("line"),d3.select(this).selectAll(".d2b-line").each(function(){this.tooltip=r})}),i.style("opacity",1),l.style("opacity",0).remove(),c.style("stroke",t.color).attr("d",function(n,e){var r=this,o=t.x.call(this,n,e),a=t.y.call(this,n,e),i=t.color.call(this,n,e),l=t.values.call(this,n,e),c=t.shift.call(this,n,e);return null===c&&(c=o.bandwidth?o.bandwidth()/2:0),this.tooltip&&this.tooltip.graph("line",e).data(l).x(function(n,e){return o(t.px(n,e))+c}).y(function(n,e){return a(t.py(n,e))}).color(i),t.line.x(function(n,e){return o(t.px.call(r,n,e))+c}).y(function(n,e){return a(t.py.call(r,n,e))})(l)}),e};d(n,t).addProp("line",d3.line()).addProp("x",d3.scaleLinear(),function(e){return arguments.length?(e.domain?t.x=function(){return e}:t.x=e,n):t.x}).addProp("y",d3.scaleLinear(),function(e){return arguments.length?(e.domain?t.y=function(){return e}:t.y=e,n):t.y}).addPropFunctor("tooltip",function(t){return t.tooltip}).addPropFunctor("shift",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values}).addPropFunctor("color",function(t){return I(t.label)}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y});return n}function b(){var t={},n=function(n){var e=this,r=n;n=n.map(t.values);var o=[],a=n.map(function(n,r){var a={};return n.forEach(function(n,r){var i=t.x.call(e,n,r);o.push(i),a[i]=t.y.call(e,n,r)}),a});o=d3.set(o).values();var i=o.reduce(function(t,n,e){return t[n]=e,t},{}),l=d3.range(0,n.length),c=o.map(function(t,n){return a.map(function(n,e){return n[t]||0})}),u=t.stack.keys(l).value(function(t,n){return t[n]||0})(c);return n.forEach(function(n,r){n.forEach(function(n,o){var a=t.x.call(e,n,o),l=u[r][i[a]];t.out.call(e,n,l[0],l[1],a)})}),r};d(n,t).addProp("stack",d3.stack()).addPropFunctor("values",function(t){return t}).addPropFunctor("x",function(t){return t.x}).addPropFunctor("y",function(t){return t.y}).addPropFunctor("out",function(t,n,e){t.y0=n,t.y1=e});return n}function g(){return Math.random().toString(36).substr(2,9)}function x(){var t={},n=function o(n){var a=n.selection?n.selection():n;a.each(function(t){});var i=a.selectAll(".d2b-area-graph").data(function(t){return t},t.key),l=i.enter().append("g").attr("class","d2b-area-graph").style("opacity",0);l.append("path").attr("class","d2b-area");var c=i.merge(l).order(),u=i.exit(),d=c.select(".d2b-area");return n!==a&&(c=c.transition(n),u=u.transition(n),d=d.transition(n)),a.each(function(n,o){var a=t.tooltip.call(this,n,o);a&&a.clear("area"),d3.select(this).selectAll(".d2b-area").each(function(){this.tooltip=a}),r.entries(n).forEach(function(t){return e(t.values)})}),c.style("opacity",1),u.style("opacity",0).remove(),d.style("fill",t.color).attr("d",function(n,e){var r=t.x.call(this,n,e),o=t.y.call(this,n,e),a=t.values.call(this,n,e),i=t.color.call(this,n,e),l=t.shift.call(this,n,e);return null===l&&(l=r.bandwidth?r.bandwidth()/2:0),this.tooltip&&this.tooltip.graph("area",e).data(a).x(function(t,n){return r(t.__x__)+l}).y(function(t,n){return o(t.__y1__)}).color(i),t.area.x(function(t,n){return r(t.__x__)+l}).y0(function(t,n){return o(t.__y0__)}).y1(function(t,n){return o(t.__y1__)})(a)}),o},e=b().out(function(t,n,e,r){t.__x__=r,t.__y0__=n,t.__y1__=e}),r=d3.nest().key(function(n){var e=t.stackBy(n);return e!==!1&&null!==e?e:g()});d(n,t).addProp("area",d3.area()).addProp("stack",d3.stack(),null,function(t){return e.stack(t)}).addProp("x",d3.scaleLinear(),function(e){return arguments.length?(e.domain?t.x=function(){return e}:t.x=e,n):t.x}).addProp("y",d3.scaleLinear(),function(e){return arguments.length?(e.domain?t.y=function(){return e}:t.y=e,n):t.y}).addPropFunctor("tooltip",function(t){return t.tooltip}).addPropFunctor("shift",null).addPropFunctor("stackBy",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values},null,function(t){return e.values(t)}).addPropFunctor("color",function(t){return I(t.label)}).addPropFunctor("px",function(t){return t.x},null,function(t){return e.x(t)}).addPropFunctor("py",function(t){return t.y},null,function(t){return e.y(t)});return n}function m(){function t(t,e,r,o){t.attr("transform",function(t,a){var i=e(n.px.call(this,t,a))+o,l=r(n.py.call(this,t,a));return"translate("+i+", "+l+")"})}var n={},e=function r(e){var o=e.selection?e.selection():e,a=o.selectAll(".d2b-scatter-graph").data(function(t){return t},n.key),i=a.enter().append("g").attr("class","d2b-scatter-graph").style("opacity",0),l=a.merge(i).order(),c=a.exit();return e!==o&&(l=l.transition(e),c=c.transition(e)),o.each(function(t,e){var r=n.tooltip.call(this,t,e);r&&r.clear("scatter"),d3.select(this).selectAll(".d2b-scatter-graph").each(function(){this.tooltip=r})}),l.style("opacity",1),c.style("opacity",0).remove(),l.each(function(r,a){var i=d3.select(this),l=n.x.call(this,r,a),c=n.y.call(this,r,a),u=n.color.call(this,r,a),d=n.symbol.call(this,r,a),s=n.values.call(this,r,a),p=n.shift.call(this,r,a);null===p&&(p=l.bandwidth?l.bandwidth()/2:0),this.tooltip&&this.tooltip.graph("scatter",a).data(s).x(function(t,e){return l(n.px(t,e))+p}).y(function(t,e){return c(n.py(t,e))}).color(function(t,e){return n.pcolor(t,e)||u}),n.point.fill(function(t,e){return n.pcolor.call(this,t,e)||u}).type(function(t,e){return n.psymbol.call(this,t,e)||d}).size(n.psize);var h=i.selectAll(".d2b-scatter-point").data(s,n.pkey),f=h.enter().append("g").attr("class","d2b-scatter-point"),v=h.merge(f).order(),y=h.exit();e!==o&&(v=v.transition(e),y=y.transition(e)),f.style("opacity",0).call(t,l,c,p),v.style("opacity",1).call(n.point).call(t,l,c,p),y.style("opacity",0).remove()}),r};d(e,n).addProp("point",s().active(!0)).addProp("x",d3.scaleLinear(),function(t){return arguments.length?(t.domain?n.x=function(){return t}:n.x=t,e):n.x}).addProp("y",d3.scaleLinear(),function(t){return arguments.length?(t.domain?n.y=function(){return t}:n.y=t,e):n.y}).addPropFunctor("tooltip",function(t){return t.tooltip}).addPropFunctor("shift",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values}).addPropFunctor("color",function(t){return I(t.label)}).addPropFunctor("symbol",function(t){return d3.symbolCircle}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y}).addPropFunctor("pcolor",function(t){return null}).addPropFunctor("psymbol",null).addPropFunctor("pkey",function(t,n){return n}).addPropFunctor("psize",function(t){return 25});return e}function P(){function t(t){var n={};return function(e,r,o,a){var i=o-r,l=n[a]=n[a]||[0,0];e.__stackIndex__=t,e.__base__=a,i>0?e.__extent__=[l[0],l[0]+=i]:e.__extent__=[l[1],l[1]+=i]}}function n(t,n,e){t.attr("transform",function(t){return"translate("+[n[e.x](t),n[e.y](t)]+")"})}function e(t,n){var e=[];t.forEach(function(o,a){var i=r[n.x].call(t,o,a),l=r.values.call(t,o,a);l.forEach(function(t,a){var l=r[n.px].call(o,t,a);e.push(i(l))})}),e.sort(d3.ascending);for(var o=1/0,a=0;a<e.length-1;a++)e[a+1]!==e[a]&&(o=Math.min(e[a+1]-e[a],o));return o}var r={},o=function l(o){var c=o.selection?o.selection():o;return c.each(function(l,u){var d=r.tooltip.call(this,l,u),s={};s="horizontal"===r.orient.call(this,l,u)?{rotate:!0,px:"py",py:"px",x:"y",y:"x",w:"height",h:"width"}:{rotate:!1,px:"px",py:"py",x:"x",y:"y",w:"width",h:"height"},a.x(r[s.px]).y(r[s.py]);var p=i.entries(l);p.forEach(function(n,e){return a.out(t(e))(n.values)});var h=(1-r.padding.call(this,l,u))*(r.bandwidth.call(this,l,u)||e(l,s)),f=h/p.length,v=f*r.groupPadding.call(this,l,u),y=d3.select(this).selectAll(".d2b-bar-graph").data(l,r.key),_=y.enter().append("g").attr("class","d2b-bar-graph").style("opacity",0),b=y.merge(_).order(),g=y.exit();o!==c&&(b=b.transition(o),g=g.transition(o)),b.style("opacity",1),g.style("opacity",0).remove(),d&&d.clear("bar"),b.each(function(t,e){var a=d3.select(this),i=r.color.call(this,t,e),l=r[s.x].call(this,t,e),u=r[s.y].call(this,t,e),p=r.values.call(this,t,e),y=r.shift.call(this,t,e);null===y&&(y=l.bandwidth?l.bandwidth()/2:0);var _=a.selectAll(".d2b-bar-group").data(p,r.pkey),b=_.enter().append("g").attr("class","d2b-bar-group");b.append("rect");var g=_.merge(b).order(),x=_.exit();g.each(function(t,n){var e=r.pcentered.call(this,t,n),o=e?y-h/4:y-h/2+t.__stackIndex__*f+v;t.__basepx__=l(t.__base__)+o,t.__extentpx__=[u(t.__extent__[0]),u(t.__extent__[1])],t.__extentpx__.sort(d3.ascending)}),d&&d.graph("bar",e).data(p)[s.x](function(t,n){return l(r[s.px](t,n))+y})[s.y](function(t,n){return u(t.__extent__[1])}).color(function(t,n){return r.pcolor(t,n)||i}),o!==c&&(g=g.transition(o),x=x.transition(o)),b.attr("class","d2b-bar-group").style("opacity",0).call(n,{x:function(t){return t.__basepx__},y:function(t){return u(0)}},s).select("rect").attr("fill",function(t,n){return r.pcolor.call(this,t,n)||i}).attr(s.w,f-2*v).attr(s.h,0),g.style("opacity",1).call(n,{x:function(t){return t.__basepx__},y:function(t){return t.__extentpx__[0]}},s).select("rect").attr("fill",function(t,n){return r.pcolor.call(this,t,n)||i}).attr(s.w,f-2*v).attr(s.h,function(t){return t.__extentpx__[1]-t.__extentpx__[0]}),x.style("opacity",0).remove()})}),l},a=b(),i=d3.nest().key(function(t){var n=r.stackBy(t);return n!==!1&&null!==n?n:g()});d(o,r).addProp("stack",d3.stack(),null,function(t){return a.stack(t)}).addProp("x",d3.scaleLinear(),function(t){return arguments.length?(t.domain?r.x=function(){return t}:r.x=t,o):r.x}).addProp("y",d3.scaleLinear(),function(t){return arguments.length?(t.domain?r.y=function(){return t}:r.y=t,o):r.y}).addPropFunctor("tooltip",function(t){return t.tooltip}).addPropFunctor("orient","vertical").addPropFunctor("padding",.5).addPropFunctor("groupPadding",0).addPropFunctor("bandwidth",null).addPropFunctor("shift",null).addPropFunctor("stackBy",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values},null,function(t){return a.values(t)}).addPropFunctor("color",function(t){return I(t.label)}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y}).addPropFunctor("pcentered",!1).addPropFunctor("pcolor",null).addPropFunctor("pkey",function(t,n){return n});return o}function k(){function t(t){var n=0,e=0,r=300;t.selectAll(".d2b-bubble-indicator.d2b-active").attr("transform",function(){var t=this.getBBox();t.width+n>r&&n>0&&(n=0,e+=t.height+5);var o="translate("+n+", "+e+")";return n+=t.width+5,o})}function n(t,n,e,r,o,a){t.each(function(t,a){var i=d3.select(this),l=i.attr("transform");l||i.attr("transform","translate("+(e(t.__parent__?t.__parent__.__x__:t.__x__)+o+",")+(r(t.__parent__?t.__parent__.__y__:t.__y__)+")")),t.__children__?i.attr("cursor","pointer").on("click",function(){d3.select(this).dispatch("change",{bubbles:!0,cancelable:!0})}).on("change",function(t){return t.__expanded__=!t.__expanded__}):i.attr("cursor","").on("click",null),n&&(i=i.transition(n)),t.__expanded__?i.style("opacity",0).selectAll("*").remove():i.style("opacity",1).call(c.point),i.attr("transform","translate("+(e(t.__x__)+o)+", "+r(t.__y__)+")")})}function e(t,n,e,r,o,a){t.each(function(t,n){var e=d3.select(this).classed("d2b-active",t.__expanded__);if(!t.__expanded__)return e.selectAll("rect, text").remove();var r=e.select("rect"),o=e.select("text");r.size()||(r=e.append("rect")),o.size()||(o=e.append("text")),o.text(c.pindicator.call(this,t,n).substring(0,5)).attr("x",5);var a=o.node().getBBox();o.attr("y",a.height/1.35),r.on("click",function(){d3.select(this).dispatch("change",{bubbles:!0,cancelable:!0})}).on("change",function(t){return t.__expanded__=!t.__expanded__}).attr("width",a.width+10).attr("height",a.height).style("fill",c.point.fill()).style("stroke",c.point.stroke())})}function o(t,r,a,i,l,u,d,s){var p=arguments.length<=8||void 0===arguments[8]?0:arguments[8],h=t.selectAll(".d2b-bubble-pack.d2b-depth-"+p).data(r,c.pkey),f=h.enter().append("g").attr("class","d2b-bubble-pack d2b-depth-"+p),v=h.merge(f);f.append("g").attr("class","d2b-bubble-point").style("opacity",0),n(v.select(".d2b-bubble-point"),a,i,l,u,d),f.append("g").attr("class","d2b-bubble-indicator"),e(v.select(".d2b-bubble-indicator"),a,i,l,u,d),v.each(function(t,n){var e=d3.select(this);t.__children__&&t.__expanded__?o(e,t.__children__,a,i,l,u,d,s,p+1):(s&&s(t),e.selectAll(".d2b-bubble-pack").transition(a).remove().select(".d2b-bubble-point").style("opacity",0).attr("transform","translate("+(i(t.__x__)+u)+", "+l(t.__y__)+")"))});var y=h.exit();a&&(y=y.transition(a)),y.remove()}function a(t){var n=arguments.length<=1||void 0===arguments[1]?0:arguments[1],e=c.pchildren(t);t.__leaves__=[],t.__depth__=n,e&&e.length?(t.__children__=e,e.forEach(function(e){a(e,n+1),e.__parent__=t,t.__leaves__=t.__leaves__.concat(e.__leaves__)})):(t.__x__=c.px(t),t.__y__=c.py(t),t.__size__=c.psize(t),t.__leaves__.push(t))}function i(t){t.__x__=(c.tendancy.x||c.tendancy)(t.__leaves__,function(t){return t.__x__},function(t){return t.__size__}),t.__y__=(c.tendancy.y||c.tendancy)(t.__leaves__,function(t){return t.__y__},function(t){return t.__size__}),t.__size__=d3.sum(t.__leaves__,function(t){return t.__size__}),t.__children__&&t.__children__.length&&t.__children__.forEach(function(t){return i(t)})}function l(t){a(t),i(t)}var c={},u=function p(n){var e=n.selection?n:null,r=n.selection?n.selection():n,a=r.selectAll(".d2b-bubble-pack-graph").data(function(t){return t},c.key),i=a.enter().append("g").attr("class","d2b-bubble-pack-graph"),u=a.merge(i).order(),d=a.exit();return e&&(u=u.transition(e),d=d.transition(e)),u.style("opacity",1),d.style("opacity",0).remove(),n.each(function(n,r){var a=d3.select(this),i=a.selectAll(".d2b-bubble-pack-graph"),u=c.tooltip.call(this,n,r);u&&u.clear("bubblePack"),a.on("change",function(){a.transition().duration(c.duration).call(p)}),i.each(function(t,n){var r=d3.select(this),i=c.x.call(this,t,n),d=c.y.call(this,t,n),s=c.color.call(this,t,n),p=c.symbol.call(this,t,n);t.values.forEach(l);var h=c.shift.call(this,t,n);null===h&&(h=i.bandwidth?i.bandwidth()/2:0),c.point.fill(function(t,n){return c.pcolor.call(this,t,n)||s}).type(function(t,n){return c.psymbol.call(this,t,n)||p});var f=u?u.graph("bubblePack",n).x(function(t,n){return i(t.__x__)+h}).y(function(t,n){return d(t.__y__)}).color(function(t,n){return c.pcolor(t,n)||s}).addPoint:null;o(r,t.values,e,i,d,h,a,f)}),t(a)}),p};d(u,c).addProp("point",s().active(!0),null,function(t){c.point.size(function(t){return 100*t.__size__}).active(function(t){return!!t.__children__})}).addProp("x",d3.scaleLinear(),function(t){return arguments.length?(t.domain?c.x=function(){return t}:c.x=t,u):c.x}).addProp("y",d3.scaleLinear(),function(t){return arguments.length?(t.domain?c.y=function(){return t}:c.y=t,u):c.y}).addProp("tendancy",r).addProp("duration",250).addPropFunctor("tooltip",function(t){return t.tooltip}).addPropFunctor("shift",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values}).addPropFunctor("color",function(t){return I(t.label)}).addPropFunctor("symbol",function(t){return d3.symbolCircle}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y}).addPropFunctor("psize",function(t){return t.size}).addPropFunctor("pchildren",function(t){return t.children}).addPropFunctor("pcolor",function(t){return null}).addPropFunctor("psymbol",null).addPropFunctor("pindicator",function(t){return t.label}).addPropFunctor("pkey",function(t,n){return n});return u}function F(){function t(t,n){t.each(function(t,e){var o=r.axis.call(this,t,e),a=o.scale(),i=r.orient.call(this,t,e).split(" "),l=r.labelOuter.call(this,t,e),c=(r.wrapLength.call(this,t,e),d3.select(this)),u=["right","left"].indexOf(i[0])>-1;u?a.range([0,n.height]):a.range([0,n.width]);var d=c.append("g");d.call(o);c.append("text").attr("class","d2b-axis-label-outer").text(l)})}function n(t){return"number"==typeof t?{top:t,left:t,right:t,bottom:t}:t}function e(t){return t=t||0,n(t)}var r={},o=function a(o){var i=o.selection?o.selection():o;return i.each(function(a,l){var c=r.size.call(this,a,l),u=(e(r.margin.call(this,a,l)),r.axes.call(this,a,l)),d=n(r.padding.call(this,a,l)),s=d3.select(this),p=s.selectAll(".d2b-axis").data(u,r.key),h=p.enter().append("g").attr("class","d2b-axis"),f=p.merge(h),v=p.exit();o!==i&&(v=v.transition(o)),v.style("opacity",0).remove(),d||(d=t(f,c))}),a};d(o,r).addPropFunctor("size",{width:960,height:500}).addPropFunctor("padding",null).addPropFunctor("margin",0).addPropFunctor("axes",function(t){return t.axes}).addPropFunctor("axis",function(t){return t.axis||d3.axisBottom()}).addPropFunctor("orient",function(t){return t.orient||"bottom"}).addPropFunctor("wrapLength",1/0).addPropFunctor("key",function(t,n){return t.key||n}).addPropFunctor("labelInner",function(t){return t.labelInner||null}).addPropFunctor("labelOuter",function(t){return t.labelOuter||null});return o}function w(t){function n(t,n,e,r,o,i,l){var c=void 0,u=void 0,d=l.prop(a.legendAt).split(" ");switch(d={x:d[1],y:d[0]},d.x){case"left":c=0;break;case"center":c=e/2-i.width/2;break;default:c=e-i.width}switch(d.y){case"bottom":u=r-i.height;break;case"center":u=r/2-i.height/2;break;default:u=0}var s=10,p={left:0,top:0,bottom:0,right:0};return i.height+=s,i.width+=s,"center"===d.x&&"center"===d.y||("horizontal"===o?"top"===d.y?p.top+=i.height:"bottom"===d.y&&(p.bottom+=i.height):"left"===d.x?p.left+=i.width:"right"===d.x&&(p.right+=i.width)),n.attr("transform","translate("+c+", "+u+")"),t.attr("transform","translate("+c+", "+u+")"),p}function e(t,n){var e=t.selection?t.selection():t,r={prop:function(n,e){var r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];return e=e||t,r.unshift(t),"function"==typeof n?n.apply(e,r):n},dispatch:function(n,e){var r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];return e=e||t,r.unshift(t),a.dispatch.apply(n,e,r)},context:t,selection:e,update:function(){var e=(t.selection?t.selection():t).transition().duration(r.prop(a.duration));o(e,n)}};return r}function r(t){var n={top:0,left:0,right:0,bottom:0};return"number"==typeof t?{top:t,left:t,right:t,bottom:t}:(["top","bottm","right","left"].forEach(function(e){t[e]&&n[e]==t[e]}),n)}function o(o,i){var l=e(o,i),c=o.selection?o.selection():o,u=c.datum(),d=l.prop(a.size),s=r(l.prop(a.padding)),p="translate("+s.left+", "+s.top+")";c.dispatch("beforeUpdate");var h=c.selectAll(".d2b-svg").data(function(t){return[t]}),f=h.enter().append("svg").attr("class","d2b-svg"),v=c.node().getBoundingClientRect(),y=d&&d.width?d.width:v.width,_=d&&d.height?d.height:v.height;f.attr("width",y).attr("height",_).append("g").attr("class","d2b-group").attr("transform",p),o.select(".d2b-svg").attr("width",y).attr("height",_).select(".d2b-group").attr("transform",p);var b=c.select(".d2b-group");y-=s.top+s.bottom,_-=s.left+s.right;var g=b.selectAll(".d2b-chart-legend").data(l.prop(a.legendHidden)?[]:[u]),x=g.enter().append("g").attr("class","d2b-chart-legend").style("opacity",0),m=g.exit();g=g.merge(x),o!==c&&(g=g.transition(o),m=m.transition(o).style("opacity",0)),g.style("opacity",1).call(a.legend.maxSize({width:y,height:_})),m.remove();var P={left:0,top:0};if(g.size()){var k=a.legend.computedSize(g),F=a.legend.orient().call(g.node(),u,i);P=n(g,x,y,_,F,k,l),y-=P.left+P.right,_-=P.top+P.bottom}var w="translate("+P.left+", "+P.top+")",A=b.selectAll(".d2b-chart-main").data(function(t){return[t]});A.enter().append("g").attr("class","d2b-chart-main").attr("transform",w);A=o.select(".d2b-chart-main").attr("transform",w),t(A,y,_,l),c.dispatch("afterUpdate")}var a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=function(t){t.each(function(n,e){var r=d3.select(this),a=t.selection?r.transition(t):r;o(a,e)})},l=d(i,a).addProp("legend",h()).addPropFunctor("size",null).addPropFunctor("padding",0).addPropFunctor("duration",250).addPropFunctor("legendHidden",!1).addPropFunctor("legendAt","center right");return l}function A(t){var n=arguments.length<=1||void 0===arguments[1]?1/0:arguments[1];t.each(function(){for(var t=d3.select(this),e=t.text().split(/\s+/).reverse(),r=void 0,o=[],a=0,i=1.1,l=parseFloat(t.attr("y"))||0,c=parseFloat(t.attr("dy"))||0,u=t.text(null).append("tspan").attr("x",0).attr("y",l).attr("dy",c+"em");r=e.pop();)o.push(r),
u.text(o.join(" ")),u.node().getComputedTextLength()>n&&(o.pop(),u.text(o.join(" ")),o=[r],u=t.append("tspan").attr("x",0).attr("y",l).attr("dy",++a*i+c+"em").text(r))})}function z(t){var n=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return isNaN(t)||null===t?n:t}function M(t){var e=arguments.length<=1||void 0===arguments[1]?function(t){return t}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?function(t){return t}:arguments[2];return e=n(e),t.selection?void t.tween("text",function(t,n){var o=this,a=z(e.call(this,t,n));this.current=z(this.current,a);var i=d3.interpolate(this.current,a);return function(t){o.textContent=r(o.current=i(t))}}):t.text(function(t,n){return this.current=z(e.call(this,t,n)),r(this.current)})}function T(t,n){return t.selection?void t.attrTween("transform",function(t){var e=this;t=d2b.omit(t,["data"]),this.current=this.current||t;var r=d3.interpolate(this.current,t);return function(t){return e.current=r(t),"translate("+n.centroid(e.current)+")"}}):t.attr("transform",function(t){return this.current=f(t,["data"]),"translate("+n.centroid(this.current)+")"})}function B(){var t=arguments.length<=0||void 0===arguments[0]?g():arguments[0],n={},e=function u(t){return(t.selection?t.selection():t).on(l("mouseover"),o).on(l("mouseout"),i).on(l("mousemove"),a),u},r=function(t,e){var r=this.getBoundingClientRect(),o={},a=(n.at.call(this,t,e)||(d3.event.clientX>window.innerWidth/2?"center left":"center right")).split(" ");switch(a={x:a[1],y:a[0]},a.x){case"left":o.x=r.left;break;case"center":o.x=r.left+r.width/2;break;default:o.x=r.left+r.width}switch(a.y){case"bottom":o.y=r.top+r.height;break;case"center":o.y=r.top+r.height/2;break;default:o.y=r.top}return o},o=function(t,e){n.tooltip=n.selection.selectAll(".d2b-tooltip").data(function(t){return[t]});var r=n.tooltip.enter().append("div").style("opacity",0).attr("class","d2b-tooltip");r.append("div").attr("class","d2b-tooltip-content"),n.tooltip=n.tooltip.merge(r),n.tooltip.transition().duration(100).style("opacity",1),n.dispatch.call("insert",n.tooltip,this,t,e)},a=function(t,e){var o=n.html.call(this,t,e),a=n.target.call(this,t,e),i=n.color.call(this,t,e),l=a?a.node():this,c=n.followMouse.call(this,t,e)?{x:d3.event.clientX,y:d3.event.clientY}:r.call(l,t,e),u=n.my.call(this,t,e)||(d3.event.clientX>window.innerWidth/2?"left":"right");n.tooltip.attr("class","d2b-tooltip d2b-tooltip-"+u).style("top",c.y+"px").style("left",c.x+"px").style("border-color",i).select(".d2b-tooltip-content").html(o),n.dispatch.call("move",n.tooltip,this,t,e)},i=function(t,e){n.tooltip.transition().duration(100).style("opacity",0).remove(),n.dispatch.call("remove",n.tooltip,this,t,e)},l=function(t){return t+".d2b-tooltip"},c=function(r,o){o&&o.select(".d2b-tooltip-area-"+t).remove(),r&&(n.selection=r.selectAll(".d2b-tooltip-area-"+t).data([e]),n.selection=n.selection.merge(n.selection.enter().append("div").attr("class","d2b-tooltip-area-"+t+" d2b-tooltip-area")))};d(e,n).addProp("container",d3.select("body"),null,c).addMethod("clear",function(t){return oldGraph.on(l("mouseover"),null).on(l("mouseout"),null).on(l("mousemove"),null),e}).addPropFunctor("followMouse",!1).addPropFunctor("color",null).addPropFunctor("my",null).addPropFunctor("at",null).addPropFunctor("target",null).addPropFunctor("html",null).addDispatcher(["insert","move","remove"]);return e}function E(){for(var t=arguments.length,n=Array(t),e=0;t>e;e++)n[e]=arguments[e];var r=n[0];return n.forEach(function(t){null!==r&&void 0!==r||(r=t)}),r}function R(){var t=arguments.length<=0||void 0===arguments[0]?g():arguments[0],n={},e={},r=function(t,e,r){if("y"===r){if(e.y===1/0)return t.style("opacity",0);t.style("opacity",1).attr("transform","translate(0, "+e.y+")").attr("y1",0).attr("y2",0).attr("x1",0).attr("x2",n.size.width)}else{if(e.x===1/0)return t.style("opacity",0);t.style("opacity",1).attr("transform","translate("+e.x+", 0)").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",n.size.height)}},o=function(t,e,r){var o=t.node();if(o){var a=t.node().getBoundingClientRect(),i=r.x,l=r.y,c=10;n.trackY?l+=e.y>n.size.height/2?e.y-c-a.height:e.y+c:l=d3.event.clientY-r.y>n.size.height/2?d3.event.clientY-c-a.height:d3.event.clientY+c,n.trackX?i+=e.x>n.size.width/2?e.x-c-a.width:e.x+c:i=d3.event.clientX-r.x>n.size.width/2?d3.event.clientX-c-a.width:d3.event.clientX+c,i+=window.scrollX,l+=window.scrollY,t.style("left",i+"px").style("top",l+"px")}},a=function(t,e){var r=n.title(e.points.map(function(t){return t.data}));t.select(".d2b-tooltip-title").style("display",r?"block":"none").html(r);var o=t.select(".d2b-tooltip-content"),a=o.selectAll(".d2b-tooltip-row").data(e.points),i=a.enter().append("div").attr("class","d2b-tooltip-row");a.exit().remove(),a=a.merge(i).html(function(t){return t.row}).style("border-left-color",function(t){return t.color||"transparent"})},i=function(t){var e={x:d3.event.clientX-t.x,y:d3.event.clientY-t.y},r=1/0,o=1/0,a=[];for(var i in b)if(b.hasOwnProperty(i)){var l=b[i],c=function(t){if(!l.hasOwnProperty(t))return"continue";var i=l[t],c=[];i.config.data.forEach(function(t,l){var u={data:t,x:E(i.config.x(t,l),n.x(t,l)),y:E(i.config.y(t,l),n.y(t,l)),color:E(i.config.color(t,l),n.color(t,l)),row:E(i.config.row(t,l),n.row(t,l))};if(n.trackX&&n.trackY){if(u.x===r&&u.y===o)return c.push(u);var d=Math.sqrt(Math.pow(r-e.x,2)+Math.pow(o-e.y,2)),s=Math.sqrt(Math.pow(u.x-e.x,2)+Math.pow(u.y-e.y,2));d>s&&s<n.threshold&&(r=u.x,o=u.y,a=[],c=[u])}else if(n.trackX){if(u.x===r)return c.push(u);var d=Math.abs(r-e.x),s=Math.abs(u.x-e.x);d>s&&s<n.threshold&&(r=u.x,a=[],c=[u])}else if(n.trackY){if(u.y===o)return c.push(u);var d=Math.abs(o-e.y),s=Math.abs(u.y-e.y);d>s&&s<n.threshold&&(o=u.y,a=[],c=[u])}}),a=a.concat(c)};for(var u in l){c(u)}}return a=a.sort(function(t,n){return d3.ascending(t.x,n.x)||d3.ascending(t.y,n.y)}),{x:r,y:o,points:a}},l=function(t){t.transition().duration(50).style("opacity",0).remove()},c=function(t){t.transition().duration(50).style("opacity",1)},u=function(){var t=n.selectionSvg.selectAll(".d2b-tooltip-marker-x").data(n.trackX?[e]:[]),r=t.enter().append("line").attr("class","d2b-tooltip-marker-x d2b-tooltip-marker"),o=n.selectionSvg.selectAll(".d2b-tooltip-marker-y").data(n.trackY?[e]:[]),a=o.enter().append("line").attr("class","d2b-tooltip-marker-y d2b-tooltip-marker"),i=n.selection.selectAll(".d2b-tooltip").data([e]),l=i.enter().append("div").attr("class","d2b-tooltip");l.merge(i).call(c),o.merge(a).call(c),t.merge(r).call(c),l.append("div").attr("class","d2b-tooltip-title"),l.append("div").attr("class","d2b-tooltip-content")},s=function(){n.selectionSvg.selectAll(".d2b-tooltip-marker-x").data([]).exit().call(l),n.selectionSvg.selectAll(".d2b-tooltip-marker-y").data([]).exit().call(l),n.selection.selectAll(".d2b-tooltip").data([]).exit().call(l)},p=function(t,e){var l=n.selectionSvg.selectAll(".d2b-tooltip-base").data([t]);l=l.merge(l.enter().append("rect").attr("class","d2b-tooltip-base"));var c=l.node().getBoundingClientRect();c={x:c.left,y:c.top};var d=i(c);return d.points.length?(u(),n.selectionSvg.select(".d2b-tooltip-marker-x").call(r,d,"x"),n.selectionSvg.select(".d2b-tooltip-marker-y").call(r,d,"y"),n.selection.select(".d2b-tooltip").call(a,d).call(o,d,c),void n.dispatch.call("move",n.tooltip,this,t,e)):s()},h=function(t,n){s()},f=function(t){return t+".d2b-tooltip-axis"},v=function(r,o){o&&o.select("div.d2b-tooltip-axis-area-"+t).remove(),r&&(n.selection=r.selectAll("div.d2b-tooltip-axis-area-"+t).data([e]),n.selection=n.selection.merge(n.selection.enter().append("div").attr("class","d2b-tooltip-axis-area-"+t+" d2b-tooltip-axis-area")))},y=function(r,o){o&&o.select("g.d2b-tooltip-axis-area-"+t).remove(),r&&(n.selectionSvg=r.selectAll("g.d2b-tooltip-axis-area-"+t).data([e]),n.selectionSvg=n.selectionSvg.merge(n.selectionSvg.enter().append("g").attr("class","d2b-tooltip-axis-area-"+t+" d2b-tooltip-axis-area")))},_=function(t,n){n&&n.on(f("mouseout"),null).on(f("mousemove"),null),t&&t.on(f("mouseout"),h).on(f("mousemove"),p)},b=(d(e,n).addProp("htmlContainer",d3.select("body"),null,v).addProp("svgContainer",null,null,y).addProp("tracker",d3.select("body"),null,_).addProp("size",{height:0,width:0}).addProp("trackX",!0).addProp("trackY",!1).addProp("threshold",1/0).addMethod("clear",function(t,n){return 0===arguments.length?b={}:1===arguments.length?delete b[t]:arguments.length>=2&&delete b[t][n],e}).addPropFunctor("title",null).addPropFunctor("x",function(t){return t.x}).addPropFunctor("y",function(t){return t.y}).addPropFunctor("color",null).addPropFunctor("row",null).addDispatcher(["insert","move","remove"]),{});return e.graph=function(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0],n=arguments.length<=1||void 0===arguments[1]?null:arguments[1],e=b[t]=b[t]||{},r=e[n];if(!r){r=e[n]={"interface":{},config:{}};var o=d(r["interface"],r.config);o.addProp("data",[]).addMethod("addPoint",function(t){return r.config.data.push(t),r["interface"]}).addPropFunctor("x",null).addPropFunctor("y",null).addPropFunctor("color",null).addPropFunctor("row",null)}return r["interface"]},e}function C(){function t(t,n,e,r){}var n=w(t,["zoomIn","zoomOut"]).addPropFunctor("interpolate","linear"),e=n.values(),r=n.base();return e.legend.items(function(t){return t}).active(!0).clickable(!0).dblclickable(!0),r}function S(){function t(t,o,i,s){var p=t.selection?t.selection():t,h=p.node(),f=p.datum(),v=a.radius.call(h,f,o,i),y=a.startAngle.call(h,f),_=a.endAngle.call(h,f),b=a.donutRatio.call(h,f),g=(a.at.call(h,f),a.values.call(h,f).filter(function(t){return!t.__empty__}));s.selection.select(".d2b-chart-legend").on("change",s.update).selectAll(".d2b-legend-item").on("mouseover",function(t){return d3.select(t.__arc__).each(e)}).on("mouseout",function(t){return d3.select(t.__arc__).each(r)});var x=d3.sum(g,function(t,n){return t.__value__=a.value(t,n)}),m=p.selectAll(".d2b-pie-chart").data([g]),P=m.enter().append("g").attr("class","d2b-pie-chart");m=m.merge(P).datum(function(t){return t=l.startAngle(y).endAngle(_)(t),t.forEach(function(t){t.outerRadius=v,t.innerRadius=v*b}),t}),p!==t&&(m=m.transition(t)),m.call(u);var k=p.selectAll(".d2b-pie-arc").each(function(t,n){this.outerRadius=t.outerRadius,t.data.__arc__=this,t.data.__percent__=t.data.__value__/x}).on("mouseover",e).on("mouseout",r).call(a.tooltip),F=k.selectAll(".d2b-pie-arc-percent").data(function(t){return[t]});F.enter().append("g").attr("class","d2b-pie-arc-percent").append("text").attr("y",6),k.each(function(t){var n=d3.select(this),e=n.select(".d2b-pie-arc path").node().current,r=n.select(".d2b-pie-arc-percent"),o=r.select("text").node();r.node().current=e,o.current=o.current||0}),p!==t&&(k=k.each(function(t){this.transitioning=!0}).transition(t).on("end",function(t){this.transitioning=!1})),k.select(".d2b-pie-arc-percent").call(d2b.tweenCentroid,c).select("text").call(M,function(t){return t.data.__percent__},d).style("opacity",function(t,n){return a.showPercent.call(this,t.data,n)?1:0});var w=n(h,f,v,o,i);P.attr("transform","translate("+w.x+", "+w.y+")"),m.attr("transform","translate("+w.x+", "+w.y+")")}function n(t,n,e,r,o){var i=a.center.call(t,n,r,o,e),l=a.at.call(t,n,r,o).split(" ");if(!i){switch(l={x:l[1],y:l[0]},i={},l.x){case"left":i.x=e;break;case"center":i.x=r/2;break;default:i.x=r-e}switch(l.y){case"bottom":i.y=o-e;break;case"center":i.y=o/2;break;default:i.y=e}}return i}function e(t){if(!this.transitioning){var n=d3.select(this).select("path");t.outerRadius=1.03*this.outerRadius,n.transition().duration(100).call(v,c)}}function r(t){if(!this.transitioning){var n=d3.select(this).select("path");t.outerRadius=this.outerRadius,n.transition().duration(100).call(v,c)}}var o=w(t),a=o.values(),i=o.base();a.legend.active(!0).clickable(!0).dblclickable(!0);var l=d3.pie().sort(null),c=d3.arc().outerRadius(function(t){return t.outerRadius}).innerRadius(function(t){return t.innerRadius}),u=d2b.svgPie().arc(c),d=d3.format(".0%");return o.addProp("key",function(t){return t.label},null,function(t){a.legend.key(t),u.key(t)}).addProp("tooltip",B().followMouse(!0).html(function(t){return"<b>"+a.label(t.data)+":</b> "+a.value(t.data)})).addPropFunctor("values",function(t){return t}).addPropFunctor("donutRatio",0).addPropFunctor("startAngle",0).addPropFunctor("endAngle",2*Math.PI).addPropFunctor("at","center center").addPropFunctor("showPercent",function(t,n){return t.__percent__>.03}).addPropFunctor("center",null).addPropFunctor("radius",function(t,n,e){return Math.min(n,e)/2}).addPropFunctor("sort",null).addPropFunctor("color",function(t){return I(t.label)},null,function(t){a.tooltip.color(function(n){return d3.rgb(t(n.data)).darker(.3)}),a.legend.color(t),u.color(t)}).addPropFunctor("value",function(t){return t.value},null,function(t){return l.value(t)}).addPropFunctor("label",function(t){return t.label},null,function(t){return a.legend.label(t)}),i}var L=Math.PI,N=Math.sqrt(8),W=Math.sqrt(2),X={draw:function(t,n){var e=Math.sqrt(n/(L+5/4)),r=.3125*e,o=2*Math.asin(.25),a=(L/2-o)/2,i=e/N-e*Math.cos(a),l=e*Math.sin(a);t.arc(i,l,e,-a,2*L-o-a),t.lineTo(e*(5/4-1/W),-e*(1/N+5/4-1/W)),t.lineTo(e*(5/4-1/W)-r,-e*(1/N+5/4-1/W)),t.lineTo(e*(5/4-1/W)-r,-e*(1/N+7/4-1/W)),t.lineTo(e*(7/4-1/W+1/N),-e*(1/N+7/4-1/W)),t.lineTo(e*(7/4-1/W+1/N),-e*(5/4-1/W)+r),t.lineTo(e*(5/4-1/W+1/N),-e*(5/4-1/W)+r),t.lineTo(e*(5/4-1/W+1/N),-e*(5/4-1/W)),t.closePath()}},Y={draw:function(t,n){var e=Math.sqrt(n/(L+5/4)),r=2*Math.asin(.25),o=e/4-e*Math.cos(r/2);t.arc(0,o,e,3*-L/2+r/2,L/2-r/2),t.lineTo(e/4,3*e/4),t.lineTo(3*e/4,3*e/4),t.lineTo(3*e/4,5*e/4),t.lineTo(e/4,5*e/4),t.lineTo(e/4,7*e/4),t.lineTo(-e/4,7*e/4),t.lineTo(-e/4,5*e/4),t.lineTo(3*-e/4,5*e/4),t.lineTo(3*-e/4,3*e/4),t.lineTo(-e/4,3*e/4),t.closePath()}},I=d3.scaleCategory10();t.symbolMars=X,t.symbolVenus=Y,t.mean=r,t.median=o,t.midpoint=l,t.mode=a,t.range=i,t.toDegrees=c,t.toRadians=u,t.point=s,t.plane=F,t.legend=h,t.svgPie=y,t.svgLine=_,t.svgArea=x,t.svgScatter=m,t.svgBar=P,t.svgBubblePack=k,t.modelBase=d,t.modelChart=w,t.defaultColor=I,t.id=g,t.textWrap=p,t.textWrapPX=A,t.tweenCentroid=T,t.tweenNumber=M,t.tweenArc=v,t.tooltip=B,t.tooltipAxis=R,t.stack=b,t.omit=f,t.chartTemplate=C,t.chartPie=S});