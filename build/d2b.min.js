!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.d2b=t.d2b||{})}(this,function(t){"use strict";function e(t){return"function"==typeof t?t:function(){return t}}function n(t){return null===t?NaN:+t}function r(t,r,a){var o=0,i=0;return a=e(a||1),r=e(r||function(t){return t}),t.filter(function(t){return!isNaN(n(a(t)))&&!isNaN(n(r(t)))}).forEach(function(t){var e=a(t),n=r(t);o+=e,i+=n*e}),t.length&&o?i/o:void 0}function a(t,a,o){o=e(o||1),a=e(a||function(t){return t});var i,l=[],c=t.filter(function(t){return 0!==o(t)&&!isNaN(n(o(t)))&&!isNaN(n(a(t)))}).sort(function(t,e){return d3.ascending(a(t),a(e))});i=Math.round(d3.sum(c,function(t){return o(t)})/2*1e12)/1e12;var d=0,u=!1;return c.forEach(function(t){u&&(l.push(a(t)),u=!1),d+=o(t),d===i&&(l.push(a(t)),u=!0),d>i&&0===l.length&&l.push(a(t))}),t.length?r(l):void 0}function o(t,a,o){o=e(o||1),a=e(a||function(t){return t});var i=[],l=0,c={};return t.forEach(function(t){var e=n(a(t));isNaN(a(t))||(c[e]=c[e]||0,c[e]+=o(t),c[e]>l?(l=c[a(t)],i=[a(t)]):c[a(t)]==l&&i.push(a(t)))}),t.length?r(i):void 0}function i(t,n){n=e(n||function(t){return t});var r=d3.extent(t,n);return t.length?r[1]-r[0]:void 0}function l(t,n){return n=e(n||function(t){return t}),t.length?d3.mean(d3.extent(t,n)):void 0}function c(t){return t*(Math.PI/180)}function d(t){return t*(180/Math.PI)}function u(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=arguments[2],o=function(e,n){return function(a){if(!arguments.length)return r[e];var o=r[e];return r[e]=a,n&&n(a,o),t}},i=function(t){return function(e){return r[t]}},l=function(n,a){return function(o){if(!arguments.length)return r[n];var i=r[n];return r[n]=e(o),a&&a(o,i),t}},c={base:function(){return t},values:function(){return r},removeProp:function(e){return-1!==a.indexOf(e)?(console.error("Cannot remove "+e+" property or value"),c):(r[e]=null,t[e]=null,c)},addProp:function(e){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a=arguments.length<=2||void 0===arguments[2]?o(e):arguments[2],i=arguments[3];return r[e]||t[e]?(console.error(e+" property is already defined."),c):(a=a||o(e,i),r[e]=n,t[e]=a,i&&i(n),c)},addPropGet:function(e){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a=arguments.length<=2||void 0===arguments[2]?i(e):arguments[2];return r[e]||t[e]?(console.error(e+" property is already defined."),c):(r[e]=n,t[e]=a,c)},addMethod:function(e,n){return t[e]?(console.error(e+" method is already defined."),c):(t[e]=n,c)},addPropFunctor:function(n){var a=arguments.length<=1||void 0===arguments[1]?null:arguments[1],o=arguments.length<=2||void 0===arguments[2]?l(n):arguments[2],i=arguments[3];return r[n]||t[n]?(console.error(n+" property is already defined."),c):(o=o||l(n,i),a=e(a),i&&i(a),r[n]=a,t[n]=o,c)},addDispatcher:function(e){var a=arguments.length<=1||void 0===arguments[1]?"on":arguments[1],o=arguments.length<=2||void 0===arguments[2]?"dispatch":arguments[2];return t[a]?(console.error(a+" property is already defined."),c):r[o]?(console.error(o+" value is already defined."),c):(t[a]=function(e,n){return 0===arguments.length?r[o]:1===arguments.length?r[o].on(e):(r[o].on(e,n),t)},r[o]=d3.dispatch.apply(n,e),c)}};return c}function s(){function t(t,e){return i.empty.call(this,t,e)?0:1}function e(t,e){var n=i.size.call(this,t,e),r=i.empty.call(this,t,e);return c.size(r?n:2.5*n).call(this,t,e)}function n(t,e){var n=i.size.call(this,t,e),r=i.empty.call(this,t,e);return c.size(r?n/3:n).call(this,t,e)}function r(t,e){var n=i.size.call(this,t,e);return c.size(n).call(this,t,e)}function a(t,r){var a=(i.size.call(this,t,r),i.empty.call(this,t,r));d3.select(this).select("path.d2b-point-back").transition().duration(100).attr("d",e),d3.select(this).select("path.d2b-point-front").transition().duration(100).style("opacity",a?.5:1).attr("d",n)}function o(t,e){var a=(i.size.call(this,t,e),i.empty.call(this,t,e));d3.select(this).select("path.d2b-point-back").transition().duration(100).attr("d",r),d3.select(this).select("path.d2b-point-front").transition().duration(100).style("opacity",a?0:1).attr("d",n)}var i={},l=function d(e){var l=e.selection?e.selection():e,c=l.selectAll("path.d2b-point-back").data(function(t){return[t]});c.enter().append("path").attr("class","d2b-point-back").attr("d",r).style("fill-opacity",0).style("stroke",i.stroke).style("stroke-width",i.strokeWidth);e!==l&&(c=c.transition(e)),c.attr("d",r).style("stroke",i.stroke).style("stroke-width",i.strokeWidth);var u=l.selectAll("path.d2b-point-front").data(function(t){return[t]});u.enter().append("path").attr("class","d2b-point-front").attr("d",n).style("opacity",t).style("fill",i.fill).style("stroke",i.stroke).style("stroke-width",i.strokeWidth);return e!==l&&(u=u.transition(e)),u.attr("d",n).style("opacity",t).style("fill",i.fill).style("stroke",i.stroke).style("stroke-width",i.strokeWidth),l.each(function(t,e){var n=i.active.call(this,t,e);d3.select(this).on("mouseover.d2b-point",n?a:null).on("mouseout.d2b-point",n?o:null)}),d},c=d3.symbol();u(l,i).addPropFunctor("size",150,null,function(t){return c.size(t)}).addPropFunctor("type",d3.symbolCircle,null,function(t){return c.type(t)}).addPropFunctor("active",!1).addPropFunctor("empty",!1).addPropFunctor("fill","steelblue").addPropFunctor("stroke",function(t,e){return d3.rgb(i.fill.call(this,t,e)).darker(.3)}).addPropFunctor("strokeWidth","1px");return l}function p(t){var n=arguments.length<=1||void 0===arguments[1]?function(t){return t.label}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?1/0:arguments[2],a=arguments.length<=3||void 0===arguments[3]?"start":arguments[3];n=e(n),t.each(function(t,e){var o=d3.select(this),i=(""+n.call(this,t,e)).split(/\s+/).reverse(),l=void 0,c=[],d=[i.pop()],u=1.1,s=+o.attr("x"),p=+o.attr("y"),h=parseFloat(o.attr("dy"))||0;for(-1===o.html().indexOf("tspan")&&o.text("");l=i.pop();)d.join(" ").length+l.length>r&&(c.push(d),d=[]),d.push(l);c.push(d);var f=o.selectAll("tspan").data(c),y=(c.length-1)*u,v="end"===a?y:"middle"===a?y/2:0;f.merge(f.enter().append("tspan")).text(function(t){return t.join(" ")}).attr("x",s).attr("y",p).attr("dy",function(t,e){return h+e*u-v+"em"})})}function h(){function t(t,r){t.selectAll(".d2b-legend-item").on("click",function(n,a){e.call(this,n,a,t,r)}).on("dblclick",function(e,a){n.call(this,e,a,t,r)})}function e(t,e,n,a){var i=r.clickable.call(this,t,e),l=r.allowEmptied.call(n.node(),n.datum(),a),c=n.datum();n.node();if(i){t.__empty__=!t.__empty__;var d=d3.select(this),u=n.selectAll(".d2b-legend-item"),s=!0;c.forEach(function(t){return s=t.__empty__?s:!1}),s&&!l?(u.each(function(t){return t.__empty__=!1}).transition().duration(100).call(o),u.filter(function(e){return e!=t}).dispatch("change")):d.transition().duration(100).call(o),d.dispatch("change",{bubbles:!0})}}function n(t,e,n,a){var i=r.dblclickable.call(this,t,e),l=n.datum();if(i){l.forEach(function(t){return t.__empty__=!0}),t.__empty__=!1;var c=n.selectAll(".d2b-legend-item");c.transition().duration(100).call(o),c.filter(function(e){return e!=t}).dispatch("change"),d3.select(this).dispatch("change",{bubbles:!0})}}var r={},a=function l(e){return e.each(function(n,a){var l=d3.select(this),c=r.size.call(this,n,a),d=r.maxSize.call(this,n,a),u=r.orient.call(this,n,a),s=r.maxTextLength.call(this,n,a),h=r.items.call(this,n,a);o.size(1.5*Math.pow(c/2,2)).strokeWidth(.1*c);var f=l.selectAll(".d2b-legend").data([h]);f=f.merge(f.enter().append("g").attr("class","d2b-legend"));var y=f.selectAll(".d2b-legend-item").data(function(t){return t},r.key),v=y.enter().append("g").attr("class","d2b-legend-item").style("opacity",0);v.append("g").append("text");var _=y.exit();y=y.merge(v).style("cursor",function(t,e){var n=r.clickable.call(this,t,e),a=r.dblclickable.call(this,t,e);return n||a?"pointer":"auto"}),l.call(t,a);var g=y.select("g").attr("transform","translate("+c/2+", "+c/2+")"),b=y.select("text").attr("transform","translate("+c/1.5+", "+c/3+")").style("font-size",c+"px").call(p,r.label,s);e.selection&&(_=_.transition(e).style("opacity",0),y=y.transition(e),g=g.transition(e),b=b.transition(e)),_.remove(),g.call(o);var x=0;b.each(function(){x=Math.max(x,this.getBBox().width)}),x+=c;var m={x:c,y:5};v.call(i[u],this,m,c,d,x),this.computedWidth=0,this.computedHeight=0,y.style("opacity",1).call(i[u],this,m,c,d,x)}),l},o=s().empty(function(t){return t.__empty__}),i={horizontal:function(t,e,n,r,a,o){var i=0,l=0,c=0;t.attr("transform",function(){var t=d3.select(this),d=r*t.selectAll("tspan").size(),u=t.select("text").node().getBBox().width;i+o>a.width&&(i=0,l+=c+n.y,c=0);var s="translate("+i+", "+l+")";return c=Math.max(c,d),e.computedWidth=Math.max(e.computedWidth,i+u+1.5*r),i+=o+n.x,s}),e.computedHeight=l+c},vertical:function(t,e,n,r,a){var o=0,i=0,l=0;t.attr("transform",function(){var t=d3.select(this),c=r*t.selectAll("tspan").size(),d=t.select("text").node().getBBox().width;i+c>a.height&&(o+=l+n.x+r,i=0,l=0);var u="translate("+o+", "+i+")";return l=Math.max(l,d),e.computedHeight=Math.max(e.computedHeight,i+c),i+=c+n.y,u}),e.computedWidth=o+l+1.5*r}};u(a,r).addPropFunctor("items",function(t){return t}).addPropFunctor("size",12).addPropFunctor("maxSize",{width:960,height:500}).addPropFunctor("orient","vertical").addPropFunctor("maxTextLength",1/0).addPropFunctor("allowEmptied",!1).addPropFunctor("key",function(t,e){return e}).addPropFunctor("clickable",!1).addPropFunctor("dblclickable",!1).addPropFunctor("label",function(t){return t.label}).addPropFunctor("active",!1,null,function(t){return o.active(t)}).addPropFunctor("symbol",d3.symbolCircle,null,function(t){return o.type(t)}).addPropFunctor("color",function(t){return X(t.label)},null,function(t){return o.fill(t)}).addMethod("computedSize",function(t){var e=t.node?t.node():t;return e?{width:e.computedWidth,height:e.computedHeight}:{width:0,height:0}});return a}function f(t,e){var n={};for(var r in t)"function"!=typeof t[r]&&e.indexOf(r)<0&&(n[r]=t[r]);return n}function y(t,e){return t.selection?void t.attrTween("d",function(t){var n=this;t=f(t,["data"]),this.current=this.current||t;var r=d3.interpolate(this.current,t);return function(t){return n.current=r(t),e(n.current)}}):t.attr("d",function(t){return this.current=f(t,["data"]),e(t)})}function v(){function t(t,r,a){var o=void 0;return(o=e(t,r,a))?{startAngle:o.endAngle,endAngle:o.endAngle}:(o=n(t,r,a))?{startAngle:o.startAngle,endAngle:o.startAngle}:{startAngle:0,endAngle:0}}function e(t,e,n){for(var a=e.length;--t>=0;)for(var o=r.key(n[t].data,t),i=0;a>i;++i)if(r.key(e[i].data,i)===o)return e[i]}function n(t,e,n){for(var a=n.length,o=e.length;++t<a;)for(var i=r.key(n[t].data,t),l=0;o>l;++l)if(r.key(e[l].data,l)===i)return e[l]}var r={},a=function o(e){var n=e.selection?e.selection():e;return n.each(function(a,o){var i=d3.select(this),l=i.selectAll(".d2b-pie-arc"),c=l.data();l=l.data(r.values,function(t,e){return r.key(t.data,e)});var d=l.enter().append("g").attr("class","d2b-pie-arc"),u=l.exit(),s=l.merge(d).order();d.append("path").attr("fill",function(t,e){return r.color.call(this,t.data,e)});var p=s.data();d.select("path").each(function(e,n){this.current=t(n,c,p)}),u.datum(function(e,n){var r=t(n,p,c);return r.data=e.data,r}),e!==n&&(u=u.transition(e),s=s.transition(e)),s.select("path").call(y,r.arc).attr("fill",function(t,e){return r.color.call(this,t.data,e)}),u.remove().select("path").call(y,r.arc)}),o};u(a,r).addProp("key",function(t){return t.label}).addProp("arc",d3.arc().innerRadius(100).outerRadius(200)).addPropFunctor("values",function(t){return t}).addPropFunctor("color",function(t){return X(t.label)});return a}function _(){var t={},e=function n(e){var r=e.selection?e.selection():e,a=r.selectAll(".d2b-line-graph").data(function(t){return t},t.key),o=a.enter().append("g").attr("class","d2b-line-graph").style("opacity",0);o.append("path").attr("class","d2b-line");var i=a.merge(o).order(),l=a.exit(),c=i.select(".d2b-line");return e!==r&&(i=i.transition(e),l=l.transition(e),c=c.transition(e)),i.style("opacity",1),l.style("opacity",0).remove(),c.style("stroke",t.color).attr("d",function(e,n){var r=this,a=t.x.call(this,e,n),o=t.y.call(this,e,n),i=t.color.call(this,e,n),l=t.values.call(this,e,n),c=t.tooltipGraph.call(this,e,n),d=t.shift.call(this,e,n);return null===d&&(d=a.bandwidth?a.bandwidth()/2:0),c&&c.data(l).x(function(e,n){return a(t.px(e,n))+d}).y(function(e,n){return o(t.py(e,n))}).color(i),t.line.x(function(e,n){return a(t.px.call(r,e,n))+d}).y(function(e,n){return o(t.py.call(r,e,n))})(l)}),n};u(e,t).addProp("line",d3.line()).addProp("x",d3.scaleLinear(),function(n){return arguments.length?(n.domain?t.x=function(){return n}:t.x=n,e):t.x}).addProp("y",d3.scaleLinear(),function(n){return arguments.length?(n.domain?t.y=function(){return n}:t.y=n,e):t.y}).addPropFunctor("tooltipGraph",function(t){return t.tooltipGraph}).addPropFunctor("shift",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values}).addPropFunctor("color",function(t){return X(t.label)}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y});return e}function g(){var t={},e=function(e){var n=this,r=e;e=e.map(t.values);var a=[],o=e.map(function(e,r){var o={};return e.forEach(function(e,r){var i=t.x.call(n,e,r);a.push(i),o[i]=t.y.call(n,e,r)}),o});a=d3.set(a).values();var i=a.reduce(function(t,e,n){return t[e]=n,t},{}),l=d3.range(0,e.length),c=a.map(function(t,e){return o.map(function(e,n){return e[t]||0})}),d=t.stack.keys(l).value(function(t,e){return t[e]||0})(c);return e.forEach(function(e,r){e.forEach(function(e,a){var o=t.x.call(n,e,a),l=d[r][i[o]];t.out.call(n,e,l[0],l[1],o)})}),r};u(e,t).addProp("stack",d3.stack()).addPropFunctor("values",function(t){return t}).addPropFunctor("x",function(t){return t.x}).addPropFunctor("y",function(t){return t.y}).addPropFunctor("out",function(t,e,n){t.y0=e,t.y1=n});return e}function b(){return Math.random().toString(36).substr(2,9)}function x(){var t={},e=function a(e){var o=e.selection?e.selection():e,i=o.selectAll(".d2b-area-graph").data(function(t){return t},t.key),l=i.enter().append("g").attr("class","d2b-area-graph").style("opacity",0);l.append("path").attr("class","d2b-area");var c=i.merge(l).order(),d=i.exit(),u=c.select(".d2b-area");return e!==o&&(c=c.transition(e),d=d.transition(e),u=u.transition(e)),o.each(function(t,e){r.entries(t).forEach(function(t){return n(t.values)})}),c.style("opacity",1),d.style("opacity",0).remove(),u.style("fill",t.color).attr("d",function(e,n){var r=t.x.call(this,e,n),a=t.y.call(this,e,n),o=t.values.call(this,e,n),i=t.color.call(this,e,n),l=t.tooltipGraph.call(this,e,n),c=t.shift.call(this,e,n);return null===c&&(c=r.bandwidth?r.bandwidth()/2:0),l&&l.data(o).x(function(t,e){return r(t.__x__)+c}).y(function(t,e){return a(t.__y1__)}).color(i),t.area.x(function(t,e){return r(t.__x__)+c}).y0(function(t,e){return a(t.__y0__)}).y1(function(t,e){return a(t.__y1__)})(o)}),a},n=g().out(function(t,e,n,r){t.__x__=r,t.__y0__=e,t.__y1__=n}),r=d3.nest().key(function(e){var n=t.stackBy(e);return n!==!1&&null!==n?n:b()});u(e,t).addProp("area",d3.area()).addProp("stack",d3.stack(),null,function(t){return n.stack(t)}).addProp("x",d3.scaleLinear(),function(n){return arguments.length?(n.domain?t.x=function(){return n}:t.x=n,e):t.x}).addProp("y",d3.scaleLinear(),function(n){return arguments.length?(n.domain?t.y=function(){return n}:t.y=n,e):t.y}).addPropFunctor("tooltipGraph",function(t){return t.tooltipGraph}).addPropFunctor("shift",null).addPropFunctor("stackBy",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values},null,function(t){return n.values(t)}).addPropFunctor("color",function(t){return X(t.label)}).addPropFunctor("px",function(t){return t.x},null,function(t){return n.x(t)}).addPropFunctor("py",function(t){return t.y},null,function(t){return n.y(t)});return e}function m(){function t(t,n,r,a){t.attr("transform",function(t,o){var i=n(e.px.call(this,t,o))+a,l=r(e.py.call(this,t,o));return"translate("+i+", "+l+")"})}var e={},n=function r(n){var a=n.selection?n.selection():n,o=a.selectAll(".d2b-scatter-graph").data(function(t){return t},e.key),i=o.enter().append("g").attr("class","d2b-scatter-graph").style("opacity",0),l=o.merge(i).order(),c=o.exit();return n!==a&&(l=l.transition(n),c=c.transition(n)),l.style("opacity",1),c.style("opacity",0).remove(),l.each(function(r,o){var i=d3.select(this),l=e.x.call(this,r,o),c=e.y.call(this,r,o),d=e.color.call(this,r,o),u=e.symbol.call(this,r,o),s=e.values.call(this,r,o),p=e.tooltipGraph.call(this,r,o),h=e.shift.call(this,r,o);null===h&&(h=l.bandwidth?l.bandwidth()/2:0),p&&p.data(s).x(function(t,n){return l(e.px(t,n))+h}).y(function(t,n){return c(e.py(t,n))}).color(function(t,n){return e.pcolor(t,n)||d}),e.point.fill(function(t,n){return e.pcolor.call(this,t,n)||d}).type(function(t,n){return e.psymbol.call(this,t,n)||u}).size(e.psize);var f=i.selectAll(".d2b-scatter-point").data(s,e.pkey),y=f.enter().append("g").attr("class","d2b-scatter-point"),v=f.merge(y).order(),_=f.exit();n!==a&&(v=v.transition(n),_=_.transition(n)),y.style("opacity",0).call(t,l,c,h),v.style("opacity",1).call(e.point).call(t,l,c,h),_.style("opacity",0).remove()}),r};u(n,e).addProp("point",s().active(!0)).addProp("x",d3.scaleLinear(),function(t){return arguments.length?(t.domain?e.x=function(){return t}:e.x=t,n):e.x}).addProp("y",d3.scaleLinear(),function(t){return arguments.length?(t.domain?e.y=function(){return t}:e.y=t,n):e.y}).addPropFunctor("tooltipGraph",function(t){return t.tooltipGraph}).addPropFunctor("shift",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values}).addPropFunctor("color",function(t){return X(t.label)}).addPropFunctor("symbol",function(t){return d3.symbolCircle}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y}).addPropFunctor("pcolor",function(t){return null}).addPropFunctor("psymbol",null).addPropFunctor("pkey",function(t,e){return e}).addPropFunctor("psize",function(t){return 25});return n}function P(){function t(t){var e={};return function(n,r,a,o){var i=a-r,l=e[o]=e[o]||[0,0];n.__stackIndex__=t,n.__base__=o,i>0?n.__extent__=[l[0],l[0]+=i]:n.__extent__=[l[1],l[1]+=i]}}function e(t,e,n){t.attr("transform",function(t){return"translate("+[e[n.x](t),e[n.y](t)]+")"})}function n(t,e){var n=[];t.forEach(function(a,o){var i=r[e.x].call(t,a,o),l=r.values.call(t,a,o);l.forEach(function(t,o){var l=r[e.px].call(a,t,o);n.push(i(l))})}),n.sort(d3.ascending);for(var a=1/0,o=0;o<n.length-1;o++)n[o+1]!==n[o]&&(a=Math.min(n[o+1]-n[o],a));return a}var r={},a=function l(a){var c=a.selection?a.selection():a;return c.each(function(l,d){var u={};u="horizontal"===r.orient.call(this,l,d)?{rotate:!0,px:"py",py:"px",x:"y",y:"x",w:"height",h:"width"}:{rotate:!1,px:"px",py:"py",x:"x",y:"y",w:"width",h:"height"},o.x(r[u.px]).y(r[u.py]);var s=i.entries(l);s.forEach(function(e,n){return o.out(t(n))(e.values)});var p=(1-r.padding.call(this,l,d))*(r.bandwidth.call(this,l,d)||n(l,u)),h=p/s.length,f=h*r.groupPadding.call(this,l,d),y=d3.select(this).selectAll(".d2b-bar-graph").data(l,r.key),v=y.enter().append("g").attr("class","d2b-bar-graph").style("opacity",0),_=y.merge(v).order(),g=y.exit();a!==c&&(_=_.transition(a),g=g.transition(a)),_.style("opacity",1),g.style("opacity",0).remove(),_.each(function(t,n){var o=d3.select(this),i=r.color.call(this,t,n),l=r[u.x].call(this,t,n),d=r[u.y].call(this,t,n),s=r.values.call(this,t,n),y=r.tooltipGraph.call(this,t,n),v=r.shift.call(this,t,n);null===v&&(v=l.bandwidth?l.bandwidth()/2:0);var _=o.selectAll(".d2b-bar-group").data(s,r.pkey),g=_.enter().append("g").attr("class","d2b-bar-group");g.append("rect");var b=_.merge(g).order(),x=_.exit();b.each(function(t,e){var n=r.pcentered.call(this,t,e),a=n?v-p/4:v-p/2+t.__stackIndex__*h+f;t.__basepx__=l(t.__base__)+a,t.__extentpx__=[d(t.__extent__[0]),d(t.__extent__[1])],t.__extentpx__.sort(d3.ascending)}),y&&y.data(s)[u.x](function(t,e){return l(r[u.px](t,e))+v})[u.y](function(t,e){return d(t.__extent__[1])}).color(function(t,e){return r.pcolor(t,e)||i}),a!==c&&(b=b.transition(a),x=x.transition(a)),g.attr("class","d2b-bar-group").style("opacity",0).call(e,{x:function(t){return t.__basepx__},y:function(t){return d(0)}},u).select("rect").attr("fill",function(t,e){return r.pcolor.call(this,t,e)||i}).attr(u.w,h-2*f).attr(u.h,0),b.style("opacity",1).call(e,{x:function(t){return t.__basepx__},y:function(t){return t.__extentpx__[0]}},u).select("rect").attr("fill",function(t,e){return r.pcolor.call(this,t,e)||i}).attr(u.w,h-2*f).attr(u.h,function(t){return t.__extentpx__[1]-t.__extentpx__[0]}),x.style("opacity",0).remove()})}),l},o=g(),i=d3.nest().key(function(t){var e=r.stackBy(t);return e!==!1&&null!==e?e:b()});u(a,r).addProp("stack",d3.stack(),null,function(t){return o.stack(t)}).addProp("x",d3.scaleLinear(),function(t){return arguments.length?(t.domain?r.x=function(){return t}:r.x=t,a):r.x}).addProp("y",d3.scaleLinear(),function(t){return arguments.length?(t.domain?r.y=function(){return t}:r.y=t,a):r.y}).addPropFunctor("tooltipGraph",function(t){return t.tooltipGraph}).addPropFunctor("orient","vertical").addPropFunctor("padding",.5).addPropFunctor("groupPadding",0).addPropFunctor("bandwidth",null).addPropFunctor("shift",null).addPropFunctor("stackBy",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values},null,function(t){return o.values(t)}).addPropFunctor("color",function(t){return X(t.label)}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y}).addPropFunctor("pcentered",!1).addPropFunctor("pcolor",null).addPropFunctor("pkey",function(t,e){return e});return a}function k(){function t(t){var e=0,n=0,r=300;t.selectAll(".d2b-bubble-indicator.d2b-active").attr("transform",function(){var t=this.getBBox();t.width+e>r&&e>0&&(e=0,n+=t.height+5);var a="translate("+e+", "+n+")";return e+=t.width+5,a})}function e(t,e,n,r,a,o){t.each(function(t,o){var i=d3.select(this),l=i.attr("transform");l||i.attr("transform","translate("+(n(t.__parent__?t.__parent__.__x__:t.__x__)+a+",")+(r(t.__parent__?t.__parent__.__y__:t.__y__)+")")),t.__children__?i.attr("cursor","pointer").on("click",function(){d3.select(this).dispatch("change",{bubbles:!0,cancelable:!0})}).on("change",function(t){return t.__expanded__=!t.__expanded__}):i.attr("cursor","").on("click",null),e&&(i=i.transition(e)),t.__expanded__?i.style("opacity",0).selectAll("*").remove():i.style("opacity",1).call(c.point),i.attr("transform","translate("+(n(t.__x__)+a)+", "+r(t.__y__)+")")})}function n(t,e,n,r,a,o){t.each(function(t,e){var n=d3.select(this).classed("d2b-active",t.__expanded__);if(!t.__expanded__)return n.selectAll("rect, text").remove();var r=n.select("rect"),a=n.select("text");r.size()||(r=n.append("rect")),a.size()||(a=n.append("text")),a.text(c.pindicator.call(this,t,e).substring(0,5)).attr("x",5);var o=a.node().getBBox();a.attr("y",o.height/1.35),r.on("click",function(){d3.select(this).dispatch("change",{bubbles:!0,cancelable:!0})}).on("change",function(t){return t.__expanded__=!t.__expanded__}).attr("width",o.width+10).attr("height",o.height).style("fill",c.point.fill()).style("stroke",c.point.stroke())})}function a(t,r,o,i,l,d,u,s){var p=arguments.length<=8||void 0===arguments[8]?0:arguments[8],h=t.selectAll(".d2b-bubble-pack.d2b-depth-"+p).data(r,c.pkey),f=h.enter().append("g").attr("class","d2b-bubble-pack d2b-depth-"+p),y=h.merge(f);f.append("g").attr("class","d2b-bubble-point").style("opacity",0),e(y.select(".d2b-bubble-point"),o,i,l,d,u),f.append("g").attr("class","d2b-bubble-indicator"),n(y.select(".d2b-bubble-indicator"),o,i,l,d,u),y.each(function(t,e){var n=d3.select(this);t.__children__&&t.__expanded__?a(n,t.__children__,o,i,l,d,u,s,p+1):(s&&s(t),n.selectAll(".d2b-bubble-pack").transition(o).remove().select(".d2b-bubble-point").style("opacity",0).attr("transform","translate("+(i(t.__x__)+d)+", "+l(t.__y__)+")"))});var v=h.exit();o&&(v=v.transition(o)),v.remove()}function o(t){var e=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=c.pchildren(t);t.__leaves__=[],t.__depth__=e,n&&n.length?(t.__children__=n,n.forEach(function(n){o(n,e+1),n.__parent__=t,t.__leaves__=t.__leaves__.concat(n.__leaves__)})):(t.__x__=c.px(t),t.__y__=c.py(t),t.__size__=c.psize(t),t.__leaves__.push(t))}function i(t){t.__x__=(c.tendancy.x||c.tendancy)(t.__leaves__,function(t){return t.__x__},function(t){return t.__size__}),t.__y__=(c.tendancy.y||c.tendancy)(t.__leaves__,function(t){return t.__y__},function(t){return t.__size__}),t.__size__=d3.sum(t.__leaves__,function(t){return t.__size__}),t.__children__&&t.__children__.length&&t.__children__.forEach(function(t){return i(t)})}function l(t){o(t),i(t)}var c={},d=function p(e){var n=e.selection?e:null,r=e.selection?e.selection():e,o=r.selectAll(".d2b-bubble-pack-graph").data(function(t){return t},c.key),i=o.enter().append("g").attr("class","d2b-bubble-pack-graph"),d=o.merge(i).order(),u=o.exit();return n&&(d=d.transition(n),u=u.transition(n)),d.style("opacity",1),u.style("opacity",0).remove(),e.each(function(e,r){var o=d3.select(this),i=o.selectAll(".d2b-bubble-pack-graph");o.on("change",function(){o.transition().duration(c.duration).call(p)}),i.each(function(t,e){var r=d3.select(this),i=c.x.call(this,t,e),d=c.y.call(this,t,e),u=c.color.call(this,t,e),s=c.symbol.call(this,t,e),p=c.tooltipGraph.call(this,t,e);t.values.forEach(l);var h=c.shift.call(this,t,e);null===h&&(h=i.bandwidth?i.bandwidth()/2:0),c.point.fill(function(t,e){return c.pcolor.call(this,t,e)||u}).type(function(t,e){return c.psymbol.call(this,t,e)||s});var f=p?p.clear().x(function(t,e){return i(t.__x__)+h}).y(function(t,e){return d(t.__y__)}).color(function(t,e){return c.pcolor(t,e)||u}).addPoint:null;a(r,t.values,n,i,d,h,o,f)}),t(o)}),p};u(d,c).addProp("point",s().active(!0),null,function(t){c.point.size(function(t){return 100*t.__size__}).active(function(t){return!!t.__children__})}).addProp("x",d3.scaleLinear(),function(t){return arguments.length?(t.domain?c.x=function(){return t}:c.x=t,d):c.x}).addProp("y",d3.scaleLinear(),function(t){return arguments.length?(t.domain?c.y=function(){return t}:c.y=t,d):c.y}).addProp("tendancy",r).addProp("duration",250).addPropFunctor("tooltipGraph",function(t){return t.tooltipGraph}).addPropFunctor("shift",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values}).addPropFunctor("color",function(t){return X(t.label)}).addPropFunctor("symbol",function(t){return d3.symbolCircle}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y}).addPropFunctor("psize",function(t){return t.size}).addPropFunctor("pchildren",function(t){return t.children}).addPropFunctor("pcolor",function(t){return null}).addPropFunctor("psymbol",null).addPropFunctor("pindicator",function(t){return t.label}).addPropFunctor("pkey",function(t,e){return e});return d}function F(){function t(t,e,n,r,a){var o=[],i=[],c=t.data;c&&(l(t,c,e,n,r),o=[c],t.info.showGrid&&(i=[c])),t.update=n.selectAll(".d2b-"+t.type+"-axis").data(o),t.enter=t.update.enter().append("g").attr("class","d2b-axis d2b-"+t.type+"-axis"),t.labelEnter=t.enter.append("text").attr("class","d2b-axis-label"),t.svg=t.enter.merge(t.update),t.label=t.svg.select(".d2b-axis-label"),t.update.exit().remove(),t.gridUpdate=n.selectAll(".d2b-"+t.type+"-grid").data(i),t.gridEnter=t.gridUpdate.enter().append("g").attr("class","d2b-grid d2b-"+t.type+"-grid"),t.gridUpdate.exit().remove(),t.grid=t.gridEnter.merge(t.gridUpdate),a&&(t.svg=t.svg.transition(a),t.update=t.update.transition(a),t.grid=t.grid.transition(a),t.gridUpdate=t.gridUpdate.transition(a),t.label=t.label.transition(a))}function e(t,e,n,r){t.data&&(o(t),i(t,e),t.enter.call(t.info.axis).call(y,t).attr("transform","translate("+n+", "+r+")"),t.update.call(t.info.axis).attr("transform","translate("+n+", "+r+")"),t.svg.call(y,t).on("end",function(){t.svg.call(y,t)}))}function n(t,e,n){t.data&&(a(t,n),i(t,e),t.gridUpdate.call(t.info.axis).selectAll(".tick text").remove(),t.gridEnter.call(t.info.axis).selectAll(".tick text").remove())}function r(t,e){t.data&&(t.labelEnter.text(t.info.label).attr("x",h(t,e)).attr("y",s(t)).attr("text-anchor",c(t)),t.label.text(t.info.label).attr("x",h(t,e)).attr("y",s(t)).attr("text-anchor",c(t)))}function a(t,e){if(t.data)switch(t.type){case"x":return t.info.axis.tickSize("inner"===t.info.orient?-e:e);case"x2":return t.info.axis.tickSize("inner"===t.info.orient?e:-e);case"y":return t.info.axis.tickSize("inner"===t.info.orient?e:-e);case"y2":return t.info.axis.tickSize("inner"===t.info.orient?-e:e)}}function o(t){t.data&&t.info.axis.tickSizeOuter(0).tickSizeInner(t.info.tickSize)}function i(t,e){t.data&&t.info.axis.scale().range([0,e])}function l(t,e,n,r,a){if(t.data){var l=t.info={};l.axis=g.axis(e,n),l.orient=g.orient(e,n)||"outer",l.wrapLength=g.wrapLength(e,n)||1/0,l.label=g.label(e,n)||"",l.labelOrient=g.labelOrient(e,n)||"outer center",l.tickSize=g.tickSize(e,n),l.showGrid=g.showGrid(e,n),l.labelOrient1=l.labelOrient.split(" ")[0],l.labelOrient2=l.labelOrient.split(" ")[1],l.wrapAnchor=d(t),o(t),i(t,a);var c=r.append("g").attr("class","d2b-axis d2b-"+t.type+"-axis").call(l.axis).call(y,t);l.axisBox=c.node().getBBox();var u=c.append("text").attr("class","d2b-axis-label d2b-"+t.type+"-label").text(l.label);l.labelBox=u.node().getBBox(),c.remove()}}function c(t){if(t.data){var e=t.info,n=["y","y2"].indexOf(t.type)>-1;return"start"===e.labelOrient2&&n?"end":"end"!==e.labelOrient2||n?"middle"===e.labelOrient2?"middle":"start":"end"}}function d(t){if(t.data)switch(t.type){case"x":return"inner"===t.info.orient?"end":"start";case"x2":return"outer"===t.info.orient?"end":"start";case"y":case"y2":return"middle";default:return"start"}}function s(t){if(t.data){var e=t.info;switch(t.type+" "+e.orient+" "+e.labelOrient1){case"x inner inner":case"x2 outer outer":return-e.axisBox.height-b;case"x inner outer":case"x2 outer inner":return e.labelBox.height+b;case"x outer inner":case"x2 inner outer":case"y inner outer":case"y2 outer inner":return-b;case"x outer outer":case"x2 inner inner":return e.labelBox.height+e.axisBox.height+b;case"y inner inner":case"y2 outer outer":return e.labelBox.height+e.axisBox.width+b;case"y outer inner":case"y2 inner outer":return e.labelBox.height+b;case"y outer outer":case"y2 inner inner":return-e.axisBox.width-b}}}function h(t,e){return t.data?"start"===t.info.labelOrient2?0:"middle"===t.info.labelOrient2?e/2:e:void 0}function f(t){var e={top:0,left:0,right:0,bottom:0};return t.x.data&&("outer"===t.x.info.orient&&(e.bottom+=t.x.info.axisBox.height),"outer"===t.x.info.labelOrient1&&(e.bottom+=t.x.info.labelBox.height+b)),t.x2.data&&("outer"===t.x2.info.orient&&(e.top+=t.x2.info.axisBox.height),"outer"===t.x2.info.labelOrient1&&(e.top+=t.x2.info.labelBox.height)),t.y.data&&("outer"===t.y.info.orient&&(e.left+=t.y.info.axisBox.width),"outer"===t.y.info.labelOrient1&&(e.left+=t.y.info.labelBox.height)),t.y2.data&&("outer"===t.y2.info.orient&&(e.right+=t.y2.info.axisBox.width),"outer"===t.y2.info.labelOrient1&&(e.right+=t.y2.info.labelBox.height+b)),e.top=Math.max(e.top,10),e.bottom=Math.max(e.bottom,10),e.left=Math.max(e.left,10),e.right=Math.max(e.right,10),e}function y(t,e){if(e.data){var n=e.info.wrapLength,r=e.info.wrapAnchor;t.selectAll(".tick text").each(function(){var t=d3.select(this);-1===t.html().indexOf("tspan")&&(this.__storeText__=t.text()),t.text("")}).call(p,function(){return this.__storeText__},n,r)}}function v(t){return"number"==typeof t?{top:t,left:t,right:t,bottom:t}:t}function _(t){return v(t||0)}var g={},b=5,x=function m(a){var o=a.selection?a.selection():a;return o.each(function(i,l){var c=g.size.call(this,i,l)||{width:960,height:500},d=_(g.margin.call(this,i,l)),u=g.x.call(this,i,l),s=g.x2.call(this,i,l),p=g.y.call(this,i,l),h=g.y2.call(this,i,l),y=d3.select(this),b={
x:{type:"x",data:u},x2:{type:"x2",data:s},y:{type:"y",data:p},y2:{type:"y2",data:h}},x=v(g.padding.call(this,i,l)),m=y.selectAll(".d2b-plane").data([i]),P=m.enter().append("g").attr("class","d2b-plane"),k=m.merge(P),F=a!==o?a:null;t(b.x,l,k,c.width,F),t(b.x2,l,k,c.width,F),t(b.y,l,k,c.height,F),t(b.y2,l,k,c.height,F),x||(x=f(b));var w={top:x.top+d.top,bottom:x.bottom+d.bottom,left:x.left+d.left,right:x.right+d.right};w.width=c.width-w.left-w.right,w.height=c.height-w.top-w.bottom,k.attr("transform","translate("+w.left+", "+w.top+")"),e(b.x,w.width,0,w.height),e(b.x2,w.width,0,0),e(b.y,w.height,0,0),e(b.y2,w.height,w.width,0),n(b.x,w.width,w.height),n(b.x2,w.width,w.height),n(b.y,w.height,w.width),n(b.y2,w.height,w.width),r(b.x,w.width),r(b.x2,w.width),r(b.y,-w.height),r(b.y2,-w.height)}),m};u(x,g).addPropFunctor("size",function(t){return t.size}).addPropFunctor("padding",null).addPropFunctor("margin",0).addPropFunctor("x",function(t){return t.x}).addPropFunctor("x2",function(t){return t.x2}).addPropFunctor("y",function(t){return t.y}).addPropFunctor("y2",function(t){return t.y2}).addPropFunctor("axis",function(t){return t.axis}).addPropFunctor("orient",function(t){return t.orient}).addPropFunctor("wrapLength",1/0).addPropFunctor("tickSize",6).addPropFunctor("showGrid",!0).addPropFunctor("label",function(t){return t.label}).addPropFunctor("labelOrient",function(t){return t.labelOrient});return x}function w(t){function e(t,e,n,r,a,i,l){var c=void 0,d=void 0,u=l.prop(o.legendAt).split(" ");switch(u={x:u[1],y:u[0]},u.x){case"left":c=0;break;case"center":c=n/2-i.width/2;break;default:c=n-i.width}switch(u.y){case"bottom":d=r-i.height;break;case"center":d=r/2-i.height/2;break;default:d=0}var s=10,p={left:0,top:0,bottom:0,right:0};return i.height+=s,i.width+=s,"center"===u.x&&"center"===u.y||("horizontal"===a?"top"===u.y?p.top+=i.height:"bottom"===u.y&&(p.bottom+=i.height):"left"===u.x?p.left+=i.width:"right"===u.x&&(p.right+=i.width)),e.attr("transform","translate("+c+", "+d+")"),t.attr("transform","translate("+c+", "+d+")"),p}function n(t,e){var n=t.selection?t.selection():t,r={prop:function(e,n){var r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];return n=n||t,r.unshift(t),"function"==typeof e?e.apply(n,r):e},dispatch:function(e,n){var r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];return n=n||t,r.unshift(t),o.dispatch.apply(e,n,r)},context:t,selection:n,update:function(){var n=(t.selection?t.selection():t).transition().duration(r.prop(o.duration));a(n,e)}};return r}function r(t){var e={top:0,left:0,right:0,bottom:0};return"number"==typeof t?{top:t,left:t,right:t,bottom:t}:(["top","bottm","right","left"].forEach(function(n){t[n]&&e[n]==t[n]}),e)}function a(a,i){var l=n(a,i),c=a.selection?a.selection():a,d=c.datum(),u=l.prop(o.size),s=r(l.prop(o.padding)),p="translate("+s.left+", "+s.top+")";c.dispatch("beforeUpdate");var h=c.selectAll(".d2b-svg").data(function(t){return[t]}),f=h.enter().append("svg").attr("class","d2b-svg"),y=c.node().getBoundingClientRect(),v=u&&u.width?u.width:y.width,_=u&&u.height?u.height:y.height;f.attr("width",v).attr("height",_).append("g").attr("class","d2b-group").attr("transform",p),a.select(".d2b-svg").attr("width",v).attr("height",_).select(".d2b-group").attr("transform",p);var g=c.select(".d2b-group");v-=s.top+s.bottom,_-=s.left+s.right;var b=g.selectAll(".d2b-chart-legend").data(l.prop(o.legendHidden)?[]:[d]),x=b.enter().append("g").attr("class","d2b-chart-legend").style("opacity",0),m=b.exit();b=b.merge(x),a!==c&&(b=b.transition(a),m=m.transition(a).style("opacity",0)),b.style("opacity",1).call(o.legend.maxSize({width:v,height:_})),m.remove();var P={left:0,top:0};if(b.size()){var k=o.legend.computedSize(b),F=o.legend.orient().call(b.node(),d,i);P=e(b,x,v,_,F,k,l),v-=P.left+P.right,_-=P.top+P.bottom}var w="translate("+P.left+", "+P.top+")",A=g.selectAll(".d2b-chart-main").data(function(t){return[t]});A.enter().append("g").attr("class","d2b-chart-main").attr("transform",w);A=a.select(".d2b-chart-main").attr("transform",w),t(A,v,_,l),c.dispatch("afterUpdate")}var o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=function(t){t.each(function(e,n){var r=d3.select(this),o=t.selection?r.transition(t):r;a(o,n)})},l=u(i,o).addProp("legend",h()).addPropFunctor("size",null).addPropFunctor("padding",0).addPropFunctor("duration",250).addPropFunctor("legendHidden",!1).addPropFunctor("legendAt","center right");return l}function A(t){var e=arguments.length<=1||void 0===arguments[1]?1/0:arguments[1];t.each(function(){for(var t=d3.select(this),n=t.text().split(/\s+/).reverse(),r=void 0,a=[],o=0,i=1.1,l=parseFloat(t.attr("y"))||0,c=parseFloat(t.attr("dy"))||0,d=t.text(null).append("tspan").attr("x",0).attr("y",l).attr("dy",c+"em");r=n.pop();)a.push(r),d.text(a.join(" ")),d.node().getComputedTextLength()>e&&(a.pop(),d.text(a.join(" ")),a=[r],d=t.append("tspan").attr("x",0).attr("y",l).attr("dy",++o*i+c+"em").text(r))})}function z(t){var e=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return isNaN(t)||null===t?e:t}function M(t){var n=arguments.length<=1||void 0===arguments[1]?function(t){return t}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?function(t){return t}:arguments[2];return n=e(n),t.selection?void t.tween("text",function(t,e){var a=this,o=z(n.call(this,t,e));this.current=z(this.current,o);var i=d3.interpolate(this.current,o);return function(t){a.textContent=r(a.current=i(t))}}):t.text(function(t,e){return this.current=z(n.call(this,t,e)),r(this.current)})}function B(t,e){return t.selection?void t.attrTween("transform",function(t){var n=this;t=d2b.omit(t,["data"]),this.current=this.current||t;var r=d3.interpolate(this.current,t);return function(t){return n.current=r(t),"translate("+e.centroid(n.current)+")"}}):t.attr("transform",function(t){return this.current=f(t,["data"]),"translate("+e.centroid(this.current)+")"})}function S(){var t=arguments.length<=0||void 0===arguments[0]?b():arguments[0],e={},n=function d(t){return(t.selection?t.selection():t).on(l("mouseover"),a).on(l("mouseout"),i).on(l("mousemove"),o),d},r=function(t,n){var r=this.getBoundingClientRect(),a={},o=(e.at.call(this,t,n)||(d3.event.clientX>window.innerWidth/2?"center left":"center right")).split(" ");switch(o={x:o[1],y:o[0]},o.x){case"left":a.x=r.left;break;case"center":a.x=r.left+r.width/2;break;default:a.x=r.left+r.width}switch(o.y){case"bottom":a.y=r.top+r.height;break;case"center":a.y=r.top+r.height/2;break;default:a.y=r.top}return a},a=function(t,n){e.tooltip=e.selection.selectAll(".d2b-tooltip").data(function(t){return[t]});var r=e.tooltip.enter().append("div").style("opacity",0).attr("class","d2b-tooltip");r.append("div").attr("class","d2b-tooltip-content"),e.tooltip=e.tooltip.merge(r),e.tooltip.transition().duration(100).style("opacity",1),e.dispatch.call("insert",e.tooltip,this,t,n)},o=function(t,n){var a=e.html.call(this,t,n),o=e.target.call(this,t,n),i=e.color.call(this,t,n),l=o?o.node():this,c=e.followMouse.call(this,t,n)?{x:d3.event.clientX,y:d3.event.clientY}:r.call(l,t,n),d=e.my.call(this,t,n)||(d3.event.clientX>window.innerWidth/2?"left":"right");e.tooltip.attr("class","d2b-tooltip d2b-tooltip-"+d).style("top",c.y+"px").style("left",c.x+"px").style("border-color",i).select(".d2b-tooltip-content").html(a),e.dispatch.call("move",e.tooltip,this,t,n)},i=function(t,n){e.tooltip.transition().duration(100).style("opacity",0).remove(),e.dispatch.call("remove",e.tooltip,this,t,n)},l=function(t){return t+".d2b-tooltip"},c=function(r,a){a&&a.select(".d2b-tooltip-area-"+t).remove(),r&&(e.selection=r.selectAll(".d2b-tooltip-area-"+t).data([n]),e.selection=e.selection.merge(e.selection.enter().append("div").attr("class","d2b-tooltip-area-"+t+" d2b-tooltip-area")))};u(n,e).addProp("container",d3.select("body"),null,c).addMethod("clear",function(t){return oldGraph.on(l("mouseover"),null).on(l("mouseout"),null).on(l("mousemove"),null),n}).addPropFunctor("followMouse",!1).addPropFunctor("color",null).addPropFunctor("my",null).addPropFunctor("at",null).addPropFunctor("target",null).addPropFunctor("html",null).addDispatcher(["insert","move","remove"]);return n}function O(){for(var t=arguments.length,e=Array(t),n=0;t>n;n++)e[n]=arguments[n];var r=e[0];return e.forEach(function(t){null!==r&&void 0!==r&&r!==!1||(r=t)}),r}function E(){var t=arguments.length<=0||void 0===arguments[0]?b():arguments[0],e={},n={},r=function(t,n,r){if("y"===r){if(n.y===1/0)return t.style("opacity",0);t.style("opacity",1).attr("transform","translate(0, "+n.y+")").attr("y1",0).attr("y2",0).attr("x1",0).attr("x2",e.size.width)}else{if(n.x===1/0)return t.style("opacity",0);t.style("opacity",1).attr("transform","translate("+n.x+", 0)").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",e.size.height)}},a=function(t,n,r){var a=t.node();if(a){var o=t.node().getBoundingClientRect(),i=r.x,l=r.y,c=10;e.trackY?l+=n.y>e.size.height/2?n.y-c-o.height:n.y+c:l=d3.event.clientY-r.y>e.size.height/2?d3.event.clientY-c-o.height:d3.event.clientY+c,e.trackX?i+=n.x>e.size.width/2?n.x-c-o.width:n.x+c:i=d3.event.clientX-r.x>e.size.width/2?d3.event.clientX-c-o.width:d3.event.clientX+c,i+=window.scrollX,l+=window.scrollY,t.style("left",i+"px").style("top",l+"px")}},o=function(t,n){var r=e.title(n.points.map(function(t){return t.data}));t.select(".d2b-tooltip-title").style("display",r?"block":"none").html(r);var a=t.select(".d2b-tooltip-content"),o=a.selectAll(".d2b-tooltip-row").data(n.points),i=o.enter().append("div").attr("class","d2b-tooltip-row");o.exit().remove(),o=o.merge(i).html(function(t){return t.row}).style("border-left-color",function(t){return t.color||"transparent"})},i=function(t){var n={x:d3.event.clientX-t.x,y:d3.event.clientY-t.y},r=1/0,a=1/0,o=[];for(var i in g)if(g.hasOwnProperty(i)){var l=g[i],c=function(t){if(!l.hasOwnProperty(t))return"continue";var i=l[t],c=[];i.config.data.forEach(function(t,l){var d={data:t,x:O(i.config.x(t,l),e.x(t,l)),y:O(i.config.y(t,l),e.y(t,l)),color:O(i.config.color(t,l),e.color(t,l)),row:O(i.config.row(t,l),e.row(t,l))};if(e.trackX&&e.trackY){if(d.x===r&&d.y===a)return c.push(d);var u=Math.sqrt(Math.pow(r-n.x,2)+Math.pow(a-n.y,2)),s=Math.sqrt(Math.pow(d.x-n.x,2)+Math.pow(d.y-n.y,2));u>s&&s<e.threshold&&(r=d.x,a=d.y,o=[],c=[d])}else if(e.trackX){if(d.x===r)return c.push(d);var u=Math.abs(r-n.x),s=Math.abs(d.x-n.x);u>s&&s<e.threshold&&(r=d.x,o=[],c=[d])}else if(e.trackY){if(d.y===a)return c.push(d);var u=Math.abs(a-n.y),s=Math.abs(d.y-n.y);u>s&&s<e.threshold&&(a=d.y,o=[],c=[d])}}),o=o.concat(c)};for(var d in l){c(d)}}return o=o.sort(function(t,e){return d3.ascending(t.x,e.x)||d3.ascending(t.y,e.y)}),{x:r,y:a,points:o}},l=function(t){t.transition().duration(50).style("opacity",0).remove()},c=function(t){t.transition().duration(50).style("opacity",1)},d=function(){var t=e.selectionSvg.selectAll(".d2b-tooltip-marker-x").data(e.trackX?[n]:[]),r=t.enter().append("line").attr("class","d2b-tooltip-marker-x d2b-tooltip-marker"),a=e.selectionSvg.selectAll(".d2b-tooltip-marker-y").data(e.trackY?[n]:[]),o=a.enter().append("line").attr("class","d2b-tooltip-marker-y d2b-tooltip-marker"),i=e.selection.selectAll(".d2b-tooltip").data([n]),l=i.enter().append("div").attr("class","d2b-tooltip");l.merge(i).call(c),a.merge(o).call(c),t.merge(r).call(c),l.append("div").attr("class","d2b-tooltip-title"),l.append("div").attr("class","d2b-tooltip-content")},s=function(){e.selectionSvg.selectAll(".d2b-tooltip-marker-x").data([]).exit().call(l),e.selectionSvg.selectAll(".d2b-tooltip-marker-y").data([]).exit().call(l),e.selection.selectAll(".d2b-tooltip").data([]).exit().call(l)},p=function(t,n){var l=e.selectionSvg.selectAll(".d2b-tooltip-base").data([t]);l=l.merge(l.enter().append("rect").attr("class","d2b-tooltip-base"));var c=l.node().getBoundingClientRect();c={x:c.left,y:c.top};var u=i(c);return u.points.length?(d(),e.selectionSvg.select(".d2b-tooltip-marker-x").call(r,u,"x"),e.selectionSvg.select(".d2b-tooltip-marker-y").call(r,u,"y"),e.selection.select(".d2b-tooltip").call(o,u).call(a,u,c),void e.dispatch.call("move",e.tooltip,this,t,n)):s()},h=function(t,e){s()},f=function(t){return t+".d2b-tooltip-axis"},y=function(r,a){a&&a.select("div.d2b-tooltip-axis-area-"+t).remove(),r&&(e.selection=r.selectAll("div.d2b-tooltip-axis-area-"+t).data([n]),e.selection=e.selection.merge(e.selection.enter().append("div").attr("class","d2b-tooltip-axis-area-"+t+" d2b-tooltip-axis-area")))},v=function(r,a){a&&a.select("g.d2b-tooltip-axis-area-"+t).remove(),r&&(e.selectionSvg=r.selectAll("g.d2b-tooltip-axis-area-"+t).data([n]),e.selectionSvg=e.selectionSvg.merge(e.selectionSvg.enter().append("g").attr("class","d2b-tooltip-axis-area-"+t+" d2b-tooltip-axis-area")))},_=function(t,e){e&&e.on(f("mouseout"),null).on(f("mousemove"),null),t&&t.on(f("mouseout"),h).on(f("mousemove"),p)},g=(u(n,e).addProp("htmlContainer",d3.select("body"),null,y).addProp("svgContainer",null,null,v).addProp("tracker",d3.select("body"),null,_).addProp("size",{height:0,width:0}).addProp("trackX",!0).addProp("trackY",!1).addProp("threshold",1/0).addMethod("clear",function(t,e){return 0===arguments.length?g={}:1===arguments.length?delete g[t]:arguments.length>=2&&delete g[t][e],n}).addPropFunctor("title",null).addPropFunctor("x",function(t){return t.x}).addPropFunctor("y",function(t){return t.y}).addPropFunctor("color",null).addPropFunctor("row",null).addDispatcher(["insert","move","remove"]),{});return n.graph=function(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0],e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],n=g[t]=g[t]||{},r=n[e];if(!r){r=n[e]={"interface":{},config:{}};var a=u(r["interface"],r.config);a.addProp("data",[]).addMethod("clear",function(){return r.config.data=[],r["interface"]}).addMethod("addPoint",function(t){return r.config.data.push(t),r["interface"]}).addPropFunctor("x",null).addPropFunctor("y",null).addPropFunctor("color",null).addPropFunctor("row",null)}return r["interface"]},n}function T(){function t(t,e,n,r){}var e=w(t,["zoomIn","zoomOut"]).addPropFunctor("interpolate","linear"),n=e.values(),r=e.base();return n.legend.items(function(t){return t}).active(!0).clickable(!0).dblclickable(!0),r}function G(){function t(t,a,i,s){var p=t.selection?t.selection():t,h=p.node(),f=p.datum(),y=o.radius.call(h,f,a,i),v=o.startAngle.call(h,f),_=o.endAngle.call(h,f),g=o.donutRatio.call(h,f),b=(o.at.call(h,f),o.values.call(h,f).filter(function(t){return!t.__empty__}));s.selection.select(".d2b-chart-legend").on("change",s.update).selectAll(".d2b-legend-item").on("mouseover",function(t){return d3.select(t.__arc__).each(n)}).on("mouseout",function(t){return d3.select(t.__arc__).each(r)});var x=d3.sum(b,function(t,e){return t.__value__=o.value(t,e)}),m=p.selectAll(".d2b-pie-chart").data([b]),P=m.enter().append("g").attr("class","d2b-pie-chart");m=m.merge(P).datum(function(t){return t=l.startAngle(v).endAngle(_)(t),t.forEach(function(t){t.outerRadius=y,t.innerRadius=y*g}),t}),p!==t&&(m=m.transition(t)),m.call(d);var k=p.selectAll(".d2b-pie-arc").each(function(t,e){this.outerRadius=t.outerRadius,t.data.__arc__=this,t.data.__percent__=t.data.__value__/x}).on("mouseover",n).on("mouseout",r).call(o.tooltip),F=k.selectAll(".d2b-pie-arc-percent").data(function(t){return[t]});F.enter().append("g").attr("class","d2b-pie-arc-percent").append("text").attr("y",6),k.each(function(t){var e=d3.select(this),n=e.select(".d2b-pie-arc path").node().current,r=e.select(".d2b-pie-arc-percent"),a=r.select("text").node();r.node().current=n,a.current=a.current||0}),p!==t&&(k=k.each(function(t){this.transitioning=!0}).transition(t).on("end",function(t){this.transitioning=!1})),k.select(".d2b-pie-arc-percent").call(d2b.tweenCentroid,c).select("text").call(M,function(t){return t.data.__percent__},u).style("opacity",function(t,e){return o.showPercent.call(this,t.data,e)?1:0});var w=e(h,f,y,a,i);P.attr("transform","translate("+w.x+", "+w.y+")"),m.attr("transform","translate("+w.x+", "+w.y+")")}function e(t,e,n,r,a){var i=o.center.call(t,e,r,a,n),l=o.at.call(t,e,r,a).split(" ");if(!i){switch(l={x:l[1],y:l[0]},i={},l.x){case"left":i.x=n;break;case"center":i.x=r/2;break;default:i.x=r-n}switch(l.y){case"bottom":i.y=a-n;break;case"center":i.y=a/2;break;default:i.y=n}}return i}function n(t){if(!this.transitioning){var e=d3.select(this).select("path");t.outerRadius=1.03*this.outerRadius,e.transition().duration(100).call(y,c)}}function r(t){if(!this.transitioning){var e=d3.select(this).select("path");t.outerRadius=this.outerRadius,e.transition().duration(100).call(y,c)}}var a=w(t),o=a.values(),i=a.base();o.legend.active(!0).clickable(!0).dblclickable(!0);var l=d3.pie().sort(null),c=d3.arc().outerRadius(function(t){return t.outerRadius}).innerRadius(function(t){return t.innerRadius}),d=d2b.svgPie().arc(c),u=d3.format(".0%");return a.addProp("key",function(t){return t.label},null,function(t){o.legend.key(t),d.key(t)}).addProp("tooltip",S().followMouse(!0).html(function(t){return"<b>"+o.label(t.data)+":</b> "+o.value(t.data)})).addPropFunctor("values",function(t){return t}).addPropFunctor("donutRatio",0).addPropFunctor("startAngle",0).addPropFunctor("endAngle",2*Math.PI).addPropFunctor("at","center center").addPropFunctor("showPercent",function(t,e){return t.__percent__>.03}).addPropFunctor("center",null).addPropFunctor("radius",function(t,e,n){return Math.min(e,n)/2}).addPropFunctor("sort",null).addPropFunctor("color",function(t){return X(t.label)},null,function(t){o.tooltip.color(function(e){return d3.rgb(t(e.data)).darker(.3)}),o.legend.color(t),d.color(t)}).addPropFunctor("value",function(t){return t.value},null,function(t){return l.value(t)}).addPropFunctor("label",function(t){return t.label},null,function(t){return o.legend.label(t)}),i}var R=Math.PI,C=Math.sqrt(8),L=Math.sqrt(2),N={draw:function(t,e){var n=Math.sqrt(e/(R+5/4)),r=.3125*n,a=2*Math.asin(.25),o=(R/2-a)/2,i=n/C-n*Math.cos(o),l=n*Math.sin(o);t.arc(i,l,n,-o,2*R-a-o),t.lineTo(n*(5/4-1/L),-n*(1/C+5/4-1/L)),t.lineTo(n*(5/4-1/L)-r,-n*(1/C+5/4-1/L)),t.lineTo(n*(5/4-1/L)-r,-n*(1/C+7/4-1/L)),t.lineTo(n*(7/4-1/L+1/C),-n*(1/C+7/4-1/L)),t.lineTo(n*(7/4-1/L+1/C),-n*(5/4-1/L)+r),t.lineTo(n*(5/4-1/L+1/C),-n*(5/4-1/L)+r),t.lineTo(n*(5/4-1/L+1/C),-n*(5/4-1/L)),t.closePath()}},W={draw:function(t,e){var n=Math.sqrt(e/(R+5/4)),r=2*Math.asin(.25),a=n/4-n*Math.cos(r/2);t.arc(0,a,n,3*-R/2+r/2,R/2-r/2),t.lineTo(n/4,3*n/4),t.lineTo(3*n/4,3*n/4),t.lineTo(3*n/4,5*n/4),t.lineTo(n/4,5*n/4),t.lineTo(n/4,7*n/4),t.lineTo(-n/4,7*n/4),t.lineTo(-n/4,5*n/4),t.lineTo(3*-n/4,5*n/4),t.lineTo(3*-n/4,3*n/4),t.lineTo(-n/4,3*n/4),t.closePath()}},X=d3.scaleCategory10();t.symbolMars=N,t.symbolVenus=W,t.mean=r,t.median=a,t.midpoint=l,t.mode=o,t.range=i,t.toDegrees=c,t.toRadians=d,t.point=s,t.plane=F,t.legend=h,t.svgPie=v,t.svgLine=_,t.svgArea=x,t.svgScatter=m,t.svgBar=P,t.svgBubblePack=k,t.modelBase=u,t.modelChart=w,t.defaultColor=X,t.id=b,t.textWrap=p,t.textWrapPX=A,t.tweenCentroid=B,t.tweenNumber=M,t.tweenArc=y,t.tooltip=S,t.tooltipAxis=E,t.stack=g,t.omit=f,t.chartTemplate=T,t.chartPie=G});