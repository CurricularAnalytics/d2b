!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.d2b=t.d2b||{})}(this,function(t){"use strict";function n(t){return"function"==typeof t?t:function(){return t}}function e(t){return null===t?NaN:+t}function r(t,r,a){var o=0,i=0;return a=n(a||1),r=n(r||function(t){return t}),t.filter(function(t){return!isNaN(e(a(t)))&&!isNaN(e(r(t)))}).forEach(function(t){var n=a(t),e=r(t);o+=n,i+=e*n}),t.length&&o?i/o:void 0}function a(t,a,o){o=n(o||1),a=n(a||function(t){return t});var i,l=[],c=t.filter(function(t){return 0!==o(t)&&!isNaN(e(o(t)))&&!isNaN(e(a(t)))}).sort(function(t,n){return d3.ascending(a(t),a(n))});i=Math.round(d3.sum(c,function(t){return o(t)})/2*1e12)/1e12;var u=0,d=!1;return c.forEach(function(t){d&&(l.push(a(t)),d=!1),u+=o(t),u===i&&(l.push(a(t)),d=!0),u>i&&0===l.length&&l.push(a(t))}),t.length?r(l):void 0}function o(t,a,o){o=n(o||1),a=n(a||function(t){return t});var i=[],l=0,c={};return t.forEach(function(t){var n=e(a(t));isNaN(a(t))||(c[n]=c[n]||0,c[n]+=o(t),c[n]>l?(l=c[a(t)],i=[a(t)]):c[a(t)]==l&&i.push(a(t)))}),t.length?r(i):void 0}function i(t,e){e=n(e||function(t){return t});var r=d3.extent(t,e);return t.length?r[1]-r[0]:void 0}function l(t,e){return e=n(e||function(t){return t}),t.length?d3.mean(d3.extent(t,e)):void 0}function c(t){return t*(Math.PI/180)}function u(t){return t*(180/Math.PI)}function d(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=arguments[2],o=function(n,e){return function(a){if(!arguments.length)return r[n];var o=r[n];return r[n]=a,e&&e(a,o),t}},i=function(t){return function(n){return r[t]}},l=function(e,a){return function(o){if(!arguments.length)return r[e];var i=r[e];return r[e]=n(o),a&&a(o,i),t}},c={base:function(){return t},values:function(){return r},removeProp:function(n){return-1!==a.indexOf(n)?(console.error("Cannot remove "+n+" property or value"),c):(r[n]=null,t[n]=null,c)},addProp:function(n){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a=arguments.length<=2||void 0===arguments[2]?o(n):arguments[2],i=arguments[3];return r[n]||t[n]?(console.error(n+" property is already defined."),c):(a=a||o(n,i),r[n]=e,t[n]=a,i&&i(e),c)},addPropGet:function(n){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a=arguments.length<=2||void 0===arguments[2]?i(n):arguments[2];return r[n]||t[n]?(console.error(n+" property is already defined."),c):(r[n]=e,t[n]=a,c)},addMethod:function(n,e){return t[n]?(console.error(n+" method is already defined."),c):(t[n]=e,c)},addPropFunctor:function(e){var a=arguments.length<=1||void 0===arguments[1]?null:arguments[1],o=arguments.length<=2||void 0===arguments[2]?l(e):arguments[2],i=arguments[3];return r[e]||t[e]?(console.error(e+" property is already defined."),c):(o=o||l(e,i),a=n(a),i&&i(a),r[e]=a,t[e]=o,c)},addDispatcher:function(n){var a=arguments.length<=1||void 0===arguments[1]?"on":arguments[1],o=arguments.length<=2||void 0===arguments[2]?"dispatch":arguments[2];return t[a]?(console.error(a+" property is already defined."),c):r[o]?(console.error(o+" value is already defined."),c):(t[a]=function(n,e){return 0===arguments.length?r[o]:1===arguments.length?r[o].on(n):(r[o].on(n,e),t)},r[o]=d3.dispatch.apply(e,n),c)}};return c}function s(){function t(t,n){return i.empty.call(this,t,n)?0:1}function n(t,n){var e=i.size.call(this,t,n),r=i.empty.call(this,t,n);return c.size(r?e:2.5*e).call(this,t,n)}function e(t,n){var e=i.size.call(this,t,n),r=i.empty.call(this,t,n);return c.size(r?e/3:e).call(this,t,n)}function r(t,n){var e=i.size.call(this,t,n);return c.size(e).call(this,t,n)}function a(t,r){var a=(i.size.call(this,t,r),i.empty.call(this,t,r));d3.select(this).select("path.d2b-point-back").transition().duration(100).attr("d",n),d3.select(this).select("path.d2b-point-front").transition().duration(100).style("opacity",a?.5:1).attr("d",e)}function o(t,n){var a=(i.size.call(this,t,n),i.empty.call(this,t,n));d3.select(this).select("path.d2b-point-back").transition().duration(100).attr("d",r),d3.select(this).select("path.d2b-point-front").transition().duration(100).style("opacity",a?0:1).attr("d",e)}var i={},l=function u(n){var l=n.selection?n.selection():n,c=l.selectAll("path.d2b-point-back").data(function(t){return[t]});c.enter().append("path").attr("class","d2b-point-back").attr("d",r).style("fill-opacity",0).style("stroke",i.stroke).style("stroke-width",i.strokeWidth);n!==l&&(c=c.transition(n)),c.attr("d",r).style("stroke",i.stroke).style("stroke-width",i.strokeWidth);var d=l.selectAll("path.d2b-point-front").data(function(t){return[t]});d.enter().append("path").attr("class","d2b-point-front").attr("d",e).style("opacity",t).style("fill",i.fill).style("stroke",i.stroke).style("stroke-width",i.strokeWidth);return n!==l&&(d=d.transition(n)),d.attr("d",e).style("opacity",t).style("fill",i.fill).style("stroke",i.stroke).style("stroke-width",i.strokeWidth),l.each(function(t,n){var e=i.active.call(this,t,n);d3.select(this).on("mouseover.d2b-point",e?a:null).on("mouseout.d2b-point",e?o:null)}),u},c=d3.symbol();d(l,i).addPropFunctor("size",150,null,function(t){return c.size(t)}).addPropFunctor("type",d3.symbolCircle,null,function(t){return c.type(t)}).addPropFunctor("active",!1).addPropFunctor("empty",!1).addPropFunctor("fill","steelblue").addPropFunctor("stroke",function(t,n){return d3.rgb(i.fill.call(this,t,n)).darker(.3)}).addPropFunctor("strokeWidth","1px");return l}function p(t){var n=arguments.length<=1||void 0===arguments[1]?function(t){return t.label}:arguments[1],e=arguments.length<=2||void 0===arguments[2]?1/0:arguments[2];t.each(function(t,r){for(var a=d3.select(this),o=n.call(this,t,r).split(/\s+/).reverse(),i=void 0,l=[],c=[o.pop()],u=1.1;i=o.pop();)c.join(" ").length+i.length>e&&(l.push(c),c=[]),c.push(i);l.push(c);var d=a.selectAll("tspan").data(l);d.merge(d.enter().append("tspan")).text(function(t){return t.join(" ")}).attr("x",0).attr("y",0).attr("dy",function(t,n){return n*u+"em"})})}function h(){function t(t,r){t.selectAll(".d2b-legend-item").on("click",function(e,a){n.call(this,e,a,t,r)}).on("dblclick",function(n,a){e.call(this,n,a,t,r)})}function n(t,n,e,a){var i=r.clickable.call(this,t,n),l=r.allowEmptied.call(e.node(),e.datum(),a),c=e.datum();e.node();if(i){t.__empty__=!t.__empty__;var u=d3.select(this),d=e.selectAll(".d2b-legend-item"),s=!0;c.forEach(function(t){return s=t.__empty__?s:!1}),s&&!l?(d.each(function(t){return t.__empty__=!1}).transition().duration(100).call(o),d.filter(function(n){return n!=t}).dispatch("change")):u.transition().duration(100).call(o),u.dispatch("change",{bubbles:!0})}}function e(t,n,e,a){var i=r.dblclickable.call(this,t,n),l=e.datum();if(i){l.forEach(function(t){return t.__empty__=!0}),t.__empty__=!1;var c=e.selectAll(".d2b-legend-item");c.transition().duration(100).call(o),c.filter(function(n){return n!=t}).dispatch("change"),d3.select(this).dispatch("change",{bubbles:!0})}}var r={},a=function l(n){return n.each(function(e,a){var l=d3.select(this),c=r.size.call(this,e,a),u=r.maxSize.call(this,e,a),d=r.orient.call(this,e,a),s=r.maxTextLength.call(this,e,a),h=r.items.call(this,e,a);o.size(1.5*Math.pow(c/2,2)).strokeWidth(.1*c);var f=l.selectAll(".d2b-legend").data([h]);f=f.merge(f.enter().append("g").attr("class","d2b-legend"));var _=f.selectAll(".d2b-legend-item").data(function(t){return t},r.key),v=_.enter().append("g").attr("class","d2b-legend-item").style("opacity",0);v.append("g").append("text");var y=_.exit();_=_.merge(v).style("cursor",function(t,n){var e=r.clickable.call(this,t,n),a=r.dblclickable.call(this,t,n);return e||a?"pointer":"auto"}),l.call(t,a);var b=_.select("g").attr("transform","translate("+c/2+", "+c/2+")"),g=_.select("text").attr("transform","translate("+c/1.5+", "+c/3+")").style("font-size",c+"px").call(p,r.label,s);n.selection&&(y=y.transition(n).style("opacity",0),_=_.transition(n),b=b.transition(n),g=g.transition(n)),y.remove(),b.call(o);var m=0;g.each(function(){m=Math.max(m,this.getBBox().width)}),m+=c;var x={x:c,y:5};v.call(i[d],this,x,c,u,m),this.computedWidth=0,this.computedHeight=0,_.style("opacity",1).call(i[d],this,x,c,u,m)}),l},o=s().empty(function(t){return t.__empty__}),i={horizontal:function(t,n,e,r,a,o){var i=0,l=0,c=0;t.attr("transform",function(){var t=d3.select(this),u=r*t.selectAll("tspan").size(),d=t.select("text").node().getBBox().width;i+o>a.width&&(i=0,l+=c+e.y,c=0);var s="translate("+i+", "+l+")";return c=Math.max(c,u),n.computedWidth=Math.max(n.computedWidth,i+d+1.5*r),i+=o+e.x,s}),n.computedHeight=l+c},vertical:function(t,n,e,r,a){var o=0,i=0,l=0;t.attr("transform",function(){var t=d3.select(this),c=r*t.selectAll("tspan").size(),u=t.select("text").node().getBBox().width;i+c>a.height&&(o+=l+e.x+r,i=0,l=0);var d="translate("+o+", "+i+")";return l=Math.max(l,u),n.computedHeight=Math.max(n.computedHeight,i+c),i+=c+e.y,d}),n.computedWidth=o+l+1.5*r}};d(a,r).addPropFunctor("items",function(t){return t}).addPropFunctor("size",12).addPropFunctor("maxSize",{width:960,height:500}).addPropFunctor("orient","vertical").addPropFunctor("maxTextLength",1/0).addPropFunctor("allowEmptied",!1).addPropFunctor("key",function(t,n){return n}).addPropFunctor("clickable",!1).addPropFunctor("dblclickable",!1).addPropFunctor("label",function(t){return t.label}).addPropFunctor("active",!1,null,function(t){return o.active(t)}).addPropFunctor("symbol",d3.symbolCircle,null,function(t){return o.type(t)}).addPropFunctor("color",function(t){return H(t.label)},null,function(t){return o.fill(t)}).addMethod("computedSize",function(t){var n=t.node?t.node():t;return n?{width:n.computedWidth,height:n.computedHeight}:{width:0,height:0}});return a}function f(t,n){var e={};for(var r in t)"function"!=typeof t[r]&&n.indexOf(r)<0&&(e[r]=t[r]);return e}function _(t,n){return t.selection?void t.attrTween("d",function(t){var e=this;t=f(t,["data"]),this.current=this.current||t;var r=d3.interpolate(this.current,t);return function(t){return e.current=r(t),n(e.current)}}):t.attr("d",function(t){return this.current=f(t,["data"]),n(t)})}function v(){function t(t,r,a){var o=void 0;return(o=n(t,r,a))?{startAngle:o.endAngle,endAngle:o.endAngle}:(o=e(t,r,a))?{startAngle:o.startAngle,endAngle:o.startAngle}:{startAngle:0,endAngle:0}}function n(t,n,e){for(var a=n.length;--t>=0;)for(var o=r.key(e[t].data,t),i=0;a>i;++i)if(r.key(n[i].data,i)===o)return n[i]}function e(t,n,e){for(var a=e.length,o=n.length;++t<a;)for(var i=r.key(e[t].data,t),l=0;o>l;++l)if(r.key(n[l].data,l)===i)return n[l]}var r={},a=function o(n){var e=n.selection?n.selection():n;return e.each(function(a,o){var i=d3.select(this),l=i.selectAll(".d2b-pie-arc"),c=l.data();l=l.data(r.values,function(t,n){return r.key(t.data,n)});var u=l.enter().append("g").attr("class","d2b-pie-arc"),d=l.exit(),s=l.merge(u).order();u.append("path").attr("fill",function(t,n){return r.color.call(this,t.data,n)});var p=s.data();u.select("path").each(function(n,e){this.current=t(e,c,p)}),d.datum(function(n,e){var r=t(e,p,c);return r.data=n.data,r}),n!==e&&(d=d.transition(n),s=s.transition(n)),s.select("path").call(_,r.arc).attr("fill",function(t,n){return r.color.call(this,t.data,n)}),d.remove().select("path").call(_,r.arc)}),o};d(a,r).addProp("key",function(t){return t.label}).addProp("arc",d3.arc().innerRadius(100).outerRadius(200)).addPropFunctor("values",function(t){return t}).addPropFunctor("color",function(t){return H(t.label)});return a}function y(){var t={},n=function e(n){var r=n.selection?n.selection():n,a=r.selectAll(".d2b-line-graph").data(function(t){return t},t.key),o=a.enter().append("g").attr("class","d2b-line-graph").style("opacity",0);o.append("path").attr("class","d2b-line");var i=a.merge(o).order(),l=a.exit(),c=i.select(".d2b-line");return n!==r&&(i=i.transition(n),l=l.transition(n),c=c.transition(n)),i.style("opacity",1),l.style("opacity",0).remove(),c.style("stroke",t.color).attr("d",function(n,e){var r=this,a=t.x.call(this,n,e),o=t.y.call(this,n,e),i=t.values.call(this,n,e),l=t.shift.call(this,n,e);return null===l&&(l=a.bandwidth?a.bandwidth()/2:0),t.line.x(function(n,e){return a(t.px.call(r,n,e))+l}).y(function(n,e){return o(t.py.call(r,n,e))})(i)}),e};d(n,t).addProp("line",d3.line()).addProp("x",d3.scaleLinear(),function(e){return arguments.length?(e.domain?t.x=function(){return e}:t.x=e,n):t.x}).addProp("y",d3.scaleLinear(),function(e){return arguments.length?(e.domain?t.y=function(){return e}:t.y=e,n):t.y}).addPropFunctor("shift",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values}).addPropFunctor("color",function(t){return H(t.label)}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y});return n}function b(){var t={},n=function(n){var e=this,r=n;n=n.map(t.values);var a=[],o=n.map(function(n,r){var o={};return n.forEach(function(n,r){var i=t.x.call(e,n,r);a.push(i),o[i]=t.y.call(e,n,r)}),o});a=d3.set(a).values();var i=a.reduce(function(t,n,e){return t[n]=e,t},{}),l=d3.range(0,n.length),c=a.map(function(t,n){return o.map(function(n,e){return n[t]||0})}),u=t.stack.keys(l).value(function(t,n){return t[n]||0})(c);return n.forEach(function(n,r){n.forEach(function(n,a){var o=t.x.call(e,n,a),l=u[r][i[o]];t.out.call(e,n,l[0],l[1],o)})}),r};d(n,t).addProp("stack",d3.stack()).addPropFunctor("values",function(t){return t}).addPropFunctor("x",function(t){return t.x}).addPropFunctor("y",function(t){return t.y}).addPropFunctor("out",function(t,n,e){t.y0=n,t.y1=e});return n}function g(){return Math.random().toString(36).substr(2,9)}function m(){var t={},n=function a(n){var o=n.selection?n.selection():n;o.each(function(t){r.entries(t).forEach(function(t){return e(t.values)})});var i=o.selectAll(".d2b-area-graph").data(function(t){return t},t.key),l=i.enter().append("g").attr("class","d2b-area-graph").style("opacity",0);l.append("path").attr("class","d2b-area");var c=i.merge(l).order(),u=i.exit(),d=c.select(".d2b-area");return n!==o&&(c=c.transition(n),u=u.transition(n),d=d.transition(n)),c.style("opacity",1),u.style("opacity",0).remove(),d.style("fill",t.color).attr("d",function(n,e){var r=t.x.call(this,n,e),a=t.y.call(this,n,e),o=t.values.call(this,n,e),i=t.shift.call(this,n,e);return null===i&&(i=r.bandwidth?r.bandwidth()/2:0),t.area.x(function(t,n){return r(t.__x__)+i}).y0(function(t,n){return a(t.__y0__)}).y1(function(t,n){return a(t.__y1__)})(o)}),a},e=b().out(function(t,n,e,r){t.__x__=r,t.__y0__=n,t.__y1__=e}),r=d3.nest().key(function(n){var e=t.stackBy(n);return e!==!1&&null!==e?e:g()});d(n,t).addProp("area",d3.area()).addProp("stack",d3.stack(),null,function(t){return e.stack(t)}).addProp("x",d3.scaleLinear(),function(e){return arguments.length?(e.domain?t.x=function(){return e}:t.x=e,n):t.x}).addProp("y",d3.scaleLinear(),function(e){return arguments.length?(e.domain?t.y=function(){return e}:t.y=e,n):t.y}).addPropFunctor("shift",null).addPropFunctor("stackBy",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values},null,function(t){return e.values(t)}).addPropFunctor("color",function(t){return H(t.label)}).addPropFunctor("px",function(t){return t.x},null,function(t){return e.x(t)}).addPropFunctor("py",function(t){return t.y},null,function(t){return e.y(t)});return n}function x(){function t(t,e,r,a){t.attr("transform",function(t,o){var i=e(n.px.call(this,t,o))+a,l=r(n.py.call(this,t,o));return"translate("+i+", "+l+")"})}var n={},e=function r(e){var a=e.selection?e.selection():e,o=a.selectAll(".d2b-scatter-graph").data(function(t){return t},n.key),i=o.enter().append("g").attr("class","d2b-scatter-graph").style("opacity",0),l=o.merge(i).order(),c=o.exit();return e!==a&&(l=l.transition(e),c=c.transition(e)),l.style("opacity",1),c.style("opacity",0).remove(),l.each(function(r,o){var i=d3.select(this),l=n.x.call(this,r,o),c=n.y.call(this,r,o),u=n.color.call(this,r,o),d=n.symbol.call(this,r,o),s=n.shift.call(this,r,o);null===s&&(s=l.bandwidth?l.bandwidth()/2:0),n.point.fill(function(t,e){return n.pcolor.call(this,t,e)||u}).type(function(t,e){return n.psymbol.call(this,t,e)||d}).size(n.psize);var p=i.selectAll(".d2b-scatter-point").data(n.values,n.pkey),h=p.enter().append("g").attr("class","d2b-scatter-point"),f=p.merge(h).order(),_=p.exit();e!==a&&(f=f.transition(e),_=_.transition(e)),h.style("opacity",0).call(t,l,c,s),f.style("opacity",1).call(n.point).call(t,l,c,s),_.style("opacity",0).remove()}),r};d(e,n).addProp("point",s().active(!0)).addProp("x",d3.scaleLinear(),function(t){return arguments.length?(t.domain?n.x=function(){return t}:n.x=t,e):n.x}).addProp("y",d3.scaleLinear(),function(t){return arguments.length?(t.domain?n.y=function(){return t}:n.y=t,e):n.y}).addPropFunctor("shift",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values}).addPropFunctor("color",function(t){return H(t.label)}).addPropFunctor("symbol",function(t){return d3.symbolCircle}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y}).addPropFunctor("pcolor",function(t){return null}).addPropFunctor("psymbol",null).addPropFunctor("pkey",function(t,n){return n}).addPropFunctor("psize",function(t){return 25});return e}function P(){function t(t){var n={};return function(e,r,a,o){var i=a-r,l=n[o]=n[o]||[0,0];e.__stackIndex__=t,e.__base__=o,i>0?e.__extent__=[l[0],l[0]+=i]:e.__extent__=[l[1],l[1]+=i]}}function n(t,n,e){t.attr("transform",function(t){return"translate("+[n[e.x](t),n[e.y](t)]+")"})}function e(t,n){var e=[];t.forEach(function(a,o){var i=r[n.x].call(t,a,o),l=r.values.call(t,a,o);l.forEach(function(t,o){var l=r[n.px].call(a,t,o);e.push(i(l))})}),e.sort(d3.ascending);for(var a=1/0,o=0;o<e.length-1;o++)e[o+1]!==e[o]&&(a=Math.min(e[o+1]-e[o],a));return a}var r={},a=function l(a){var c=a.selection?a.selection():a;return c.each(function(l,u){var d={};d="horizontal"===r.orient.call(this,l,u)?{rotate:!0,px:"py",py:"px",x:"y",y:"x",w:"height",h:"width"}:{rotate:!1,px:"px",py:"py",x:"x",y:"y",w:"width",h:"height"},o.x(r[d.px]).y(r[d.py]);var s=i.entries(l);s.forEach(function(n,e){return o.out(t(e))(n.values)});var p=(1-r.padding.call(this,l,u))*(r.bandwidth.call(this,l,u)||e(l,d)),h=p/s.length,f=h*r.groupPadding.call(this,l,u),_=d3.select(this).selectAll(".d2b-bar-graph").data(l,r.key),v=_.enter().append("g").attr("class","d2b-bar-graph").style("opacity",0),y=_.merge(v).order(),b=_.exit();a!==c&&(y=y.transition(a),b=b.transition(a)),y.style("opacity",1),b.style("opacity",0).remove(),y.each(function(t,e){var o=d3.select(this),i=r.color.call(this,t,e),l=r[d.x].call(this,t,e),u=r[d.y].call(this,t,e),s=r.shift.call(this,t,e);null===s&&(s=l.bandwidth?l.bandwidth()/2:0);var _=o.selectAll(".d2b-bar-group").data(r.values,r.pkey),v=_.enter().append("g").attr("class","d2b-bar-group");v.append("rect");var y=_.merge(v).order(),b=_.exit();y.each(function(t,n){var e=r.pcentered.call(this,t,n),a=e?s-p/4:s-p/2+t.__stackIndex__*h+f;t.__basepx__=l(t.__base__)+a,t.__extentpx__=[u(t.__extent__[0]),u(t.__extent__[1])],t.__extentpx__.sort(d3.ascending)}),a!==c&&(y=y.transition(a),b=b.transition(a)),v.attr("class","d2b-bar-group").style("opacity",0).call(n,{x:function(t){return t.__basepx__},y:function(t){return u(0)}},d).select("rect").attr("fill",function(t,n){return r.pcolor.call(this,t,n)||i}).attr(d.w,h-2*f).attr(d.h,0),y.style("opacity",1).call(n,{x:function(t){return t.__basepx__},y:function(t){return t.__extentpx__[0]}},d).select("rect").attr("fill",function(t,n){return r.pcolor.call(this,t,n)||i}).attr(d.w,h-2*f).attr(d.h,function(t){return t.__extentpx__[1]-t.__extentpx__[0]}),b.style("opacity",0).remove()})}),l},o=b(),i=d3.nest().key(function(t){var n=r.stackBy(t);return n!==!1&&null!==n?n:g()});d(a,r).addProp("stack",d3.stack(),null,function(t){return o.stack(t)}).addProp("x",d3.scaleLinear(),function(t){return arguments.length?(t.domain?r.x=function(){return t}:r.x=t,a):r.x}).addProp("y",d3.scaleLinear(),function(t){return arguments.length?(t.domain?r.y=function(){return t}:r.y=t,a):r.y}).addPropFunctor("orient","vertical").addPropFunctor("padding",.5).addPropFunctor("groupPadding",0).addPropFunctor("bandwidth",null).addPropFunctor("shift",null).addPropFunctor("stackBy",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values},null,function(t){return o.values(t)}).addPropFunctor("color",function(t){return H(t.label)}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y}).addPropFunctor("pcentered",!1).addPropFunctor("pcolor",null).addPropFunctor("pkey",function(t,n){return n});return a}function k(){function t(t){var n=0,e=0,r=300;t.selectAll(".d2b-bubble-indicator.d2b-active").attr("transform",function(){var t=this.getBBox();t.width+n>r&&n>0&&(n=0,e+=t.height+5);var a="translate("+n+", "+e+")";return n+=t.width+5,a})}function n(t,n,e,r,a,o){t.each(function(t,o){var i=d3.select(this),l=i.attr("transform");l||i.attr("transform","translate("+(e(t.__parent__?t.__parent__.__x__:t.__x__)+a+",")+(r(t.__parent__?t.__parent__.__y__:t.__y__)+")")),t.__children__?i.attr("cursor","pointer").on("click",function(){d3.select(this).dispatch("change",{bubbles:!0,cancelable:!0})}).on("change",function(t){return t.__expanded__=!t.__expanded__}):i.attr("cursor","").on("click",null),n&&(i=i.transition(n)),t.__expanded__?i.style("opacity",0).selectAll("*").remove():i.style("opacity",1).call(c.point),i.attr("transform","translate("+(e(t.__x__)+a)+", "+r(t.__y__)+")")})}function e(t,n,e,r,a,o){t.each(function(t,n){var e=d3.select(this).classed("d2b-active",t.__expanded__);if(!t.__expanded__)return e.selectAll("rect, text").remove();var r=e.select("rect"),a=e.select("text");r.size()||(r=e.append("rect")),a.size()||(a=e.append("text")),a.text(c.pindicator.call(this,t,n).substring(0,5)).attr("x",5);var o=a.node().getBBox();a.attr("y",o.height/1.35),r.on("click",function(){d3.select(this).dispatch("change",{bubbles:!0,cancelable:!0})}).on("change",function(t){return t.__expanded__=!t.__expanded__}).attr("width",o.width+10).attr("height",o.height).style("fill",c.point.fill()).style("stroke",c.point.stroke())})}function a(t,r,o,i,l,u,d){var s=arguments.length<=7||void 0===arguments[7]?0:arguments[7],p=t.selectAll(".d2b-bubble-pack.d2b-depth-"+s).data(r,c.pkey),h=p.enter().append("g").attr("class","d2b-bubble-pack d2b-depth-"+s),f=p.merge(h);h.append("g").attr("class","d2b-bubble-point").style("opacity",0),n(f.select(".d2b-bubble-point"),o,i,l,u,d),h.append("g").attr("class","d2b-bubble-indicator"),e(f.select(".d2b-bubble-indicator"),o,i,l,u,d),f.each(function(t,n){var e=d3.select(this);t.__children__&&t.__expanded__?a(e,t.__children__,o,i,l,u,d,s+1):e.selectAll(".d2b-bubble-pack").transition(o).remove().select(".d2b-bubble-point").style("opacity",0).attr("transform","translate("+(i(t.__x__)+u)+", "+l(t.__y__)+")")});var _=p.exit();o&&(_=_.transition(o)),_.remove()}function o(t){var n=arguments.length<=1||void 0===arguments[1]?0:arguments[1],e=c.pchildren(t);t.__leaves__=[],t.__depth__=n,e&&e.length?(t.__children__=e,e.forEach(function(e){o(e,n+1),e.__parent__=t,t.__leaves__=t.__leaves__.concat(e.__leaves__)})):(t.__x__=c.px(t),t.__y__=c.py(t),t.__size__=c.psize(t),t.__leaves__.push(t))}function i(t){t.__x__=(c.tendancy.x||c.tendancy)(t.__leaves__,function(t){return t.__x__},function(t){return t.__size__}),t.__y__=(c.tendancy.y||c.tendancy)(t.__leaves__,function(t){return t.__y__},function(t){return t.__size__}),t.__size__=d3.sum(t.__leaves__,function(t){return t.__size__}),t.__children__&&t.__children__.length&&t.__children__.forEach(function(t){return i(t)})}function l(t){o(t),i(t)}var c={},u=function p(n){var e=n.selection?n:null,r=n.selection?n.selection():n,o=r.selectAll(".d2b-bubble-pack-graph").data(function(t){return t},c.key),i=o.enter().append("g").attr("class","d2b-bubble-pack-graph"),u=o.merge(i).order(),d=o.exit();return e&&(u=u.transition(e),d=d.transition(e)),u.style("opacity",1),d.style("opacity",0).remove(),n.each(function(n,r){var o=d3.select(this),i=o.selectAll(".d2b-bubble-pack-graph");o.on("change",function(){o.transition().duration(c.duration).call(p)}),i.each(function(t,n){var r=d3.select(this),i=c.x.call(this,t,n),u=c.y.call(this,t,n),d=c.color.call(this,t,n),s=c.symbol.call(this,t,n);t.values.forEach(l);var p=c.shift.call(this,t,n);null===p&&(p=i.bandwidth?i.bandwidth()/2:0),c.point.fill(function(t,n){return c.pcolor.call(this,t,n)||d}).type(function(t,n){return c.psymbol.call(this,t,n)||s}),a(r,t.values,e,i,u,p,o)}),t(o)}),p};d(u,c).addProp("point",s().active(!0),null,function(t){c.point.size(function(t){return 100*t.__size__}).active(function(t){return!!t.__children__})}).addProp("x",d3.scaleLinear(),function(t){return arguments.length?(t.domain?c.x=function(){return t}:c.x=t,u):c.x}).addProp("y",d3.scaleLinear(),function(t){return arguments.length?(t.domain?c.y=function(){return t}:c.y=t,u):c.y}).addProp("tendancy",r).addProp("duration",250).addPropFunctor("shift",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values}).addPropFunctor("color",function(t){return H(t.label)}).addPropFunctor("symbol",function(t){return d3.symbolCircle}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y}).addPropFunctor("psize",function(t){return t.size}).addPropFunctor("pchildren",function(t){return t.children}).addPropFunctor("pcolor",function(t){return null}).addPropFunctor("psymbol",null).addPropFunctor("pindicator",function(t){return t.label}).addPropFunctor("pkey",function(t,n){return n});return u}function F(t){function n(t,n,e,r,a,o,l){var c=void 0,u=void 0,d=l.prop(i.legendAt).split(" ");switch(d={x:d[1],y:d[0]},d.x){case"left":c=0;break;case"center":c=e/2-o.width/2;break;default:c=e-o.width}switch(d.y){case"bottom":u=r-o.height;break;case"center":u=r/2-o.height/2;break;default:u=0}var s=10,p={left:0,top:0,bottom:0,right:0};return o.height+=s,o.width+=s,"center"===d.x&&"center"===d.y||("horizontal"===a?"top"===d.y?p.top+=o.height:"bottom"===d.y&&(p.bottom+=o.height):"left"===d.x?p.left+=o.width:"right"===d.x&&(p.right+=o.width)),n.attr("transform","translate("+c+", "+u+")"),t.attr("transform","translate("+c+", "+u+")"),p}function e(t,n){var e=t.selection?t.selection():t,r={prop:function(n,e){var r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];return e=e||t,r.unshift(t),"function"==typeof n?n.apply(e,r):n},dispatch:function(n,e){var r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];return e=e||t,r.unshift(t),i.dispatch.apply(n,e,r)},context:t,selection:e,update:function(){var e=(t.selection?t.selection():t).transition().duration(r.prop(i.duration));a(e,n)}};return r}function r(t){var n={top:0,left:0,right:0,bottom:0};return"number"==typeof t?{top:t,left:t,right:t,bottom:t}:(["top","bottm","right","left"].forEach(function(e){t[e]&&n[e]==t[e]}),n)}function a(a,o){var l=e(a,o),c=a.selection?a.selection():a,u=c.datum(),d=l.prop(i.size),s=r(l.prop(i.padding)),p="translate("+s.left+", "+s.top+")";c.dispatch("beforeUpdate");var h=c.selectAll(".d2b-svg").data(function(t){return[t]}),f=h.enter().append("svg").attr("class","d2b-svg"),_=c.node().getBoundingClientRect(),v=d&&d.width?d.width:_.width,y=d&&d.height?d.height:_.height;f.attr("width",v).attr("height",y).append("g").attr("class","d2b-group").attr("transform",p),a.select(".d2b-svg").attr("width",v).attr("height",y).select(".d2b-group").attr("transform",p);var b=c.select(".d2b-group");v-=s.top+s.bottom,y-=s.left+s.right;var g=b.selectAll(".d2b-chart-legend").data(l.prop(i.legendHidden)?[]:[u]),m=g.enter().append("g").attr("class","d2b-chart-legend").style("opacity",0),x=g.exit();g=g.merge(m),a!==c&&(g=g.transition(a),x=x.transition(a).style("opacity",0)),g.style("opacity",1).call(i.legend.maxSize({width:v,height:y})),x.remove();var P={left:0,top:0};if(g.size()){var k=i.legend.computedSize(g),F=i.legend.orient().call(g.node(),u,o);P=n(g,m,v,y,F,k,l),v-=P.left+P.right,y-=P.top+P.bottom}var w="translate("+P.left+", "+P.top+")",A=b.selectAll(".d2b-chart-main").data(function(t){return[t]});A.enter().append("g").attr("class","d2b-chart-main").attr("transform",w);A=a.select(".d2b-chart-main").attr("transform",w),t(A,v,y,l),c.dispatch("afterUpdate")}var o=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],l=function(t){t.each(function(n,e){var r=d3.select(this),o=t.selection?r.transition(t):r;a(o,e)})},c=d(l,i).addProp("legend",h()).addPropFunctor("size",null).addPropFunctor("padding",0).addPropFunctor("duration",250).addPropFunctor("legendHidden",!1).addPropFunctor("legendAt","center right").addDispatcher(["beforeUpdate","afterUpdate"].concat(o));return c}function w(t){var n=arguments.length<=1||void 0===arguments[1]?1/0:arguments[1];t.each(function(){for(var t=d3.select(this),e=t.text().split(/\s+/).reverse(),r=void 0,a=[],o=0,i=1.1,l=parseFloat(t.attr("y"))||0,c=parseFloat(t.attr("dy"))||0,u=t.text(null).append("tspan").attr("x",0).attr("y",l).attr("dy",c+"em");r=e.pop();)a.push(r),u.text(a.join(" ")),u.node().getComputedTextLength()>n&&(a.pop(),u.text(a.join(" ")),a=[r],u=t.append("tspan").attr("x",0).attr("y",l).attr("dy",++o*i+c+"em").text(r))})}function A(t){var n=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return isNaN(t)||null===t?n:t}function z(t){var e=arguments.length<=1||void 0===arguments[1]?function(t){return t}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?function(t){return t}:arguments[2];return e=n(e),t.selection?void t.tween("text",function(t,n){var a=this,o=A(e.call(this,t,n));this.current=A(this.current,o);var i=d3.interpolate(this.current,o);return function(t){a.textContent=r(a.current=i(t))}}):t.text(function(t,n){return this.current=A(e.call(this,t,n)),r(this.current)})}function M(t,n){return t.selection?void t.attrTween("transform",function(t){var e=this;t=d2b.omit(t,["data"]),this.current=this.current||t;var r=d3.interpolate(this.current,t);return function(t){return e.current=r(t),"translate("+n.centroid(e.current)+")"}}):t.attr("transform",function(t){return this.current=f(t,["data"]),"translate("+n.centroid(this.current)+")"})}function T(){var t=arguments.length<=0||void 0===arguments[0]?d2b.id():arguments[0],n={},e=function u(t){return(t.selection?t.selection():t).on(l("mouseover"),a).on(l("mouseout"),i).on(l("mousemove"),o),u},r=function(t,e){var r=this.getBoundingClientRect(),a={},o=(n.at.call(this,t,e)||(d3.event.clientX>window.innerWidth/2?"center left":"center right")).split(" ");switch(o={x:o[1],y:o[0]},o.x){case"left":a.x=r.left;break;case"center":a.x=r.left+r.width/2;break;default:a.x=r.left+r.width}switch(o.y){case"bottom":a.y=r.top+r.height;break;case"center":a.y=r.top+r.height/2;break;default:a.y=r.top}return a},a=function(t,e){n.tooltip=n.selection.selectAll(".d2b-tooltip").data(function(t){return[t]});var r=n.tooltip.enter().append("div").style("opacity",0).attr("class","d2b-tooltip");r.append("div").attr("class","d2b-tooltip-content"),n.tooltip=n.tooltip.merge(r),n.tooltip.transition().duration(100).style("opacity",1),n.dispatch.call("insert",n.tooltip,this,t,e)},o=function(t,e){var a=n.html.call(this,t,e),o=n.target.call(this,t,e),i=n.color.call(this,t,e),l=o?o.node():this,c=n.followMouse.call(this,t,e)?{x:d3.event.clientX,y:d3.event.clientY}:r.call(l,t,e),u=n.my.call(this,t,e)||(d3.event.clientX>window.innerWidth/2?"left":"right");n.tooltip.attr("class","d2b-tooltip d2b-tooltip-"+u).style("top",c.y+"px").style("left",c.x+"px").style("border-color",i).select(".d2b-tooltip-content").html(a),n.dispatch.call("move",n.tooltip,this,t,e)},i=function(t,e){n.tooltip.transition().duration(100).style("opacity",0).remove(),n.dispatch.call("remove",n.tooltip,this,t,e)},l=function(t){return t+".d2b-tooltip"},c=function(r,a){a&&a.select(".d2b-tooltip-area-"+t).remove(),r&&(n.selection=r.selectAll(".d2b-tooltip-area-"+t).data([e]),
n.selection=n.selection.merge(n.selection.enter().append("div").attr("class","d2b-tooltip-area-"+t+" d2b-tooltip-area")))};d(e,n).addProp("container",d3.select("body"),null,c).addMethod("clear",function(t){oldGraph.on(l("mouseover"),null).on(l("mouseout"),null).on(l("mousemove"),null)}).addPropFunctor("followMouse",!1).addPropFunctor("color",null).addPropFunctor("my",null).addPropFunctor("at",null).addPropFunctor("target",null).addPropFunctor("html",null).addDispatcher(["insert","move","remove"]);return e}function B(){function t(t,n,e,r){}var n=F(t,["zoomIn","zoomOut"]).addPropFunctor("interpolate","linear"),e=n.values(),r=n.base();return e.legend.items(function(t){return t}).active(!0).clickable(!0).dblclickable(!0),r}function E(){function t(t,a,i,s){var p=t.selection?t.selection():t,h=p.node(),f=p.datum(),_=o.radius.call(h,f,a,i),v=o.startAngle.call(h,f),y=o.endAngle.call(h,f),b=o.donutRatio.call(h,f),g=(o.at.call(h,f),o.values.call(h,f).filter(function(t){return!t.__empty__}));s.selection.select(".d2b-chart-legend").on("change",s.update).selectAll(".d2b-legend-item").on("mouseover",function(t){return d3.select(t.__arc__).each(e)}).on("mouseout",function(t){return d3.select(t.__arc__).each(r)});var m=d3.sum(g,function(t,n){return t.__value__=o.value(t,n)}),x=p.selectAll(".d2b-pie-chart").data([g]),P=x.enter().append("g").attr("class","d2b-pie-chart");x=x.merge(P).datum(function(t){return t=l.startAngle(v).endAngle(y)(t),t.forEach(function(t){t.outerRadius=_,t.innerRadius=_*b}),t}),p!==t&&(x=x.transition(t)),x.call(u);var k=p.selectAll(".d2b-pie-arc").each(function(t,n){this.outerRadius=t.outerRadius,t.data.__arc__=this,t.data.__percent__=t.data.__value__/m}).on("mouseover",e).on("mouseout",r).call(o.tooltip),F=k.selectAll(".d2b-pie-arc-percent").data(function(t){return[t]});F.enter().append("g").attr("class","d2b-pie-arc-percent").append("text").attr("y",6),k.each(function(t){var n=d3.select(this),e=n.select(".d2b-pie-arc path").node().current,r=n.select(".d2b-pie-arc-percent"),a=r.select("text").node();r.node().current=e,a.current=a.current||0}),p!==t&&(k=k.each(function(t){this.transitioning=!0}).transition(t).on("end",function(t){this.transitioning=!1})),k.select(".d2b-pie-arc-percent").call(d2b.tweenCentroid,c).select("text").call(z,function(t){return t.data.__percent__},d).style("opacity",function(t,n){return o.showPercent.call(this,t.data,n)?1:0});var w=n(h,f,_,a,i);P.attr("transform","translate("+w.x+", "+w.y+")"),x.attr("transform","translate("+w.x+", "+w.y+")")}function n(t,n,e,r,a){var i=o.center.call(t,n,r,a,e),l=o.at.call(t,n,r,a).split(" ");if(!i){switch(l={x:l[1],y:l[0]},i={},l.x){case"left":i.x=e;break;case"center":i.x=r/2;break;default:i.x=r-e}switch(l.y){case"bottom":i.y=a-e;break;case"center":i.y=a/2;break;default:i.y=e}}return i}function e(t){if(!this.transitioning){var n=d3.select(this).select("path");t.outerRadius=1.03*this.outerRadius,n.transition().call(_,c)}}function r(t){if(!this.transitioning){var n=d3.select(this).select("path");t.outerRadius=this.outerRadius,n.transition().call(_,c)}}var a=F(t),o=a.values(),i=a.base();o.legend.active(!0).clickable(!0).dblclickable(!0);var l=d3.pie().sort(null),c=d3.arc().outerRadius(function(t){return t.outerRadius}).innerRadius(function(t){return t.innerRadius}),u=d2b.svgPie().arc(c),d=d3.format(".0%");return a.addProp("key",function(t){return t.label},null,function(t){o.legend.key(t),u.key(t)}).addProp("tooltip",T().followMouse(!0).html(function(t){return"<b>"+o.label(t.data)+":</b> "+o.value(t.data)})).addPropFunctor("values",function(t){return t}).addPropFunctor("donutRatio",0).addPropFunctor("startAngle",0).addPropFunctor("endAngle",2*Math.PI).addPropFunctor("at","center center").addPropFunctor("showPercent",function(t,n){return t.__percent__>.03}).addPropFunctor("center",null).addPropFunctor("radius",function(t,n,e){return Math.min(n,e)/2}).addPropFunctor("sort",null).addPropFunctor("color",function(t){return d2b.defaultColor(t.label)},null,function(t){o.tooltip.color(function(n){return d3.rgb(t(n.data)).darker(.3)}),o.legend.color(t),u.color(t)}).addPropFunctor("value",function(t){return t.value},null,function(t){return l.value(t)}).addPropFunctor("label",function(t){return t.label},null,function(t){return o.legend.label(t)}),i}var R=Math.PI,C=Math.sqrt(8),N=Math.sqrt(2),W={draw:function(t,n){var e=Math.sqrt(n/(R+5/4)),r=.3125*e,a=2*Math.asin(.25),o=(R/2-a)/2,i=e/C-e*Math.cos(o),l=e*Math.sin(o);t.arc(i,l,e,-o,2*R-a-o),t.lineTo(e*(5/4-1/N),-e*(1/C+5/4-1/N)),t.lineTo(e*(5/4-1/N)-r,-e*(1/C+5/4-1/N)),t.lineTo(e*(5/4-1/N)-r,-e*(1/C+7/4-1/N)),t.lineTo(e*(7/4-1/N+1/C),-e*(1/C+7/4-1/N)),t.lineTo(e*(7/4-1/N+1/C),-e*(5/4-1/N)+r),t.lineTo(e*(5/4-1/N+1/C),-e*(5/4-1/N)+r),t.lineTo(e*(5/4-1/N+1/C),-e*(5/4-1/N)),t.closePath()}},L={draw:function(t,n){var e=Math.sqrt(n/(R+5/4)),r=2*Math.asin(.25),a=e/4-e*Math.cos(r/2);t.arc(0,a,e,3*-R/2+r/2,R/2-r/2),t.lineTo(e/4,3*e/4),t.lineTo(3*e/4,3*e/4),t.lineTo(3*e/4,5*e/4),t.lineTo(e/4,5*e/4),t.lineTo(e/4,7*e/4),t.lineTo(-e/4,7*e/4),t.lineTo(-e/4,5*e/4),t.lineTo(3*-e/4,5*e/4),t.lineTo(3*-e/4,3*e/4),t.lineTo(-e/4,3*e/4),t.closePath()}},H=d3.scaleCategory10();t.symbolMars=W,t.symbolVenus=L,t.mean=r,t.median=a,t.midpoint=l,t.mode=o,t.range=i,t.toDegrees=c,t.toRadians=u,t.point=s,t.legend=h,t.svgPie=v,t.svgLine=y,t.svgArea=m,t.svgScatter=x,t.svgBar=P,t.svgBubblePack=k,t.modelBase=d,t.modelChart=F,t.defaultColor=H,t.id=g,t.textWrap=p,t.textWrapPX=w,t.tweenCentroid=M,t.tweenNumber=z,t.tweenArc=_,t.tooltip=T,t.stack=b,t.omit=f,t.chartTemplate=B,t.chartPie=E});