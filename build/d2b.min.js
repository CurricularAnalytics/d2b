!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.d2b=t.d2b||{})}(this,function(t){"use strict";function n(t){return"function"==typeof t?t:function(){return t}}function e(t){return null===t?NaN:+t}function r(t,r,a){var o=0,i=0;return a=n(a||1),r=n(r||function(t){return t}),t.filter(function(t){return!isNaN(e(a(t)))&&!isNaN(e(r(t)))}).forEach(function(t){var n=a(t),e=r(t);o+=n,i+=e*n}),t.length&&o?i/o:void 0}function a(t,a,o){o=n(o||1),a=n(a||function(t){return t});var i,l=[],c=t.filter(function(t){return 0!==o(t)&&!isNaN(e(o(t)))&&!isNaN(e(a(t)))}).sort(function(t,n){return d3.ascending(a(t),a(n))});i=Math.round(d3.sum(c,function(t){return o(t)})/2*1e12)/1e12;var u=0,d=!1;return c.forEach(function(t){d&&(l.push(a(t)),d=!1),u+=o(t),u===i&&(l.push(a(t)),d=!0),u>i&&0===l.length&&l.push(a(t))}),t.length?r(l):void 0}function o(t,a,o){o=n(o||1),a=n(a||function(t){return t});var i=[],l=0,c={};return t.forEach(function(t){var n=e(a(t));isNaN(a(t))||(c[n]=c[n]||0,c[n]+=o(t),c[n]>l?(l=c[a(t)],i=[a(t)]):c[a(t)]==l&&i.push(a(t)))}),t.length?r(i):void 0}function l(t,e){e=n(e||function(t){return t});var r=d3.extent(t,e);return t.length?r[1]-r[0]:void 0}function c(t,e){return e=n(e||function(t){return t}),t.length?d3.mean(d3.extent(t,e)):void 0}function u(t){return t*(Math.PI/180)}function s(t){return t*(180/Math.PI)}function p(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=arguments[2],o=function(n,e){return function(a){if(!arguments.length)return r[n];var o=r[n];return r[n]=a,e&&e(a,o),t}},i=function(t){return function(n){return r[t]}},l=function(e,a){return function(o){if(!arguments.length)return r[e];var i=r[e];return r[e]=n(o),a&&a(r[e],i),t}},c=function(e,a){return function(o){if(!arguments.length)return r[e];var i=r[e];return o&&o.domain?r[e]=function(){return o}:r[e]=n(o),a&&a(r[e],i),t}},u={base:function(){return t},values:function(){return r},removeProp:function(n){return-1!==a.indexOf(n)?(console.error("Cannot remove "+n+" property or value"),u):(r[n]=null,t[n]=null,u)},addProp:function(n){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a=arguments.length<=2||void 0===arguments[2]?o(n):arguments[2],i=arguments[3];return r[n]||t[n]?(console.error(n+" property is already defined."),u):(a=a||o(n,i),a(e),t[n]=a,u)},addPropGet:function(n){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a=arguments.length<=2||void 0===arguments[2]?i(n):arguments[2];return r[n]||t[n]?(console.error(n+" property is already defined."),u):(r[n]=e,t[n]=a,u)},addMethod:function(n,e){return t[n]?(console.error(n+" method is already defined."),u):(t[n]=e,u)},addPropFunctor:function(n){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a=arguments.length<=2||void 0===arguments[2]?l(n):arguments[2],o=arguments[3];return r[n]||t[n]?(console.error(n+" property is already defined."),u):(a=a||l(n,o),a(e),t[n]=a,u)},addScaleFunctor:function(t){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1],e=arguments.length<=2||void 0===arguments[2]?c(t):arguments[2],r=arguments[3];return u.addProp(t,n,e,r)},addDispatcher:function(n){var a=arguments.length<=1||void 0===arguments[1]?"on":arguments[1],o=arguments.length<=2||void 0===arguments[2]?"dispatch":arguments[2];return t[a]?(console.error(a+" property is already defined."),u):r[o]?(console.error(o+" value is already defined."),u):(t[a]=function(n,e){return 0===arguments.length?r[o]:1===arguments.length?r[o].on(n):(r[o].on(n,e),t)},r[o]=d3.dispatch.apply(e,n),u)}};return u}function f(){function t(t,n){return i.empty.call(this,t,n)?0:1}function n(t,n){var e=i.size.call(this,t,n),r=i.empty.call(this,t,n);return c.size(r?e:2.5*e).call(this,t,n)}function e(t,n){var e=i.size.call(this,t,n),r=i.empty.call(this,t,n);return c.size(r?e/3:e).call(this,t,n)}function r(t,n){var e=i.size.call(this,t,n);return c.size(e).call(this,t,n)}function a(t,r){var a=(i.size.call(this,t,r),i.empty.call(this,t,r));d3.select(this).select("path.d2b-point-back").transition().duration(100).attr("d",n),d3.select(this).select("path.d2b-point-front").transition().duration(100).style("opacity",a?.5:1).attr("d",e)}function o(t,n){var a=(i.size.call(this,t,n),i.empty.call(this,t,n));d3.select(this).select("path.d2b-point-back").transition().duration(100).attr("d",r),d3.select(this).select("path.d2b-point-front").transition().duration(100).style("opacity",a?0:1).attr("d",e)}var i={},l=function u(n){var l=n.selection?n.selection():n,c=l.selectAll("path.d2b-point-back").data(function(t){return[t]});c.enter().append("path").attr("class","d2b-point-back").attr("d",r).style("fill-opacity",0).style("stroke",i.stroke).style("stroke-width",i.strokeWidth);n!==l&&(c=c.transition(n)),c.attr("d",r).style("stroke",i.stroke).style("stroke-width",i.strokeWidth);var d=l.selectAll("path.d2b-point-front").data(function(t){return[t]});d.enter().append("path").attr("class","d2b-point-front").attr("d",e).style("opacity",t).style("fill",i.fill).style("stroke",i.stroke).style("stroke-width",i.strokeWidth);return n!==l&&(d=d.transition(n)),d.attr("d",e).style("opacity",t).style("fill",i.fill).style("stroke",i.stroke).style("stroke-width",i.strokeWidth),l.each(function(t,n){var e=i.active.call(this,t,n);d3.select(this).on("mouseover.d2b-point",e?a:null).on("mouseout.d2b-point",e?o:null)}),u},c=d3.symbol();p(l,i).addPropFunctor("size",150,null,function(t){return c.size(t)}).addPropFunctor("type",d3.symbolCircle,null,function(t){return c.type(t)}).addPropFunctor("active",!1).addPropFunctor("empty",!1).addPropFunctor("fill","steelblue").addPropFunctor("stroke",function(t,n){return d3.rgb(i.fill.call(this,t,n)).darker(.3)}).addPropFunctor("strokeWidth","1px");return l}function h(t){var e=arguments.length<=1||void 0===arguments[1]?function(t){return t.label}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?1/0:arguments[2],a=arguments.length<=3||void 0===arguments[3]?"start":arguments[3];e=n(e),t.each(function(t,n){var o=d3.select(this),i=(""+e.call(this,t,n)).split(/\s+/).reverse(),l=void 0,c=[],u=[i.pop()],d=1.1,s=+o.attr("x"),p=+o.attr("y"),f=parseFloat(o.attr("dy"))||0;for(-1===o.html().indexOf("tspan")&&o.text("");l=i.pop();)u.join(" ").length+l.length>r&&(c.push(u),u=[]),u.push(l);c.push(u);var h=o.selectAll("tspan").data(c),y=(c.length-1)*d,g="end"===a?y:"middle"===a?y/2:0;h.merge(h.enter().append("tspan")).text(function(t){return t.join(" ")}).attr("x",s).attr("y",p).attr("dy",function(t,n){return f+n*d-g+"em"})})}function y(){function t(t,r){t.selectAll(".d2b-legend-item").on("click",function(e,a){n.call(this,e,a,t,r)}).on("dblclick",function(n,a){e.call(this,n,a,t,r)})}function n(t,n,e,r){var o=a.clickable.call(this,t,n),l=a.allowEmptied.call(e.node(),e.datum(),r);e.datum(),e.node();if(o){a.setEmpty(t,n,!a.empty(t,n));var c=d3.select(this),u=e.selectAll(".d2b-legend-item"),d=!0;u.each(function(t,n){return d=a.empty(t,n)?d:!1}),d&&!l?(u.each(function(t,n){return a.setEmpty(t,n,!1)}).transition().duration(100).call(i),u.filter(function(n){return n!=t}).dispatch("change")):c.transition().duration(100).call(i),c.dispatch("change",{bubbles:!0})}}function e(t,n,e,r){var o=a.dblclickable.call(this,t,n);e.datum();if(o){var l=e.selectAll(".d2b-legend-item");l.each(function(t,n){return a.setEmpty(t,n,!0)}),a.setEmpty(t,n,!1),l.transition().duration(100).call(i),l.filter(function(n){return n!=t}).dispatch("change"),d3.select(this).dispatch("change",{bubbles:!0})}}function r(t,n,e,r){var a=0,o=0;switch(r[1]){case"center":case"middle":o=e.height/2-n.height/2;break;case"bottom":o=e.height-n.height;break;case"top":default:o=0}switch(r[2]){case"center":case"middle":a=e.width/2-n.width/2;break;case"right":a=e.width-n.width;break;case"left":default:a=0}n.left=a,n.right=e.width-a+n.width,n.top=o,n.bottom=e.height-o+n.height,t.attr("transform","translate("+a+", "+o+")")}var a={},o=function c(n){return n.each(function(e,o){var c=d3.select(this),u=a.itemSize.call(this,e,o),d=a.size.call(this,e,o),s=a.orient.call(this,e,o).split(" "),p=s[0],f=a.maxTextLength.call(this,e,o),y=a.items.call(this,e,o);i.size(1.5*Math.pow(u/2,2)).strokeWidth(.1*u);var g=c.selectAll(".d2b-legend").data([y]),x=g.enter().append("g").attr("class","d2b-legend");g=g.merge(x);var v=g.selectAll(".d2b-legend-item").data(function(t){return t.sort(a.order)},a.key),b=v.enter().append("g").attr("class","d2b-legend-item").style("opacity",0);b.append("g").append("text");var m=v.exit();v=v.merge(b).style("cursor",function(t,n){var e=a.clickable.call(this,t,n),r=a.dblclickable.call(this,t,n);return e||r?"pointer":"auto"}),c.call(t,o);var P=v.select("g").attr("transform","translate("+u/2+", "+u/2+")"),k=v.select("text").attr("transform","translate("+u/1.5+", "+u/3+")").style("font-size",u+"px").call(h,a.label,f);n.selection&&(m=m.transition(n).style("opacity",0),v=v.transition(n),P=P.transition(n),k=k.transition(n),g=g.transition(n)),m.remove(),P.call(i);var F=0;k.each(function(){F=Math.max(F,this.getBBox().width)}),F+=u;var w={x:u,y:5};b.call(l[p],{},w,u,d,F),this.__box__={width:0,height:0,top:0,left:0,right:0,bottom:0},v.style("opacity",1).call(l[p],this.__box__,w,u,d,F),x.call(r,this.__box__,d,s),g.call(r,this.__box__,d,s)}),c},i=f(),l={horizontal:function(t,n,e,r,a,o){var i=0,l=0,c=0;t.attr("transform",function(){var t=d3.select(this),u=r*t.selectAll("tspan").size(),d=t.select("text").node().getBBox().width;i+o>a.width&&(i=0,l+=c+e.y,c=0);var s="translate("+i+", "+l+")";return c=Math.max(c,u),n.width=Math.max(n.width,i+d+1.5*r),i+=o+e.x,s}),n.height=l+c},vertical:function(t,n,e,r,a){var o=0,i=0,l=0;t.attr("transform",function(){var t=d3.select(this),c=r*t.selectAll("tspan").size(),u=t.select("text").node().getBBox().width;i+c>a.height&&(o+=l+e.x+r,i=0,l=0);var d="translate("+o+", "+i+")";return l=Math.max(l,u),n.height=Math.max(n.height,i+c),i+=c+e.y,d}),n.width=o+l+1.5*r}};p(o,a).addPropFunctor("items",function(t){return t}).addPropFunctor("itemSize",12).addPropFunctor("size",{width:960,height:500}).addPropFunctor("orient","vertical center right").addPropFunctor("maxTextLength",1/0).addPropFunctor("allowEmptied",!1).addPropFunctor("order",function(t,n){return d3.ascending(a.label(t),a.label(n))}).addPropFunctor("key",function(t,n){return n}).addPropFunctor("clickable",!1).addPropFunctor("dblclickable",!1).addPropFunctor("label",function(t){return t.label}).addPropFunctor("empty",function(t){return t.empty},null,function(t){return i.empty(t)}).addPropFunctor("setEmpty",function(t,n,e){t.empty=e}).addPropFunctor("active",!1,null,function(t){return i.active(t)}).addPropFunctor("symbol",d3.symbolCircle,null,function(t){return i.type(t)}).addPropFunctor("color",function(t){return I(t.label)},null,function(t){return i.fill(t)}).addMethod("box",function(t){var n=t.node?t.node():t;return n?n.__box__:null});return o}function g(t,n){var e={};for(var r in t)"function"!=typeof t[r]&&n.indexOf(r)<0&&(e[r]=t[r]);return e}function x(t,n){return t.selection?void t.attrTween("d",function(t){var e=this;t=g(t,["data"]),this.current=this.current||t;var r=d3.interpolate(this.current,t);return function(t){return e.current=r(t),n(e.current)}}):t.attr("d",function(t){return this.current=g(t,["data"]),n(t)})}function v(){function t(t,r,a){var o=void 0;return(o=n(t,r,a))?{startAngle:o.endAngle,endAngle:o.endAngle}:(o=e(t,r,a))?{startAngle:o.startAngle,endAngle:o.startAngle}:{startAngle:0,endAngle:0}}function n(t,n,e){for(var a=n.length;--t>=0;)for(var o=r.key(e[t].data,t),i=0;a>i;++i)if(r.key(n[i].data,i)===o)return n[i]}function e(t,n,e){for(var a=e.length,o=n.length;++t<a;)for(var i=r.key(e[t].data,t),l=0;o>l;++l)if(r.key(n[l].data,l)===i)return n[l]}var r={},a=function o(n){var e=n.selection?n.selection():n;return e.each(function(a,o){var i=d3.select(this),l=i.selectAll(".d2b-pie-arc"),c=l.data();l=l.data(r.values,function(t,n){return r.key(t.data,n)});var u=l.enter().append("g").attr("class","d2b-pie-arc"),d=l.exit(),s=l.merge(u).order();u.append("path").attr("fill",function(t,n){return r.color.call(this,t.data,n)});var p=s.data();u.select("path").each(function(n,e){this.current=t(e,c,p)}),d.datum(function(n,e){var r=t(e,p,c);return r.data=n.data,r}),n!==e&&(d=d.transition(n),s=s.transition(n)),s.select("path").call(x,r.arc).attr("fill",function(t,n){return r.color.call(this,t.data,n)}),d.remove().select("path").call(x,r.arc)}),o};p(a,r).addProp("key",function(t){return t.label}).addProp("arc",d3.arc().innerRadius(100).outerRadius(200)).addPropFunctor("values",function(t){return t}).addPropFunctor("color",function(t){return I(t.label)});return a}function b(){var t={},n=function(n){var e=this,r=n;n=n.map(t.values);var a=[],o=n.map(function(n,r){var o={};return n.forEach(function(n,r){var i=t.x.call(e,n,r);a.push(i),o[i]=t.y.call(e,n,r)}),o});a=d3.set(a).values();var i=a.reduce(function(t,n,e){return t[n]=e,t},{}),l=d3.range(0,n.length),c=a.map(function(t,n){return o.map(function(n,e){return n[t]||0})}),u=t.stack.keys(l).value(function(t,n){return t[n]||0})(c);return n.forEach(function(n,r){n.forEach(function(n,a){var o=t.x.call(e,n,a),l=u[r][i[o]];t.out.call(e,n,l[0],l[1],o)})}),r};p(n,t).addProp("stack",d3.stack()).addPropFunctor("values",function(t){return t}).addPropFunctor("x",function(t){return t.x}).addPropFunctor("y",function(t){return t.y}).addPropFunctor("out",function(t,n,e){t.y0=n,t.y1=e});return n}function m(){return Math.random().toString(36).substr(2,9)}function P(){function t(t,e){var o=n.graphs(t,e).map(function(t,e){var r={data:t,index:e,x:n.x(t,e),y:n.y(t,e),tooltipGraph:n.tooltipGraph(t,e),shift:n.shift(t,e),stackBy:n.stackBy(t,e),key:n.key(t,e),color:n.color(t,e)};return r.values=n.values(t,e).map(function(t,e){return{data:t,index:e,graph:r,x:n.px(t,e),y:n.py(t,e)}}),r});return a.entries(o).forEach(function(t){return r(t.values)}),o}var n={},e=function o(e){var r=e.selection?e.selection():e,a=r.selectAll(".d2b-line-graph").data(function(n,e){return t(n,e)},function(t){return t.key}),i=a.enter().append("g").attr("class","d2b-line-graph d2b-graph").style("opacity",0);i.append("path").attr("class","d2b-line");var l=a.merge(i).order(),c=a.exit(),u=l.select(".d2b-line");return e!==r&&(l=l.transition(e),c=c.transition(e),u=u.transition(e)),l.style("opacity",1),c.style("opacity",0).remove(),u.style("stroke",function(t){return t.color}).attr("d",function(t,e){var r=t.x,a=t.y,o=t.shift;return null===o&&(o=r.bandwidth?r.bandwidth()/2:0),t.tooltipGraph&&t.tooltipGraph.data(t.values).x(function(t,n){return r(t.x)+o}).y(function(t,n){return a(t.y1)}).color(t.color),n.line.x(function(t,n){return r(t.x)+o}).y(function(t,n){return a(t.y1)})(t.values)}),o},r=b().values(function(t){return t.values}).y(function(t){return t.y}).x(function(t){return t.x}),a=d3.nest().key(function(t){var n=t.stackBy;return n!==!1&&null!==n?n:m()});p(e,n).addProp("line",d3.line()).addPropFunctor("graphs",function(t){return t}).addScaleFunctor("x",d3.scaleLinear()).addScaleFunctor("y",d3.scaleLinear()).addPropFunctor("tooltipGraph",function(t){return t.tooltipGraph}).addPropFunctor("shift",null).addPropFunctor("stackBy",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values}).addPropFunctor("color",function(t){return I(t.label)}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y}).addMethod("getComputedGraphs",function(n){return(n.selection?n.selection():n).data().map(function(n,e){return t(n,e)})}).addMethod("getVisiblePoints",function(t){var n=e.getComputedGraphs(t);return n.map(function(t){return[].concat.apply([],t.map(function(t){return t.values.map(function(n){return{x:n.x,y:n.y1,graph:t}})}))})});return e}function k(){function t(t,e){var o=n.graphs(t,e).map(function(t,e){var r={data:t,index:e,x:n.x(t,e),y:n.y(t,e),tooltipGraph:n.tooltipGraph(t,e),shift:n.shift(t,e),stackBy:n.stackBy(t,e),key:n.key(t,e),color:n.color(t,e)};return r.values=n.values(t,e).map(function(t,e){return{data:t,index:e,graph:r,x:n.px(t,e),y:n.py(t,e)}}),r});return a.entries(o).forEach(function(t){return r(t.values)}),o}var n={},e=function o(e){var r=e.selection?e.selection():e,a=r.selectAll(".d2b-area-graph").data(function(n,e){return t(n,e)},function(t){return t.key}),i=a.enter().append("g").attr("class","d2b-area-graph d2b-graph").style("opacity",0);i.append("path").attr("class","d2b-area");var l=a.merge(i).order(),c=a.exit(),u=l.select(".d2b-area");return e!==r&&(l=l.transition(e),c=c.transition(e),u=u.transition(e)),l.style("opacity",1),c.style("opacity",0).remove(),u.style("fill",function(t){return t.color}).attr("d",function(t,e){var r=t.x,a=t.y,o=t.shift;return null===o&&(o=r.bandwidth?r.bandwidth()/2:0),t.tooltipGraph&&t.tooltipGraph.data(t.values).x(function(t,n){return r(t.x)+o}).y(function(t,n){return a(t.y1)}).color(t.color),n.area.x(function(t,n){return r(t.x)+o}).y0(function(t,n){return a(t.y0)}).y1(function(t,n){return a(t.y1)})(t.values)}),o},r=b().values(function(t){return t.values}).y(function(t){return t.y}).x(function(t){return t.x}),a=d3.nest().key(function(t){var n=t.stackBy;return n!==!1&&null!==n?n:m()});p(e,n).addProp("area",d3.area()).addPropFunctor("graphs",function(t){return t}).addScaleFunctor("x",d3.scaleLinear()).addScaleFunctor("y",d3.scaleLinear()).addPropFunctor("tooltipGraph",function(t){return t.tooltipGraph}).addPropFunctor("shift",null).addPropFunctor("stackBy",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values}).addPropFunctor("color",function(t){return I(t.label)}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y}).addMethod("getComputedGraphs",function(n){return(n.selection?n.selection():n).data().map(function(n,e){return t(n,e)})}).addMethod("getVisiblePoints",function(t){var n=e.getComputedGraphs(t);return n.map(function(t){var n=[].concat.apply([],t.map(function(t){return t.values.map(function(n){return{x:n.x,y:n.y0,graph:t}})})),e=[].concat.apply([],t.map(function(t){return t.values.map(function(n){return{x:n.x,y:n.y1,graph:t}})}));return n.concat(e)})});return e}function F(){function t(t,n){var r=e.graphs(t,n).map(function(t,n){var r={data:t,index:n,x:e.x(t,n),y:e.y(t,n),tooltipGraph:e.tooltipGraph(t,n),shift:e.shift(t,n),stackBy:e.stackBy(t,n),key:e.key(t,n),color:e.color(t,n),symbol:e.symbol(t,n)};return r.values=e.values(t,n).map(function(t,n){return{data:t,index:n,graph:r,x:e.px(t,n),y:e.py(t,n),color:e.pcolor(t,n),symbol:e.psymbol(t,n),key:e.pkey(t,n),size:e.psize(t,n)}}),r});return o.entries(r).forEach(function(t){return a(t.values)}),r}function n(t,n,e,r){t.attr("transform",function(t,a){return"translate("+(n(t.x)+r)+", "+e(t.y1)+")"})}var e={},r=function i(r){var a=r.selection?r.selection():r,o=a.selectAll(".d2b-scatter-graph").data(function(n,e){return t(n,e)},function(t){return t.key}),l=o.enter().append("g").attr("class","d2b-scatter-graph d2b-graph").style("opacity",0),c=o.merge(l).order(),u=o.exit();return r!==a&&(c=c.transition(r),u=u.transition(r)),c.style("opacity",1),u.style("opacity",0).remove(),c.each(function(t,o){var i=d3.select(this),l=t.x,c=t.y,u=t.shift;null===u&&(u=l.bandwidth?l.bandwidth()/2:0),t.tooltipGraph&&t.tooltipGraph.data(t.values).x(function(n){return l(n.x)+t.shift}).y(function(t){return c(t.y)}).color(function(n){return n.color||t.color}),e.point.fill(function(n){return n.color||t.color}).type(function(n){return n.symbol||t.symbol}).size(function(t){return t.size});var d=i.selectAll(".d2b-scatter-point").data(t.values,function(t){return t.key}),s=d.enter().append("g").attr("class","d2b-scatter-point"),p=d.merge(s).order(),f=d.exit();r!==a&&(p=p.transition(r),f=f.transition(r)),s.style("opacity",0).call(n,l,c,u),p.style("opacity",1).call(e.point).call(n,l,c,u),f.style("opacity",0).remove()}),i},a=b().values(function(t){return t.values}).y(function(t){return t.y}).x(function(t){return t.x}),o=d3.nest().key(function(t){var n=t.stackBy;return n!==!1&&null!==n?n:m()});p(r,e).addProp("point",f().active(!0)).addPropFunctor("graphs",function(t){return t}).addScaleFunctor("x",d3.scaleLinear()).addScaleFunctor("y",d3.scaleLinear()).addPropFunctor("tooltipGraph",function(t){return t.tooltipGraph}).addPropFunctor("shift",null).addPropFunctor("stackBy",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values}).addPropFunctor("color",function(t){return I(t.label)}).addPropFunctor("symbol",function(t){return d3.symbolCircle}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y}).addPropFunctor("pcolor",function(t){return null}).addPropFunctor("psymbol",null).addPropFunctor("pkey",function(t,n){return n}).addPropFunctor("psize",function(t){return 25}).addMethod("getComputedGraphs",function(n){return(n.selection?n.selection():n).data().map(function(n,e){return t(n,e)})}).addMethod("getVisiblePoints",function(t){var n=r.getComputedGraphs(t);return n.map(function(t){return[].concat.apply([],t.map(function(t){return t.values.map(function(n){return{x:n.x,y:n.y1,graph:t}})}))})});return r}function w(){function t(t){return"horizontal"===t?{rotate:!0,px:"py",py:"px",x:"y",y:"x",w:"height",h:"width"}:{rotate:!1,px:"px",py:"py",x:"x",y:"y",w:"width",h:"height"}}function n(n,r){var a=arguments.length<=2||void 0===arguments[2]?t(o.orient(n,r)):arguments[2],i=o.graphs(n,r).map(function(t,n){var e={data:t,index:n,x:o.x(t,n),y:o.y(t,n),tooltipGraph:o.tooltipGraph(t,n),shift:o.shift(t,n),stackBy:o.stackBy(t,n),key:o.key(t,n),color:o.color(t,n)};return e.values=o.values(t,n).map(function(t,n){return{data:t,index:n,graph:e,key:o.pkey(t,n),x:o.px(t,n),y:o.py(t,n),centered:o.pcentered(t,n),color:o.pcolor(t,n)}}),e});return l.x(function(t){return t[a.x]}).y(function(t){return t[a.y]}),c.entries(i).forEach(function(t,n){return l.out(e(n))(t.values)}),i}function e(t){var n={};return function(e,r,a,o){var i=n[o]=n[o]||[0,0];e.dy=a-r,e.stackIndex=t,e.base=o,e.dy>0?e.extent=[i[0],i[0]+=e.dy]:e.extent=[i[1],i[1]+=e.dy]}}function r(t,n,e){t.attr("transform",function(t){return"translate("+[n[e.x](t),n[e.y](t)]+")"})}function a(t,n){var e=[];t.forEach(function(t){var r=t[n.x],a=t.values;a.forEach(function(t){e.push(r(t.x))})}),e.sort(d3.ascending);for(var r=1/0,a=0;a<e.length-1;a++)e[a+1]!==e[a]&&(r=Math.min(e[a+1]-e[a],r));return r}var o={},i=function u(e){var i=e.selection?e.selection():e;return i.each(function(l,u){var d=o.orient(l,u),s=t(d),p=n(l,u,s),f=o.padding(l,u),h=o.groupPadding(l,u),y=o.bandwidth(l,u);y=(1-f)*(y||a(p,s));var g=c.entries(p),x=y/g.length;h=x*h;var v=d3.select(this).selectAll(".d2b-bar-graph").data(p,function(t){return t.key}),b=v.enter().append("g").attr("class","d2b-bar-graph d2b-graph").style("opacity",0),m=v.merge(b).order(),P=v.exit();e!==i&&(m=m.transition(e),P=P.transition(e)),m.style("opacity",1),P.style("opacity",0).remove(),m.each(function(t){var n=d3.select(this),a=t.x,o=t.y,l=t.shift;null===l&&(l=a.bandwidth?a.bandwidth()/2:0);var c=n.selectAll(".d2b-bar-group").data(t.values,function(t){return t.key}),u=c.enter().append("g").attr("class","d2b-bar-group");u.append("rect");var d=c.merge(u).order(),p=c.exit();d.each(function(t){var n=t.centered?l-y/4:l-y/2+t.stackIndex*x+h;t.basepx=a(t.base)+n,t.extentpx=[o(t.extent[0]),o(t.extent[1])],t.extentpx.sort(d3.ascending)}),t.tooltipGraph&&t.tooltipGraph.data(t.values)[s.x](function(t){return a(t[s.x]+l)})[s.y](function(t){return o(t.extent[1])}).color(function(n){return n.color||t.color}),e!==i&&(d=d.transition(e),p=p.transition(e)),u.attr("class","d2b-bar-group").style("opacity",0).call(r,{x:function(t){return t.basepx},y:function(n){return t.y(0)}},s).select("rect").attr("fill",function(n){return n.color||t.color}).attr(s.w,x-2*h).attr(s.h,0),d.style("opacity",1).call(r,{x:function(t){return t.basepx},y:function(t){return t.extentpx[0]}},s).select("rect").attr("fill",function(n){return n.color||t.color}).attr(s.w,x-2*h).attr(s.h,function(t){return t.extentpx[1]-t.extentpx[0]}),p.style("opacity",0).remove()})}),u},l=b().values(function(t){return t.values}),c=d3.nest().key(function(t){return t.stackBy});p(i,o).addPropFunctor("graphs",function(t){return t}).addPropFunctor("padding",.5).addPropFunctor("groupPadding",0).addPropFunctor("bandwidth",null).addScaleFunctor("x",d3.scaleLinear()).addScaleFunctor("y",d3.scaleLinear()).addPropFunctor("tooltipGraph",function(t){return t.tooltipGraph}).addPropFunctor("orient","vertical").addPropFunctor("shift",null).addPropFunctor("stackBy",function(t,n){return n}).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values},null).addPropFunctor("color",function(t){return I(t.label)}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y}).addPropFunctor("pcentered",!1).addPropFunctor("pcolor",null).addPropFunctor("pkey",function(t,n){return n}).addMethod("getComputedGraphs",function(t){return(t.selection?t.selection():t).data().map(function(t,e){return n(t,e)})}).addMethod("getVisiblePoints",function(e){return(e.selection?e.selection():e).data().map(function(e,r){var a=o.orient(e,r),i=t(a),l=n(e,r,i),c=[].concat.apply([],l.map(function(t){return t.values.map(function(n){var e={};return e[""+i.x]=n.base,e[""+i.y]=n.extent[0],e.graph=t,e})})),u=[].concat.apply([],l.map(function(t){return t.values.map(function(n){var e={};return e[""+i.x]=n.base,e[""+i.y]=n.extent[1],e.graph=t,e})}));return c.concat(u)})});return i}function A(){function t(n,e,r){return{data:n,index:e,graph:r,x:d.px(n,e),y:d.py(n,e),color:d.pcolor(n,e)||r.color,symbol:d.psymbol(n,e)||r.color,key:d.pkey(n,e),size:d.psize(n,e),indicator:d.pindicator(n,e),children:(d.pchildren(n,e)||[]).map(function(n,e){return t(n,e,r)})}}function e(n,e){var r=d.graphs(n,e).map(function(n,e){var r={data:n,index:e,tendancy:d.tendancy(n,e),x:d.x(n,e),y:d.y(n,e),tooltipGraph:d.tooltipGraph(n,e),shift:d.shift(n,e),key:d.key(n,e),color:d.color(n,e),symbol:d.symbol(n,e)};return r.values=d.values(n,e).map(function(n,e){return t(n,e,r)}),r});return r.forEach(function(t){return t.values.forEach(function(n){return u(n,t.tendancy)})}),r}function a(t,n){t.data.expanded=n,t.children.forEach(function(t){return a(t,n)})}function o(t,n){var e=5,r=5;t.selectAll(".d2b-bubble-indicator.d2b-active").attr("transform",function(){var t=this.getBBox();t.width+e>n&&e>0&&(e=5,r+=t.height+5);var a="translate("+e+", "+r+")";return e+=t.width+5,a})}function i(t,n,e,r,a,o){t.each(function(t,o){var i=d3.select(this),l=i.attr("transform");l||i.attr("transform","translate("+(e(t.parent?t.parent.x:t.x)+a+",")+(r(t.parent?t.parent.y:t.y)+")")),t.children.length?i.attr("cursor","pointer").on("click",function(){d3.select(this).dispatch("change",{bubbles:!0,cancelable:!0})}).on("change",function(t){return t.data.expanded=!t.data.expanded}):i.attr("cursor","").on("click",null),n&&(i=i.transition(n)),t.data.expanded?i.style("opacity",0).selectAll("*").remove():i.style("opacity",null).call(d.point),i.attr("transform","translate("+(e(t.x)+a)+", "+r(t.y)+")")})}function l(t,n,e,r,o,i){t.each(function(t,n){var e=d3.select(this).classed("d2b-active",t.data.expanded);if(!t.data.expanded)return e.selectAll("rect, text, path").remove();var r=e.select("rect"),o=e.select("text"),i=e.select("path");r.size()||(r=e.append("rect")),o.size()||(o=e.append("text")),i.size()||(i=e.append("path")),o.text(function(t){return t.indicator.substring(0,5)}).attr("x",20);var l=o.node().getBBox();o.attr("y",l.height/1.35),r.on("click",function(){d3.select(this).dispatch("change",{bubbles:!0,cancelable:!0})}).on("change",function(t){t.data.expanded=!t.data.expanded,t.data.expanded||a(t,!1)}).attr("width",l.width+25).attr("height",l.height).style("fill",d.point.fill()).style("stroke",d.point.stroke()),i.attr("d",function(t){return s.type(t.symbol)()}).attr("transform","translate(10, 9.5)").style("fill",d.point.stroke())})}function c(t,n,e,r,a,o,u,d){var s=arguments.length<=8||void 0===arguments[8]?0:arguments[8],p=t.selectAll(".d2b-bubble-pack.d2b-depth-"+s).data(n,function(t){return t.key}),f=p.enter().append("g").attr("class","d2b-bubble-pack d2b-depth-"+s),h=p.merge(f);f.append("g").attr("class","d2b-bubble-point").style("opacity",0),i(h.select(".d2b-bubble-point"),e,r,a,o,u),f.append("g").attr("class","d2b-bubble-indicator"),l(h.select(".d2b-bubble-indicator"),e,r,a,o,u),h.each(function(t){var n=d3.select(this),i=n.selectAll(".d2b-bubble-pack");i=e?i.transition(e):i,t.children.length&&t.data.expanded?c(n,t.children,e,r,a,o,u,d,s+1):(d&&d(t),i.remove().select(".d2b-bubble-point").style("opacity",0).attr("transform","translate("+[r(t.x)+o,a(t.y)]+")"))});var y=p.exit();e&&(y=y.transition(e)),y.remove()}function u(t,n){var e=arguments.length<=2||void 0===arguments[2]?0:arguments[2];t.children=t.children||[],t.leaves=t.children.length?[]:[t],t.depth=e,t.children.length&&t.children.forEach(function(r){u(r,n,e+1),r.parent=t,t.leaves=t.leaves.concat(r.leaves)}),t.size=t.size||d3.sum(t.leaves,function(t){return t.size}),t.x=t.x||(n.x||n)(t.leaves,function(t){return t.x},function(t){return t.size}),t.y=t.y||(n.y||n)(t.leaves,function(t){return t.y},function(t){return t.size})}var d={},s=d3.symbol().size(80),h=function y(t){var n=t.selection?t:null,r=t.selection?t.selection():t,a=r.selectAll(".d2b-bubble-pack-graph").data(function(t,n){return e(t,n)},function(t){return t.key}),i=a.enter().append("g").attr("class","d2b-bubble-pack-graph d2b-graph"),l=a.merge(i).order(),u=a.exit();return n&&(l=l.transition(n),u=u.transition(n)),l.style("opacity",1),u.style("opacity",0).remove(),t.each(function(t,e){var r=d3.select(this),a=d.duration(t,e),i=r.selectAll(".d2b-bubble-pack-graph");r.on("change",function(){r.transition().duration(a).call(y)});var l=0;i.each(function(t){var e=d3.select(this),a=t.x.range();l=Math.max(l,Math.abs(a[0]-a[1]));var o=t.shift;null===o&&(o=t.x.bandwidth?t.x.bandwidth()/2:0),d.point.fill(function(t){return t.color}).type(function(t){return t.symbol});var i=t.tooltipGraph?t.tooltipGraph.clear().x(function(n){return t.x(n.x)+o}).y(function(n){return t.y(n.y)}).color(function(t){return t.color}).addPoint:null;c(e,t.values,n,t.x,t.y,o,r,i)}),o(r,l)}),y};p(h,d).addProp("point",f().size(function(t){return 100*t.size}),null,function(t){d.point.active(function(t){return!!t.children.length})}).addPropFunctor("duration",250).addPropFunctor("graphs",function(t){return t}).addScaleFunctor("x",d3.scaleLinear()).addScaleFunctor("y",d3.scaleLinear()).addPropFunctor("tendancy",r,function(t){return arguments.length?(t&&t.tendancy?d.tendancy=function(){return t}:d.tendancy=n(t),h):d.tendancy}).addPropFunctor("tooltipGraph",function(t){return t.tooltipGraph}).addPropFunctor("shift",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values}).addPropFunctor("color",function(t){return I(t.label)}).addPropFunctor("symbol",function(t){return d3.symbolCircle}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y}).addPropFunctor("psize",function(t){return t.size}).addPropFunctor("pchildren",function(t){return t.children}).addPropFunctor("pcolor",function(t){return null}).addPropFunctor("psymbol",d3.symbolCircle).addPropFunctor("pindicator",function(t){return t.label}).addPropFunctor("pkey",function(t,n){return n}).addMethod("getComputedGraphs",function(t){return(t.selection?t.selection():t).data().map(function(t,n){return e(t,n)})}).addMethod("getVisiblePoints",function(t){function n(t,e,r){t.data.expanded?t.children.forEach(function(t){return n(t,e,r)}):e.push({x:t.x,y:t.y,graph:r})}var e=h.getComputedGraphs(t);return e.map(function(t){return[].concat.apply([],t.map(function(t){var e=[];return t.values.forEach(function(r){return n(r,e,t)}),e}))})});return h}function z(){function t(t,n,e,r,a){var o=[],i=[],c=t.data;c&&(l(t,c,n,e,r),o=[c],t.info.showGrid&&(i=[c])),
t.update=e.selectAll(".d2b-"+t.type+"-axis").data(o),t.enter=t.update.enter().append("g").attr("class","d2b-axis d2b-"+t.type+"-axis"),t.labelEnter=t.enter.append("text").attr("class","d2b-axis-label"),t.svg=t.enter.merge(t.update),t.label=t.svg.select(".d2b-axis-label"),t.update.exit().remove(),t.gridUpdate=e.selectAll(".d2b-"+t.type+"-grid").data(i),t.gridEnter=t.gridUpdate.enter().append("g").attr("class","d2b-grid d2b-"+t.type+"-grid"),t.gridUpdate.exit().remove(),t.grid=t.gridEnter.merge(t.gridUpdate),a&&(t.svg=t.svg.transition(a),t.update=t.update.transition(a),t.grid=t.grid.transition(a),t.gridUpdate=t.gridUpdate.transition(a),t.label=t.label.transition(a))}function n(t,n,e,r){t.data&&(o(t),i(t,n),t.enter.call(t.info.axis).attr("transform","translate("+e+", "+r+")"),t.update.call(t.info.axis).attr("transform","translate("+e+", "+r+")"),t.svg.call(y,t).on("end",function(){t.svg.call(y,t)}))}function e(t,n,e){t.data&&(a(t,e),i(t,n),t.gridUpdate.call(t.info.axis).selectAll(".tick text").remove(),t.gridEnter.call(t.info.axis).selectAll(".tick text").remove())}function r(t,n){t.data&&(t.labelEnter.text(t.info.label).attr("x",s(t,n)).attr("y",d(t)).attr("text-anchor",c(t)),t.label.text(t.info.label).attr("x",s(t,n)).attr("y",d(t)).attr("text-anchor",c(t)))}function a(t,n){if(t.data)switch(t.type){case"x":return t.info.axis.tickSize("inner"===t.info.orient?-n:n);case"x2":return t.info.axis.tickSize("inner"===t.info.orient?n:-n);case"y":return t.info.axis.tickSize("inner"===t.info.orient?n:-n);case"y2":return t.info.axis.tickSize("inner"===t.info.orient?-n:n)}}function o(t){t.data&&t.info.axis.tickSizeOuter(0).tickSizeInner(t.info.tickSize)}function i(t,n){t.data&&t.info.axis.scale().range([0,n])}function l(t,n,e,r,a){if(t.data){var l=t.info={};l.axis=v.axis(n,e),l.orient=v.orient(n,e),l.wrapLength=v.wrapLength(n,e),l.label=v.label(n,e)||"",l.labelOrient=v.labelOrient(n,e),l.tickSize=v.tickSize(n,e),l.showGrid=v.showGrid(n,e),l.labelOrient1=l.labelOrient.split(" ")[0],l.labelOrient2=l.labelOrient.split(" ")[1],l.wrapAnchor=u(t),o(t),i(t,a);var c=r.append("g").attr("class","d2b-axis d2b-"+t.type+"-axis").call(l.axis).call(y,t);l.axisBox=c.node().getBBox();var d=c.append("text").attr("class","d2b-axis-label d2b-"+t.type+"-label").text(l.label);l.labelBox=d.node().getBBox(),c.remove()}}function c(t){if(t.data){var n=t.info,e=["y","y2"].indexOf(t.type)>-1;return"start"===n.labelOrient2&&e?"end":"end"!==n.labelOrient2||e?"middle"===n.labelOrient2?"middle":"start":"end"}}function u(t){if(t.data)switch(t.type){case"x":return"inner"===t.info.orient?"end":"start";case"x2":return"outer"===t.info.orient?"end":"start";case"y":case"y2":return"middle";default:return"start"}}function d(t){if(t.data){var n=t.info;switch(t.type+" "+n.orient+" "+n.labelOrient1){case"x inner inner":case"x2 outer outer":return-n.axisBox.height-b;case"x inner outer":case"x2 outer inner":return n.labelBox.height+b;case"x outer inner":case"x2 inner outer":case"y inner outer":case"y2 outer inner":return-b;case"x outer outer":case"x2 inner inner":return n.labelBox.height+n.axisBox.height+b;case"y inner inner":case"y2 outer outer":return n.labelBox.height+n.axisBox.width+b;case"y outer inner":case"y2 inner outer":return n.labelBox.height+b;case"y outer outer":case"y2 inner inner":return-n.axisBox.width-b}}}function s(t,n){return t.data?"start"===t.info.labelOrient2?0:"middle"===t.info.labelOrient2?n/2:n:void 0}function f(t){var n={top:0,left:0,right:0,bottom:0};return t.x.data&&("outer"===t.x.info.orient&&(n.bottom+=t.x.info.axisBox.height),"outer"===t.x.info.labelOrient1&&(n.bottom+=t.x.info.labelBox.height+b)),t.x2.data&&("outer"===t.x2.info.orient&&(n.top+=t.x2.info.axisBox.height),"outer"===t.x2.info.labelOrient1&&(n.top+=t.x2.info.labelBox.height)),t.y.data&&("outer"===t.y.info.orient&&(n.left+=t.y.info.axisBox.width),"outer"===t.y.info.labelOrient1&&(n.left+=t.y.info.labelBox.height)),t.y2.data&&("outer"===t.y2.info.orient&&(n.right+=t.y2.info.axisBox.width),"outer"===t.y2.info.labelOrient1&&(n.right+=t.y2.info.labelBox.height+b)),n.top=Math.max(n.top,10),n.bottom=Math.max(n.bottom,10),n.left=Math.max(n.left,10),n.right=Math.max(n.right,10),n}function y(t,n){if(n.data){var e=n.info.wrapLength,r=n.info.wrapAnchor;t.selectAll(".tick text").each(function(){var t=d3.select(this);-1===t.html().indexOf("tspan")&&(this.storeText=t.text()),t.text("")}).call(h,function(){return this.storeText},e,r)}}function g(t){return"number"==typeof t?{top:t,left:t,right:t,bottom:t}:t}function x(t){return g(t||0)}var v={},b=5,m=function P(a){var o=a.selection?a.selection():a;return o.each(function(i,l){var c=v.size.call(this,i,l)||{width:960,height:500},u=x(v.margin.call(this,i,l)),d=v.x.call(this,i,l),s=v.x2.call(this,i,l),p=v.y.call(this,i,l),h=v.y2.call(this,i,l),y=d3.select(this),b={x:{type:"x",data:d},x2:{type:"x2",data:s},y:{type:"y",data:p},y2:{type:"y2",data:h}},m=g(v.padding.call(this,i,l)),P=y.selectAll(".d2b-plane").data([i]),k=P.enter().append("g").attr("class","d2b-plane"),F=P.merge(k),w=a!==o?a:null;t(b.x,l,F,c.width,w),t(b.x2,l,F,c.width,w),t(b.y,l,F,c.height,w),t(b.y2,l,F,c.height,w),m||(m=f(b));var A={top:m.top+u.top,bottom:m.bottom+u.bottom,left:m.left+u.left,right:m.right+u.right};A.width=c.width-A.left-A.right,A.height=c.height-A.top-A.bottom,this.__box__=A,w&&(P=P.transition(w)),k.attr("transform","translate("+A.left+", "+A.top+")"),P.attr("transform","translate("+A.left+", "+A.top+")"),n(b.x,A.width,0,A.height),n(b.x2,A.width,0,0),n(b.y,A.height,0,0),n(b.y2,A.height,A.width,0),e(b.x,A.width,A.height),e(b.x2,A.width,A.height),e(b.y,A.height,A.width),e(b.y2,A.height,A.width),r(b.x,A.width),r(b.x2,A.width),r(b.y,-A.height),r(b.y2,-A.height)}),P};p(m,v).addPropFunctor("size",function(t){return t.size}).addPropFunctor("padding",null).addPropFunctor("margin",0).addPropFunctor("x",function(t){return t.x}).addPropFunctor("x2",function(t){return t.x2}).addPropFunctor("y",function(t){return t.y}).addPropFunctor("y2",function(t){return t.y2}).addPropFunctor("axis",function(t){return t.axis}).addPropFunctor("orient",function(t){return t.orient||"outer"}).addPropFunctor("wrapLength",function(t){return t.wrapLength||1/0}).addPropFunctor("tickSize",function(t){return t.tickSize||6}).addPropFunctor("showGrid",function(t){return null!==t.showGrid&&void 0!==t.showGrid?t.showGrid:!0}).addPropFunctor("label",function(t){return t.label}).addPropFunctor("labelOrient",function(t){return t.labelOrient||"outer center"}).addMethod("box",function(t){var n=t.node?t.node():t;return n?n.__box__:null});return m}function M(t){function n(t,n){var e=t.selection?t.selection():t,a={prop:function(n,e){var r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];return e=e||t,r.unshift(t),"function"==typeof n?n.apply(e,r):n},dispatch:function(n,e){var r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];return e=e||t,r.unshift(t),o.dispatch.apply(n,e,r)},context:t,selection:e,update:function(){var e=(t.selection?t.selection():t).transition().duration(a.prop(o.duration));r(e,n)}};return a}function e(t){var n={top:0,left:0,right:0,bottom:0};return"number"==typeof t?{top:t,left:t,right:t,bottom:t}:(["top","bottm","right","left"].forEach(function(e){t[e]&&n[e]==t[e]}),n)}function r(r,i){a(o.legend);var l=n(r,i),c=r.selection?r.selection():r,u=c.datum(),d=l.prop(o.size),s=e(l.prop(o.padding)),p="translate("+s.left+", "+s.top+")";c.dispatch("beforeUpdate");var f=c.selectAll(".d2b-svg").data(function(t){return[t]}),h=f.enter().append("svg").attr("class","d2b-svg"),y=c.node().getBoundingClientRect(),g=d&&d.width?d.width:y.width,x=d&&d.height?d.height:y.height;h.attr("width",g).attr("height",x).append("g").attr("class","d2b-group").attr("transform",p),r.select(".d2b-svg").attr("width",g).attr("height",x).select(".d2b-group").attr("transform",p);var v=c.select(".d2b-group");g-=s.top+s.bottom,x-=s.left+s.right;var b=v.selectAll(".d2b-chart-main").data(function(t){return[t]}),m=b.enter().append("g").attr("class","d2b-chart-main"),P=v.selectAll(".d2b-chart-legend").data(l.prop(o.legendHidden)?[]:[u]),k=P.enter().append("g").attr("class","d2b-chart-legend").style("opacity",0),F=P.exit();P=P.merge(k),r!==c&&(P=P.transition(r),F=F.transition(r).style("opacity",0)),P.style("opacity",1).call(o.legend.size({width:g,height:x})),F.remove();var w={left:0,top:0};if(P.size()){var A=o.legend.box(P),z=o.legend.orient().call(P.node(),u,0).split(" "),M=10;"top"===z[1]&&(w.top=A.height+M),"left"===z[2]&&(w.left=A.width+M),"vertical"===z[0]?g-=A.width+M:x-=A.height+M}var G="translate("+w.left+", "+w.top+")";m.attr("transform",G),b=r.select(".d2b-chart-main").attr("transform",G),t(b,i,g,x,l),c.dispatch("afterUpdate")}var a=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1],o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=function(t){t.each(function(n,e){var a=d3.select(this),o=t.selection?a.transition(t):a;r(o,e)})},l=p(i,o).addProp("legend",y()).addPropFunctor("size",null).addPropFunctor("padding",0).addPropFunctor("duration",250).addPropFunctor("legendHidden",!1);return l}function G(t){var n=arguments.length<=1||void 0===arguments[1]?1/0:arguments[1];t.each(function(){for(var t=d3.select(this),e=t.text().split(/\s+/).reverse(),r=void 0,a=[],o=0,i=1.1,l=parseFloat(t.attr("y"))||0,c=parseFloat(t.attr("dy"))||0,u=t.text(null).append("tspan").attr("x",0).attr("y",l).attr("dy",c+"em");r=e.pop();)a.push(r),u.text(a.join(" ")),u.node().getComputedTextLength()>n&&(a.pop(),u.text(a.join(" ")),a=[r],u=t.append("tspan").attr("x",0).attr("y",l).attr("dy",++o*i+c+"em").text(r))})}function _(t){var n=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return isNaN(t)||null===t?n:t}function B(t){var e=arguments.length<=1||void 0===arguments[1]?function(t){return t}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?function(t){return t}:arguments[2];return e=n(e),t.selection?void t.tween("text",function(t,n){var a=this,o=_(e.call(this,t,n));this.current=_(this.current,o);var i=d3.interpolate(this.current,o);return function(t){a.textContent=r(a.current=i(t))}}):t.text(function(t,n){return this.current=_(e.call(this,t,n)),r(this.current)})}function E(t,n){return t.selection?void t.attrTween("transform",function(t){var e=this;t=d2b.omit(t,["data"]),this.current=this.current||t;var r=d3.interpolate(this.current,t);return function(t){return e.current=r(t),"translate("+n.centroid(e.current)+")"}}):t.attr("transform",function(t){return this.current=g(t,["data"]),"translate("+n.centroid(this.current)+")"})}function C(){var t=arguments.length<=0||void 0===arguments[0]?m():arguments[0],n={},e=function u(t){return(t.selection?t.selection():t).on(l("mouseover"),a).on(l("mouseout"),i).on(l("mousemove"),o),u},r=function(t,e){var r=this.getBoundingClientRect(),a={},o=(n.at.call(this,t,e)||(d3.event.clientX>window.innerWidth/2?"center left":"center right")).split(" ");switch(o={x:o[1],y:o[0]},o.x){case"left":a.x=r.left;break;case"center":a.x=r.left+r.width/2;break;default:a.x=r.left+r.width}switch(o.y){case"bottom":a.y=r.top+r.height;break;case"center":a.y=r.top+r.height/2;break;default:a.y=r.top}return a},a=function(t,e){n.tooltip=n.selection.selectAll(".d2b-tooltip").data(function(t){return[t]});var r=n.tooltip.enter().append("div").style("opacity",0).attr("class","d2b-tooltip");r.append("div").attr("class","d2b-tooltip-content"),n.tooltip=n.tooltip.merge(r),n.tooltip.transition().duration(100).style("opacity",1),n.dispatch.call("insert",n.tooltip,this,t,e)},o=function(t,e){var a=n.html.call(this,t,e),o=n.target.call(this,t,e),i=n.color.call(this,t,e),l=o?o.node():this,c=n.followMouse.call(this,t,e)?{x:d3.event.clientX,y:d3.event.clientY}:r.call(l,t,e),u=n.my.call(this,t,e)||(d3.event.clientX>window.innerWidth/2?"left":"right");n.tooltip.attr("class","d2b-tooltip d2b-tooltip-"+u).style("top",c.y+"px").style("left",c.x+"px").style("border-color",i).select(".d2b-tooltip-content").html(a),n.dispatch.call("move",n.tooltip,this,t,e)},i=function(t,e){n.tooltip.transition().duration(100).style("opacity",0).remove(),n.dispatch.call("remove",n.tooltip,this,t,e)},l=function(t){return t+".d2b-tooltip"},c=function(r,a){a&&a.select(".d2b-tooltip-area-"+t).remove(),r&&(n.selection=r.selectAll(".d2b-tooltip-area-"+t).data([e]),n.selection=n.selection.merge(n.selection.enter().append("div").attr("class","d2b-tooltip-area-"+t+" d2b-tooltip-area")))};p(e,n).addProp("container",d3.select("body"),null,c).addMethod("clear",function(t){return oldGraph.on(l("mouseover"),null).on(l("mouseout"),null).on(l("mousemove"),null),e}).addPropFunctor("followMouse",!1).addPropFunctor("color",null).addPropFunctor("my",null).addPropFunctor("at",null).addPropFunctor("target",null).addPropFunctor("html",null).addDispatcher(["insert","move","remove"]);return e}function T(){for(var t=arguments.length,n=Array(t),e=0;t>e;e++)n[e]=arguments[e];var r=n[0];return n.forEach(function(t){null!==r&&void 0!==r&&r!==!1||(r=t)}),r}function S(){var t=arguments.length<=0||void 0===arguments[0]?m():arguments[0],n={},e={},r=function(t,e,r){if("y"===r){if(e.y===1/0)return t.style("opacity",0);t.style("opacity",1).attr("transform","translate(0, "+e.y+")").attr("y1",0).attr("y2",0).attr("x1",0).attr("x2",n.size.width)}else{if(e.x===1/0)return t.style("opacity",0);t.style("opacity",1).attr("transform","translate("+e.x+", 0)").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",n.size.height)}},a=function(t,e,r){var a=t.node();if(a){var o=t.node().getBoundingClientRect(),i=r.x,l=r.y,c=10;n.trackY?l+=e.y>n.size.height/2?e.y-c-o.height:e.y+c:l=d3.event.clientY-r.y>n.size.height/2?d3.event.clientY-c-o.height:d3.event.clientY+c,n.trackX?i+=e.x>n.size.width/2?e.x-c-o.width:e.x+c:i=d3.event.clientX-r.x>n.size.width/2?d3.event.clientX-c-o.width:d3.event.clientX+c,i+=window.scrollX,l+=window.scrollY,t.style("left",i+"px").style("top",l+"px")}},o=function(t,e){var r=n.title(e.points.map(function(t){return t.data}));t.select(".d2b-tooltip-title").style("display",r?"block":"none").html(r);var a=t.select(".d2b-tooltip-content"),o=a.selectAll(".d2b-tooltip-row").data(e.points),i=o.enter().append("div").attr("class","d2b-tooltip-row");o.exit().remove(),o=o.merge(i).html(function(t){return t.row}).style("border-left-color",function(t){return t.color||"transparent"})},i=function(t){var e={x:d3.event.clientX-t.x,y:d3.event.clientY-t.y},r=1/0,a=1/0,o=[];for(var i in v)if(v.hasOwnProperty(i)){var l=v[i],c=function(t){if(!l.hasOwnProperty(t))return"continue";var i=l[t],c=[];i.config.data.forEach(function(t,l){var u={data:t,x:T(i.config.x(t,l),n.x(t,l)),y:T(i.config.y(t,l),n.y(t,l)),color:T(i.config.color(t,l),n.color(t,l)),row:T(i.config.row(t,l),n.row(t,l))};if(n.trackX&&n.trackY){if(u.x===r&&u.y===a)return c.push(u);var d=Math.sqrt(Math.pow(r-e.x,2)+Math.pow(a-e.y,2)),s=Math.sqrt(Math.pow(u.x-e.x,2)+Math.pow(u.y-e.y,2));d>s&&s<n.threshold&&(r=u.x,a=u.y,o=[],c=[u])}else if(n.trackX){if(u.x===r)return c.push(u);var d=Math.abs(r-e.x),s=Math.abs(u.x-e.x);d>s&&s<n.threshold&&(r=u.x,o=[],c=[u])}else if(n.trackY){if(u.y===a)return c.push(u);var d=Math.abs(a-e.y),s=Math.abs(u.y-e.y);d>s&&s<n.threshold&&(a=u.y,o=[],c=[u])}}),o=o.concat(c)};for(var u in l){c(u)}}return o=o.sort(function(t,n){return d3.ascending(t.x,n.x)||d3.ascending(t.y,n.y)}),{x:r,y:a,points:o}},l=function(t){t.transition().duration(50).style("opacity",0).remove()},c=function(t){t.transition().duration(50).style("opacity",1)},u=function(){var t=n.selectionSvg.selectAll(".d2b-tooltip-marker-x").data(n.trackX?[e]:[]),r=t.enter().append("line").attr("class","d2b-tooltip-marker-x d2b-tooltip-marker"),a=n.selectionSvg.selectAll(".d2b-tooltip-marker-y").data(n.trackY?[e]:[]),o=a.enter().append("line").attr("class","d2b-tooltip-marker-y d2b-tooltip-marker"),i=n.selection.selectAll(".d2b-tooltip").data([e]),l=i.enter().append("div").attr("class","d2b-tooltip");l.merge(i).call(c),a.merge(o).call(c),t.merge(r).call(c),l.append("div").attr("class","d2b-tooltip-title"),l.append("div").attr("class","d2b-tooltip-content")},d=function(){n.selectionSvg.selectAll(".d2b-tooltip-marker-x").data([]).exit().call(l),n.selectionSvg.selectAll(".d2b-tooltip-marker-y").data([]).exit().call(l),n.selection.selectAll(".d2b-tooltip").data([]).exit().call(l)},s=function(t,e){var l=n.selectionSvg.selectAll(".d2b-tooltip-base").data([t]);l=l.merge(l.enter().append("rect").attr("class","d2b-tooltip-base"));var c=l.node().getBoundingClientRect();c={x:c.left,y:c.top};var s=i(c);return s.points.length?(u(),n.selectionSvg.select(".d2b-tooltip-marker-x").call(r,s,"x"),n.selectionSvg.select(".d2b-tooltip-marker-y").call(r,s,"y"),n.selection.select(".d2b-tooltip").call(o,s).call(a,s,c),void n.dispatch.call("move",n.tooltip,this,t,e)):d()},f=function(t,n){d()},h=function(t){return t+".d2b-tooltip-axis"},y=function(r,a){a&&a.select("div.d2b-tooltip-axis-area-"+t).remove(),r&&(n.selection=r.selectAll("div.d2b-tooltip-axis-area-"+t).data([e]),n.selection=n.selection.merge(n.selection.enter().append("div").attr("class","d2b-tooltip-axis-area-"+t+" d2b-tooltip-axis-area")))},g=function(r,a){a&&a.select("g.d2b-tooltip-axis-area-"+t).remove(),r&&(n.selectionSvg=r.selectAll("g.d2b-tooltip-axis-area-"+t).data([e]),n.selectionSvg=n.selectionSvg.merge(n.selectionSvg.enter().append("g").attr("class","d2b-tooltip-axis-area-"+t+" d2b-tooltip-axis-area")))},x=function(t,n){n&&n.on(h("mouseout"),null).on(h("mousemove"),null),t&&t.on(h("mouseout"),f).on(h("mousemove"),s)},v=(p(e,n).addProp("htmlContainer",d3.select("body"),null,y).addProp("svgContainer",null,null,g).addProp("tracker",d3.select("body"),null,x).addProp("size",{height:0,width:0}).addProp("trackX",!0).addProp("trackY",!1).addProp("threshold",1/0).addMethod("clear",function(t,n){return 0===arguments.length?v={}:1===arguments.length?delete v[t]:arguments.length>=2&&delete v[t][n],e}).addPropFunctor("title",null).addPropFunctor("x",function(t){return t.x}).addPropFunctor("y",function(t){return t.y}).addPropFunctor("color",null).addPropFunctor("row",null).addDispatcher(["insert","move","remove"]),{});return e.graph=function(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0],n=arguments.length<=1||void 0===arguments[1]?null:arguments[1],e=v[t]=v[t]||{},r=e[n];if(!r){r=e[n]={"interface":{},config:{}};var a=p(r["interface"],r.config);a.addProp("data",[]).addMethod("clear",function(){return r.config.data=[],r["interface"]}).addMethod("addPoint",function(t){return r.config.data.push(t),r["interface"]}).addPropFunctor("x",null).addPropFunctor("y",null).addPropFunctor("color",null).addPropFunctor("row",null)}return r["interface"]},e}function L(){function t(t){t.items(function(t){return t.items})}function n(t,n){return{items:a.items(t,n),interpolate:a.interpolate(t,n)}}function e(t,n,e,r,a,o){}var r=M(e,n,t).addPropFunctor("interpolate","linear").addPropFunctor("items",function(t){return t}),a=r.values(),o=r.base();return o}function O(){function t(t){t.empty(function(t){return t.hidden}).setEmpty(function(t,n,e){return t.hidden=e})}function n(t,n,o,l,p){var f=t.selection?t.selection():t,h=f.node(),y=f.datum(),g=i.radius(y,n,o,l),x=i.startAngle(y,n),v=i.endAngle(y,n),b=i.donutRatio(y,n),m=(i.at(y,n),i.values(y,n).filter(function(t){return!t.hidden}));p.selection.select(".d2b-chart-legend").on("change",p.update).selectAll(".d2b-legend-item").on("mouseover",function(t){return d3.select(t.__arc__).each(r)}).on("mouseout",function(t){return d3.select(t.__arc__).each(a)});var P=d3.sum(m,function(t,n){return t.__value__=i.value(t,n)}),k=f.selectAll(".d2b-pie-chart").data([m]),F=k.enter().append("g").attr("class","d2b-pie-chart");k=k.merge(F).datum(function(t){return t=c.startAngle(x).endAngle(v)(t),t.forEach(function(t){t.outerRadius=g,t.innerRadius=g*b}),t}),f!==t&&(k=k.transition(t)),k.call(d);var w=f.selectAll(".d2b-pie-arc").each(function(t,n){this.outerRadius=t.outerRadius,t.data.__arc__=this,t.data.__percent__=t.data.__value__/P}).on("mouseover",r).on("mouseout",a).call(i.tooltip),A=w.selectAll(".d2b-pie-arc-percent").data(function(t){return[t]});A.enter().append("g").attr("class","d2b-pie-arc-percent").append("text").attr("y",6),w.each(function(t){var n=d3.select(this),e=n.select(".d2b-pie-arc path").node().current,r=n.select(".d2b-pie-arc-percent"),a=r.select("text").node();r.node().current=e,a.current=a.current||0}),f!==t&&(w=w.each(function(t){this.transitioning=!0}).transition(t).on("end",function(t){this.transitioning=!1})),w.select(".d2b-pie-arc-percent").call(d2b.tweenCentroid,u).select("text").call(B,function(t){return t.data.__percent__},s).style("opacity",function(t,n){return i.showPercent.call(this,t.data,n)?1:0});var z=e(h,y,n,g,o,l);F.attr("transform","translate("+z.x+", "+z.y+")"),k.attr("transform","translate("+z.x+", "+z.y+")")}function e(t,n,e,r,a,o){var l=i.center(n,e,a,o,r),c=i.at(n,e,a,o).split(" ");if(!l){switch(c={x:c[1],y:c[0]},l={},c.x){case"left":l.x=r;break;case"center":case"middle":l.x=a/2;break;case"right":default:l.x=a-r}switch(c.y){case"bottom":l.y=o-r;break;case"center":case"middle":l.y=o/2;break;case"top":default:l.y=r}}return l}function r(t){if(!this.transitioning){var n=d3.select(this).select("path");t.outerRadius=1.03*this.outerRadius,n.transition().duration(100).call(x,u)}}function a(t){if(!this.transitioning){var n=d3.select(this).select("path");t.outerRadius=this.outerRadius,n.transition().duration(100).call(x,u)}}var o=M(n,t),i=o.values(),l=o.base();i.legend.active(!0).clickable(!0).dblclickable(!0);var c=d3.pie().sort(null),u=d3.arc().outerRadius(function(t){return t.outerRadius}).innerRadius(function(t){return t.innerRadius}),d=d2b.svgPie().arc(u),s=d3.format(".0%");return o.addProp("key",function(t){return t.label},null,function(t){i.legend.key(t),d.key(t)}).addProp("tooltip",C().followMouse(!0).html(function(t){return"<b>"+i.label(t.data)+":</b> "+i.value(t.data)})).addPropFunctor("values",function(t){return t}).addPropFunctor("donutRatio",0).addPropFunctor("startAngle",0).addPropFunctor("endAngle",2*Math.PI).addPropFunctor("at","center center").addPropFunctor("showPercent",function(t,n){return t.__percent__>.03}).addPropFunctor("center",null).addPropFunctor("radius",function(t,n,e,r){return Math.min(e,r)/2}).addPropFunctor("sort",null).addPropFunctor("color",function(t){return I(t.label)},null,function(t){i.tooltip.color(function(n){return d3.rgb(t(n.data)).darker(.3)}),i.legend.color(t),d.color(t)}).addPropFunctor("value",function(t){return t.value},null,function(t){return c.value(t)}).addPropFunctor("label",function(t){return t.label},null,function(t){return i.legend.label(t)}),l}function R(){function t(t){t.items(n).empty(function(t){return t.data.hidden}).setEmpty(function(t,n,e){return t.data.hidden=e}).label(function(t){return t.label}).color(function(t){return t.color})}function n(t,n){var r=arguments.length<=2||void 0===arguments[2]?e(t,n):arguments[2],o=arguments.length<=3||void 0===arguments[3]?a(r):arguments[3],i=o.filter(function(t){return!t.group});return i.forEach(function(t){t.groupType="graph",t.groupGraphs=[t]}),(y.groups(t,n)||[]).map(function(t,n){var e={groupType:"group",data:t,label:y.groupLabel(t,n),color:y.groupColor(t,n)};return e.groupGraphs=o.filter(function(t){return e.label===t.group}),e.groupGraphs.forEach(function(t){t.color=e.color}),e}).concat(i)}function e(t,n){return y.sets(t,n).map(function(t,n){return{data:t,index:n,generators:y.setGenerators(t,n).map(function(t,n){return{data:t,index:n,generator:y.generator(t,n),key:y.generatorKey(t,n)}}),graphs:r(t,n)}})}function r(t,n){return y.setGraphs(t,n).map(function(t,n){return{data:t,index:n,label:y.graphLabel(t,n)||"",xType:y.graphXType(t,n)||"x",yType:y.graphYType(t,n)||"y",color:y.graphColor(t,n),group:y.graphGroup(t,n),tooltipConfig:y.graphTooltipConfig||function(){}}})}function a(){var t=arguments.length<=0||void 0===arguments[0]?e(d,i):arguments[0];return[].concat.apply([],t.map(function(t){return t.graphs}))}function o(t){t.forEach(function(t){t.groupGraphs.forEach(function(n){return n.data.hidden=t.data.hidden})})}function l(t,n){var e=n.selectAll(".d2b-graph");t.groupGraphs.some(function(t){return!t.data.hidden})&&e.style("opacity",.2).filter(function(n){return t.data===n.data||(t.groupGraphs.map(function(t){return t.data})||[]).indexOf(n.data)>-1}).style("opacity","")}function c(t,n){n.selectAll(".d2b-graph").style("opacity",1)}function u(t,n){return n.filter(function(n){return n.data===t||n.data===t.data})[0]}function s(t,n,e,r){if(n.length){t.axis||(t.axis=e.axis),t.scale||(t.scale=p(n,e));var a=t.scale.domain();if(r&&(a=a.reverse()),!t.scale.bandwidth&&t.linearPadding){var o=a[1]-a[0];a[0]=a[0]+o*t.linearPadding[0],a[1]=a[1]+o*t.linearPadding[1]}t.scale.domain(a),t.axis.scale(t.scale)}}function p(t,n){return t.some(function(t){return isNaN(t)})?n.band.domain(d3.set(t).values()):n.linear.domain(d3.extent(t))}function f(t,r,i,d,p){var f=t.selection?t.selection():t,h=f.datum(),g=f.node(),x=e(h,r),v=a(x),P=y.duration(h,r),k=n(h,r,x);o(k);var F=g.tooltip=g.tooltip||S().trackX(!0).trackY(!1).threshold(50);F.title(function(t){return""+(t[0].x||t[0].x1)}).clear(),p.selection.select(".d2b-chart-legend").on("change",p.update).selectAll(".d2b-legend-item").on("mouseover",function(t){return l(t,f)}).on("mouseout",function(t){return c(t,f)}),y.plane.size({width:i,height:d});var w=f.selectAll(".d2b-axis-plane").data([h]),A=w,z=w.enter().append("g").attr("class","d2b-axis-plane");w=w.merge(z);var M=f.selectAll(".d2b-axis-wrapper").data([h]),G=M,_=M.enter().append("g").attr("class","d2b-axis-wrapper");_.append("rect").attr("class","d2b-axis-background"),M=M.merge(_);var B=M.selectAll(".d2b-axis-set").data(x),E=B.enter().append("g").attr("class","d2b-axis-set"),C=B.exit();B=B.merge(E).order(),f!==t&&(C=C.transition(t),G=G.transition(t),A=A.transition(t));var T={x:[],x2:[],y:[],y2:[]};B.each(function(t,n){var e=d3.select(this);this.genUpdate=e.selectAll(".d2b-graph-generator").data(t.generators,function(t){return t.key}),this.genEnter=this.genUpdate.enter().append("g").attr("class","d2b-graph-generator").style("opacity",0),this.genExit=this.genUpdate.exit(),this.gen=this.genUpdate.merge(this.genEnter).order(),this.gen.each(function(n,e){var r=d3.select(this),a=n.generator.tooltipGraph(function(t){if(e)return null;var n=F.graph(m());return n.row(function(t){var n=u(t.graph.data,v).label;return n+": "+(t.y||t.y1)}),u(t,v).tooltipConfig(n),n}).color(function(t){return u(t,v).color}).graphs(t.graphs.map(function(t){return t.data}).filter(function(t){return!t.hidden})).getVisiblePoints(r)[0];n.generator.duration&&n.generator.duration(P),a.forEach(function(t){var n=u(t.graph,v);T[n.xType||"x"].push(t.x),T[n.yType||"y"].push(t.y)})})});var L=y.x(h,r,T.x),O=y.y(h,r,T.y),R=y.x2(h,r,T.x2),N=y.y2(h,r,T.y2);s(L,T.x,b.x),s(O,T.y,b.y,!0),s(R,T.x2,b.x2),s(N,T.y2,b.y2,!0),y.plane.axis(function(t){return t.axis}).x(L.axis?L:null).y(O.axis?O:null).x2(R.axis?R:null).y2(N.axis?N:null),z.call(y.plane),A.call(y.plane);var X=y.plane.box(w);B.each(function(n,e){f!==t&&(this.genUpdate=this.genUpdate.transition(t).style("opacity",1),this.genExit.transition(t).style("opacity",0).remove(),this.genEnter.transition(t).style("opacity",1)),this.gen.each(function(n,e){var r=d3.select(this);f!==t&&(r=r.transition(t)),n.generator.x(function(t,n){return"x2"===u(t,v).xType?R.scale:L.scale}).y(function(t,n){return"y2"===u(t,v).yType?N.scale:O.scale}),r.call(n.generator)}),d3.select(this).on("change",p.update)}),C.style("opacity",0).remove(),_.attr("transform","translate("+X.left+", "+X.top+")").select("rect.d2b-axis-background").attr("height",Math.max(0,X.height)).attr("width",Math.max(0,X.width)),G.attr("transform","translate("+X.left+", "+X.top+")").select("rect.d2b-axis-background").attr("height",Math.max(0,X.height)).attr("width",Math.max(0,X.width)),y.tooltipConfig(F),F.svgContainer(M).tracker(M).size(X)}var h=M(f,t),y=h.values(),g=h.base();h.addProp("plane",z()).addPropFunctor("x",function(t){return{}}).addPropFunctor("y",function(t){return{}}).addPropFunctor("x2",function(t){return{}}).addPropFunctor("y2",function(t){return{}}).addPropFunctor("tooltipConfig",function(t){return t.tooltipConfig}).addPropFunctor("groups",function(t){return t.groups}).addPropFunctor("sets",function(t){return t.sets}).addPropFunctor("generator",function(t){return t}).addPropFunctor("groupLabel",function(t){return t.label}).addPropFunctor("groupColor",function(t){return I(y.groupLabel(t))}).addPropFunctor("setGenerators",function(t){return t.generators}).addPropFunctor("setGraphs",function(t){return t.graphs}).addPropFunctor("generatorKey",function(t){return t.name}).addPropFunctor("graphLabel",function(t){return t.label}).addPropFunctor("graphGroup",function(t){return t.group}).addPropFunctor("graphColor",function(t){return I(y.graphLabel(t))}).addPropFunctor("graphXType","x").addPropFunctor("graphYType","y").addPropFunctor("graphTooltipConfig",function(t){return t.tooltipConfig}),y.legend.active(!0).clickable(!0).dblclickable(!0);var x=d3.scaleBand(),v=d3.scaleLinear(),b={x:{band:x.copy(),linear:v.copy(),axis:d3.axisBottom()},y:{band:x.copy(),linear:v.copy(),axis:d3.axisLeft()},x2:{band:x.copy(),linear:v.copy(),axis:d3.axisTop()},y2:{band:x.copy(),linear:v.copy(),axis:d3.axisRight()}};return g}var N=Math.PI,X=Math.sqrt(8),U=Math.sqrt(2),Y={draw:function(t,n){var e=Math.sqrt(n/(N+5/4)),r=.3125*e,a=2*Math.asin(.25),o=(N/2-a)/2,i=e/X-e*Math.cos(o),l=e*Math.sin(o);t.arc(i,l,e,-o,2*N-a-o),t.lineTo(e*(5/4-1/U),-e*(1/X+5/4-1/U)),t.lineTo(e*(5/4-1/U)-r,-e*(1/X+5/4-1/U)),t.lineTo(e*(5/4-1/U)-r,-e*(1/X+7/4-1/U)),t.lineTo(e*(7/4-1/U+1/X),-e*(1/X+7/4-1/U)),t.lineTo(e*(7/4-1/U+1/X),-e*(5/4-1/U)+r),t.lineTo(e*(5/4-1/U+1/X),-e*(5/4-1/U)+r),t.lineTo(e*(5/4-1/U+1/X),-e*(5/4-1/U)),t.closePath()}},W={draw:function(t,n){var e=Math.sqrt(n/(N+5/4)),r=2*Math.asin(.25),a=e/4-e*Math.cos(r/2);t.arc(0,a,e,3*-N/2+r/2,N/2-r/2),t.lineTo(e/4,3*e/4),t.lineTo(3*e/4,3*e/4),t.lineTo(3*e/4,5*e/4),t.lineTo(e/4,5*e/4),t.lineTo(e/4,7*e/4),t.lineTo(-e/4,7*e/4),t.lineTo(-e/4,5*e/4),t.lineTo(3*-e/4,5*e/4),t.lineTo(3*-e/4,3*e/4),t.lineTo(-e/4,3*e/4),t.closePath()}};r.tendancy="mean",a.tendancy="median",o.tendancy="mode",l.tendancy="range",c.tendancy="midpoint";var I=d3.scaleCategory10();t.symbolMars=Y,t.symbolVenus=W,t.mean=r,t.median=a,t.midpoint=c,t.mode=o,t.range=l,t.toDegrees=u,t.toRadians=s,t.point=f,t.plane=z,t.legend=y,t.svgPie=v,t.svgLine=P,t.svgArea=k,t.svgScatter=F,t.svgBar=w,t.svgBubblePack=A,t.modelBase=p,t.modelChart=M,t.defaultColor=I,t.id=m,t.textWrap=h,t.textWrapPX=G,t.tweenCentroid=E,t.tweenNumber=B,t.tweenArc=x,t.tooltip=C,t.tooltipAxis=S,t.stack=b,t.omit=g,t.chartTemplate=L,t.chartPie=O,t.chartAxis=R});