!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.d2b=t.d2b||{})}(this,function(t){"use strict";function n(t){return"function"==typeof t?t:function(){return t}}function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=arguments[2],o=function(n,e){return function(a){if(!arguments.length)return r[n];var o=r[n];return r[n]=a,e&&e(a,o),t}},i=function(t){return function(n){return r[t]}},l=function(e,a){return function(o){if(!arguments.length)return r[e];var i=r[e];return r[e]=n(o),a&&a(o,i),t}},c={base:function(){return t},values:function(){return r},removeProp:function(n){return-1!==a.indexOf(n)?(console.error("Cannot remove "+n+" property or value"),c):(r[n]=null,t[n]=null,c)},addProp:function(n){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a=arguments.length<=2||void 0===arguments[2]?o(n):arguments[2],i=arguments[3];return r[n]||t[n]?(console.error(n+" property is already defined."),c):(a=a||o(n,i),r[n]=e,t[n]=a,i&&i(e),c)},addPropGet:function(n){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a=arguments.length<=2||void 0===arguments[2]?i(n):arguments[2];return r[n]||t[n]?(console.error(n+" property is already defined."),c):(r[n]=e,t[n]=a,c)},addMethod:function(n,e){return t[n]?(console.error(n+" method is already defined."),c):(t[n]=e,c)},addPropFunctor:function(e){var a=arguments.length<=1||void 0===arguments[1]?null:arguments[1],o=arguments.length<=2||void 0===arguments[2]?l(e):arguments[2],i=arguments[3];return r[e]||t[e]?(console.error(e+" property is already defined."),c):(o=o||l(e,i),a=n(a),i&&i(a),r[e]=a,t[e]=o,c)},addDispatcher:function(n){var a=arguments.length<=1||void 0===arguments[1]?"on":arguments[1],o=arguments.length<=2||void 0===arguments[2]?"dispatch":arguments[2];return t[a]?(console.error(a+" property is already defined."),c):r[o]?(console.error(o+" value is already defined."),c):(t[a]=function(n,e){return 0===arguments.length?r[o]:1===arguments.length?r[o].on(n):(r[o].on(n,e),t)},r[o]=d3.dispatch.apply(e,n),c)}};return c}function r(){function t(t,n){return l.empty.call(this,t,n)?0:1}function n(t,n){var e=l.size.call(this,t,n),r=l.empty.call(this,t,n);return u.size(r?e:2.5*e).call(this,t,n)}function r(t,n){var e=l.size.call(this,t,n),r=l.empty.call(this,t,n);return u.size(r?e/3:e).call(this,t,n)}function a(t,n){var e=l.size.call(this,t,n);return u.size(e).call(this,t,n)}function o(t,e){var a=(l.size.call(this,t,e),l.empty.call(this,t,e));d3.select(this).select("path.d2b-point-back").transition("d2b-point-transition").duration(100).attr("d",n),d3.select(this).select("path.d2b-point-front").transition("d2b-point-transition").duration(100).style("opacity",a?.5:1).attr("d",r)}function i(t,n){var e=(l.size.call(this,t,n),l.empty.call(this,t,n));d3.select(this).select("path.d2b-point-back").transition("d2b-point-transition").duration(100).attr("d",a),d3.select(this).select("path.d2b-point-front").transition("d2b-point-transition").duration(100).style("opacity",e?0:1).attr("d",r)}var l={},c=function d(n){var e=n.selection?n.selection():n,c=e.selectAll("path.d2b-point-back").data(function(t){return[t]});c.enter().append("path").attr("class","d2b-point-back").attr("d",a).style("fill-opacity",0).style("stroke",l.stroke).style("stroke-width",l.strokeWidth);n!==e&&(c=c.transition(n)),c.attr("d",a).style("stroke",l.stroke).style("stroke-width",l.strokeWidth);var u=e.selectAll("path.d2b-point-front").data(function(t){return[t]});u.enter().append("path").attr("class","d2b-point-front").attr("d",r).style("opacity",t).style("fill",l.fill).style("stroke",l.stroke).style("stroke-width",l.strokeWidth);return n!==e&&(u=u.transition(n)),u.attr("d",r).style("opacity",t).style("fill",l.fill).style("stroke",l.stroke).style("stroke-width",l.strokeWidth),e.each(function(t,n){var e=l.active.call(this,t,n);d3.select(this).on("mouseover.d2b-point",e?o:null).on("mouseout.d2b-point",e?i:null)}),d},u=d3.symbol();e(c,l).addPropFunctor("size",150,null,function(t){return u.size(t)}).addPropFunctor("type",d3.symbolCircle,null,function(t){return u.type(t)}).addPropFunctor("active",!1).addPropFunctor("empty",!1).addPropFunctor("fill","steelblue").addPropFunctor("stroke",function(t,n){return d3.rgb(l.fill.call(this,t,n)).darker(.3)}).addPropFunctor("strokeWidth","1px");return c}function a(t){var n=arguments.length<=1||void 0===arguments[1]?function(t){return t.label}:arguments[1],e=arguments.length<=2||void 0===arguments[2]?1/0:arguments[2];t.each(function(t,r){for(var a=d3.select(this),o=n.call(this,t,r).split(/\s+/).reverse(),i=void 0,l=[],c=[o.pop()],u=1.1;i=o.pop();)c.join(" ").length+i.length>e&&(l.push(c),c=[]),c.push(i);l.push(c);var d=a.selectAll("tspan").data(l);d.merge(d.enter().append("tspan")).text(function(t){return t.join(" ")}).attr("x",0).attr("y",0).attr("dy",function(t,n){return n*u+"em"})})}function o(){function t(t,e){t.selectAll(".d2b-legend-item").on("click.d2b-legend",function(r,a){n.call(this,r,a,t,e),i.dispatch.call("click",this,t,r,a)}).on("dblclick.d2b-legend",function(n,r){o.call(this,n,r,t,e),i.dispatch.call("dblclick",this,t,n,r)}).on("mouseover.d2b-legend",function(n,e){i.dispatch.call("mouseover",this,t,n,e)}).on("mouseout.d2b-legend",function(n,e){i.dispatch.call("mouseout",this,t,n,e)})}function n(t,n,e,r){var a=i.clickable.call(this,t,n),o=i.allowEmptied.call(e.node(),e.datum(),r),u=e.datum();if(a){if(t.empty=!t.empty,d3.select(this).transition("d2b-legend-change").duration(100).call(c),o)return i.dispatch.call("change",this,e,t,n);var d=!0;u.forEach(function(t){return d=t.empty?d:!1}),d&&(u.forEach(function(t){return t.empty=!1}),e.transition("d2b-legend-change").duration(100).call(l)),i.dispatch.call("change",this,e,t,n)}}function o(t,n,e,r){var a=i.dblclickable.call(this,t,n),o=e.datum();a&&(o.forEach(function(t){return t.empty=!0}),t.empty=!1,e.transition("d2b-legend-change").duration(100).call(l),i.dispatch.call("change",this,e,t,n))}var i={},l=function d(n){return n.each(function(e,r){var o=d3.select(this),l=i.size.call(this,e,r),d=i.maxSize.call(this,e,r),s=i.orient.call(this,e,r),p=i.maxTextLength.call(this,e,r),h=i.items.call(this,e,r);c.size(1.5*Math.pow(l/2,2)).strokeWidth(.1*l);var f=o.selectAll(".d2b-legend").data([h]);f=f.merge(f.enter().append("g").attr("class","d2b-legend"));var y=f.selectAll(".d2b-legend-item").data(function(t){return t},i.key),v=y.enter().append("g").attr("class","d2b-legend-item").style("opacity",0);v.append("g").append("text");var g=y.exit();y=y.merge(v).style("cursor",function(t,n){var e=i.clickable.call(this,t,n),r=i.dblclickable.call(this,t,n);return e||r?"pointer":"auto"}),o.call(t,r);var b=y.select("g").attr("transform","translate("+l/2+", "+l/2+")"),m=y.select("text").attr("transform","translate("+l/1.5+", "+l/3+")").style("font-size",l+"px").call(a,i.label,p);n.selection&&(g=g.transition(n).style("opacity",0),y=y.transition(n),b=b.transition(n),m=m.transition(n)),g.remove(),b.call(c);var x=0;m.each(function(){x=Math.max(x,this.getBBox().width)}),x+=l;var P={x:l,y:5};v.call(u[s],this,P,l,d,x),this.computedWidth=0,this.computedHeight=0,y.style("opacity",1).call(u[s],this,P,l,d,x)}),d},c=r().empty(function(t){return t.empty}),u={horizontal:function(t,n,e,r,a,o){var i=0,l=0,c=0;t.attr("transform",function(){var t=d3.select(this),u=r*t.selectAll("tspan").size(),d=t.select("text").node().getBBox().width;i+o>a.width&&(i=0,l+=c+e.y,c=0);var s="translate("+i+", "+l+")";return c=Math.max(c,u),n.computedWidth=Math.max(n.computedWidth,i+d+1.5*r),i+=o+e.x,s}),n.computedHeight=l+c},vertical:function(t,n,e,r,a){var o=0,i=0,l=0;t.attr("transform",function(){var t=d3.select(this),c=r*t.selectAll("tspan").size(),u=t.select("text").node().getBBox().width;i+c>a.height&&(o+=l+e.x+r,i=0,l=0);var d="translate("+o+", "+i+")";return l=Math.max(l,u),n.computedHeight=Math.max(n.computedHeight,i+c),i+=c+e.y,d}),n.computedWidth=o+l+1.5*r}};e(l,i).addPropFunctor("items",function(t){return t}).addPropFunctor("size",12).addPropFunctor("maxSize",{width:960,height:500}).addPropFunctor("orient","vertical").addPropFunctor("maxTextLength",1/0).addPropFunctor("allowEmptied",!1).addPropFunctor("key",function(t,n){return n}).addPropFunctor("clickable",!1).addPropFunctor("dblclickable",!1).addPropFunctor("label",function(t){return t.label}).addPropFunctor("active",!1,null,function(t){return c.active(t)}).addPropFunctor("symbol",d3.symbolCircle,null,function(t){return c.type(t)}).addPropFunctor("color",function(t){return M(t.label)},null,function(t){return c.fill(t)}).addMethod("computedSize",function(t){var n=t.node?t.node():t;return n?{width:n.computedWidth,height:n.computedHeight}:{width:0,height:0}}).addDispatcher(["dblclick","click","mouseover","mouseout","change"]);return l}function i(t,n){var e={};for(var r in t)"function"!=typeof t[r]&&n.indexOf(r)<0&&(e[r]=t[r]);return e}function l(t,n){return t.selection?void t.attrTween("d",function(t){var e=this;t=i(t,["data"]),this.current=this.current||t;var r=d3.interpolate(this.current,t);return function(t){return e.current=r(t),n(e.current)}}):t.attr("d",function(t){return this.current=i(t,["data"]),n(t)})}function c(){function t(t,e,a){var o=void 0;return(o=n(t,e,a))?{startAngle:o.endAngle,endAngle:o.endAngle}:(o=r(t,e,a))?{startAngle:o.startAngle,endAngle:o.startAngle}:{startAngle:0,endAngle:0}}function n(t,n,e){for(var r=n.length;--t>=0;)for(var o=a.key(e[t].data,t),i=0;r>i;++i)if(a.key(n[i].data,i)===o)return n[i]}function r(t,n,e){for(var r=e.length,o=n.length;++t<r;)for(var i=a.key(e[t].data,t),l=0;o>l;++l)if(a.key(n[l].data,l)===i)return n[l]}var a={},o=function i(n){var e=n.selection?n.selection():n;return e.each(function(r,o){var i=d3.select(this),c=i.selectAll(".d2b-pie-arc"),u=c.data();c=c.data(a.values,function(t,n){return a.key(t.data,n)});var d=c.enter().append("g").attr("class","d2b-pie-arc"),s=c.exit(),p=c.merge(d).order();d.append("path").attr("fill",function(t,n){return a.color.call(this,t.data,n)});var h=p.data();d.select("path").each(function(n,e){this.current=t(e,u,h)}),s.datum(function(n,e){var r=t(e,h,u);return r.data=n.data,r}),n!==e&&(s=s.transition(n),p=p.transition(n)),p.select("path").call(l,a.arc).attr("fill",function(t,n){return a.color.call(this,t.data,n)}),s.remove().select("path").call(l,a.arc)}),i};e(o,a).addProp("key",function(t){return t.label}).addProp("arc",d3.arc().innerRadius(100).outerRadius(200)).addPropFunctor("values",function(t){return t}).addPropFunctor("color",function(t){return M(t.label)});return o}function u(){var t={},n=function r(n){var e=n.selection?n.selection():n,a=e.selectAll(".d2b-line-graph").data(function(t){return t},t.key),o=a.enter().append("g").attr("class","d2b-line-graph").style("opacity",0);o.append("path").attr("class","d2b-line");var i=a.merge(o).order(),l=a.exit(),c=i.select(".d2b-line");return n!==e&&(i=i.transition(n),l=l.transition(n),c=c.transition(n)),i.style("opacity",1),l.style("opacity",0).remove(),c.style("stroke",t.color).attr("d",function(n,e){var r=this,a=t.x.call(this,n,e),o=t.y.call(this,n,e),i=t.values.call(this,n,e);return t.line.x(function(n,e){return a(t.px.call(r,n,e))}).y(function(n,e){return o(t.py.call(r,n,e))})(i)}),r};e(n,t).addProp("line",d3.line()).addProp("x",d3.scaleLinear(),function(e){return arguments.length?(e.domain?t.x=function(){return e}:t.x=e,n):t.x}).addProp("y",d3.scaleLinear(),function(e){return arguments.length?(e.domain?t.y=function(){return e}:t.y=e,n):t.y}).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values}).addPropFunctor("color",function(t){return M(t.label)}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y});return n}function d(){var t={},n=function(n){var e=this,r=n;n=n.map(t.values);var a=[],o=n.map(function(n,r){var o={};return n.forEach(function(n,r){var i=t.x.call(e,n,r);a.push(i),o[i]=t.y.call(e,n,r)}),o});a=d3.set(a).values();var i=a.reduce(function(t,n,e){return t[n]=e,t},{}),l=d3.range(0,n.length),c=a.map(function(t,n){return o.map(function(n,e){return n[t]||0})}),u=t.stack.keys(l).value(function(t,n){return t[n]||0})(c);return n.forEach(function(n,r){n.forEach(function(n,a){var o=t.x.call(e,n,a),l=u[r][i[o]];t.out.call(e,n,l[0],l[1],o)})}),r};e(n,t).addProp("stack",d3.stack()).addPropFunctor("values",function(t){return t}).addPropFunctor("x",function(t){return t.x}).addPropFunctor("y",function(t){return t.y}).addPropFunctor("out",function(t,n,e){t.y0=n,t.y1=e});return n}function s(){return Math.random().toString(36).substr(2,9)}function p(){var t={},n=function o(n){var e=n.selection?n.selection():n;e.each(function(t){a.entries(t).forEach(function(t){return r(t.values)})});var i=e.selectAll(".d2b-area-graph").data(function(t){return t},t.key),l=i.enter().append("g").attr("class","d2b-area-graph").style("opacity",0);l.append("path").attr("class","d2b-area");var c=i.merge(l).order(),u=i.exit(),d=c.select(".d2b-area");return n!==e&&(c=c.transition(n),u=u.transition(n),d=d.transition(n)),c.style("opacity",1),u.style("opacity",0).remove(),d.style("fill",t.color).attr("d",function(n,e){var r=t.x.call(this,n,e),a=t.y.call(this,n,e),o=t.values.call(this,n,e);return t.area.x(function(t,n){return r(t.x)}).y0(function(t,n){return a(t.__y0__)}).y1(function(t,n){return a(t.__y1__)})(o)}),o},r=d().out(function(t,n,e){t.__y0__=n,t.__y1__=e}),a=d3.nest().key(function(n){var e=t.stackBy(n);return e!==!1&&null!==e?e:s()});e(n,t).addProp("area",d3.area()).addProp("stack",d3.stack(),null,function(t){return r.stack(t)}).addProp("x",d3.scaleLinear(),function(e){return arguments.length?(e.domain?t.x=function(){return e}:t.x=e,n):t.x}).addProp("y",d3.scaleLinear(),function(e){return arguments.length?(e.domain?t.y=function(){return e}:t.y=e,n):t.y}).addPropFunctor("stackBy",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values},null,function(t){return r.values(t)}).addPropFunctor("color",function(t){return M(t.label)}).addPropFunctor("px",function(t){return t.x},null,function(t){return r.x(t)}).addPropFunctor("py",function(t){return t.y},null,function(t){return r.y(t)});return n}function h(){function t(t,e,r){t.attr("transform",function(t,a){var o=e(n.px.call(this,t,a)),i=r(n.py.call(this,t,a));return"translate("+o+", "+i+")"})}var n={},a=function o(e){var r=e.selection?e.selection():e,a=r.selectAll(".d2b-scatter-graph").data(function(t){return t},n.key),i=a.enter().append("g").attr("class","d2b-scatter-graph").style("opacity",0),l=a.merge(i).order(),c=a.exit();return e!==r&&(l=l.transition(e),c=c.transition(e)),l.style("opacity",1),c.style("opacity",0).remove(),l.each(function(a,o){var i=d3.select(this),l=n.x.call(this,a,o),c=n.y.call(this,a,o),u=n.color.call(this,a,o),d=n.symbol.call(this,a,o);n.point.fill(function(t,e){return n.pcolor.call(this,t,e)||u}).type(function(t,e){return n.psymbol.call(this,t,e)||d}).size(n.psize);var s=i.selectAll(".d2b-scatter-point").data(n.values,n.pkey),p=s.enter().append("g").attr("class","d2b-scatter-point"),h=s.merge(p).order(),f=s.exit();e!==r&&(h=h.transition(e),f=f.transition(e)),p.style("opacity",0).call(t,l,c),h.style("opacity",1).call(n.point).call(t,l,c),f.style("opacity",0).remove()}),o};e(a,n).addProp("point",r().active(!0)).addProp("x",d3.scaleLinear(),function(t){return arguments.length?(t.domain?n.x=function(){return t}:n.x=t,a):n.x}).addProp("y",d3.scaleLinear(),function(t){return arguments.length?(t.domain?n.y=function(){return t}:n.y=t,a):n.y}).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values}).addPropFunctor("color",function(t){return M(t.label)}).addPropFunctor("symbol",function(t){return d3.symbolCircle}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y}).addPropFunctor("pcolor",function(t){return null}).addPropFunctor("psymbol",null).addPropFunctor("pkey",function(t,n){return n}).addPropFunctor("psize",function(t){return 25});return a}function f(){function t(t){var n={};return function(e,r,a,o){var i=a-r,l=n[o]=n[o]||[0,0];e.__stackIndex__=t,e.__base__=o,i>0?e.__extent__=[l[0],l[0]+=i]:e.__extent__=[l[1],l[1]+=i]}}function n(t,n,e){t.attr("transform",function(t){return"translate("+[n[e.x](t),n[e.y](t)]+")"})}function r(t,n){var e=[];t.forEach(function(r,o){var i=a[n.x].call(t,r,o),l=a.values.call(t,r,o);l.forEach(function(t,o){var l=a[n.px].call(r,t,o);e.push(i(l))})}),e.sort(d3.ascending);for(var r=1/0,o=0;o<e.length-1;o++)e[o+1]!==e[o]&&(r=Math.min(e[o+1]-e[o],r));return r}var a={},o=function c(e){var o=e.selection?e.selection():e;return o.each(function(c,u){var d={};d="horizontal"===a.orient.call(this,c,u)?{rotate:!0,px:"py",py:"px",x:"y",y:"x",w:"height",h:"width"}:{rotate:!1,px:"px",py:"py",x:"x",y:"y",w:"width",h:"height"},i.x(a[d.px]).y(a[d.py]);var s=l.entries(c);s.forEach(function(n,e){return i.out(t(e))(n.values)});var p=(1-a.padding.call(this,c,u))*(a.bandwidth.call(this,c,u)||r(c,d)),h=p/s.length,f=h*a.groupPadding.call(this,c,u),y=d3.select(this).selectAll(".d2b-bar-graph").data(c,a.key),v=y.enter().append("g").attr("class","d2b-bar-graph").style("opacity",0),g=y.merge(v).order(),b=y.exit();e!==o&&(g=g.transition(e),b=b.transition(e)),g.style("opacity",1),b.style("opacity",0).remove(),g.each(function(t,r){var i=d3.select(this),l=a.color.call(this,t,r),c=a[d.x].call(this,t,r),u=a[d.y].call(this,t,r),s=a.offset.call(this,t,r)||c.bandwidth?c.bandwidth()/2:0,y=i.selectAll(".d2b-bar-group").data(a.values,a.pkey),v=y.enter().append("g").attr("class","d2b-bar-group");v.append("rect");var g=y.merge(v).order(),b=y.exit();g.each(function(t,n){var e=a.pcentered.call(this,t,n),r=e?s-p/4:s-p/2+t.__stackIndex__*h+f;t.__basepx__=c(t.__base__)+r,t.__extentpx__=[u(t.__extent__[0]),u(t.__extent__[1])],t.__extentpx__.sort(d3.ascending)}),e!==o&&(g=g.transition(e),b=b.transition(e)),v.attr("class","d2b-bar-group").style("opacity",0).call(n,{x:function(t){return t.__basepx__},y:function(t){return u(0)}},d).select("rect").attr("fill",function(t,n){return a.pcolor.call(this,t,n)||l}).attr(d.w,h-2*f).attr(d.h,0),g.style("opacity",1).call(n,{x:function(t){return t.__basepx__},y:function(t){return t.__extentpx__[0]}},d).select("rect").attr("fill",function(t,n){return a.pcolor.call(this,t,n)||l}).attr(d.w,h-2*f).attr(d.h,function(t){return t.__extentpx__[1]-t.__extentpx__[0]}),b.style("opacity",0).remove()})}),c},i=d(),l=d3.nest().key(function(t){var n=a.stackBy(t);return n!==!1&&null!==n?n:s()});e(o,a).addProp("stack",d3.stack(),null,function(t){return i.stack(t)}).addProp("x",d3.scaleLinear(),function(t){return arguments.length?(t.domain?a.x=function(){return t}:a.x=t,o):a.x}).addProp("y",d3.scaleLinear(),function(t){return arguments.length?(t.domain?a.y=function(){return t}:a.y=t,o):a.y}).addPropFunctor("orient","vertical").addPropFunctor("padding",.5).addPropFunctor("groupPadding",0).addPropFunctor("bandwidth",null).addPropFunctor("offset",null).addPropFunctor("stackBy",null).addPropFunctor("key",function(t){return t.label}).addPropFunctor("values",function(t){return t.values},null,function(t){return i.values(t)}).addPropFunctor("color",function(t){return M(t.label)}).addPropFunctor("px",function(t){return t.x}).addPropFunctor("py",function(t){return t.y}).addPropFunctor("pcentered",!1).addPropFunctor("pcolor",null).addPropFunctor("pkey",function(t,n){return n});return o}function y(t){function n(t,n,e,r,a,o,i){var l=void 0,u=void 0,d=i.prop(c.legendAt).split(" ");switch(d={x:d[1],y:d[0]},d.x){case"left":l=0;break;case"center":l=e/2-o.width/2;break;default:l=e-o.width}switch(d.y){case"bottom":u=r-o.height;break;case"center":u=r/2-o.height/2;break;default:u=0}var s=10,p={left:0,top:0,bottom:0,right:0};return o.height+=s,o.width+=s,"center"===d.x&&"center"===d.y||("horizontal"===a?"top"===d.y?p.top+=o.height:"bottom"===d.y&&(p.bottom+=o.height):"left"===d.x?p.left+=o.width:"right"===d.x&&(p.right+=o.width)),n.attr("transform","translate("+l+", "+u+")"),t.attr("transform","translate("+l+", "+u+")"),p}function r(t,n){var e={prop:function(n,e){var r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];return e=e||t,r.unshift(t),"function"==typeof n?n.apply(e,r):n},dispatch:function(n,e){var r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];return e=e||t,r.unshift(t),c.dispatch.apply(n,e,r)},update:function(){var r=(t.selection?t.selection():t).transition("d2b-chart").duration(e.prop(c.duration));i(r,n)}};return e}function a(t){var n={top:0,left:0,right:0,bottom:0};return"number"==typeof t?{top:t,left:t,right:t,bottom:t}:(["top","bottm","right","left"].forEach(function(e){t[e]&&n[e]==t[e]}),n)}function i(e,o){var i=r(e,o),l=e.selection?e.selection():e,u=l.datum(),d=i.prop(c.size),s=a(i.prop(c.padding)),p="translate("+s.left+", "+s.top+")";i.dispatch("beforeUpdate");var h=l.selectAll(".d2b-svg").data(function(t){return[t]}),f=h.enter().append("svg").attr("class","d2b-svg"),y=l.node().getBoundingClientRect(),v=d&&d.width?d.width:y.width,g=d&&d.height?d.height:y.height;f.attr("width",v).attr("height",g).append("g").attr("class","d2b-group").attr("transform",p),e.select(".d2b-svg").attr("width",v).attr("height",g).select(".d2b-group").attr("transform",p);var b=l.select(".d2b-group");v-=s.top+s.bottom,g-=s.left+s.right;var m=b.selectAll(".d2b-chart-legend").data(i.prop(c.legendHidden)?[]:[u]),x=m.enter().append("g").attr("class","d2b-chart-legend").style("opacity",0),P=m.exit();m=m.merge(x),e!==l&&(m=m.transition(e),P=P.transition(e).style("opacity",0)),m.style("opacity",1).call(c.legend.maxSize({width:v,height:g})),P.remove();var _={left:0,top:0};if(m.size()){var k=c.legend.computedSize(m),F=c.legend.orient().call(m.node(),u,o);_=n(m,x,v,g,F,k,i),v-=_.left+_.right,g-=_.top+_.bottom}var w="translate("+_.left+", "+_.top+")",A=b.selectAll(".d2b-chart-main").data(function(t){return[t]});A.enter().append("g").attr("class","d2b-chart-main").attr("transform",w);A=e.select(".d2b-chart-main").attr("transform",w),t(A,v,g,i),i.dispatch("afterUpdate")}var l=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],c=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],u=function(t){t.each(function(n,e){var r=d3.select(this),a=t.selection?r.transition(t):r;i(a,e)})},d=e(u,c).addProp("legend",o()).addPropFunctor("size",null).addPropFunctor("padding",0).addPropFunctor("duration",250).addPropFunctor("legendHidden",!1).addPropFunctor("legendAt","center right").addDispatcher(["beforeUpdate","afterUpdate"].concat(l));return d}function v(t){var n=arguments.length<=1||void 0===arguments[1]?1/0:arguments[1];t.each(function(){for(var t=d3.select(this),e=t.text().split(/\s+/).reverse(),r=void 0,a=[],o=0,i=1.1,l=parseFloat(t.attr("y"))||0,c=parseFloat(t.attr("dy"))||0,u=t.text(null).append("tspan").attr("x",0).attr("y",l).attr("dy",c+"em");r=e.pop();)a.push(r),u.text(a.join(" ")),u.node().getComputedTextLength()>n&&(a.pop(),u.text(a.join(" ")),a=[r],u=t.append("tspan").attr("x",0).attr("y",l).attr("dy",++o*i+c+"em").text(r))})}function g(t){var n=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return isNaN(t)||null===t?n:t}function b(t){var e=arguments.length<=1||void 0===arguments[1]?function(t){return t}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?function(t){return t}:arguments[2];return e=n(e),t.selection?void t.tween("text",function(t,n){var a=this,o=g(e.call(this,t,n));this.current=g(this.current,o);var i=d3.interpolate(this.current,o);return function(t){a.textContent=r(a.current=i(t))}}):t.text(function(t,n){return this.current=g(e.call(this,t,n)),r(this.current)})}function m(t,n){return t.selection?void t.attrTween("transform",function(t){var e=this;t=d2b.omit(t,["data"]),this.current=this.current||t;var r=d3.interpolate(this.current,t);return function(t){return e.current=r(t),"translate("+n.centroid(e.current)+")"}}):t.attr("transform",function(t){return this.current=i(t,["data"]),"translate("+n.centroid(this.current)+")"})}function x(){var t=arguments.length<=0||void 0===arguments[0]?d2b.id():arguments[0],n={},r=function d(t){return(t.selection?t.selection():t).on(c("mouseover"),o).on(c("mouseout"),l).on(c("mousemove"),i),d},a=function(t,e){var r=this.getBoundingClientRect(),a={},o=(n.at.call(this,t,e)||(d3.event.clientX>window.innerWidth/2?"center left":"center right")).split(" ");switch(o={x:o[1],y:o[0]},o.x){case"left":a.x=r.left;break;case"center":a.x=r.left+r.width/2;break;default:a.x=r.left+r.width}switch(o.y){case"bottom":a.y=r.top+r.height;break;case"center":a.y=r.top+r.height/2;break;default:a.y=r.top}return a},o=function(t,e){n.tooltip=n.selection.selectAll(".d2b-tooltip").data(function(t){return[t]});var r=n.tooltip.enter().append("div").style("opacity",0).attr("class","d2b-tooltip");r.append("div").attr("class","d2b-tooltip-content"),n.tooltip=n.tooltip.merge(r),n.tooltip.transition("d2b-tooltip-insert").duration(100).style("opacity",1),n.dispatch.call("insert",n.tooltip,this,t,e)},i=function(t,e){var r=n.html.call(this,t,e),o=n.target.call(this,t,e),i=n.color.call(this,t,e),l=o?o.node():this,c=n.followMouse.call(this,t,e)?{x:d3.event.clientX,y:d3.event.clientY}:a.call(l,t,e),u=n.my.call(this,t,e)||(d3.event.clientX>window.innerWidth/2?"left":"right");n.tooltip.attr("class","d2b-tooltip d2b-tooltip-"+u).style("top",c.y+"px").style("left",c.x+"px").style("border-color",i).select(".d2b-tooltip-content").html(r),n.dispatch.call("move",n.tooltip,this,t,e)},l=function(t,e){n.tooltip.transition().duration(100).style("opacity",0).remove(),n.dispatch.call("remove",n.tooltip,this,t,e)},c=function(t){return t+".d2b-tooltip"},u=function(e,a){a&&a.select(".d2b-tooltip-area-"+t).remove(),e&&(n.selection=e.selectAll(".d2b-tooltip-area-"+t).data([r]),n.selection=n.selection.merge(n.selection.enter().append("div").attr("class","d2b-tooltip-area-"+t+" d2b-tooltip-area")))};e(r,n).addProp("container",d3.select("body"),null,u).addMethod("clear",function(t){oldGraph.on(c("mouseover"),null).on(c("mouseout"),null).on(c("mousemove"),null)}).addPropFunctor("followMouse",!1).addPropFunctor("color",null).addPropFunctor("my",null).addPropFunctor("at",null).addPropFunctor("target",null).addPropFunctor("html",null).addDispatcher(["insert","move","remove"]);return r}function P(){function t(t,n,e,r){}var n=y(t,["zoomIn","zoomOut"]).addPropFunctor("interpolate","linear"),e=n.values(),r=n.base();return e.legend.items(function(t){return t.values}).active(!0).clickable(!0).dblclickable(!0).on("change",function(){console.log("legend changed!")}),r}function _(){function t(t,a,l,p){var h=t.selection?t.selection():t,f=h.node(),y=o.radius.call(f,a,l),v=h.datum();v.__update__=p.update,v=v.filter(function(t){return!t.empty});var g=d3.sum(v,function(t,n){return o.value.call(i,t,n)}),m=h.selectAll(".d2b-pie-chart").data([v]),x=m.enter().append("g").attr("class","d2b-pie-chart");m=m.merge(x).datum(function(t){return t=c(t),t.forEach(function(t){t.outerRadius=y,t.innerRadius=y*o.donutRatio}),t}),h!==t&&(m=m.transition(t)),m.call(d);var P=h.selectAll(".d2b-pie-arc").each(function(t){this.outerRadius=t.outerRadius,t.data.__elem__=this}).on("mouseover",e).on("mouseout",r).call(o.tooltip),_=P.selectAll(".d2b-pie-arc-percent").data(function(t){return[t]});_.enter().append("g").attr("class","d2b-pie-arc-percent").append("text").attr("y",6),P.each(function(t){var n=d3.select(this),e=n.select(".d2b-pie-arc path").node().current,r=n.select(".d2b-pie-arc-percent"),a=r.select("text").node();r.node().current=e,a.current=a.current||0}),h!==t&&(P=P.each(function(t){this.transitioning=!0}).transition(t).on("end",function(t){this.transitioning=!1})),P.select(".d2b-pie-arc-percent").call(d2b.tweenCentroid,u).select("text").call(b,function(t){return t.value/g},s).style("opacity",function(t,n){return o.showPercent.call(this,t.data,n,t.value/g)?1:0});var k=n(f,y,a,l);x.attr("transform","translate("+k.x+", "+k.y+")"),m.attr("transform","translate("+k.x+", "+k.y+")")}function n(t,n,e,r){var a=o.center.call(t,e,r,n);if(!a){var i=o.at.split(" ");switch(i={x:i[1],y:i[0]},a={},i.x){case"left":a.x=n;break;case"center":a.x=e/2;break;default:a.x=e-n}switch(i.y){case"bottom":a.y=r-n;break;case"center":a.y=r/2;break;default:a.y=n}}return a}function e(t){if(!this.transitioning){var n=d3.select(this).select("path");t.outerRadius=1.03*this.outerRadius,n.transition("d2b-chart").call(l,u)}}function r(t){if(!this.transitioning){var n=d3.select(this).select("path");t.outerRadius=this.outerRadius,n.transition("d2b-chart").call(l,u)}}var a=y(t),o=a.values(),i=a.base();o.legend.active(!0).clickable(!0).dblclickable(!0).on("change",function(t,n){return t.datum().__update__()}).on("mouseover.d2b-pie",function(t,n){return d3.select(n.__elem__).each(e)}).on("mouseout.d2b-pie",function(t,n){return d3.select(n.__elem__).each(r)});var c=d3.pie().sort(null),u=d3.arc().outerRadius(function(t){return t.outerRadius}).innerRadius(function(t){return t.innerRadius}),d=d2b.svgPie().arc(u),s=d3.format(".0%");return a.addProp("donutRatio",0).addProp("startAngle",0,null,function(t){return c.startAngle(t)}).addProp("endAngle",2*Math.PI,null,function(t){return c.endAngle(t)}).addProp("at","center center").addProp("key",function(t){return t.label},null,function(t){o.legend.key(t),d.key(t)}).addProp("tooltip",x().followMouse(!0).html(function(t){return"<b>"+o.label(t.data)+":</b> "+o.value(t.data)})).addPropFunctor("showPercent",function(t,n,e){return e>.03}).addPropFunctor("center",null).addPropFunctor("radius",function(t,n){return Math.min(t,n)/2}).addPropFunctor("sort",null).addPropFunctor("color",function(t){return d2b.defaultColor(t.label)},null,function(t){o.tooltip.color(function(n){return d3.rgb(t(n.data)).darker(.3)}),o.legend.color(t),d.color(t)}).addPropFunctor("value",function(t){return t.value},null,function(t){return c.value(t)}).addPropFunctor("label",function(t){return t.label},null,function(t){return o.legend.label(t)}),i}var k=Math.PI,F=Math.sqrt(8),w=Math.sqrt(2),A={draw:function(t,n){var e=Math.sqrt(n/(k+5/4)),r=.3125*e,a=2*Math.asin(.25),o=(k/2-a)/2,i=e/F-e*Math.cos(o),l=e*Math.sin(o);t.arc(i,l,e,-o,2*k-a-o),t.lineTo(e*(5/4-1/w),-e*(1/F+5/4-1/w)),t.lineTo(e*(5/4-1/w)-r,-e*(1/F+5/4-1/w)),t.lineTo(e*(5/4-1/w)-r,-e*(1/F+7/4-1/w)),t.lineTo(e*(7/4-1/w+1/F),-e*(1/F+7/4-1/w)),t.lineTo(e*(7/4-1/w+1/F),-e*(5/4-1/w)+r),t.lineTo(e*(5/4-1/w+1/F),-e*(5/4-1/w)+r),t.lineTo(e*(5/4-1/w+1/F),-e*(5/4-1/w)),t.closePath()}},z={draw:function(t,n){var e=Math.sqrt(n/(k+5/4)),r=2*Math.asin(.25),a=e/4-e*Math.cos(r/2);t.arc(0,a,e,3*-k/2+r/2,k/2-r/2),t.lineTo(e/4,3*e/4),t.lineTo(3*e/4,3*e/4),t.lineTo(3*e/4,5*e/4),t.lineTo(e/4,5*e/4),t.lineTo(e/4,7*e/4),t.lineTo(-e/4,7*e/4),t.lineTo(-e/4,5*e/4),t.lineTo(3*-e/4,5*e/4),t.lineTo(3*-e/4,3*e/4),t.lineTo(-e/4,3*e/4),t.closePath()}},M=d3.scaleCategory10();t.symbolMars=A,t.symbolVenus=z,t.point=r,t.legend=o,t.svgPie=c,t.svgLine=u,t.svgArea=p,t.svgScatter=h,t.svgBar=f,t.modelBase=e,t.modelChart=y,t.defaultColor=M,t.id=s,t.textWrap=a,t.textWrapPX=v,t.tweenCentroid=m,t.tweenNumber=b,t.tweenArc=l,t.tooltip=x,t.stack=d,t.omit=i,t.chartTemplate=P,t.chartPie=_});