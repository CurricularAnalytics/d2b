/* Copyright Â© 2013-2015 Academic Dashboards, All Rights Reserved. */function arcTween(a,b){a.attrTween("d",function(a){var c=d3.interpolate(this._current,a);return this._current=a,function(a){return b(c(a))}})}var AD=AD||{};AD.createNameSpace=function(a){var b=a.split("."),c=AD;"AD"===b[0]&&(b=b.slice(1));for(var d=0;d<b.length;d++){var e=b[d];"undefined"==typeof c[e]&&(c[e]={}),c=c[e]}return c},AD.createNameSpace("AD.CHARTS"),AD.createNameSpace("AD.DASHBOARDS"),AD.createNameSpace("AD.UTILS"),AD.createNameSpace("AD.UTILS.CHARTPAGE"),AD.createNameSpace("AD.CONSTANTS"),AD.CONSTANTS.DEFAULTPALETTE={primary:"rgb(42,54,82)",secondary:"rgb(11,22,47)"},AD.CONSTANTS.DEFAULTWIDTH=function(){return 960},AD.CONSTANTS.DEFAULTHEIGHT=function(){return 540},AD.CONSTANTS.DEFAULTMARGIN=function(){return{left:0,right:0,top:0,bottom:0}},AD.CONSTANTS.DEFAULTFORCEDMARGIN=function(){return{left:30,bottom:20,right:30,top:20}},AD.CONSTANTS.DEFAULTCOLOR=function(){return d3.scale.category20c()},AD.CONSTANTS.ANIMATIONLENGTHS=function(){return{normal:500,"short":100,"long":1e3}},AD.UTILS.chartAdapter=function(a,b){if(b.chart=new AD.CHARTS[a],b.chartLayoutData||(b.chartLayoutData={}),b.chartLayout=new AD.UTILS.CHARTPAGE.chartLayout,b.chartLayout.chart(b.chart).data(b.chartLayoutData),b.properties)for(key in b.properties)b.chart[key](b.properties[key])},AD.UTILS.CHARTPAGE.chartLayout=function(){var a,b,c=AD.CONSTANTS.DEFAULTWIDTH(),d=AD.CONSTANTS.DEFAULTHEIGHT(),e={chartLayout:{}},f=AD.CONSTANTS.ANIMATIONLENGTHS().normal,g=!0,h={};return h.chart=function(a){return arguments.length?(b=a,g=!0,h):b},h.width=function(a){return arguments.length?(c=a,h):c},h.height=function(a){return arguments.length?(d=a,h):d},h.selection=function(b){return arguments.length?(a=b,g=!0,h):a},h.select=function(b){return arguments.length?(a=d3.select(b),g=!0,h):a},h.animationDuration=function(a){return arguments.length?(f=a,h):f},h.data=function(a,b){return arguments.length?(b&&(e={chartLayout:{}},g=!0),a.data.chartLayout.footnote&&(e.chartLayout.footnote=a.data.chartLayout.footnote),a.data.chartLayout.rightNotes&&(e.chartLayout.rightNotes=a.data.chartLayout.rightNotes),a.data.chartLayout.leftNotes&&(e.chartLayout.leftNotes=a.data.chartLayout.leftNotes),a.data.chartLayout.title&&(e.chartLayout.title=a.data.chartLayout.title),a.data.chartCallback&&(e.chartCallback=a.data.chartCallback),h):e},h.generate=function(c){a.selectAll("*").remove(),a.wrapper=a.append("div").attr("class","ad-chart-layout-wrapper"),a.container=a.wrapper.append("div").attr("class","ad-chart-layout ad-container"),a.container.title=a.container.append("div").attr("class","ad-chart-layout-title"),a.container.title.div=a.container.title.append("div"),a.container.chart=a.container.append("div").attr("class","ad-chart-layout-chart"),b.selection(a.container.chart).update(e.chartCallback),a.container.rightNotes=a.container.append("div").attr("class","ad-chart-layout-right-notes"),a.container.rightNotes.ul=a.container.rightNotes.append("ul"),a.container.leftNotes=a.container.append("div").attr("class","ad-chart-layout-left-notes"),a.container.leftNotes.ul=a.container.leftNotes.append("ul"),a.container.footnote=a.container.append("div").attr("class","ad-chart-layout-footnote"),a.container.footnote.div=a.container.footnote.append("div"),a.container.source=a.container.append("div").attr("class","ad-chart-layout-source").append("ul"),g=!1;var d=f;return h.animationDuration(0).update(c).animationDuration(d),h},h.update=function(i){if(!a)return console.warn("chartLayout was not given a selection");if(!b)return console.warn("chartLayout was not given a chart");g&&h.generate(i);var j={top:10,bottom:0,left:0,right:0};a.wrapper.style("width",c+"px").style("height",d+"px"),a.container.title.div.text(e.chartLayout.title).style("opacity","1"),e.chartLayout.title?j.top+=a.container.title.node().getBoundingClientRect().height:a.container.title.div.style("opacity","0"),a.container.footnote.div.text(e.chartLayout.footnote),j.bottom+=a.container.footnote.node().getBoundingClientRect().height,a.container.footnote.style("top",d-j.bottom+"px"),!e.chartLayout.rightNotes||e.chartLayout.rightNotes.length<1?e.chartLayout.rightNotes=[]:j.right+=.2*c+5,a.container.rightNotes.style("width",.2*c+"px").style("height",d-j.top-j.bottom+"px").style("left",.8*c-5+"px");var k=a.container.rightNotes.ul.selectAll("li.ad-chart-layout-note").data(e.chartLayout.rightNotes);k.enter().append("li").attr("class","ad-chart-layout-note"),k.text(function(a){return a}),k.exit().style("opacity",0).remove(),!e.chartLayout.leftNotes||e.chartLayout.leftNotes.length<1?e.chartLayout.leftNotes=[]:j.left+=.2*c,a.container.leftNotes.style("width",.2*c+"px").style("height",d-j.top-j.bottom+"px");var l=a.container.leftNotes.ul.selectAll("li.ad-chart-layout-note").data(e.chartLayout.leftNotes);return l.enter().append("li").attr("class","ad-chart-layout-note"),l.text(function(a){return a}),l.exit().style("opacity",0).remove(),a.container.chart.style("left",j.left+5+"px").style("top",j.top+"px"),b.width(c-j.left-j.right-10).height(d-j.top-j.bottom).animationDuration(f).update(e.chartCallback),d3.timer.flush(),i&&i(),h},h},AD.UTILS.chartPage=function(){var a,b,c=AD.CONSTANTS.DEFAULTWIDTH(),d=0,e=AD.CONSTANTS.ANIMATIONLENGTHS().normal,f="forward",g=function(){var b={};b.left="backward"==f?-c+"px":c+"px",a.currentPage=a.append("div").attr("class","ad-chart-page-current-page").style("opacity",0).style("left",b.left)},h={};return h.width=function(a){return arguments.length?(c=a,h):c},h.computedHeight=function(){return d},h.selection=function(b){return arguments.length?(a=b,h):a},h.select=function(b){return arguments.length?(a=d3.select(b),h):a},h.animationDuration=function(a){return arguments.length?(e=a,h):e},h.animationType=function(a){return arguments.length?(f=a,h):f},h.data=function(a){return arguments.length?(newData=!0,b=a,h):b},h.update=function(i){if(!a)return console.warn("page was not given a selection");var j={};if(newData&&(newData=!1,a.currentPage&&(j.left="backward"==f?c+"px":-c+"px",a.currentPage.transition().duration(e).style("opacity",0).style("left",j.left).remove()),g()),d=0,a.currentPage.transition().duration(e).style("opacity",1).style("left","0px"),!b.data.charts||b.data.charts.length<1)return console.warn("chart page was not provided any charts");{var k=a.currentPage.selectAll("div.ad-page-chart-layout").data(b.data.charts);k.enter().append("div").attr("class","ad-page-chart-layout").each(function(a){a.chart.chartLayout&&a.chart.chartLayout.select(this).width(c*a.width).height(a.height).animationDuration(0).update(a.chart.chartLayoutData.chartCallback)})}return k.each(function(a){a.chart.chartLayout&&a.chart.chartLayout.animationDuration(e).width(c*a.width).update(a.chart.chartLayoutData.chartCallback)}).style("left",function(a){return c*a.x+"px"}).style("top",function(a){return a.y+"px"}),d3.timer.flush(),i&&i(),h},h},AD.createNameSpace("AD.UTILS.CONTROLS"),AD.UTILS.CONTROLS.checkbox=function(){var a,b=5,c=0,d=0,e={label:"",state:!1},f={elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){},elementChange:function(){}},g={};return g.scale=function(a){return arguments.length?(b=a,g):b},g.selection=function(b){return arguments.length?(a=b,g):a},g.checked=function(a){return arguments.length?(e.state=a,g.update()):e.state},g.computedHeight=function(){return d},g.computedWidth=function(){return c},g.on=function(a,b){return a=a.split("."),arguments.length?1==arguments.length?a[1]?f[a[0]][a[1]]:f[a[0]]["default"]:(a[1]?f[a[0]][a[1]]=b:f[a[0]]["default"]=b,g):f},g.data=function(a){return arguments.length?(e=a,g):e},g.update=function(h){if(!a)return console.warn("checkbox was not given a selection");if(!e)return console.warn("checkboxData is null");var i=a.selectAll("g.ad-checkbox-container").data([e]),j=i.enter().append("g").attr("class","ad-checkbox-container").on("click",function(a,b){e.state=!e.state;for(key in f.elementClick)f.elementClick[key].call(this,a,b);for(key in f.elementChange)f.elementChange[key].call(this,a,b);g.update()}).on("mouseover",function(a,b){for(key in f.elementMouseover)f.elementMouseover[key].call(this,a,b)}).on("mouseout",function(a,b){for(key in f.elementMouseout)f.elementMouseout[key].call(this,a,b)});j.append("rect").attr("rx",1),j.append("path"),j.append("text").text(function(a){return a.label});var k=i.select("text").attr("y",2.1*b).style("font-size",2.5*b+"px"),l=k.node().getComputedTextLength(),m=b;l+=m;var n="translate("+l+",0)",o=i.select("path").attr("transform",n).attr("d","M"+.38*b+","+1.06*b+" l"+.7*b+","+.5*b+" l"+.58*b+","+-1.19*b).style("stroke-width",.4*b).attr("stroke-dasharray",2.2*b);o.transition().duration(AD.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("stroke-dashoffset",e.state?0:2.2*b);i.select("rect").attr("width",2.1*b+"px").attr("height",2.1*b+"px").attr("transform",n).style("stroke-width",.4*b);return c=l+2.1*b,d=2.5*b,h&&h(),g},g},AD.UTILS.CONTROLS.horizontalControls=function(){var a,b,c=AD.CONSTANTS.DEFAULTWIDTH(),d=(AD.CONSTANTS.DEFAULTCOLOR(),0),e=0,f=AD.CONSTANTS.ANIMATIONLENGTHS().normal,g=5,h={elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){},elementChange:function(){}},i={};return i.width=function(a){return arguments.length?(c=a,i):c},i.computedHeight=function(){return e},i.computedWidth=function(){return d},i.selection=function(b){return arguments.length?(a=b,i):a},i.scale=function(a){return arguments.length?(g=a,i):g},i.animationDuration=function(a){return arguments.length?(f=a,i):f},i.on=function(a,b){return a=a.split("."),arguments.length?1==arguments.length?a[1]?h[a[0]][a[1]]:h[a[0]]["default"]:(a[1]?h[a[0]][a[1]]=b:h[a[0]]["default"]=b,i):h},i.data=function(a){return arguments.length?(b=a,i):b},i.update=function(i){if(!a)return console.warn("controls was not given a selection");var j=3*g,k=g;if(e=0,d=0,b.length>0){var l=a.selectAll("g.ad-control").data(b,function(a){return a.label+","+a.type});l.enter().append("g").attr("class","ad-control").each(function(a){a.control=new AD.UTILS.CONTROLS[a.type],a.control.selection(d3.select(this)).on("elementClick",function(a,b){for(key in h.elementClick)h.elementClick[key].call(this,a,b)}).on("elementChange",function(a,b){for(key in h.elementChange)h.elementChange[key].call(this,a,b)}).on("elementMouseover",function(a,b){for(key in h.elementMouseover)h.elementMouseover[key].call(this,a,b)}).on("elementMouseout",function(a,b){for(key in h.elementMouseout)h.elementMouseout[key].call(this,a,b)})});var m=0;l.each(function(a){a.control.scale(g).data(a.data).update(),d+a.control.computedWidth()>c&&(d=0,e+=m+k,m=0),d3.select(this).style("opacity",1).attr("transform","translate("+d+","+e+")"),d+=a.control.computedWidth()+j,m<a.control.computedHeight()&&(m=a.control.computedHeight())}),d-=j,e+=m,l.exit().transition().duration(f).style("opacity",0).remove()}return l},i},AD.createNameSpace("AD.UTILS.SHAPES"),AD.UTILS.createGeneralTooltip=function(a,b,c){var d=d3.select("body"),e=d.append("div").attr("class","ad-general-tooltip").html(b+": "+c).style("opacity",0);e.transition().duration(50).style("opacity",1);var f=AD.UTILS.scrollOffset(),g=d.node().getBoundingClientRect().width,h={left:0,top:0};return h.left=f.left+d3.event.clientX<g/2?f.left+d3.event.clientX+10:f.left+d3.event.clientX-e.node().getBoundingClientRect().width-10,h.top=f.top+d3.event.clientY-10,AD.UTILS.moveTooltip(e,h.left,h.top,0),a.on("mousemove",function(){f=AD.UTILS.scrollOffset(),h.left=f.left+d3.event.clientX<g/2?f.left+d3.event.clientX+10:f.left+d3.event.clientX-e.node().getBoundingClientRect().width-10,h.top=f.top+d3.event.clientY-10,AD.UTILS.moveTooltip(e,h.left,h.top,50)}),e},AD.UTILS.removeTooltip=function(){d3.selectAll(".ad-general-tooltip").remove()},AD.UTILS.moveTooltip=function(a,b,c,d){a.transition().duration(d).ease("linear").style("opacity",1).style("top",c+"px").style("left",b+"px"),d3.timer.flush()},AD.UTILS.scrollOffset=function(){var a=document.documentElement,b=(window.pageXOffset||a.scrollLeft)-(a.clientLeft||0),c=(window.pageYOffset||a.scrollTop)-(a.clientTop||0);return{top:c,left:b}},AD.UTILS.getValues=function(a){var b=[];for(var c in a)a[c].key=c,b.push(a[c]);return b},AD.createNameSpace("AD.UTILS.AXISCHARTS"),AD.UTILS.AXISCHARTS.getDomainLinear=function(a){return[d3.min(a)<0?d3.min(a):0,d3.max(a)+1]},AD.UTILS.AXISCHARTS.getDomainOrdinal=function(a){return d3.set(a).values()},AD.UTILS.numberFormat=function(a){var b,c="";return a.siPrefixed?(a.precision>-1&&(c+="."+a.precision),c+="s"):(a.separateThousands&&(c+=","),a.precision>-1&&(c+="."+a.precision+"f")),b=d3.format(c),function(c){var d={before:a.units.before?a.units.before:"",after:a.units.after?a.units.after:""};return isNaN(c)?d.before+c+d.after:d.before+b(c)+d.after}},AD.createNameSpace("AD.UTILS.LEGENDS"),AD.UTILS.LEGENDS.horizontalLegend=function(){var a,b,c=AD.CONSTANTS.DEFAULTWIDTH(),d=[],e=AD.CONSTANTS.DEFAULTCOLOR(),f=0,g=0,h=AD.CONSTANTS.ANIMATIONLENGTHS().normal,i=5,j={elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){}},k={};return k.items=function(a){return arguments.length?(d=a,k):d},k.width=function(a){return arguments.length?(c=a,k):c},k.computedHeight=function(){return g},k.computedWidth=function(){return f},k.color=function(a){return arguments.length?(e=a,k):e},k.selection=function(b){return arguments.length?(a=b,k):a},k.select=function(b){return arguments.length?(a=d3.select(b),k):a},k.animationDuration=function(a){return arguments.length?(h=a,k):h},k.scale=function(a){return arguments.length?(i=a,k):i},k.on=function(a,b){return a=a.split("."),arguments.length?1==arguments.length?a[1]?j[a[0]][a[1]]:j[a[0]]["default"]:(a[1]?j[a[0]][a[1]]=b:j[a[0]]["default"]=b,k):j},k.data=function(a){return arguments.length?(b=a.data,k):b},k.update=function(d){if(!a)return console.warn("legend was not given a selection");if(g=0,f=0,b.items.length>0){var l=a.selectAll("g.ad-legend-item").data(b.items,function(a){return a.label}),m=l.enter().append("g").attr("class","ad-legend-item").style("opacity",0).on("mouseover",function(a,b){for(key in j.elementMouseover)j.elementMouseover[key].call(this,a,b)}).on("mouseout",function(a,b){for(key in j.elementMouseout)j.elementMouseout[key].call(this,a,b)}).on("click",function(a,b){for(key in j.elementClick)j.elementClick[key].call(this,a,b)});m.append("circle").attr("fill",function(a){return a.color||e(a.label)}),m.append("text").text(function(a){return a.label});var n=(l.select("circle").attr("r",i).attr("y",i/2),l.select("text").style("font-size",2.5*i+"px").attr("x",2*i).attr("y",i)),o=0;n.each(function(){var a=this.getComputedTextLength();a>o&&(o=a)}),o+=6*i;var p=Math.floor(c/o),q=0,r=0;l.transition().duration(h).style("opacity",1).attr("transform",function(a,b){b%p==0&&(q=0,r+=4*i);var c="translate("+q+","+r+")";return q+=o,c}),l.exit().transition().duration(h).style("opacity",0).remove(),g=r,f=l[0].length>=p?o*p:o*l[0].length}return d&&d(),k},k},AD.UTILS.breadcrumbs=function(){var a,b=AD.CONSTANTS.DEFAULTWIDTH(),c=(AD.CONSTANTS.DEFAULTCOLOR(),{items:[]}),d=0,e=0,f=AD.CONSTANTS.ANIMATIONLENGTHS().normal,g=5,h={elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){}},j={};return j.width=function(a){return arguments.length?(b=a,j):b},j.computedHeight=function(){return e},j.computedWidth=function(){return d},j.selection=function(b){return arguments.length?(a=b,j):a},j.scale=function(a){return arguments.length?(g=a,j):g},j.animationDuration=function(a){return arguments.length?(f=a,j):f},j.on=function(a,b){return a=a.split("."),arguments.length?1==arguments.length?a[1]?h[a[0]][a[1]]:h[a[0]]["default"]:(a[1]?h[a[0]][a[1]]=b:h[a[0]]["default"]=b,j):h},j.data=function(a){return arguments.length?(c=a.data,j):c},j.update=function(b){if(!a)return console.warn("breadcrumbs was not given a selection");a.breadcrumb=a.selectAll("g.ad-breadcrumb").data(c.items,function(a){return a.key?a.key:i});var d=a.breadcrumb.enter().append("g").attr("class","ad-breadcrumb").style("opacity",0);d.append("path"),d.append("text");var h=g,k=g,l=4*g;a.breadcrumb.text=a.breadcrumb.select("text").text(function(a){return a.label}).attr("x",k+h).attr("y",2.9*g).style("font-size",2.5*g+"px"),a.breadcrumb.path=a.breadcrumb.select("path");var m=0;return a.breadcrumb.each(function(b,c){var d=d3.select(this);d.text=d.select("text"),d.path=d.select("path");var e=d.text.node().getComputedTextLength()+2*k+h,g=h,i=h;0==c&&(g=0),c==a.breadcrumb.size()-1&&(i=0),d.path.transition().duration(f/2).attr("d","M 0 0 L "+g+" "+l/2+" L 0 "+l+" L "+e+" "+l+" L "+(e+i)+" "+l/2+" L "+e+" 0 L 0 0 Z"),d.transition().duration(f/2).style("opacity",1).attr("transform","translate("+m+",0)"),m+=h+e}),e=l,a.breadcrumb.exit().transition().duration(f/4).style("opacity",0).remove(),j},j},AD.CHARTS.sunburstChart=function(){var a=AD.CONSTANTS.DEFAULTWIDTH(),c=AD.CONSTANTS.DEFAULTHEIGHT(),d=c,e=a,f=!0,g=d3.select("body"),h=AD.CONSTANTS.ANIMATIONLENGTHS().normal,j=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),k=new AD.UTILS.LEGENDS.horizontalLegend,l=new AD.UTILS.breadcrumbs;l.scale(6);var m,n,o=AD.CONSTANTS.DEFAULTCOLOR(),p={},q=function(a){return a},r=d3.layout.partition().value(function(a){return a.size}),s=d3.svg.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,a.start))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,a.end))}).innerRadius(function(a){return Math.max(0,a.inner)}).outerRadius(function(a){return Math.max(0,a.outer)}),t={children:d3.scale.pow().exponent(.8),parents:d3.scale.linear()},u={},v=d3.scale.linear().range([0,2*Math.PI]),w={elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){}},x=function(a){for(var b=[],c=a;c.parent;)b.unshift(c),c=c.parent;return b.unshift(c),b},y=function(a){var b=x(a).reverse();for(i=0;i<b.length;i++)if(b[i].top)return d3.rgb(o(b[i].name)).brighter(.5*i);return o(a.name)},z=function(a){var b=x(a);g.group.sunburst.arcs.arc.filter(function(a){return b.indexOf(a)>=0}).transition().duration(h/7).style("opacity",1),g.group.sunburst.arcs.arc.filter(function(a){return b.indexOf(a)<0}).transition().duration(h/7).style("opacity",.4),H(b)},A=function(){G(),g.group.sunburst.arcs.arc.transition().duration(h/5).style("opacity",1)},B=function(a){n=a,E()},C=function(a){var b=a,c=[1,0];do c[0]>b.y&&(c[0]=b.y),c[1]<b.y+b.dy&&(c[1]=b.y+b.dy),b=b.parent;while(b);return c},D=function(a,b){return b?(b[0]>a.y&&(b[0]=a.y),b[1]<a.y+a.dy&&(b[1]=a.y+a.dy)):b=[1,0],a.children&&a.children.forEach(function(a){return D(a,b)}),b},E=function(){var a=x(n),b={};b.parents=g.group.sunburst.arcs.arc.path.filter(function(b){return a.indexOf(b)>=0}),v.domain([n.x,n.x+n.dx]),t.parents.domain(C(n)),t.children.domain(D(n));b.parents.each(function(a){this.newArc={start:v(a.x),end:v(a.x+a.dx),inner:t.parents(a.y),outer:t.parents(a.y+a.dy)},this.oldArc||(this.oldArc={start:0,end:0,inner:this.newArc.inner,outer:this.newArc.outer})}),b.children=g.group.sunburst.arcs.arc.path.filter(function(b){return a.indexOf(b)<0}),b.children.each(function(a){this.newArc={start:v(a.x),end:v(a.x+a.dx),inner:t.children(a.y),outer:t.children(a.y+a.dy)},this.oldArc||(this.oldArc={start:0,end:0,inner:this.newArc.inner,outer:this.newArc.outer})}),g.group.sunburst.arcs.arc.exit().select("path").each(function(){this.newArc={start:0,end:0,inner:this.oldArc.inner,outer:this.oldArc.outer}}).transition().duration(1.5*h).attrTween("d",F).each("end",function(){this.parentNode.remove()}).remove();var c=g.group.sunburst.arcs.arc.path.transition().duration(1.5*h).attrTween("d",F);c.each("end",function(){this.oldArc=this.newArc})},F=function(){function a(a){return b=c(a),s(b)}var c=d3.interpolate(this.oldArc,this.newArc);return a},G=function(){var a={data:{items:[]}};l.data(a).update()},H=function(a){var b={data:{items:a.map(function(a,b){return{label:a.name,key:b+","+a.name,data:a}})}};l.data(b).update(),breadcrumbsSelection=l.selection(),breadcrumbsSelection.breadcrumb.path.attr("stroke-width",2).attr("stroke",function(a){return y(a.data)})},I={};return I.select=function(a){return g=d3.select(a),f=!0,I},I.selection=function(a){return arguments.length?(g=a,f=!0,I):g},I.width=function(b){return arguments.length?(a=b,I):a},I.height=function(a){return arguments.length?(c=a,I):c},I.animationDuration=function(a){return arguments.length?(h=a,k.animationDuration(h),I):h},I.xFormat=function(a){return arguments.length?(q=AD.UTILS.numberFormat(a),I):q},I.on=function(a,b){return a=a.split("."),arguments.length?1==arguments.length?a[1]?w[a[0]][a[1]]:w[a[0]]["default"]:(a[1]?w[a[0]][a[1]]=b:w[a[0]]["default"]=b,I):w},I.data=function(a,b){return arguments.length?(b&&(p={},f=!0),p=a.data,m=r.nodes(p.partition),n=p.partition,I):p},I.generate=function(a){f=!1,g.selectAll("*").remove(),g.svg=g.append("svg").attr("class","ad-sunburst-chart ad-svg ad-container"),g.group=g.svg.append("g"),g.group.sunburst=g.group.append("g").attr("class","ad-sunburst").on("mouseout",A),g.group.sunburst.arcs=g.group.sunburst.append("g").attr("class","ad-sunburst-arcs"),g.group.sunburst.tooltip=g.group.sunburst.append("g").attr("class","ad-sunburst-tooltip"),g.group.legend=g.group.append("g").attr("class","ad-legend"),g.group.breadcrumbs=g.group.append("g").attr("class","ad-sunburst-breadcrumbs"),k.color(o).selection(g.group.legend),l.selection(g.group.breadcrumbs);var b=h;return I.animationDuration(0).update(a).animationDuration(b),I},I.update=function(b){if(f)return I.generate(b);j=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),g.svg.transition().duration(h).attr("width",a).attr("height",c),e=a-j.right-j.left;var i=m.filter(function(a){return a.top}),n={data:{items:d3.set(i.map(function(a){return a.name})).values().map(function(a){return{label:a}})}};k.width(e).data(n).update(),j.bottom+=k.computedHeight(),g.group.breadcrumbs.transition().duration(h).attr("transform","translate("+j.left+","+j.top+")"),l.width(e).update(),j.top+=l.computedHeight(),d=c-j.top-j.bottom,g.group.legend.transition().duration(h).attr("transform","translate("+(j.left+(e-k.computedWidth())/2)+","+(d+j.top)+")"),g.group.sunburst.transition().duration(h).attr("transform","translate("+(j.left+e/2)+","+(j.top+d/2)+")"),u.outer=Math.min(e,d)/2-20,u.inner=u.outer/3,t.children.range([u.inner+.17*(u.outer-u.inner),u.outer]),t.parents.range([u.inner,u.inner+.13*(u.outer-u.inner)]),g.group.sunburst.arcs.arc=g.group.sunburst.arcs.selectAll("g.sunburst-arc").data(m,function(a){return x(a).map(function(a){return a.name}).join("-")});{var o=g.group.sunburst.arcs.arc.enter().append("g").attr("class","sunburst-arc");o.append("path").on("mouseover",z)}return g.group.sunburst.arcs.arc.transition().duration(h).style("opacity",1),g.group.sunburst.arcs.arc.path=g.group.sunburst.arcs.arc.select("path").style("fill",y),g.group.sunburst.arcs.arc.path.on("click",B).classed("ad-pointer-element",!0),E(),d3.timer.flush(),b&&b(),I},I},AD.CHARTS.axisChart=function(){var a,b,c,d=AD.CONSTANTS.DEFAULTWIDTH(),e=AD.CONSTANTS.DEFAULTHEIGHT(),f=AD.CONSTANTS.DEFAULTMARGIN(),g=e,h=d,i={type:"linear",scale:d3.scale.linear(),domain:"auto"},j={type:"linear",scale:d3.scale.linear(),domain:"auto"},k=!0,l=d3.select("body"),m=AD.CONSTANTS.ANIMATIONLENGTHS().normal,n=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),o=function(a){return a},p=function(a){return a},q={elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){}},r={yAxisLock:{label:"Lock Y-Axis",type:"checkbox",visible:!1,enabled:!1,maxStacked:AD.CONSTANTS.DEFAULTHEIGHT(),maxNonStacked:AD.CONSTANTS.DEFAULTHEIGHT()},stacking:{label:"Stack Bars",type:"checkbox",visible:!1,enabled:!1}},s=AD.CONSTANTS.DEFAULTCOLOR(),t={columns:{},labels:{x:"",y:""}},u=function(a){var b=a.svg;b.transition().duration(m).style("opacity",0).each("end",function(){b.remove()}),a.svg=l.group.columns[a.newType.split(",")[0]+"_columns"].append("g"),x[a.newType](a,"true")},v=function(a){var b=a.svg;b.transition().duration(m).style("opacity",0).each("end",function(){b.remove()})},w=["area","bar","line","scatter"],x={};x.area=function(a){var b=a.svg.selectAll("path").data([a]);b.enter().append("path").style("opacity",0).datum(a.modifiedData.values).attr("d",a.area).style("stroke",s(a.data.label)).style("fill",s(a.data.label)),b.datum(a.modifiedData.values).transition().duration(m).attr("d",a.area).style("opacity",1)},x.bar=function(a){var b=a.svg.selectAll("rect").data(a.data.values,function(a){return a.x});b.enter().append("rect").attr("class","ad-bar-rect").style("opacity",0).attr("height",0).attr("y",g),b.style("fill",s(a.data.label)).style("stroke-width","0.6px").style("opacity",1),b.transition().duration(m).attr("x",function(a){return a.xPos}).attr("y",function(a){return a.yPos}).attr("width",function(a){return a.width}).attr("height",function(a){return a.height}).style("stroke",s(a.data.label)),b.exit().transition().duration(m).style("opacity",0).attr("height",0).attr("y",g).remove()},x.line=function(a){var b=d3.svg.line().x(function(a){return i.scale(a.x)+A()}).y(function(a){return j.scale(a.y)}),c=a.data.type.split(",")[1];c&&b.interpolate(c);var d=a.svg.selectAll("path").data([a]);d.enter().append("path").attr("class","ad-line").style("opacity",0).datum(a.data.values).attr("d",b).style("stroke",s(a.data.label)),d.datum(a.data.values).transition().duration(m).attr("d",b).style("opacity",1)},x.scatter=function(a){{var b=a.svg.selectAll("g.ad-scatter-point").data(a.data.values,function(a){return a.x}),c=b.enter().append("g").attr("class","ad-scatter-point").attr("transform",function(a){return"translate("+(i.scale(a.x)+A())+","+j.scale(a.y)+")"});c.append("circle").attr("class","ad-scatter-point").attr("r",5).style("fill",s(a.data.label)).on("mouseover",function(){d3.select(this).transition().duration(250).attr("r",7)}).on("mouseout",function(){d3.select(this).transition().duration(250).attr("r",5)})}b.transition().duration(m).attr("transform",function(a){return"translate("+(i.scale(a.x)+A())+","+j.scale(a.y)+")"}),b.exit().transition().duration(m).style("opacity",0).remove()};var y={},z={};y.bar=function(){},y.scatter=function(a){a.data.svg.selectAll("circle").transition().duration(m/2).attr("r",7)},y.area=function(){},y.line=function(){},z.bar=function(){},z.scatter=function(a){a.data.svg.selectAll("circle").transition().duration(m/2).attr("r",5)},z.area=function(){},z.line=function(){};var A=function(){return"ordinal"==i.type?i.scale.rangeBand()/2:0},B=function(a){var b,c,d=h/(7*a.length),e={};r.stacking.enabled?("ordinal"==i.type?(b=i.scale.rangeBand(),c=.6*b):(b=2.5*-d,c=d),a.forEach(function(a){a.data.values.forEach(function(a){a.height=g-j.scale(a.y),e[a.x]=e[a.x]||g,e[a.x]-=a.height,a.xPos=i.scale(a.x)+.2*b,a.yPos=e[a.x],a.width=c})})):(b="ordinal"==i.type?d3.scale.ordinal().domain(a.map(function(a){return a.data.label})).rangeRoundBands([0,i.scale.rangeBand()],.05,.3):d3.scale.ordinal().domain(a.map(function(a){return a.data.label})).rangeRoundBands([-d/2,d/2],.05,.3),c=b.rangeBand(),a.forEach(function(a){a.data.values.forEach(function(d){d.xPos=i.scale(d.x)+b(a.data.label),d.height=g-j.scale(d.y),d.yPos=g-d.height,d.width=c})}))},C=function(a){a.forEach(function(a){a.area=d3.svg.area().x(function(a){return i.scale(a.x)+A()}).y0(g).y1(function(a){return j.scale(a.y)}),interpolationType=a.data.type.split(",")[1],interpolationType&&a.area.interpolate(interpolationType),a.modifiedData=a.data})},D={};return D.select=function(a){return l=d3.select(a),k=!0,D},D.selection=function(a){return arguments.length?(l=a,k=!0,D):l},D.xScale=function(a){return arguments.length?(i.type=a.type,i.domain=a.domain,k=!0,"linear"==a.type?i.scale=d3.scale.linear():"ordinal"==a.type&&(i.scale=d3.scale.ordinal()),a.domain?i.scale.domain(a.domain):i.domain="auto",D):i},D.yScale=function(a){return arguments.length?(j.type=a.type,j.domain=a.domain,k=!0,"linear"==a.type?j.scale=d3.scale.linear():"ordinal"==a.type&&(j.scale=d3.scale.ordinal()),a.domain?j.scale.domain(a.domain):j.domain="auto",D):j},D.width=function(a){return arguments.length?(d=a,D):d},D.height=function(a){return arguments.length?(e=a,D):e},D.margin=function(a){return arguments.length?(a.left&&(f.left=a.left),a.right&&(f.right=a.right),a.top&&(f.top=a.top),a.bottom&&(f.bottom=a.bottom),D):f},D.controls=function(a){return arguments.length?(a.yAxisLock&&(r.yAxisLock.visible=null!=a.yAxisLock.visible?a.yAxisLock.visible:r.yAxisLock.visible,r.yAxisLock.enabled=null!=a.yAxisLock.enabled?a.yAxisLock.enabled:r.yAxisLock.enabled,r.yAxisLock.maxStacked=null!=a.yAxisLock.maxStacked?a.yAxisLock.maxStacked:r.yAxisLock.maxStacked,r.yAxisLock.maxNonStacked=null!=a.yAxisLock.maxNonStacked?a.yAxisLock.maxNonStacked:r.yAxisLock.maxNonStacked),a.stacking&&(r.stacking.visible=null!=a.stacking.visible?a.stacking.visible:r.stacking.visible,r.stacking.enabled=null!=a.stacking.enabled?a.stacking.enabled:r.stacking.enabled),D):r},D.animationDuration=function(a){return arguments.length?(m=a,b.animationDuration(m),c.animationDuration(m),D):m},D.xFormat=function(a){return arguments.length?(o=AD.UTILS.numberFormat(a),D):o},D.yFormat=function(a){return arguments.length?(p=AD.UTILS.numberFormat(a),D):p},D.on=function(a,b){return a=a.split("."),arguments.length?1==arguments.length?a[1]?q[a[0]][a[1]]:q[a[0]]["default"]:(a[1]?q[a[0]][a[1]]=b:q[a[0]]["default"]=b,D):q},D.data=function(a,b){return arguments.length?(b&&(t={columns:{},labels:{x:"",y:""}},k=!0),a.data.columns.forEach(function(a){var b;t.columns[a.label]?(b=t.columns[a.label],b.data.values=a.values||b.data.values,b.data.type=a.type||b.data.type,b.replace=a.replace||!1,b.newType=a.type?a.type.split(",")[0]:b.oldType):(b=t.columns[a.label]={data:a,newType:a.type.split(",")[0],oldType:null},k||(b.svg=l.group.columns[a.type.split(",")[0]+"_columns"].append("g")))}),a.data.labels&&(t.labels=a.data.labels),D):t},D.generate=function(a){k=!1,l.selectAll("*").remove(),l.svg=l.append("svg").attr("class","ad-axis-chart ad-svg ad-container"),l.group=l.svg.append("g"),l.group.axes=l.group.append("g").attr("class","ad-axes"),l.group.axes.x=l.group.axes.append("g").attr("class","ad-x ad-axis"),l.group.axes.y=l.group.axes.append("g").attr("class","ad-y ad-axis"),l.group.axes.xLabel=l.group.axes.append("g").attr("class","ad-x-label").append("text"),l.group.axes.yLabel=l.group.axes.append("g").attr("class","ad-y-label").append("text"),l.group.columns=l.group.append("g").attr("class","ad-columns"),w.forEach(function(a){l.group.columns[a+"_columns"]=l.group.columns.append("g").attr("class","ad-"+a+"-columns")});for(key in t.columns)t.columns[key].svg=l.group.columns[t.columns[key].newType+"_columns"].append("g");l.controls=l.group.append("g").attr("class","ad-controls"),c=new AD.UTILS.CONTROLS.horizontalControls,c.selection(l.controls).on("elementChange",function(a){r[a.key].enabled=a.state,D.update()}),l.legend=l.group.append("g").attr("class","ad-legend"),b=new AD.UTILS.LEGENDS.horizontalLegend,b.color(s).selection(l.legend).on("elementMouseover",function(a){y[a.data.newType]&&(y[a.data.newType](a),a.data.svg.classed("ad-legend-mouseover",!0))}).on("elementMouseout",function(a){y[a.data.newType]&&(z[a.data.newType](a),a.data.svg.classed("ad-legend-mouseover",!1))});var d=m;return D.animationDuration(0),D.update(a),D.animationDuration(d),D},D.update=function(q){if(k)return D.generate(q);n=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),n.bottom+=20,n.left+=20;var s=AD.UTILS.getValues(t.columns),w=s.filter(function(a){return"bar"==a.newType}),y=s.filter(function(a){return"area"==a.newType});h=d-f.left-f.right-n.right-n.left;var z={data:{items:s.filter(function(a){return"none"!=a.newType}).map(function(a){return{label:a.data.label,type:a.newType,data:a}}).sort(function(a,b){return a.label-b.label})}};b.width(h).data(z).update(),n.bottom+=b.computedHeight();var A=AD.UTILS.getValues(r).filter(function(a){return a.visible});A.map(function(a){a.data={state:a.enabled,label:a.label,key:a.key}}),c.width(h).data(A).update(),n.top+=c.computedHeight(),g=e-f.top-f.bottom-n.top-n.bottom;var E=[],F=[];s.forEach(function(a){a.data.values&&a.newType&&a.data.values.forEach(function(a){E.push(a.x),F.push(a.y)
})});var G={};r.stacking.enabled&&(w.forEach(function(a){a.data.values.forEach(function(a){G[a.x]||(G[a.x]=0),G[a.x]+=a.y})}),F=F.concat(AD.UTILS.getValues(G))),"linear"==i.type?(i.scale.range([0,h]),"auto"==i.domain&&(vals=[],i.scale.domain(AD.UTILS.AXISCHARTS.getDomainLinear(E)))):"ordinal"==i.type&&(i.scale.rangeRoundBands([0,h],.1),"auto"==i.domain&&i.scale.domain(AD.UTILS.AXISCHARTS.getDomainOrdinal(E)));var H=[0,0];H=r.yAxisLock.enabled?r.stacking.enabled?[0,r.yAxisLock.maxStacked]:[0,r.yAxisLock.maxNonStacked]:AD.UTILS.AXISCHARTS.getDomainLinear(F),j.scale.range([g,0]),"auto"==j.domain&&j.scale.domain(H),l.svg.attr("width",d).attr("height",e),j.scale.nice(5);var I=d3.svg.axis().scale(i.scale).orient("bottom").tickFormat(o),J=d3.svg.axis().scale(j.scale).orient("left").tickFormat(p);l.group.axes.y.transition().duration(m).call(J);var K=0;d3.select(".ad-y.ad-axis").selectAll(".tick text").each(function(){K<this.getComputedTextLength()&&(K=this.getComputedTextLength())}),n.left+=K,h=d-f.left-f.right-n.right-n.left,"linear"==i.type?i.scale.range([0,h]):"ordinal"==i.type&&i.scale.rangeRoundBands([0,h],.1),I.tickSize(-g),J.tickSize(-h),l.group.transition().duration(m),l.group.axes.x.transition().duration(m).attr("transform","translate("+(f.left+n.left)+","+(f.top+n.top+g)+")").call(I),l.group.axes.y.transition().duration(m).attr("transform","translate("+(f.left+n.left)+","+(f.top+n.top)+")").call(J),a="ordinal"==i.type?d3.scale.ordinal().domain(w.map(function(a){return a.data.label})).rangeRoundBands([0,i.scale.rangeBand()]):h/(20*w.length),l.group.axes.xLabel.transition().duration(m).text(t.labels.x).attr("transform","translate("+(f.left+n.left+h/2)+","+(g+30+(f.top+n.top))+")"),l.group.axes.yLabel.transition().duration(m).attr("transform","translate("+(f.left+n.left-K-10)+","+(g/2+(f.top+n.top))+"),rotate(-90)").text(t.labels.y),l.legend.transition().duration(m).attr("transform","translate("+(f.left+n.left+(h-b.computedWidth())/2)+","+(g+25+(f.top+n.top))+")"),l.controls.transition().duration(m).attr("transform","translate("+(f.left+n.left+h-c.computedWidth())+","+(-c.computedHeight()-10+(f.top+n.top))+")"),l.group.columns.transition().duration(m).attr("transform","translate("+(f.left+n.left)+","+(f.top+n.top)+")"),B(w),C(y),s.forEach(function(a){a.replace?u(a):"none"==a.newType?v(a):a.oldType?a.newType==a.oldType?x[a.newType](a,!1):u(a):x[a.newType](a,!0),a.oldType=a.newType});var L=y.map(function(a){return{column:a,maxY:d3.max(a.data.values.map(function(a){return a.y}))}});return L.sort(function(a,b){return b.maxY-a.maxY}),L.forEach(function(a){l.group.columns.area_columns.node().appendChild(a.column.svg.node())}),d3.timer.flush(),q&&q(),D},D},AD.CHARTS.sankeyChart=function(){var a,b=AD.CONSTANTS.DEFAULTWIDTH(),c=AD.CONSTANTS.DEFAULTHEIGHT(),d=c,e=b,f=!0,g=d3.select("body"),h=AD.CONSTANTS.ANIMATIONLENGTHS().normal,i=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),j=new AD.UTILS.LEGENDS.horizontalLegend,k=AD.CONSTANTS.DEFAULTCOLOR(),l={nodes:[],links:[]},m=30,n=15,o=20,p=1,q={elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){}},r=function(a){return a},s={};return s.select=function(a){return g=d3.select(a),f=!0,s},s.selection=function(a){return arguments.length?(g=a,f=!0,s):g},s.width=function(a){return arguments.length?(b=a,s):b},s.height=function(a){return arguments.length?(c=a,s):c},s.animationDuration=function(a){return arguments.length?(h=a,j.animationDuration(h),s):h},s.xFormat=function(a){return arguments.length?(r=AD.UTILS.numberFormat(a),s):r},s.nodePadding=function(a){return arguments.length?(m=a,s):m},s.layout=function(a){return arguments.length?(o=a,s):o},s.minLinkWidth=function(a){return arguments.length?(p=a,s):p},s.on=function(a,b){return a=a.split("."),arguments.length?1==arguments.length?a[1]?q[a[0]][a[1]]:q[a[0]]["default"]:(a[1]?q[a[0]][a[1]]=b:q[a[0]]["default"]=b,s):q},s.data=function(a,b){return arguments.length?(b&&(l={nodes:[],links:[]},f=!0),a.data.nodes&&(l.nodes=a.data.nodes),a.data.links&&(l.links=a.data.links),a.data.labels&&(l.labels=a.data.labels),a.data.columnHeaders&&(l.columnHeaders=a.data.columnHeaders),s):l},s.generate=function(a){f=!1,g.selectAll("*").remove(),g.svg=g.append("svg").attr("class","ad-sankey-chart ad-svg ad-container"),g.group=g.svg.append("g"),g.group.sankey=g.group.append("g").attr("class","ad-sankey"),g.group.sankey.links=g.group.sankey.append("g").attr("class","ad-sankey-links"),g.group.sankey.nodes=g.group.sankey.append("g").attr("class","ad-sankey-nodes"),g.group.labels=g.group.append("g").attr("class","ad-sankey-labels"),g.group.labels.source=g.group.labels.append("g").attr("class","ad-sankey-label-source"),g.group.labels.source.text=g.group.labels.source.append("text").attr("y",23),g.group.labels.destination=g.group.labels.append("g").attr("class","ad-sankey-label-destination"),g.group.labels.destination.text=g.group.labels.destination.append("text").attr("y",23),g.group.columnHeaders=g.group.append("g").attr("class","ad-sankey-column-headers"),g.legend=g.group.append("g").attr("class","ad-legend"),j.color(k).selection(g.legend);var b=h;return s.animationDuration(0).update(a).animationDuration(b),s},s.update=function(q){if(f)return s.generate(q);i=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),e=b-i.right-i.left;var t={data:{items:d3.set(l.nodes.map(function(a){return a.colorKey?a.colorKey:a.name})).values().map(function(a){return{label:a}})}};j.width(e).data(t).update(),i.bottom+=j.computedHeight();var u={source:g.group.labels.source.transition().duration(h),destination:g.group.labels.destination.transition().duration(h)};l.labels?(g.group.labels.attr("transform","translate("+i.left+","+i.top+")"),l.labels.source?(u.source.style("opacity",1),g.group.labels.source.text.text(l.labels.source)):u.source.style("opacity",0),l.labels.destination?(u.destination.style("opacity",1),g.group.labels.destination.text.text(l.labels.destination)):u.destination.style("opacity",0),u.source.attr("transform","translate(0,0)"),u.destination.attr("transform","translate("+e+",0)"),i.top+=35):(u.source.style("opacity",0),u.destination.style("opacity",0));var v,w;l.columnHeaders&&l.columnHeaders.length>0&&(w=d3.scale.linear().domain([0,l.columnHeaders.length-1]).range([0,e-n]),g.group.columnHeaders.attr("transform","translate("+i.left+","+i.top+")"),v=g.group.columnHeaders.selectAll("g.ad-sankey-column-header").data(l.columnHeaders),v.enter().append("g").attr("class","ad-sankey-column-header").append("text").attr("y",16).attr("x",function(a,b){return 0==b?-n/2:b==l.columnHeaders.length-1?n/2:void 0}),v.select("text").text(function(a){return a}),v.transition().duration(h).attr("transform",function(a,b){return"translate("+(w(b)+n/2)+",0)"}),i.top+=25),d=c-i.top-i.bottom,g.legend.transition().duration(h).attr("transform","translate("+(i.left+(e-j.computedWidth())/2)+","+(d+i.top)+")"),a=d3.sankey().size([e,d]).nodeWidth(n).nodePadding(m).nodes(l.nodes).links(l.links).layout(o);var x=g.group.sankey.nodes.selectAll("g.ad-sankey-node").data(l.nodes,function(a,b){return a.key?a.key:b}),y=x.enter().append("g").attr("class","ad-sankey-node").on("mouseover",function(a){AD.UTILS.createGeneralTooltip(d3.select(this),"<b>"+a.name+"</b>",r(a.value))}).on("mouseout",function(){AD.UTILS.removeTooltip()});y.append("rect"),y.append("text");var z=x.select("text").text(function(a){return a.shortName});x.transition().duration(h).attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),x.select("rect").transition().duration(h).attr("width",a.nodeWidth()).attr("height",function(a){return a.dy}),z.transition().duration(h).style("text-anchor",function(a){return a.x<e/2?"start":"end"}).attr("x",function(b){return b.x<e/2?a.nodeWidth()+5:-5}).attr("y",function(a){return a.dy/2+5});var A=g.group.sankey.links.selectAll("g.ad-sankey-link").data(l.links,function(a,b){return a.key?a.key:b}),B=A.enter().append("g").attr("class","ad-sankey-link").on("mouseover",function(a){AD.UTILS.createGeneralTooltip(d3.select(this),"<b>"+a.source.name+' <i class="fa fa-arrow-right"></i> '+a.target.name+"</b>",r(a.value))}).on("mouseout",function(){AD.UTILS.removeTooltip()});return B.append("path"),B.append("text"),A.exit().transition().duration(h).style("opacity",0).remove(),x.exit().transition().duration(h).style("opacity",0).remove(),A.select("path").transition().duration(h).attr("d",a.link()).style("stroke-width",function(a){return Math.max(a.dy,p)}).style("stroke",function(a){return k(a[a.colorBy].colorKey?a[a.colorBy].colorKey:a[a.colorBy].name)}),g.svg.attr("width",b).attr("height",c),g.group.sankey.attr("transform","translate("+i.left+","+i.top+")"),d3.timer.flush(),q&&q(),s},s},AD.CHARTS.pieChart=function(){var a=AD.CONSTANTS.DEFAULTWIDTH(),b=AD.CONSTANTS.DEFAULTHEIGHT(),c=b,d=a,e=!0,f=!0,g=d3.select("body"),h=AD.CONSTANTS.ANIMATIONLENGTHS().normal,i=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),j=new AD.UTILS.LEGENDS.horizontalLegend,k=AD.CONSTANTS.DEFAULTCOLOR(),l={},m=function(a){return a},n={elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){}},o=0,p=Math.min(c,d)/2,q=d3.svg.arc().outerRadius(p).innerRadius(p*o),r=d3.layout.pie().value(function(a){return a.value}).sort(null),s=1,t=[],u={};return u.select=function(a){return g=d3.select(a),e=!0,u},u.selection=function(a){return arguments.length?(g=a,e=!0,u):g},u.width=function(b){return arguments.length?(a=b,u):a},u.height=function(a){return arguments.length?(b=a,u):b},u.animationDuration=function(a){return arguments.length?(h=a,j.animationDuration(h),u):h},u.xFormat=function(a){return arguments.length?(m=AD.UTILS.numberFormat(a),u):m},u.donutRatio=function(a){return arguments.length?(o=a,u):o},u.on=function(a,b){return a=a.split("."),arguments.length?1==arguments.length?a[1]?n[a[0]][a[1]]:n[a[0]]["default"]:(a[1]?n[a[0]][a[1]]=b:n[a[0]]["default"]=b,u):n},u.data=function(a,b){return arguments.length?(b&&(l={},e=!0),a.data.values&&(a.data.values.forEach(function(a,b){a.key||(a.key=Date.now()+b)}),l.values=a.data.values,s=d3.sum(l.values.map(function(a){return a.value})),t={data:{items:l.values}},f=!0),u):l},u.generate=function(a){e=!1,g.selectAll("*").remove(),g.svg=g.append("svg").attr("class","ad-pie-chart ad-svg ad-container"),g.group=g.svg.append("g"),g.group.pie=g.group.append("g").attr("class","ad-pie"),g.legend=g.group.append("g").attr("class","ad-legend"),j.color(k).selection(g.legend);var b=h;return u.animationDuration(0).update(a).animationDuration(b),u},u.update=function(n){if(e)return u.generate(n);i=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),d=a-i.right-i.left,j.width(d).data(t).update(),i.bottom+=j.computedHeight(),c=b-i.top-i.bottom,p=Math.min(c,d)/2,q.outerRadius(p).innerRadius(p*o),g.group.pie.transition().duration(h).attr("transform","translate("+d/2+","+c/2+")");var v=g.group.pie.datum(l.values).selectAll("g.ad-arc").data(r,function(a){return a.data.key}),w=v.enter().append("g").attr("class","ad-arc").style("opacity",0);v.transition().duration(h).style("opacity",1),w.append("path").each(function(a){this._current={},this._current.startAngle=0,this._current.endAngle=0,a.path=d3.select(this)}),w.append("text"),v.select("text").transition().duration(h).text(function(a){return d3.format("%")(a.data.value/s)}).attr("transform",function(a){var b=q.centroid(a);return"translate("+b[0]+","+b[1]+")"});var x=v.select("path");x.each(function(a){a.test="test"}).style("fill",function(a){return k(a.data.colorKey?a.data.colorKey:a.data.label)}).on("mouseover",null).on("mouseout",null);var y=x.transition().duration(h);return f?(f=!f,y.call(arcTween,q)):y.attr("d",q),y.each("end",function(){var a=d3.select(this);a.on("mouseover",function(b){a.transition().duration(AD.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("transform","scale(1.01)").style("fill-opacity",.9),AD.UTILS.createGeneralTooltip(a,"<b>"+b.data.label+"</b>",m(b.data.value))}).on("mouseout",function(){a.transition().duration(AD.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("transform","scale(1)").style("fill-opacity",""),AD.UTILS.removeTooltip()})}),v.exit().transition().duration(h).style("opacity",0).remove(),g.legend.transition().duration(h).attr("transform","translate("+(d-j.computedWidth())/2+","+c+")"),g.svg.attr("width",a).attr("height",b),g.group.attr("transform","translate("+i.left+","+i.top+")"),d3.timer.flush(),n&&n(),u},u},AD.CHARTS.interactiveBarChart=function(){var a,b,c,d=AD.CONSTANTS.DEFAULTWIDTH(),e=AD.CONSTANTS.DEFAULTHEIGHT(),f=e,g=d,h={horizontal:g,vertical:f},i={type:"linear",scale:d3.scale.linear(),domain:"auto"},j={type:"linear",scale:d3.scale.linear(),domain:"auto"},k={horizontal:i,vertical:j},l=!0,m=d3.select("body"),n=AD.CONSTANTS.ANIMATIONLENGTHS().normal,o=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),p=function(a){return a},q=function(a){return a},r={elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){}},s={x:"x",y:"y",horizontal:"horizontal",vertical:"vertical",width:"width",height:"height",bottom:"bottom",left:"left"},t={yAxisLock:{label:"Lock Y-Axis",type:"checkbox",visible:!1,enabled:!1,maxStacked:AD.CONSTANTS.DEFAULTHEIGHT(),maxNonStacked:AD.CONSTANTS.DEFAULTHEIGHT()},stacking:{label:"Stack Bars",type:"checkbox",visible:!1,enabled:!1},horizontal:{label:"Horizontal",type:"checkbox",visible:!1,enabled:!1}},u=AD.CONSTANTS.DEFAULTCOLOR(),v={columns:{},labels:{x:"",y:""}},w=function(a){var b=a.svg;b.transition().duration(n).style("opacity",0).each("end",function(){b.remove()})},x=function(a){var b=a.svg.selectAll("rect").data(a.data.values,function(a){return a.x});b.enter().append("rect").attr("class","ad-bar-rect").style("opacity",0).attr(s.height,0).attr(s.y,h[s.vertical]).on("mouseover",function(b){AD.UTILS.createGeneralTooltip(d3.select(this),"<b>"+a.key+" <i>("+p(b.x)+")</i></b> ",q(b.y))}).on("mouseout",function(){AD.UTILS.removeTooltip()}),b.style("fill",u(a.data.label)).style("opacity",1),b.transition().duration(n).attr(s.x,function(a){return a.xPos}).attr(s.y,function(a){return a.yPos}).attr(s.width,function(a){return a[s.width]}).attr(s.height,function(a){return a[s.height]}),b.exit().transition().duration(n).style("opacity",0).attr(s.height,0).attr(s.y,h.vertical).remove()},y=function(a){var b,c,d=g/(2*a.length),e={};t.stacking.enabled?("ordinal"==i.type?(b=k[s.horizontal].scale.rangeBand(),c=.6*b):(b=2.5*-d,c=d),a.forEach(function(a){a.data.values.forEach(function(a){t.horizontal.enabled?(a[s.height]=k[s.vertical].scale(a.y),e[a.x]=e[a.x]||0,a.xPos=k[s.horizontal].scale(a.x)+.2*b,a.yPos=e[a.x],e[a.x]+=a[s.height],a[s.width]=c):(a[s.height]=h[s.vertical]-k[s.vertical].scale(a.y),e[a.x]=e[a.x]||h[s.vertical],e[a.x]-=a[s.height],a.xPos=k[s.horizontal].scale(a.x)+.2*b,a.yPos=e[a.x],a[s.width]=c)})})):(b="ordinal"==i.type?d3.scale.ordinal().domain(a.map(function(a){return a.data.label})).rangeRoundBands([0,i.scale.rangeBand()],.05,0):d3.scale.ordinal().domain(a.map(function(a){return a.data.label})).rangeRoundBands([-d/2,d/2],.05,.3),c=b.rangeBand(),a.forEach(function(a){a.data.values.forEach(function(d){t.horizontal.enabled?(d.xPos=k[s.horizontal].scale(d.x)+b(a.data.label),d[s.height]=j.scale(d.y),d.yPos=0,d[s.width]=c):(d.xPos=k[s.horizontal].scale(d.x)+b(a.data.label),d[s.height]=h[s.vertical]-j.scale(d.y),d.yPos=h[s.vertical]-d[s.height],d[s.width]=c)})}))},z={};return z.select=function(a){return m=d3.select(a),l=!0,z},z.selection=function(a){return arguments.length?(m=a,l=!0,z):m},z.xScale=function(a){return arguments.length?(i.type=a.type,i.domain=a.domain,l=!0,"linear"==a.type?i.scale=d3.scale.linear():"ordinal"==a.type&&(i.scale=d3.scale.ordinal()),a.domain||(i.domain="auto"),z):i},z.yScale=function(a){return arguments.length?(j.type=a.type,j.domain=a.domain,l=!0,"linear"==a.type?j.scale=d3.scale.linear():"ordinal"==a.type&&(j.scale=d3.scale.ordinal()),a.domain||(j.domain="auto"),z):j},z.width=function(a){return arguments.length?(d=a,z):d},z.height=function(a){return arguments.length?(e=a,z):e},z.controls=function(a){return arguments.length?(a.yAxisLock&&(t.yAxisLock.visible=null!=a.yAxisLock.visible?a.yAxisLock.visible:t.yAxisLock.visible,t.yAxisLock.enabled=null!=a.yAxisLock.enabled?a.yAxisLock.enabled:t.yAxisLock.enabled,t.yAxisLock.maxStacked=null!=a.yAxisLock.maxStacked?a.yAxisLock.maxStacked:t.yAxisLock.maxStacked,t.yAxisLock.maxNonStacked=null!=a.yAxisLock.maxNonStacked?a.yAxisLock.maxNonStacked:t.yAxisLock.maxNonStacked),a.stacking&&(t.stacking.visible=null!=a.stacking.visible?a.stacking.visible:t.stacking.visible,t.stacking.enabled=null!=a.stacking.enabled?a.stacking.enabled:t.stacking.enabled),a.horizontal&&(t.horizontal.visible=null!=a.horizontal.visible?a.horizontal.visible:t.horizontal.visible,t.horizontal.enabled=null!=a.horizontal.enabled?a.horizontal.enabled:t.horizontal.enabled),z):t},z.animationDuration=function(a){return arguments.length?(n=a,b.animationDuration(n),c.animationDuration(n),z):n},z.xFormat=function(a){return arguments.length?(p=AD.UTILS.numberFormat(a),z):p},z.yFormat=function(a){return arguments.length?(q=AD.UTILS.numberFormat(a),z):q},z.on=function(a,b){return a=a.split("."),arguments.length?1==arguments.length?a[1]?r[a[0]][a[1]]:r[a[0]]["default"]:(a[1]?r[a[0]][a[1]]=b:r[a[0]]["default"]=b,z):r},z.data=function(a,b){return arguments.length?(b&&(v={columns:{},labels:{x:"",y:""}},l=!0),a.data.columns.forEach(function(a){var b;v.columns[a.label]?(b=v.columns[a.label],b.data.values=a.values||b.data.values,b.type=a.type):(b=v.columns[a.label]={data:a,type:a.type},l||(b.svg=m.group.columns.append("g"))),"none"==b.type&&(w(b),delete v.columns[a.label])}),a.data.labels&&(v.labels=a.data.labels),z):v},z.generate=function(a){l=!1,m.selectAll("*").remove(),m.svg=m.append("svg").attr("class","ad-interactive-bar-chart ad-svg ad-container"),m.group=m.svg.append("g"),m.group.axes=m.group.append("g").attr("class","ad-axes"),m.group.axes.x=m.group.axes.append("g").attr("class","ad-x ad-axis"),m.group.axes.y=m.group.axes.append("g").attr("class","ad-y ad-axis"),m.group.axes.xLabel=m.group.axes.append("g").attr("class","ad-x-label").append("text"),m.group.axes.yLabel=m.group.axes.append("g").attr("class","ad-y-label").append("text"),m.group.columns=m.group.append("g").attr("class","ad-columns");for(key in v.columns)v.columns[key].svg=m.group.columns.append("g");m.controls=m.group.append("g").attr("class","ad-controls"),c=new AD.UTILS.CONTROLS.horizontalControls,c.selection(m.controls).on("elementChange",function(a){t[a.key].enabled=a.state,z.update()}),m.legend=m.group.append("g").attr("class","ad-legend"),b=new AD.UTILS.LEGENDS.horizontalLegend,b.color(u).selection(m.legend).on("elementMouseover",function(a){m.group.columns.selectAll("rect").transition().duration(n/2).style("opacity",.35),a.data.svg.selectAll("rect").transition().duration(0).style("opacity",1)}).on("elementMouseout",function(){m.group.columns.selectAll("rect").transition().duration(n/4).style("opacity",1)});var d=n;return z.animationDuration(0),z.update(a),z.animationDuration(d),z},z.update=function(r){if(l)return z.generate(r);o=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),o.bottom+=20,o.left+=20,t.horizontal.enabled?(k={horizontal:j,vertical:i},s={x:"y",y:"x",horizontal:"vertical",vertical:"horizontal",width:"height",height:"width",bottom:"left",left:"bottom"}):(k={horizontal:i,vertical:j},s={x:"x",y:"y",horizontal:"horizontal",vertical:"vertical",width:"width",height:"height",bottom:"bottom",left:"left"});var u=AD.UTILS.getValues(v.columns);g=d-o.right-o.left;var w={data:{items:u.map(function(a){return{label:a.data.label,data:a}}).sort(function(a,b){return a.label-b.label})}};b.width(g).data(w).update(),o.bottom+=b.computedHeight();var A=AD.UTILS.getValues(t).filter(function(a){return a.visible});A.map(function(a){a.data={state:a.enabled,label:a.label,key:a.key}}),c.width(g).data(A).update(),o.top+=c.computedHeight(),f=e-o.top-o.bottom,h={horizontal:g,vertical:f};var B=[],C=[],D={};t.stacking.enabled?(u.forEach(function(a){a.data.values.forEach(function(a){D[a.x]||(D[a.x]=0),D[a.x]+=a.y,B.push(a.x),C.push(a.y)})}),C=C.concat(AD.UTILS.getValues(D))):u.forEach(function(a){a.data.values&&a.data.values.forEach(function(a){B.push(a.x),C.push(a.y)})});var E={};"ordinal"==k[s.horizontal].type?(k[s.horizontal].scale.rangeRoundBands([0,h[s.horizontal]],.1),E[s.horizontal]=AD.UTILS.AXISCHARTS.getDomainOrdinal(B).sort()):(k[s.horizontal].scale.range([0,h[s.horizontal]]),E[s.horizontal]=AD.UTILS.AXISCHARTS.getDomainLinear(B)),E[s.vertical]=t.yAxisLock.enabled?t.stacking.enabled?[0,t.yAxisLock.maxStacked]:[0,t.yAxisLock.maxNonStacked]:AD.UTILS.AXISCHARTS.getDomainLinear(C),k[s.vertical].scale.range([h[s.vertical],0]),k[s.horizontal].scale.domain("auto"==k[s.horizontal].domain?E[s.horizontal]:k[s.horizontal].domain),k[s.vertical].scale.domain("auto"==k[s.vertical].domain?E[s.vertical]:k[s.vertical].domain),t.horizontal.enabled&&k[s.vertical].scale.domain(k[s.vertical].scale.domain().reverse()),m.svg.attr("width",d).attr("height",e),k[s.vertical].scale.nice(5);var F={x:d3.svg.axis().scale(k[s.horizontal].scale).orient(s.bottom).tickFormat(p),y:d3.svg.axis().scale(k[s.vertical].scale).orient(s.left).tickFormat(q)};m.group.axes[s.y].transition().duration(n).call(F[s.y]);var G=0;return m.group.axes[s.y].selectAll(".tick text").each(function(){G<this.getComputedTextLength()&&(G=this.getComputedTextLength())}),o.left+=G,g=d-o.right-o.left,h.horizontal=g,t.horizontal.enabled?"linear"==k.horizontal.type?k.horizontal.scale.range([h.horizontal,0]):"ordinal"==k.horizontal.type&&k.horizontal.scale.rangeRoundBands([h.horizontal,0],.1):"linear"==k.horizontal.type?k.horizontal.scale.range([0,h.horizontal]):"ordinal"==k.horizontal.type&&k.horizontal.scale.rangeRoundBands([0,h.horizontal],.1),F.x.tickSize(-h[s.vertical]),F.y.tickSize(-h[s.horizontal]),m.group.axes[s.x].transition().duration(n).attr("transform","translate("+o.left+","+(o.top+f)+")").call(F[s.x]),m.group.axes[s.y].transition().duration(n).attr("transform","translate("+o.left+","+o.top+")").call(F[s.y]),a="ordinal"==k[s.horizontal].type?d3.scale.ordinal().domain(u.map(function(a){return a.data.label})).rangeRoundBands([0,k[s.horizontal].scale.rangeBand()]):h[s.horizontal]/(20*u.length),m.group.axes[s.x+"Label"].transition().duration(n).text(v.labels[s.x]).attr("transform","translate("+(o.left+g/2)+","+(f+30+o.top)+")"),m.group.axes[s.y+"Label"].transition().duration(n).attr("transform","translate("+(o.left-G-10)+","+(f/2+o.top)+"),rotate(-90)").text(v.labels[s.y]),m.legend.transition().duration(n).attr("transform","translate("+(o.left+(g-b.computedWidth())/2)+","+(f+25+o.top)+")"),m.controls.transition().duration(n).attr("transform","translate("+(o.left+g-c.computedWidth())+","+(-c.computedHeight()-10+o.top)+")"),m.group.columns.transition().duration(n).attr("transform","translate("+o.left+","+o.top+")"),y(u),u.forEach(function(a){x(a)}),d3.timer.flush(),r&&r(),z},z},AD.CHARTS.iframeChart=function(){var a=AD.CONSTANTS.DEFAULTWIDTH(),b=AD.CONSTANTS.DEFAULTHEIGHT(),c=!0,d=d3.select("body"),e=AD.CONSTANTS.ANIMATIONLENGTHS().normal,f=(AD.CONSTANTS.DEFAULTFORCEDMARGIN(),AD.CONSTANTS.DEFAULTCOLOR(),{}),g={elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){}},h={};return h.select=function(a){return d=d3.select(a),c=!0,h},h.selection=function(a){return arguments.length?(d=a,c=!0,h):d},h.width=function(b){return arguments.length?(a=b,h):a},h.height=function(a){return arguments.length?(b=a,h):b},h.animationDuration=function(a){return arguments.length?(e=a,h):e},h.on=function(a,b){return a=a.split("."),arguments.length?1==arguments.length?a[1]?g[a[0]][a[1]]:g[a[0]]["default"]:(a[1]?g[a[0]][a[1]]=b:g[a[0]]["default"]=b,h):g},h.data=function(a,b){return arguments.length?(b&&(f={}),c=!0,f=a.data,h):f},h.generate=function(a){c=!1,d.selectAll("*").remove(),d.div=d.append("div").attr("class","ad-iframe-chart ad-container"),d.div.iframe=d.div.append("iframe").attr("class","ad-iframe").attr("src",f.url);var b=e;return h.animationDuration(0).update(a).animationDuration(b),h},h.update=function(f){return c?h.generate(f):(d.div.iframe.transition().duration(e).attr("width",a).attr("height",b),d3.timer.flush(),f&&f(),h)},h},AD.DASHBOARDS.dashboard=function(){var a=AD.CONSTANTS.DEFAULTWIDTH(),b=AD.CONSTANTS.DEFAULTMARGIN(),c=a-200,d=!0,e=d3.select("body"),f=AD.CONSTANTS.ANIMATIONLENGTHS().normal,g=(AD.CONSTANTS.DEFAULTFORCEDMARGIN(),new AD.UTILS.chartPage),h={};h.array=[],h.position=-1,h.pushNew=function(a){h.array=h.array.slice(0,h.position+1),h.position++,h.array.push({category:a.category,section:a.section})};var i={section:{},category:{}},j=!0,k={},l=AD.CONSTANTS.DEFAULTPALETTE,m=function(a){a&&a.forEach(function(a){a.charts&&a.charts.forEach(function(a){a.chart=k.dashboard.charts[a.reference]})})},n=function(a,b,c){b.forEach(function(b){m(b.categories),b.position=a.concat([{section:b,sectionGroup:c}]),b.sections&&n(a.concat([{section:b,sectionGroup:c}]),b.sections),b.sectionGroups&&o(a.concat([{section:b,sectionGroup:c}]),b.sectionGroups)})},o=function(a,b){b.forEach(function(b){b.sections&&n(a,b.sections,b)})},p=function(a){for(chart in a.dashboard.charts)AD.UTILS.chartAdapter(a.dashboard.charts[chart].type,a.dashboard.charts[chart]);n([],[a.dashboard.topSection])},q=function(){e.container.content.breadcrumbs.svg.selectAll(".ad-breadcrumb-sub-section-group-section").transition().duration(f/2).style("opacity",0),e.container.content.breadcrumbs.svg.selectAll(".ad-breadcrumb").each(function(){this.expanded=!1}),e.container.content.breadcrumbs.svg.style("height","30px")},r=function(){var a=9,b=e.container.content.breadcrumbs.svg.selectAll("g.ad-breadcrumb").data(i.section.position,function(a){return a.section.name}),c=b.enter().append("g").style("opacity",0).attr("class","ad-breadcrumb");c.append("path").style("fill",l.primary),c.append("text").text(function(a){return a.section.name}).attr("y",21).attr("x",15),b.each(function(c,d){var g,h=this,j=d3.select(h),k=j.select("text"),m=j.select("path"),n=k.node().getBBox().width+25;if(j.select("g.ad-breadcrumb-triangle").remove(),c.section!=i.section?j.classed("ad-innactive",!1).on("click",function(a){w(a.section)}):j.classed("ad-innactive",!0).on("click",function(){}),c.sectionGroup){var o=j.selectAll("g.ad-breadcrumb-sub-section-group-section").data(c.sectionGroup.sections.filter(function(a){return a!=c.section}));h.dyExpanded=0,h.expanded=!1;var p=o.enter().append("g").style("opacity",0).attr("class","ad-breadcrumb-sub-section-group-section");p.append("path"),p.append("text").attr("y",21).attr("x",15).text(function(a){return a.name}),o.each(function(){var b=d3.select(this),c=b.select("path"),d=b.select("text"),e=d.node().getBBox().width+25;c.attr("d","M 0 0 L "+a+" 15 L 0 30 L "+e+" 30 L "+(e+a)+" 15 L "+e+" 0 L 0 0 Z")}).on("click",function(a){d3.event.stopPropagation(),w(a)}).attr("transform",function(a,b){return"translate(0,"+34*(b+1)+")"}),h.dyExpanded=34*(o.size()+5),n+=15,g=j.append("g").attr("class","ad-breadcrumb-triangle").on("click",function(){d3.event.stopPropagation(),h.expanded?(o.transition().duration(f/2).style("opacity",0),e.container.content.breadcrumbs.svg.style("height","30px")):(q(),e.container.content.breadcrumbs.svg.style("height",Math.max(30,h.dyExpanded)+"px"),o.transition().duration(f/2).delay(function(a,b){return 20*b}).style("opacity",1)),h.expanded=!h.expanded}),g.append("rect").attr("width",20).attr("height",30).style("fill",d3.rgb(l.primary).darker(2)).attr("transform","translate("+(n-20)+",0)"),g.append("path").attr("d","M 0 0 L 9 0 L 4.5 5 L 0 0").style("fill","white").attr("transform","translate("+(n-15)+",13)")}var r=a,s=a;0==d&&(r=0),d+1==b.size()&&(s=0),m.transition().duration(f).attr("d","M 0 0 L "+r+" 15 L 0 30 L "+n+" 30 L "+(n+s)+" 15 L "+n+" 0 L 5 0 Z"),this.dx=n});var d=0;b.transition().duration(f).attr("transform",function(){var a="translate("+d+",0)";return d+=this.dx+2,a}).style("opacity",1),b.exit().transition().duration(f).style("opacity",0).remove()},s=function(){if(!i.section.categories||i.section.categories.length<1)return void e.container.header.navigation.categoryTabs.style("display","none").selectAll("*").remove();e.container.header.navigation.categoryTabs.style("display","");var a=e.container.header.navigation.categoryTabs.selectAll("li.ad-category-tab").data(i.section.categories);a.enter().append("li").attr("class","ad-category-tab").on("click",x),a.text(function(a){return a.name}).each(function(a){a==i.category?d3.select(this).classed("ad-innactive",!0).on("click",function(){}):d3.select(this).classed("ad-innactive",!1).on("click",x)}),a.exit().transition().duration(f).style("opacity",0).remove()},t=function(){if(!i.section.sections||i.section.sections.length<1)return void e.container.sidebar.subSections.style("display","none").selectAll("*").remove();e.container.sidebar.subSections.style("display","");var a=e.container.sidebar.subSections.selectAll("li.ad-sub-section").data(i.section.sections);a.enter().append("li").style("opacity",0).attr("class","ad-sub-section").on("click",w),a.text(function(a){return a.name}).transition().duration(f).style("opacity",1),a.exit().transition().duration(f).style("opacity",0).remove()},u=function(){if(!i.section.sectionGroups||i.section.sectionGroups.length<1)return void e.container.sidebar.subSectionGroups.style("display","none").selectAll("*").remove();var a=i.section.sectionGroups.filter(function(a){return a.sections.length>0});if(a.length<1)return void e.container.sidebar.subSectionGroups.style("display","none").selectAll("*").remove();e.container.sidebar.subSectionGroups.style("display","");var b=e.container.sidebar.subSectionGroups.selectAll("li.ad-sub-section-group").data(a);b.enter().append("li").style("opacity",0).attr("class","ad-sub-section-group"),b.transition().duration(f).style("opacity",1),b.text(function(a){return a.name}).each(v),b.exit().transition().duration(f).style("opacity",0).remove()},v=function(a){if(a.sections&&!(a.sections.length<1)){var b=d3.select(this);b.selectAll("*").remove();var c=b.append("ul").datum(a).attr("class","ad-sub-section-group-sections"),d=c.selectAll("li.ad-sub-section-group-section").data(function(a){return a.sections});d.enter().append("li").attr("class","ad-sub-section-group-section"),d.on("click",w),d.text(function(a){return a.name})}},w=function(a){q(),i.section=a;var b=a.categories.filter(function(a){return a.name==i.category.name});return x(b.length>0?b[0]:a.categories[0])},x=function(a){return i.category=a,h.pushNew(i),g.animationType("forward").data({data:i.category}).update(),y.update()},y={};return y.select=function(a){return e=d3.select(a),d=!0,y},y.selection=function(a){return arguments.length?(e=a,d=!0,y):e},y.width=function(b){return arguments.length?(a=b,c=a-200,g.width(c-10),j=!0,y):a},y.margin=function(a){return arguments.length?(a.left&&(b.left=a.left),a.right&&(b.right=a.right),a.top&&(b.top=a.top),a.bottom&&(b.bottom=a.bottom),y):b},y.palette=function(a){return arguments.length?(l=a,y):l},y.animationDuration=function(a){return arguments.length?(f=a,g.animationDuration(f),y):f},y.data=function(a,b){return arguments.length?(b&&(d=!0,k={}),k=a,p(k),y):f},y.generate=function(a){d=!1,e.selectAll("*").remove(),e.container=e.append("div").attr("class","ad-dashboard ad-container"),e.container.header=e.container.append("div").attr("class","ad-header"),e.container.header.navigation=e.container.header.append("div").attr("class","ad-navigation"),e.container.header.navigation.home=e.container.header.navigation.append("div").attr("class","ad-navigation-home"),e.container.header.navigation.home.append("i").attr("class","fa fa-home"),e.container.header.navigation.arrows=e.container.header.navigation.append("div").attr("class","ad-navigation-arrows"),e.container.header.navigation.arrows.left=e.container.header.navigation.arrows.append("div").attr("id","ad-left-arrow"),e.container.header.navigation.arrows.right=e.container.header.navigation.arrows.append("div").attr("id","ad-right-arrow"),e.container.header.navigation.arrows.left.append("i").attr("class","fa fa-chevron-left"),e.container.header.navigation.arrows.right.append("i").attr("class","fa fa-chevron-right"),e.container.header.navigation.categoryTabs=e.container.header.navigation.append("ul").attr("class","ad-category-tabs"),e.container.sidebar=e.container.append("div").attr("class","ad-dashboard-sidebar"),e.container.sidebar.subSections=e.container.sidebar.append("ul").attr("class","ad-sub-sections"),e.container.sidebar.subSectionGroups=e.container.sidebar.append("ul").attr("class","ad-sub-section-groups"),e.container.content=e.container.append("div").attr("class","ad-dashboard-content"),e.container.content.breadcrumbs=e.container.content.append("div").attr("class","ad-navigation-breadcrumbs"),e.container.content.breadcrumbs.svg=e.container.content.breadcrumbs.append("svg").attr("class","ad-navigation-breadcrumbs-svg"),e.container.content.chartPage=e.container.content.append("div").attr("class","ad-dashboard-chart-page"),g.selection(e.container.content.chartPage),w(k.dashboard.topSection);
return y.update(a),y},y.update=function(b){return d?y.generate(b):(e.container.content.style("width",c+"px"),i.section==k.dashboard.topSection?e.container.header.navigation.home.classed("ad-innactive",!0).on("click",function(){}):e.container.header.navigation.home.classed("ad-innactive",!1).on("click",function(){w(k.dashboard.topSection)}),h.position+1==h.array.length?e.container.header.navigation.arrows.right.classed("ad-innactive",!0).on("click",function(){}):e.container.header.navigation.arrows.right.classed("ad-innactive",!1).on("click",function(){h.position++,i={category:h.array[h.position].category,section:h.array[h.position].section},q(),g.animationType("forward").data({data:i.category}).update(),y.update()}),0==h.position?e.container.header.navigation.arrows.left.classed("ad-innactive",!0).on("click",function(){}):e.container.header.navigation.arrows.left.classed("ad-innactive",!1).on("click",function(){h.position--,i={category:h.array[h.position].category,section:h.array[h.position].section},q(),g.animationType("backward").data({data:i.category}).update(),y.update()}),e.container.transition().delay(f).duration(f).style("width",a+"px"),s(),r(),t(),u(),j&&(j=!1,g.update()),d3.timer.flush(),b&&b(),y)},y},d3.sankey=function(){function a(){n.forEach(function(a){a.sourceLinks=[],a.targetLinks=[]}),o.forEach(function(a){var b=a.source,c=a.target;"number"==typeof b&&(b=a.source=n[a.source]),"number"==typeof c&&(c=a.target=n[a.target]),b.sourceLinks.push(a),c.targetLinks.push(a)})}function b(){n.forEach(function(a){a.value=Math.max(d3.sum(a.sourceLinks,i),d3.sum(a.targetLinks,i))})}function c(){for(var a,b=n,c=0;b.length;)a=[],b.forEach(function(b){b.x=c,b.dx=k,b.sourceLinks.forEach(function(b){a.indexOf(b.target)<0&&a.push(b.target)})}),b=a,++c;d(c),e((m[0]-k)/(c-1))}function d(a){n.forEach(function(b){b.sourceLinks.length||(b.x=a-1)})}function e(a){n.forEach(function(b){b.x*=a})}function f(a){function b(){var a=d3.min(g,function(a){return(m[1]-(a.length-1)*l)/d3.sum(a,i)});g.forEach(function(b){b.forEach(function(b,c){b.y=c,b.dy=b.value*a})}),o.forEach(function(b){b.dy=b.value*a})}function c(a){function b(a){return h(a.source)*a.value}g.forEach(function(c){c.forEach(function(c){if(c.targetLinks.length){var d=d3.sum(c.targetLinks,b)/d3.sum(c.targetLinks,i);c.y+=(d-h(c))*a}})})}function d(a){function b(a){return h(a.target)*a.value}g.slice().reverse().forEach(function(c){c.forEach(function(c){if(c.sourceLinks.length){var d=d3.sum(c.sourceLinks,b)/d3.sum(c.sourceLinks,i);c.y+=(d-h(c))*a}})})}function e(){g.forEach(function(a){var b,c,d,e=0,g=a.length;for(a.sort(f),d=0;g>d;++d)b=a[d],c=e-b.y,c>0&&(b.y+=c),e=b.y+b.dy+l;if(c=e-l-m[1],c>0)for(e=b.y-=c,d=g-2;d>=0;--d)b=a[d],c=b.y+b.dy+l-e,c>0&&(b.y-=c),e=b.y})}function f(a,b){return a.y-b.y}var g=d3.nest().key(function(a){return a.x}).sortKeys(d3.ascending).entries(n).map(function(a){return a.values});b(),e();for(var j=1;a>0;--a)d(j*=.99),e(),c(j),e()}function g(){function a(a,b){return a.source.y-b.source.y}function b(a,b){return a.target.y-b.target.y}n.forEach(function(c){c.sourceLinks.sort(b),c.targetLinks.sort(a)}),n.forEach(function(a){var b=0,c=0;a.sourceLinks.forEach(function(a){a.sy=b,b+=a.dy}),a.targetLinks.forEach(function(a){a.ty=c,c+=a.dy})})}function h(a){return a.y+a.dy/2}function i(a){return a.value}var j={},k=24,l=8,m=[1,1],n=[],o=[];return j.nodeWidth=function(a){return arguments.length?(k=+a,j):k},j.nodePadding=function(a){return arguments.length?(l=+a,j):l},j.nodes=function(a){return arguments.length?(n=a,j):n},j.links=function(a){return arguments.length?(o=a,j):o},j.size=function(a){return arguments.length?(m=a,j):m},j.layout=function(d){return a(),b(),c(),f(d),g(),j},j.relayout=function(){return g(),j},j.link=function(){function a(a){var c=a.source.x+a.source.dx,d=a.target.x,e=d3.interpolateNumber(c,d),f=e(b),g=e(1-b),h=a.source.y+a.sy+a.dy/2,i=a.target.y+a.ty+a.dy/2;return"M"+c+","+h+"C"+f+","+h+" "+g+","+i+" "+d+","+i}var b=.5;return a.curvature=function(c){return arguments.length?(b=+c,a):b},a},j};