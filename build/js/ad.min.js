/*! Copyright 2014 - 2015 Kevin Warne All rights reserved.*/function arcTween(a,b){a.attrTween("d",function(a){var c=d3.interpolate(this._current,a);return this._current=a,function(a){return b(c(a))}})}var AD=AD||{};AD.createNameSpace=function(a){var b=a.split("."),c=AD;"AD"===b[0]&&(b=b.slice(1));for(var d=0;d<b.length;d++){var e=b[d];"undefined"==typeof c[e]&&(c[e]={}),c=c[e]}return c},AD.createNameSpace("AD.CHARTS"),AD.createNameSpace("AD.DASHBOARDS"),AD.createNameSpace("AD.UTILS"),AD.createNameSpace("AD.UTILS.CHARTPAGE"),AD.createNameSpace("AD.CONSTANTS"),AD.CONSTANTS.DEFAULTPALETTE={primary:"rgb(42,54,82)",secondary:"rgb(11,22,47)"},AD.CONSTANTS.DEFAULTWIDTH=function(){return 960},AD.CONSTANTS.DEFAULTHEIGHT=function(){return 540},AD.CONSTANTS.DEFAULTMARGIN=function(){return{left:0,right:0,top:0,bottom:0}},AD.CONSTANTS.DEFAULTFORCEDMARGIN=function(){return{left:30,bottom:20,right:30,top:20}},AD.CONSTANTS.DEFAULTCOLOR=function(){return d3.scale.category10()},AD.CONSTANTS.ANIMATIONLENGTHS=function(){return{normal:500,"short":100,"long":1e3}},AD.UTILS.chartAdapter=function(a,b){if(b.chart=new AD.CHARTS[a],b.chartLayoutData||(b.chartLayoutData={}),b.chartLayout=new AD.UTILS.CHARTPAGE.chartLayout,b.chartLayout.chart(b.chart).data(b.chartLayoutData),console.log(b.chartLayoutData),console.log("hi"),b.properties)for(key in b.properties)b.chart[key](b.properties[key])},AD.UTILS.CHARTPAGE.chartLayout=function(){var a,b,c=AD.CONSTANTS.DEFAULTWIDTH(),d=AD.CONSTANTS.DEFAULTHEIGHT(),e={chartLayout:{}},f=AD.CONSTANTS.ANIMATIONLENGTHS().normal,g=!0,h={};return h.chart=function(a){return arguments.length?(b=a,g=!0,h):b},h.width=function(a){return arguments.length?(c=a,h):c},h.height=function(a){return arguments.length?(d=a,h):d},h.selection=function(b){return arguments.length?(a=b,g=!0,h):a},h.select=function(b){return arguments.length?(a=d3.select(b),g=!0,h):a},h.animationDuration=function(a){return arguments.length?(f=a,h):f},h.data=function(a,b){return arguments.length?(b&&(e={chartLayout:{}},g=!0),a.data.chartLayout.footnote&&(e.chartLayout.footnote=a.data.chartLayout.footnote),a.data.chartLayout.rightNotes&&(e.chartLayout.rightNotes=a.data.chartLayout.rightNotes),a.data.chartLayout.leftNotes&&(e.chartLayout.leftNotes=a.data.chartLayout.leftNotes),a.data.chartLayout.title&&(e.chartLayout.title=a.data.chartLayout.title),a.data.chartCallback&&(e.chartCallback=a.data.chartCallback),h):e},h.generate=function(c){a.selectAll("*").remove(),a.wrapper=a.append("div").attr("class","ad-chart-layout-wrapper"),a.container=a.wrapper.append("div").attr("class","ad-chart-layout ad-container"),a.container.title=a.container.append("div").attr("class","ad-chart-layout-title"),a.container.title.div=a.container.title.append("div"),a.container.chart=a.container.append("div").attr("class","ad-chart-layout-chart"),b.selection(a.container.chart).update(e.chartCallback),a.container.rightNotes=a.container.append("div").attr("class","ad-chart-layout-right-notes"),a.container.rightNotes.ul=a.container.rightNotes.append("ul"),a.container.leftNotes=a.container.append("div").attr("class","ad-chart-layout-left-notes"),a.container.leftNotes.ul=a.container.leftNotes.append("ul"),a.container.footnote=a.container.append("div").attr("class","ad-chart-layout-footnote"),a.container.footnote.div=a.container.footnote.append("div"),a.container.source=a.container.append("div").attr("class","ad-chart-layout-source").append("ul"),g=!1;var d=f;return h.animationDuration(0).update(c).animationDuration(d),h},h.update=function(i){if(!a)return console.warn("chartLayout was not given a selection");if(!b)return console.warn("chartLayout was not given a chart");g&&h.generate(i);var j={top:10,bottom:0,left:0,right:0};a.wrapper.style("width",c+"px").style("height",d+"px"),a.container.title.div.text(e.chartLayout.title).style("opacity","1"),e.chartLayout.title?j.top+=a.container.title.node().getBoundingClientRect().height:a.container.title.div.style("opacity","0"),a.container.footnote.div.text(e.chartLayout.footnote),j.bottom+=a.container.footnote.node().getBoundingClientRect().height,a.container.footnote.style("top",d-j.bottom+"px"),!e.chartLayout.rightNotes||e.chartLayout.rightNotes.length<1?e.chartLayout.rightNotes=[]:j.right+=.2*c+5,a.container.rightNotes.style("width",.2*c+"px").style("height",d-j.top-j.bottom+"px").style("left",.8*c-5+"px");var k=a.container.rightNotes.ul.selectAll("li.ad-chart-layout-note").data(e.chartLayout.rightNotes);k.enter().append("li").attr("class","ad-chart-layout-note"),k.text(function(a){return a}),k.exit().style("opacity",0).remove(),!e.chartLayout.leftNotes||e.chartLayout.leftNotes.length<1?e.chartLayout.leftNotes=[]:j.left+=.2*c,a.container.leftNotes.style("width",.2*c+"px").style("height",d-j.top-j.bottom+"px");var l=a.container.leftNotes.ul.selectAll("li.ad-chart-layout-note").data(e.chartLayout.leftNotes);return l.enter().append("li").attr("class","ad-chart-layout-note"),l.text(function(a){return a}),l.exit().style("opacity",0).remove(),a.container.chart.style("left",j.left+5+"px").style("top",j.top+"px"),b.width(c-j.left-j.right-10).height(d-j.top-j.bottom).animationDuration(f).update(e.chartCallback),d3.timer.flush(),i&&i(),h},h},AD.UTILS.chartPage=function(){var a,b,c=AD.CONSTANTS.DEFAULTWIDTH(),d=0,e=AD.CONSTANTS.ANIMATIONLENGTHS().normal,f="forward",g=function(){var b={};b.left="backward"==f?-c+"px":c+"px",a.currentPage=a.append("div").attr("class","ad-chart-page-current-page").style("opacity",0).style("left",b.left)},h={};return h.width=function(a){return arguments.length?(c=a,h):c},h.computedHeight=function(){return d},h.selection=function(b){return arguments.length?(a=b,h):a},h.select=function(b){return arguments.length?(a=d3.select(b),h):a},h.animationDuration=function(a){return arguments.length?(e=a,h):e},h.animationType=function(a){return arguments.length?(f=a,h):f},h.data=function(a){return arguments.length?(newData=!0,b=a,h):b},h.update=function(i){if(!a)return console.warn("page was not given a selection");var j={};if(newData&&(newData=!1,a.currentPage&&(j.left="backward"==f?c+"px":-c+"px",a.currentPage.transition().duration(e).style("opacity",0).style("left",j.left).remove()),g()),d=0,a.currentPage.transition().duration(e).style("opacity",1).style("left","0px"),!b.data.charts||b.data.charts.length<1)return console.warn("chart page was not provided any charts");{var k=a.currentPage.selectAll("div.ad-page-chart-layout").data(b.data.charts);k.enter().append("div").attr("class","ad-page-chart-layout").each(function(a){a.chart.chartLayout&&a.chart.chartLayout.select(this).width(c*a.width).height(a.height).animationDuration(0).update(a.chart.chartLayoutData.chartCallback)})}return k.each(function(a){a.chart.chartLayout&&a.chart.chartLayout.animationDuration(e).width(c*a.width).update(a.chart.chartLayoutData.chartCallback)}).style("left",function(a){return c*a.x+"px"}).style("top",function(a){return a.y+"px"}),d3.timer.flush(),i&&i(),h},h},AD.createNameSpace("AD.UTILS.CONTROLS"),AD.UTILS.CONTROLS.checkbox=function(){var a,b=5,c=0,d=0,e={label:"",state:!1},f={elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){},elementChange:function(){}},g={};return g.scale=function(a){return arguments.length?(b=a,g):b},g.selection=function(b){return arguments.length?(a=b,g):a},g.checked=function(a){return arguments.length?(e.state=a,g.update()):e.state},g.computedHeight=function(){return d},g.computedWidth=function(){return c},g.on=function(a,b){return a=a.split("."),arguments.length?1==arguments.length?a[1]?f[a[0]][a[1]]:f[a[0]]["default"]:(a[1]?f[a[0]][a[1]]=b:f[a[0]]["default"]=b,g):f},g.data=function(a){return arguments.length?(e=a,g):e},g.update=function(h){if(!a)return console.warn("checkbox was not given a selection");if(!e)return console.warn("checkboxData is null");var i=a.selectAll("g.ad-checkbox-container").data([e]),j=i.enter().append("g").attr("class","ad-checkbox-container").on("click",function(a,b){e.state=!e.state;for(key in f.elementClick)f.elementClick[key].call(this,a,b);for(key in f.elementChange)f.elementChange[key].call(this,a,b);g.update()}).on("mouseover",function(a,b){for(key in f.elementMouseover)f.elementMouseover[key].call(this,a,b)}).on("mouseout",function(a,b){for(key in f.elementMouseout)f.elementMouseout[key].call(this,a,b)});j.append("rect").attr("rx",1),j.append("path"),j.append("text").text(function(a){return a.label});var k=i.select("text").attr("y",2.1*b).style("font-size",2.5*b+"px"),l=k.node().getComputedTextLength(),m=b;l+=m;var n="translate("+l+",0)",o=i.select("path").attr("transform",n).attr("d","M"+.38*b+","+1.06*b+" l"+.7*b+","+.5*b+" l"+.58*b+","+-1.19*b).style("stroke-width",.4*b).attr("stroke-dasharray",2.2*b);o.transition().duration(AD.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("stroke-dashoffset",e.state?0:2.2*b);i.select("rect").attr("width",2.1*b+"px").attr("height",2.1*b+"px").attr("transform",n).style("stroke-width",.4*b);return c=l+2.1*b,d=2.5*b,h&&h(),g},g},AD.UTILS.CONTROLS.horizontalControls=function(){var a,b,c=AD.CONSTANTS.DEFAULTWIDTH(),d=(AD.CONSTANTS.DEFAULTCOLOR(),0),e=0,f=AD.CONSTANTS.ANIMATIONLENGTHS().normal,g=5,h={elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){},elementChange:function(){}},i={};return i.width=function(a){return arguments.length?(c=a,i):c},i.computedHeight=function(){return e},i.computedWidth=function(){return d},i.selection=function(b){return arguments.length?(a=b,i):a},i.scale=function(a){return arguments.length?(g=a,i):g},i.animationDuration=function(a){return arguments.length?(f=a,i):f},i.on=function(a,b){return a=a.split("."),arguments.length?1==arguments.length?a[1]?h[a[0]][a[1]]:h[a[0]]["default"]:(a[1]?h[a[0]][a[1]]=b:h[a[0]]["default"]=b,i):h},i.data=function(a){return arguments.length?(b=a,i):b},i.update=function(i){if(!a)return console.warn("controls was not given a selection");var j=3*g,k=g;if(e=0,d=0,b.length>0){var l=a.selectAll("g.ad-control").data(b,function(a){return a.label+","+a.type});l.enter().append("g").attr("class","ad-control").each(function(a){a.control=new AD.UTILS.CONTROLS[a.type],a.control.selection(d3.select(this)).on("elementClick",function(a,b){for(key in h.elementClick)h.elementClick[key].call(this,a,b)}).on("elementChange",function(a,b){for(key in h.elementChange)h.elementChange[key].call(this,a,b)}).on("elementMouseover",function(a,b){for(key in h.elementMouseover)h.elementMouseover[key].call(this,a,b)}).on("elementMouseout",function(a,b){for(key in h.elementMouseout)h.elementMouseout[key].call(this,a,b)})});var m=0;l.each(function(a){a.control.scale(g).data(a.data).update(),d+a.control.computedWidth()>c&&(d=0,e+=m+k,m=0),d3.select(this).style("opacity",1).attr("transform","translate("+d+","+e+")"),d+=a.control.computedWidth()+j,m<a.control.computedHeight()&&(m=a.control.computedHeight())}),d-=j,e+=m,l.exit().transition().duration(f).style("opacity",0).remove()}return l},i},AD.createNameSpace("AD.UTILS.SHAPES"),AD.UTILS.createGeneralTooltip=function(a,b,c){var d=d3.select("body"),e=d.append("div").attr("class","ad-general-tooltip").html(b+": "+c).style("opacity",0);e.transition().duration(50).style("opacity",1);var f=AD.UTILS.scrollOffset(),g=d.node().getBoundingClientRect().width,h={left:0,top:0};return h.left=f.left+d3.event.clientX<g/2?f.left+d3.event.clientX+10:f.left+d3.event.clientX-e.node().getBoundingClientRect().width-10,h.top=f.top+d3.event.clientY-10,AD.UTILS.moveTooltip(e,h.left,h.top,0),a.on("mousemove",function(){f=AD.UTILS.scrollOffset(),h.left=f.left+d3.event.clientX<g/2?f.left+d3.event.clientX+10:f.left+d3.event.clientX-e.node().getBoundingClientRect().width-10,h.top=f.top+d3.event.clientY-10,AD.UTILS.moveTooltip(e,h.left,h.top,50)}),e},AD.UTILS.removeTooltip=function(){d3.selectAll(".ad-general-tooltip").remove()},AD.UTILS.moveTooltip=function(a,b,c,d){a.transition().duration(d).ease("linear").style("opacity",1).style("top",c+"px").style("left",b+"px"),d3.timer.flush()},AD.UTILS.scrollOffset=function(){var a=document.documentElement,b=(window.pageXOffset||a.scrollLeft)-(a.clientLeft||0),c=(window.pageYOffset||a.scrollTop)-(a.clientTop||0);return{top:c,left:b}},AD.UTILS.getValues=function(a){var b=[];for(var c in a)a[c].key=c,b.push(a[c]);return b},AD.createNameSpace("AD.UTILS.AXISCHARTS"),AD.UTILS.AXISCHARTS.getDomainLinear=function(a){return[d3.min(a)<0?d3.min(a):0,d3.max(a)+1]},AD.UTILS.AXISCHARTS.getDomainOrdinal=function(a){return d3.set(a).values()},AD.UTILS.numberFormat=function(a){var b,c="";return a.siPrefixed?(a.precision>-1&&(c+="."+a.precision),c+="s"):(a.separateThousands&&(c+=","),a.precision>-1&&(c+="."+a.precision+"f")),b=d3.format(c),function(c){var d={before:a.units.before?a.units.before:"",after:a.units.after?a.units.after:""};return isNaN(c)?d.before+c+d.after:d.before+b(c)+d.after}},AD.createNameSpace("AD.UTILS.LEGENDS"),AD.UTILS.LEGENDS.horizontalLegend=function(){var a,b,c=AD.CONSTANTS.DEFAULTWIDTH(),d=[],e=AD.CONSTANTS.DEFAULTCOLOR(),f=0,g=0,h=AD.CONSTANTS.ANIMATIONLENGTHS().normal,i=5,j={elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){}},k={};return k.items=function(a){return arguments.length?(d=a,k):d},k.width=function(a){return arguments.length?(c=a,k):c},k.computedHeight=function(){return g},k.computedWidth=function(){return f},k.color=function(a){return arguments.length?(e=a,k):e},k.selection=function(b){return arguments.length?(a=b,k):a},k.select=function(b){return arguments.length?(a=d3.select(b),k):a},k.animationDuration=function(a){return arguments.length?(h=a,k):h},k.scale=function(a){return arguments.length?(i=a,k):i},k.on=function(a,b){return a=a.split("."),arguments.length?1==arguments.length?a[1]?j[a[0]][a[1]]:j[a[0]]["default"]:(a[1]?j[a[0]][a[1]]=b:j[a[0]]["default"]=b,k):j},k.data=function(a){return arguments.length?(b=a,k):b},k.update=function(d){if(!a)return console.warn("legend was not given a selection");if(g=0,f=0,b.data.items.length>0){var l=a.selectAll("g.ad-legend-item").data(b.data.items,function(a){return a.label}),m=l.enter().append("g").attr("class","ad-legend-item").style("opacity",0).on("mouseover",function(a,b){for(key in j.elementMouseover)j.elementMouseover[key].call(this,a,b)}).on("mouseout",function(a,b){for(key in j.elementMouseout)j.elementMouseout[key].call(this,a,b)}).on("click",function(a,b){for(key in j.elementClick)j.elementClick[key].call(this,a,b)});m.append("circle").attr("fill",function(a){return a.color||e(a.label)}),m.append("text").text(function(a){return a.label});var n=(l.select("circle").attr("r",i).attr("y",i/2),l.select("text").style("font-size",2.5*i+"px").attr("x",2*i).attr("y",i)),o=0;n.each(function(){var a=this.getComputedTextLength();a>o&&(o=a)}),o+=6*i;var p=Math.floor(c/o),q=0,r=0;l.transition().duration(h).style("opacity",1).attr("transform",function(a,b){b%p==0&&(q=0,r+=4*i);var c="translate("+q+","+r+")";return q+=o,c}),l.exit().transition().duration(h).style("opacity",0).remove(),g=r,f=l[0].length>=p?o*p:o*l[0].length}return d&&d(),k},k},AD.CHARTS.axisChart=function(){var a,b,c,d=AD.CONSTANTS.DEFAULTWIDTH(),e=AD.CONSTANTS.DEFAULTHEIGHT(),f=AD.CONSTANTS.DEFAULTMARGIN(),g=e,h=d,i={type:"linear",scale:d3.scale.linear(),domain:"auto"},j={type:"linear",scale:d3.scale.linear(),domain:"auto"},k=!0,l=d3.select("body"),m=AD.CONSTANTS.ANIMATIONLENGTHS().normal,n=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),o=function(a){return a},p=function(a){return a},q={yAxisLock:{label:"Lock Y-Axis",type:"checkbox",visible:!1,enabled:!1,maxStacked:AD.CONSTANTS.DEFAULTHEIGHT(),maxNonStacked:AD.CONSTANTS.DEFAULTHEIGHT()},stacking:{label:"Stack Bars",type:"checkbox",visible:!1,enabled:!1}},r=AD.CONSTANTS.DEFAULTCOLOR(),s={columns:{},labels:{x:"",y:""}},t=function(a){var b=a.svg;b.transition().duration(m).style("opacity",0).each("end",function(){b.remove()}),a.svg=l.group.columns[a.newType.split(",")[0]+"_columns"].append("g"),w[a.newType](a,"true")},u=function(a){var b=a.svg;b.transition().duration(m).style("opacity",0).each("end",function(){b.remove()})},v=["area","bar","line","scatter"],w={};w.area=function(a){var b=a.svg.selectAll("path").data([a]);b.enter().append("path").style("opacity",0).datum(a.modifiedData.values).attr("d",a.area).style("stroke",r(a.data.label)).style("fill",r(a.data.label)),b.datum(a.modifiedData.values).transition().duration(m).attr("d",a.area).style("opacity",1)},w.bar=function(a){var b=a.svg.selectAll("rect").data(a.data.values,function(a){return a.x});b.enter().append("rect").attr("class","ad-bar-rect").style("opacity",0).attr("height",0).attr("y",g),b.style("fill",r(a.data.label)).style("stroke-width","0.6px").style("opacity",1),b.transition().duration(m).attr("x",function(a){return a.xPos}).attr("y",function(a){return a.yPos}).attr("width",function(a){return a.width}).attr("height",function(a){return a.height}).style("stroke",r(a.data.label)),b.exit().transition().duration(m).style("opacity",0).attr("height",0).attr("y",g).remove()},w.line=function(a){var b=d3.svg.line().x(function(a){return i.scale(a.x)+z()}).y(function(a){return j.scale(a.y)}),c=a.data.type.split(",")[1];c&&b.interpolate(c);var d=a.svg.selectAll("path").data([a]);d.enter().append("path").attr("class","ad-line").style("opacity",0).datum(a.data.values).attr("d",b).style("stroke",r(a.data.label)),d.datum(a.data.values).transition().duration(m).attr("d",b).style("opacity",1)},w.scatter=function(a){{var b=a.svg.selectAll("g.ad-scatter-point").data(a.data.values,function(a){return a.x}),c=b.enter().append("g").attr("class","ad-scatter-point").attr("transform",function(a){return"translate("+(i.scale(a.x)+z())+","+j.scale(a.y)+")"});c.append("circle").attr("class","ad-scatter-point").attr("r",5).style("fill",r(a.data.label)).on("mouseover",function(){d3.select(this).transition().duration(250).attr("r",7)}).on("mouseout",function(){d3.select(this).transition().duration(250).attr("r",5)})}b.transition().duration(m).attr("transform",function(a){return"translate("+(i.scale(a.x)+z())+","+j.scale(a.y)+")"}),b.exit().transition().duration(m).style("opacity",0).remove()};var x={},y={};x.bar=function(){},x.scatter=function(a){a.data.svg.selectAll("circle").transition().duration(m/2).attr("r",7)},x.area=function(){},x.line=function(){},y.bar=function(){},y.scatter=function(a){a.data.svg.selectAll("circle").transition().duration(m/2).attr("r",5)},y.area=function(){},y.line=function(){};var z=function(){return"ordinal"==i.type?i.scale.rangeBand()/2:0},A=function(a){var b,c,d=h/(7*a.length),e={};q.stacking.enabled?("ordinal"==i.type?(b=i.scale.rangeBand(),c=.6*b):(b=2.5*-d,c=d),a.forEach(function(a){a.data.values.forEach(function(a){a.height=g-j.scale(a.y),e[a.x]=e[a.x]||g,e[a.x]-=a.height,a.xPos=i.scale(a.x)+.2*b,a.yPos=e[a.x],a.width=c})})):(b="ordinal"==i.type?d3.scale.ordinal().domain(a.map(function(a){return a.data.label})).rangeRoundBands([0,i.scale.rangeBand()],.05,.3):d3.scale.ordinal().domain(a.map(function(a){return a.data.label})).rangeRoundBands([-d/2,d/2],.05,.3),c=b.rangeBand(),a.forEach(function(a){a.data.values.forEach(function(d){d.xPos=i.scale(d.x)+b(a.data.label),d.height=g-j.scale(d.y),d.yPos=g-d.height,d.width=c})}))},B=function(a){a.forEach(function(a){a.area=d3.svg.area().x(function(a){return i.scale(a.x)+z()}).y0(g).y1(function(a){return j.scale(a.y)}),interpolationType=a.data.type.split(",")[1],interpolationType&&a.area.interpolate(interpolationType),a.modifiedData=a.data})},C={};return C.select=function(a){return l=d3.select(a),k=!0,C},C.selection=function(a){return arguments.length?(l=a,k=!0,C):l},C.xScale=function(a){return arguments.length?(i.type=a.type,i.domain=a.domain,k=!0,"linear"==a.type?i.scale=d3.scale.linear():"ordinal"==a.type&&(i.scale=d3.scale.ordinal()),a.domain?i.scale.domain(a.domain):i.domain="auto",C):i},C.yScale=function(a){return arguments.length?(j.type=a.type,j.domain=a.domain,k=!0,"linear"==a.type?j.scale=d3.scale.linear():"ordinal"==a.type&&(j.scale=d3.scale.ordinal()),a.domain?j.scale.domain(a.domain):j.domain="auto",C):j},C.width=function(a){return arguments.length?(d=a,C):d},C.height=function(a){return arguments.length?(e=a,C):e},C.margin=function(a){return arguments.length?(a.left&&(f.left=a.left),a.right&&(f.right=a.right),a.top&&(f.top=a.top),a.bottom&&(f.bottom=a.bottom),C):f},C.controls=function(a){return arguments.length?(a.yAxisLock&&(q.yAxisLock.visible=null!=a.yAxisLock.visible?a.yAxisLock.visible:q.yAxisLock.visible,q.yAxisLock.enabled=null!=a.yAxisLock.enabled?a.yAxisLock.enabled:q.yAxisLock.enabled,q.yAxisLock.maxStacked=null!=a.yAxisLock.maxStacked?a.yAxisLock.maxStacked:q.yAxisLock.maxStacked,q.yAxisLock.maxNonStacked=null!=a.yAxisLock.maxNonStacked?a.yAxisLock.maxNonStacked:q.yAxisLock.maxNonStacked),a.stacking&&(q.stacking.visible=null!=a.stacking.visible?a.stacking.visible:q.stacking.visible,q.stacking.enabled=null!=a.stacking.enabled?a.stacking.enabled:q.stacking.enabled),C):q},C.animationDuration=function(a){return arguments.length?(m=a,b.animationDuration(m),c.animationDuration(m),C):m},C.xFormat=function(a){return arguments.length?(o=AD.UTILS.numberFormat(a),C):o},C.yFormat=function(a){return arguments.length?(p=AD.UTILS.numberFormat(a),C):p},C.data=function(a,b){return arguments.length?(b&&(s={columns:{},labels:{x:"",y:""}},k=!0),a.data.columns.forEach(function(a){var b;s.columns[a.label]?(b=s.columns[a.label],b.data.values=a.values||b.data.values,b.data.type=a.type||b.data.type,b.replace=a.replace||!1,b.newType=a.type?a.type.split(",")[0]:b.oldType):(b=s.columns[a.label]={data:a,newType:a.type.split(",")[0],oldType:null},k||(b.svg=l.group.columns[a.type.split(",")[0]+"_columns"].append("g")))}),a.data.labels&&(s.labels=a.data.labels),C):s},C.generate=function(a){k=!1,l.selectAll("*").remove(),l.svg=l.append("svg").attr("class","ad-axis-chart ad-svg ad-container"),l.group=l.svg.append("g"),l.group.axes=l.group.append("g").attr("class","ad-axes"),l.group.axes.x=l.group.axes.append("g").attr("class","ad-x ad-axis"),l.group.axes.y=l.group.axes.append("g").attr("class","ad-y ad-axis"),l.group.axes.xLabel=l.group.axes.append("g").attr("class","ad-x-label").append("text"),l.group.axes.yLabel=l.group.axes.append("g").attr("class","ad-y-label").append("text"),l.group.columns=l.group.append("g").attr("class","ad-columns"),v.forEach(function(a){l.group.columns[a+"_columns"]=l.group.columns.append("g").attr("class","ad-"+a+"-columns")});for(key in s.columns)s.columns[key].svg=l.group.columns[s.columns[key].newType+"_columns"].append("g");l.controls=l.group.append("g").attr("class","ad-controls"),c=new AD.UTILS.CONTROLS.horizontalControls,c.selection(l.controls).on("elementChange",function(a){q[a.key].enabled=a.state,C.update()}),l.legend=l.group.append("g").attr("class","ad-legend"),b=new AD.UTILS.LEGENDS.horizontalLegend,b.color(r).selection(l.legend).on("elementMouseover",function(a){x[a.data.newType]&&(x[a.data.newType](a),a.data.svg.classed("ad-legend-mouseover",!0))}).on("elementMouseout",function(a){x[a.data.newType]&&(y[a.data.newType](a),a.data.svg.classed("ad-legend-mouseover",!1))});var d=m;return C.animationDuration(0),C.update(a),C.animationDuration(d),C},C.update=function(r){if(k)return C.generate(r);n=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),n.bottom+=20,n.left+=20;var v=AD.UTILS.getValues(s.columns),x=v.filter(function(a){return"bar"==a.newType}),y=v.filter(function(a){return"area"==a.newType});h=d-f.left-f.right-n.right-n.left;var z={data:{items:v.filter(function(a){return"none"!=a.newType}).map(function(a){return{label:a.data.label,type:a.newType,data:a}}).sort(function(a,b){return a.label-b.label})}};b.width(h).data(z).update(),n.bottom+=b.computedHeight();var D=AD.UTILS.getValues(q).filter(function(a){return a.visible});D.map(function(a){a.data={state:a.enabled,label:a.label,key:a.key}}),c.width(h).data(D).update(),n.top+=c.computedHeight(),g=e-f.top-f.bottom-n.top-n.bottom;var E=[],F=[];v.forEach(function(a){a.data.values&&a.newType&&a.data.values.forEach(function(a){E.push(a.x),F.push(a.y)})});var G={};q.stacking.enabled&&(x.forEach(function(a){a.data.values.forEach(function(a){G[a.x]||(G[a.x]=0),G[a.x]+=a.y})}),F=F.concat(AD.UTILS.getValues(G))),"linear"==i.type?(i.scale.range([0,h]),"auto"==i.domain&&(vals=[],i.scale.domain(AD.UTILS.AXISCHARTS.getDomainLinear(E)))):"ordinal"==i.type&&(i.scale.rangeRoundBands([0,h],.1),"auto"==i.domain&&i.scale.domain(AD.UTILS.AXISCHARTS.getDomainOrdinal(E)));var H=[0,0];H=q.yAxisLock.enabled?q.stacking.enabled?[0,q.yAxisLock.maxStacked]:[0,q.yAxisLock.maxNonStacked]:AD.UTILS.AXISCHARTS.getDomainLinear(F),j.scale.range([g,0]),"auto"==j.domain&&j.scale.domain(H),l.svg.attr("width",d).attr("height",e),j.scale.nice(5);var I=d3.svg.axis().scale(i.scale).orient("bottom").tickFormat(o),J=d3.svg.axis().scale(j.scale).orient("left").tickFormat(p);l.group.axes.y.transition().duration(m).call(J);var K=0;d3.select(".ad-y.ad-axis").selectAll(".tick text").each(function(){K<this.getComputedTextLength()&&(K=this.getComputedTextLength())}),n.left+=K,h=d-f.left-f.right-n.right-n.left,"linear"==i.type?i.scale.range([0,h]):"ordinal"==i.type&&i.scale.rangeRoundBands([0,h],.1),I.tickSize(-g),J.tickSize(-h),l.group.transition().duration(m),l.group.axes.x.transition().duration(m).attr("transform","translate("+(f.left+n.left)+","+(f.top+n.top+g)+")").call(I),l.group.axes.y.transition().duration(m).attr("transform","translate("+(f.left+n.left)+","+(f.top+n.top)+")").call(J),a="ordinal"==i.type?d3.scale.ordinal().domain(x.map(function(a){return a.data.label})).rangeRoundBands([0,i.scale.rangeBand()]):h/(20*x.length),l.group.axes.xLabel.transition().duration(m).text(s.labels.x).attr("transform","translate("+(f.left+n.left+h/2)+","+(g+30+(f.top+n.top))+")"),l.group.axes.yLabel.transition().duration(m).attr("transform","translate("+(f.left+n.left-K-10)+","+(g/2+(f.top+n.top))+"),rotate(-90)").text(s.labels.y),l.legend.transition().duration(m).attr("transform","translate("+(f.left+n.left+(h-b.computedWidth())/2)+","+(g+25+(f.top+n.top))+")"),l.controls.transition().duration(m).attr("transform","translate("+(f.left+n.left+h-c.computedWidth())+","+(-c.computedHeight()-10+(f.top+n.top))+")"),l.group.columns.transition().duration(m).attr("transform","translate("+(f.left+n.left)+","+(f.top+n.top)+")"),A(x),B(y),v.forEach(function(a){a.replace?t(a):"none"==a.newType?u(a):a.oldType?a.newType==a.oldType?w[a.newType](a,!1):t(a):w[a.newType](a,!0),a.oldType=a.newType});var L=y.map(function(a){return{column:a,maxY:d3.max(a.data.values.map(function(a){return a.y}))}});return L.sort(function(a,b){return b.maxY-a.maxY}),L.forEach(function(a){l.group.columns.area_columns.node().appendChild(a.column.svg.node())}),d3.timer.flush(),r&&r(),C},C},AD.CHARTS.sankeyChart=function(){var a,b=AD.CONSTANTS.DEFAULTWIDTH(),c=AD.CONSTANTS.DEFAULTHEIGHT(),d=c,e=b,f=!0,g=d3.select("body"),h=AD.CONSTANTS.ANIMATIONLENGTHS().normal,i=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),j=new AD.UTILS.LEGENDS.horizontalLegend,k=AD.CONSTANTS.DEFAULTCOLOR(),l={nodes:[],links:[]},m=30,n=15,o=20,p=1,q=function(a){return a},r={};return r.select=function(a){return g=d3.select(a),f=!0,r},r.selection=function(a){return arguments.length?(g=a,f=!0,r):g},r.width=function(a){return arguments.length?(b=a,r):b},r.height=function(a){return arguments.length?(c=a,r):c},r.animationDuration=function(a){return arguments.length?(h=a,j.animationDuration(h),r):h},r.xFormat=function(a){return arguments.length?(q=AD.UTILS.numberFormat(a),r):q},r.nodePadding=function(a){return arguments.length?(m=a,r):m},r.layout=function(a){return arguments.length?(o=a,r):o},r.minLinkWidth=function(a){return arguments.length?(p=a,r):p},r.data=function(a,b){return arguments.length?(b&&(l={nodes:[],links:[]},f=!0),a.data.nodes&&(l.nodes=a.data.nodes),a.data.links&&(l.links=a.data.links),a.data.labels&&(l.labels=a.data.labels),a.data.columnHeaders&&(l.columnHeaders=a.data.columnHeaders),r):l},r.generate=function(a){f=!1,g.selectAll("*").remove(),g.svg=g.append("svg").attr("class","ad-sankey-chart ad-svg ad-container"),g.group=g.svg.append("g"),g.group.sankey=g.group.append("g").attr("class","ad-sankey"),g.group.sankey.links=g.group.sankey.append("g").attr("class","ad-sankey-links"),g.group.sankey.nodes=g.group.sankey.append("g").attr("class","ad-sankey-nodes"),g.group.labels=g.group.append("g").attr("class","ad-sankey-labels"),g.group.labels.source=g.group.labels.append("g").attr("class","ad-sankey-label-source"),g.group.labels.source.text=g.group.labels.source.append("text").attr("y",23),g.group.labels.destination=g.group.labels.append("g").attr("class","ad-sankey-label-destination"),g.group.labels.destination.text=g.group.labels.destination.append("text").attr("y",23),g.group.columnHeaders=g.group.append("g").attr("class","ad-sankey-column-headers"),g.legend=g.group.append("g").attr("class","ad-legend"),j.color(k).selection(g.legend);var b=h;return r.animationDuration(0).update(a).animationDuration(b),r},r.update=function(s){if(f)return r.generate(s);i=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),e=b-i.right-i.left;var t={data:{items:d3.set(l.nodes.map(function(a){return a.colorKey?a.colorKey:a.name})).values().map(function(a){return{label:a}})}};j.width(e).data(t).update(),i.bottom+=j.computedHeight();var u={source:g.group.labels.source.transition().duration(h),destination:g.group.labels.destination.transition().duration(h)};l.labels?(g.group.labels.attr("transform","translate("+i.left+","+i.top+")"),l.labels.source?(u.source.style("opacity",1),g.group.labels.source.text.text(l.labels.source)):u.source.style("opacity",0),l.labels.destination?(u.destination.style("opacity",1),g.group.labels.destination.text.text(l.labels.destination)):u.destination.style("opacity",0),u.source.attr("transform","translate(0,0)"),u.destination.attr("transform","translate("+e+",0)"),i.top+=35):(u.source.style("opacity",0),u.destination.style("opacity",0));var v,w;l.columnHeaders&&l.columnHeaders.length>0&&(w=d3.scale.linear().domain([0,l.columnHeaders.length-1]).range([0,e-n]),g.group.columnHeaders.attr("transform","translate("+i.left+","+i.top+")"),v=g.group.columnHeaders.selectAll("g.ad-sankey-column-header").data(l.columnHeaders),v.enter().append("g").attr("class","ad-sankey-column-header").append("text").attr("y",16).attr("x",function(a,b){return 0==b?-n/2:b==l.columnHeaders.length-1?n/2:void 0}),v.select("text").text(function(a){return a}),v.transition().duration(h).attr("transform",function(a,b){return"translate("+(w(b)+n/2)+",0)"}),i.top+=25),d=c-i.top-i.bottom,g.legend.transition().duration(h).attr("transform","translate("+(i.left+(e-j.computedWidth())/2)+","+(d+i.top)+")"),a=d3.sankey().size([e,d]).nodeWidth(n).nodePadding(m).nodes(l.nodes).links(l.links).layout(o);var x=g.group.sankey.nodes.selectAll("g.ad-sankey-node").data(l.nodes,function(a,b){return a.key?a.key:b}),y=x.enter().append("g").attr("class","ad-sankey-node").on("mouseover",function(a){AD.UTILS.createGeneralTooltip(d3.select(this),"<b>"+a.name+"</b>",q(a.value))}).on("mouseout",function(){AD.UTILS.removeTooltip()});y.append("rect"),y.append("text");var z=x.select("text").text(function(a){return a.shortName});x.transition().duration(h).attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),x.select("rect").transition().duration(h).attr("width",a.nodeWidth()).attr("height",function(a){return a.dy}),z.transition().duration(h).style("text-anchor",function(a){return a.x<e/2?"start":"end"}).attr("x",function(b){return b.x<e/2?a.nodeWidth()+5:-5}).attr("y",function(a){return a.dy/2+5});var A=g.group.sankey.links.selectAll("g.ad-sankey-link").data(l.links,function(a,b){return a.key?a.key:b}),B=A.enter().append("g").attr("class","ad-sankey-link").on("mouseover",function(a){AD.UTILS.createGeneralTooltip(d3.select(this),"<b>"+a.source.name+' <i class="fa fa-arrow-right"></i> '+a.target.name+"</b>",q(a.value))}).on("mouseout",function(){AD.UTILS.removeTooltip()});return B.append("path"),B.append("text"),A.exit().transition().duration(h).style("opacity",0).remove(),x.exit().transition().duration(h).style("opacity",0).remove(),A.select("path").transition().duration(h).attr("d",a.link()).style("stroke-width",function(a){return Math.max(a.dy,p)
}).style("stroke",function(a){return k(a[a.colorBy].colorKey?a[a.colorBy].colorKey:a[a.colorBy].name)}),g.svg.attr("width",b).attr("height",c),g.group.sankey.attr("transform","translate("+i.left+","+i.top+")"),d3.timer.flush(),s&&s(),r},r},AD.CHARTS.pieChart=function(){var a=AD.CONSTANTS.DEFAULTWIDTH(),b=AD.CONSTANTS.DEFAULTHEIGHT(),c=b,d=a,e=!0,f=!0,g=d3.select("body"),h=AD.CONSTANTS.ANIMATIONLENGTHS().normal,i=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),j=new AD.UTILS.LEGENDS.horizontalLegend,k=AD.CONSTANTS.DEFAULTCOLOR(),l={},m=function(a){return a},n=0,o=Math.min(c,d)/2,p=d3.svg.arc().outerRadius(o).innerRadius(o*n),q=d3.layout.pie().value(function(a){return a.value}).sort(null),r=1,s=[],t={};return t.select=function(a){return g=d3.select(a),e=!0,t},t.selection=function(a){return arguments.length?(g=a,e=!0,t):g},t.width=function(b){return arguments.length?(a=b,t):a},t.height=function(a){return arguments.length?(b=a,t):b},t.animationDuration=function(a){return arguments.length?(h=a,j.animationDuration(h),t):h},t.xFormat=function(a){return arguments.length?(m=AD.UTILS.numberFormat(a),t):m},t.donutRatio=function(a){return arguments.length?(n=a,t):n},t.data=function(a,b){return arguments.length?(b&&(l={},e=!0),a.data.values&&(a.data.values.forEach(function(a,b){a.key||(a.key=Date.now()+b)}),l.values=a.data.values,r=d3.sum(l.values.map(function(a){return a.value})),s={data:{items:l.values}},f=!0),t):l},t.generate=function(a){e=!1,g.selectAll("*").remove(),g.svg=g.append("svg").attr("class","ad-pie-chart ad-svg ad-container"),g.group=g.svg.append("g"),g.group.pie=g.group.append("g").attr("class","ad-pie"),g.legend=g.group.append("g").attr("class","ad-legend"),j.color(k).selection(g.legend);var b=h;return t.animationDuration(0).update(a).animationDuration(b),t},t.update=function(u){if(e)return t.generate(u);i=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),d=a-i.right-i.left,j.width(d).data(s).update(),i.bottom+=j.computedHeight(),c=b-i.top-i.bottom,o=Math.min(c,d)/2,p.outerRadius(o).innerRadius(o*n),g.group.pie.transition().duration(h).attr("transform","translate("+d/2+","+c/2+")");var v=g.group.pie.datum(l.values).selectAll("g.ad-arc").data(q,function(a){return a.data.key}),w=v.enter().append("g").attr("class","ad-arc").style("opacity",0);v.transition().duration(h).style("opacity",1),w.append("path").each(function(a){this._current={},this._current.startAngle=0,this._current.endAngle=0,a.path=d3.select(this)}),w.append("text"),v.select("text").transition().duration(h).text(function(a){return d3.format("%")(a.data.value/r)}).attr("transform",function(a){var b=p.centroid(a);return"translate("+b[0]+","+b[1]+")"});var x=v.select("path");x.each(function(a){a.test="test"}).style("fill",function(a){return k(a.data.colorKey?a.data.colorKey:a.data.label)}).on("mouseover",null).on("mouseout",null);var y=x.transition().duration(h);return f?(f=!f,y.call(arcTween,p)):y.attr("d",p),y.each("end",function(){var a=d3.select(this);a.on("mouseover",function(b){a.transition().duration(AD.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("transform","scale(1.01)").style("fill-opacity",.9),AD.UTILS.createGeneralTooltip(a,"<b>"+b.data.label+"</b>",m(b.data.value))}).on("mouseout",function(){a.transition().duration(AD.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("transform","scale(1)").style("fill-opacity",""),AD.UTILS.removeTooltip()})}),v.exit().transition().duration(h).style("opacity",0).remove(),g.legend.transition().duration(h).attr("transform","translate("+(d-j.computedWidth())/2+","+c+")"),g.svg.attr("width",a).attr("height",b),g.group.attr("transform","translate("+i.left+","+i.top+")"),d3.timer.flush(),u&&u(),t},t},AD.CHARTS.interactiveBarChart=function(){var a,b,c,d=AD.CONSTANTS.DEFAULTWIDTH(),e=AD.CONSTANTS.DEFAULTHEIGHT(),f=e,g=d,h={horizontal:g,vertical:f},i={type:"linear",scale:d3.scale.linear(),domain:"auto"},j={type:"linear",scale:d3.scale.linear(),domain:"auto"},k={horizontal:i,vertical:j},l=!0,m=d3.select("body"),n=AD.CONSTANTS.ANIMATIONLENGTHS().normal,o=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),p=function(a){return a},q=function(a){return a},r={x:"x",y:"y",horizontal:"horizontal",vertical:"vertical",width:"width",height:"height",bottom:"bottom",left:"left"},s={yAxisLock:{label:"Lock Y-Axis",type:"checkbox",visible:!1,enabled:!1,maxStacked:AD.CONSTANTS.DEFAULTHEIGHT(),maxNonStacked:AD.CONSTANTS.DEFAULTHEIGHT()},stacking:{label:"Stack Bars",type:"checkbox",visible:!1,enabled:!1},horizontal:{label:"Horizontal",type:"checkbox",visible:!1,enabled:!1}},t=AD.CONSTANTS.DEFAULTCOLOR(),u={columns:{},labels:{x:"",y:""}},v=function(a){var b=a.svg;b.transition().duration(n).style("opacity",0).each("end",function(){b.remove()})},w=function(a){var b=a.svg.selectAll("rect").data(a.data.values,function(a){return a.x});b.enter().append("rect").attr("class","ad-bar-rect").style("opacity",0).attr(r.height,0).attr(r.y,h[r.vertical]).on("mouseover",function(b){AD.UTILS.createGeneralTooltip(d3.select(this),"<b>"+a.key+" <i>("+p(b.x)+")</i></b> ",q(b.y))}).on("mouseout",function(){AD.UTILS.removeTooltip()}),b.style("fill",t(a.data.label)).style("opacity",1),b.transition().duration(n).attr(r.x,function(a){return a.xPos}).attr(r.y,function(a){return a.yPos}).attr(r.width,function(a){return a[r.width]}).attr(r.height,function(a){return a[r.height]}),b.exit().transition().duration(n).style("opacity",0).attr(r.height,0).attr(r.y,h.vertical).remove()},x=function(a){var b,c,d=g/(2*a.length),e={};s.stacking.enabled?("ordinal"==i.type?(b=k[r.horizontal].scale.rangeBand(),c=.6*b):(b=2.5*-d,c=d),a.forEach(function(a){a.data.values.forEach(function(a){s.horizontal.enabled?(a[r.height]=k[r.vertical].scale(a.y),e[a.x]=e[a.x]||0,a.xPos=k[r.horizontal].scale(a.x)+.2*b,a.yPos=e[a.x],e[a.x]+=a[r.height],a[r.width]=c):(a[r.height]=h[r.vertical]-k[r.vertical].scale(a.y),e[a.x]=e[a.x]||h[r.vertical],e[a.x]-=a[r.height],a.xPos=k[r.horizontal].scale(a.x)+.2*b,a.yPos=e[a.x],a[r.width]=c)})})):(b="ordinal"==i.type?d3.scale.ordinal().domain(a.map(function(a){return a.data.label})).rangeRoundBands([0,i.scale.rangeBand()],.05,0):d3.scale.ordinal().domain(a.map(function(a){return a.data.label})).rangeRoundBands([-d/2,d/2],.05,.3),c=b.rangeBand(),a.forEach(function(a){a.data.values.forEach(function(d){s.horizontal.enabled?(d.xPos=k[r.horizontal].scale(d.x)+b(a.data.label),d[r.height]=j.scale(d.y),d.yPos=0,d[r.width]=c):(d.xPos=k[r.horizontal].scale(d.x)+b(a.data.label),d[r.height]=h[r.vertical]-j.scale(d.y),d.yPos=h[r.vertical]-d[r.height],d[r.width]=c)})}))},y={};return y.select=function(a){return m=d3.select(a),l=!0,y},y.selection=function(a){return arguments.length?(m=a,l=!0,y):m},y.xScale=function(a){return arguments.length?(i.type=a.type,i.domain=a.domain,l=!0,"linear"==a.type?i.scale=d3.scale.linear():"ordinal"==a.type&&(i.scale=d3.scale.ordinal()),a.domain||(i.domain="auto"),y):i},y.yScale=function(a){return arguments.length?(j.type=a.type,j.domain=a.domain,l=!0,"linear"==a.type?j.scale=d3.scale.linear():"ordinal"==a.type&&(j.scale=d3.scale.ordinal()),a.domain||(j.domain="auto"),y):j},y.width=function(a){return arguments.length?(d=a,y):d},y.height=function(a){return arguments.length?(e=a,y):e},y.controls=function(a){return arguments.length?(a.yAxisLock&&(s.yAxisLock.visible=null!=a.yAxisLock.visible?a.yAxisLock.visible:s.yAxisLock.visible,s.yAxisLock.enabled=null!=a.yAxisLock.enabled?a.yAxisLock.enabled:s.yAxisLock.enabled,s.yAxisLock.maxStacked=null!=a.yAxisLock.maxStacked?a.yAxisLock.maxStacked:s.yAxisLock.maxStacked,s.yAxisLock.maxNonStacked=null!=a.yAxisLock.maxNonStacked?a.yAxisLock.maxNonStacked:s.yAxisLock.maxNonStacked),a.stacking&&(s.stacking.visible=null!=a.stacking.visible?a.stacking.visible:s.stacking.visible,s.stacking.enabled=null!=a.stacking.enabled?a.stacking.enabled:s.stacking.enabled),a.horizontal&&(s.horizontal.visible=null!=a.horizontal.visible?a.horizontal.visible:s.horizontal.visible,s.horizontal.enabled=null!=a.horizontal.enabled?a.horizontal.enabled:s.horizontal.enabled),y):s},y.animationDuration=function(a){return arguments.length?(n=a,b.animationDuration(n),c.animationDuration(n),y):n},y.xFormat=function(a){return arguments.length?(p=AD.UTILS.numberFormat(a),y):p},y.yFormat=function(a){return arguments.length?(q=AD.UTILS.numberFormat(a),y):q},y.data=function(a,b){return arguments.length?(b&&(u={columns:{},labels:{x:"",y:""}},l=!0),a.data.columns.forEach(function(a){var b;u.columns[a.label]?(b=u.columns[a.label],b.data.values=a.values||b.data.values,b.type=a.type):(b=u.columns[a.label]={data:a,type:a.type},l||(b.svg=m.group.columns.append("g"))),"none"==b.type&&(v(b),delete u.columns[a.label])}),a.data.labels&&(u.labels=a.data.labels),y):u},y.generate=function(a){l=!1,m.selectAll("*").remove(),m.svg=m.append("svg").attr("class","ad-interactive-bar-chart ad-svg ad-container"),m.group=m.svg.append("g"),m.group.axes=m.group.append("g").attr("class","ad-axes"),m.group.axes.x=m.group.axes.append("g").attr("class","ad-x ad-axis"),m.group.axes.y=m.group.axes.append("g").attr("class","ad-y ad-axis"),m.group.axes.xLabel=m.group.axes.append("g").attr("class","ad-x-label").append("text"),m.group.axes.yLabel=m.group.axes.append("g").attr("class","ad-y-label").append("text"),m.group.columns=m.group.append("g").attr("class","ad-columns");for(key in u.columns)u.columns[key].svg=m.group.columns.append("g");m.controls=m.group.append("g").attr("class","ad-controls"),c=new AD.UTILS.CONTROLS.horizontalControls,c.selection(m.controls).on("elementChange",function(a){s[a.key].enabled=a.state,y.update()}),m.legend=m.group.append("g").attr("class","ad-legend"),b=new AD.UTILS.LEGENDS.horizontalLegend,b.color(t).selection(m.legend).on("elementMouseover",function(a){m.group.columns.selectAll("rect").transition().duration(n/2).style("opacity",.35),a.data.svg.selectAll("rect").transition().duration(0).style("opacity",1)}).on("elementMouseout",function(){m.group.columns.selectAll("rect").transition().duration(n/4).style("opacity",1)});var d=n;return y.animationDuration(0),y.update(a),y.animationDuration(d),y},y.update=function(t){if(l)return y.generate(t);o=AD.CONSTANTS.DEFAULTFORCEDMARGIN(),o.bottom+=20,o.left+=20,s.horizontal.enabled?(k={horizontal:j,vertical:i},r={x:"y",y:"x",horizontal:"vertical",vertical:"horizontal",width:"height",height:"width",bottom:"left",left:"bottom"}):(k={horizontal:i,vertical:j},r={x:"x",y:"y",horizontal:"horizontal",vertical:"vertical",width:"width",height:"height",bottom:"bottom",left:"left"});var v=AD.UTILS.getValues(u.columns);g=d-o.right-o.left;var z={data:{items:v.map(function(a){return{label:a.data.label,data:a}}).sort(function(a,b){return a.label-b.label})}};b.width(g).data(z).update(),o.bottom+=b.computedHeight();var A=AD.UTILS.getValues(s).filter(function(a){return a.visible});A.map(function(a){a.data={state:a.enabled,label:a.label,key:a.key}}),c.width(g).data(A).update(),o.top+=c.computedHeight(),f=e-o.top-o.bottom,h={horizontal:g,vertical:f};var B=[],C=[],D={};s.stacking.enabled?(v.forEach(function(a){a.data.values.forEach(function(a){D[a.x]||(D[a.x]=0),D[a.x]+=a.y,B.push(a.x),C.push(a.y)})}),C=C.concat(AD.UTILS.getValues(D))):v.forEach(function(a){a.data.values&&a.data.values.forEach(function(a){B.push(a.x),C.push(a.y)})});var E={};"ordinal"==k[r.horizontal].type?(k[r.horizontal].scale.rangeRoundBands([0,h[r.horizontal]],.1),E[r.horizontal]=AD.UTILS.AXISCHARTS.getDomainOrdinal(B).sort()):(k[r.horizontal].scale.range([0,h[r.horizontal]]),E[r.horizontal]=AD.UTILS.AXISCHARTS.getDomainLinear(B)),E[r.vertical]=s.yAxisLock.enabled?s.stacking.enabled?[0,s.yAxisLock.maxStacked]:[0,s.yAxisLock.maxNonStacked]:AD.UTILS.AXISCHARTS.getDomainLinear(C),k[r.vertical].scale.range([h[r.vertical],0]),k[r.horizontal].scale.domain("auto"==k[r.horizontal].domain?E[r.horizontal]:k[r.horizontal].domain),k[r.vertical].scale.domain("auto"==k[r.vertical].domain?E[r.vertical]:k[r.vertical].domain),s.horizontal.enabled&&k[r.vertical].scale.domain(k[r.vertical].scale.domain().reverse()),m.svg.attr("width",d).attr("height",e),k[r.vertical].scale.nice(5);var F={x:d3.svg.axis().scale(k[r.horizontal].scale).orient(r.bottom).tickFormat(p),y:d3.svg.axis().scale(k[r.vertical].scale).orient(r.left).tickFormat(q)};m.group.axes[r.y].transition().duration(n).call(F[r.y]);var G=0;return m.group.axes[r.y].selectAll(".tick text").each(function(){G<this.getComputedTextLength()&&(G=this.getComputedTextLength())}),o.left+=G,g=d-o.right-o.left,h.horizontal=g,s.horizontal.enabled?"linear"==k.horizontal.type?k.horizontal.scale.range([h.horizontal,0]):"ordinal"==k.horizontal.type&&k.horizontal.scale.rangeRoundBands([h.horizontal,0],.1):"linear"==k.horizontal.type?k.horizontal.scale.range([0,h.horizontal]):"ordinal"==k.horizontal.type&&k.horizontal.scale.rangeRoundBands([0,h.horizontal],.1),F.x.tickSize(-h[r.vertical]),F.y.tickSize(-h[r.horizontal]),m.group.axes[r.x].transition().duration(n).attr("transform","translate("+o.left+","+(o.top+f)+")").call(F[r.x]),m.group.axes[r.y].transition().duration(n).attr("transform","translate("+o.left+","+o.top+")").call(F[r.y]),a="ordinal"==k[r.horizontal].type?d3.scale.ordinal().domain(v.map(function(a){return a.data.label})).rangeRoundBands([0,k[r.horizontal].scale.rangeBand()]):h[r.horizontal]/(20*v.length),m.group.axes[r.x+"Label"].transition().duration(n).text(u.labels[r.x]).attr("transform","translate("+(o.left+g/2)+","+(f+30+o.top)+")"),m.group.axes[r.y+"Label"].transition().duration(n).attr("transform","translate("+(o.left-G-10)+","+(f/2+o.top)+"),rotate(-90)").text(u.labels[r.y]),m.legend.transition().duration(n).attr("transform","translate("+(o.left+(g-b.computedWidth())/2)+","+(f+25+o.top)+")"),m.controls.transition().duration(n).attr("transform","translate("+(o.left+g-c.computedWidth())+","+(-c.computedHeight()-10+o.top)+")"),m.group.columns.transition().duration(n).attr("transform","translate("+o.left+","+o.top+")"),x(v),v.forEach(function(a){w(a)}),d3.timer.flush(),t&&t(),y},y},AD.CHARTS.iframeChart=function(){var a=AD.CONSTANTS.DEFAULTWIDTH(),b=AD.CONSTANTS.DEFAULTHEIGHT(),c=!0,d=d3.select("body"),e=AD.CONSTANTS.ANIMATIONLENGTHS().normal,f=(AD.CONSTANTS.DEFAULTFORCEDMARGIN(),AD.CONSTANTS.DEFAULTCOLOR(),{}),g={};return g.select=function(a){return d=d3.select(a),c=!0,g},g.selection=function(a){return arguments.length?(d=a,c=!0,g):d},g.width=function(b){return arguments.length?(a=b,g):a},g.height=function(a){return arguments.length?(b=a,g):b},g.animationDuration=function(a){return arguments.length?(e=a,g):e},g.data=function(a,b){return arguments.length?(b&&(f={},c=!0),f=a.data,g):f},g.generate=function(a){c=!1,d.selectAll("*").remove(),d.div=d.append("div").attr("class","ad-iframe-chart ad-container"),d.div.iframe=d.div.append("iframe").attr("class","ad-iframe");var b=e;return g.animationDuration(0).update(a).animationDuration(b),g},g.update=function(h){return c?g.generate(h):(d.div.iframe.attr("src",f.url).transition().duration(e).attr("width",a).attr("height",b),d3.timer.flush(),h&&h(),g)},g},AD.DASHBOARDS.dashboard=function(){var a=AD.CONSTANTS.DEFAULTWIDTH(),b=AD.CONSTANTS.DEFAULTMARGIN(),c=a-200,d=!0,e=d3.select("body"),f=AD.CONSTANTS.ANIMATIONLENGTHS().normal,g=(AD.CONSTANTS.DEFAULTFORCEDMARGIN(),new AD.UTILS.chartPage),h={};h.array=[],h.position=-1,h.pushNew=function(a){h.array=h.array.slice(0,h.position+1),h.position++,h.array.push({category:a.category,section:a.section})};var i={section:{},category:{}},j=!0,k={},l=AD.CONSTANTS.DEFAULTPALETTE,m=function(a){a&&a.forEach(function(a){a.charts&&a.charts.forEach(function(a){a.chart=k.dashboard.charts[a.reference]})})},n=function(a,b,c){b.forEach(function(b){m(b.categories),b.position=a.concat([{section:b,sectionGroup:c}]),b.sections&&n(a.concat([{section:b,sectionGroup:c}]),b.sections),b.sectionGroups&&o(a.concat([{section:b,sectionGroup:c}]),b.sectionGroups)})},o=function(a,b){b.forEach(function(b){b.sections&&n(a,b.sections,b)})},p=function(a){for(chart in a.dashboard.charts)AD.UTILS.chartAdapter(a.dashboard.charts[chart].type,a.dashboard.charts[chart]);n([],[a.dashboard.topSection])},q=function(){e.container.content.breadcrumbs.svg.selectAll(".ad-breadcrumb-sub-section-group-section").transition().duration(f/2).style("opacity",0),e.container.content.breadcrumbs.svg.selectAll(".ad-breadcrumb").each(function(){this.expanded=!1}),e.container.content.breadcrumbs.svg.style("height","30px")},r=function(){var a=9,b=e.container.content.breadcrumbs.svg.selectAll("g.ad-breadcrumb").data(i.section.position,function(a){return a.section.name}),c=b.enter().append("g").style("opacity",0).attr("class","ad-breadcrumb");c.append("path").style("fill",l.primary),c.append("text").text(function(a){return a.section.name}).attr("y",21).attr("x",15),b.each(function(c,d){var g,h=this,j=d3.select(h),k=j.select("text"),m=j.select("path"),n=k.node().getBBox().width+25;if(j.select("g.ad-breadcrumb-triangle").remove(),c.section!=i.section?j.classed("ad-innactive",!1).on("click",function(a){w(a.section)}):j.classed("ad-innactive",!0).on("click",function(){}),c.sectionGroup){var o=j.selectAll("g.ad-breadcrumb-sub-section-group-section").data(c.sectionGroup.sections.filter(function(a){return a!=c.section}));h.dyExpanded=0,h.expanded=!1;var p=o.enter().append("g").style("opacity",0).attr("class","ad-breadcrumb-sub-section-group-section");p.append("path"),p.append("text").attr("y",21).attr("x",15).text(function(a){return a.name}),o.each(function(){var b=d3.select(this),c=b.select("path"),d=b.select("text"),e=d.node().getBBox().width+25;c.attr("d","M 0 0 L "+a+" 15 L 0 30 L "+e+" 30 L "+(e+a)+" 15 L "+e+" 0 L 0 0")}).on("click",function(a){d3.event.stopPropagation(),w(a)}).attr("transform",function(a,b){return"translate(0,"+34*(b+1)+")"}),h.dyExpanded=34*(o.size()+5),n+=15,g=j.append("g").attr("class","ad-breadcrumb-triangle").on("click",function(){d3.event.stopPropagation(),h.expanded?(o.transition().duration(f/2).style("opacity",0),e.container.content.breadcrumbs.svg.style("height","30px")):(q(),e.container.content.breadcrumbs.svg.style("height",Math.max(30,h.dyExpanded)+"px"),o.transition().duration(f/2).delay(function(a,b){return 20*b}).style("opacity",1)),h.expanded=!h.expanded}),g.append("rect").attr("width",20).attr("height",30).style("fill",d3.rgb(l.primary).darker(2)).attr("transform","translate("+(n-20)+",0)"),g.append("path").attr("d","M 0 0 L 9 0 L 4.5 5 L 0 0").style("fill","white").attr("transform","translate("+(n-15)+",13)")}var r=a,s=a;0==d&&(r=0),d+1==b.size()&&(s=0),m.transition().duration(f).attr("d","M 0 0 L "+r+" 15 L 0 30 L "+n+" 30 L "+(n+s)+" 15 L "+n+" 0 L 5 0"),this.dx=n});var d=0;b.transition().duration(f).attr("transform",function(){var a="translate("+d+",0)";return d+=this.dx+2,a}).style("opacity",1),b.exit().transition().duration(f).style("opacity",0).remove()},s=function(){if(!i.section.categories||i.section.categories.length<1)return void e.container.header.navigation.categoryTabs.style("display","none").selectAll("*").remove();e.container.header.navigation.categoryTabs.style("display","");var a=e.container.header.navigation.categoryTabs.selectAll("li.ad-category-tab").data(i.section.categories);a.enter().append("li").attr("class","ad-category-tab").on("click",x),a.text(function(a){return a.name}).each(function(a){a==i.category?d3.select(this).classed("ad-innactive",!0).on("click",function(){}):d3.select(this).classed("ad-innactive",!1).on("click",x)}),a.exit().transition().duration(f).style("opacity",0).remove()},t=function(){if(!i.section.sections||i.section.sections.length<1)return void e.container.sidebar.subSections.style("display","none").selectAll("*").remove();e.container.sidebar.subSections.style("display","");var a=e.container.sidebar.subSections.selectAll("li.ad-sub-section").data(i.section.sections);a.enter().append("li").style("opacity",0).attr("class","ad-sub-section").on("click",w),a.text(function(a){return a.name}).transition().duration(f).style("opacity",1),a.exit().transition().duration(f).style("opacity",0).remove()},u=function(){if(!i.section.sectionGroups||i.section.sectionGroups.length<1)return void e.container.sidebar.subSectionGroups.style("display","none").selectAll("*").remove();var a=i.section.sectionGroups.filter(function(a){return a.sections.length>0});if(a.length<1)return void e.container.sidebar.subSectionGroups.style("display","none").selectAll("*").remove();e.container.sidebar.subSectionGroups.style("display","");var b=e.container.sidebar.subSectionGroups.selectAll("li.ad-sub-section-group").data(a);b.enter().append("li").style("opacity",0).attr("class","ad-sub-section-group"),b.transition().duration(f).style("opacity",1),b.text(function(a){return a.name}).each(v),b.exit().transition().duration(f).style("opacity",0).remove()},v=function(a){if(a.sections&&!(a.sections.length<1)){var b=d3.select(this);b.selectAll("*").remove();var c=b.append("ul").datum(a).attr("class","ad-sub-section-group-sections"),d=c.selectAll("li.ad-sub-section-group-section").data(function(a){return a.sections});d.enter().append("li").attr("class","ad-sub-section-group-section"),d.on("click",w),d.text(function(a){return a.name})}},w=function(a){q(),i.section=a;var b=a.categories.filter(function(a){return a.name==i.category.name});return x(b.length>0?b[0]:a.categories[0])},x=function(a){return i.category=a,h.pushNew(i),g.animationType("forward").data({data:i.category}).update(),y.update()},y={};return y.select=function(a){return e=d3.select(a),d=!0,y},y.selection=function(a){return arguments.length?(e=a,d=!0,y):e},y.width=function(b){return arguments.length?(a=b,c=a-200,g.width(c-10),j=!0,y):a},y.margin=function(a){return arguments.length?(a.left&&(b.left=a.left),a.right&&(b.right=a.right),a.top&&(b.top=a.top),a.bottom&&(b.bottom=a.bottom),y):b},y.palette=function(a){return arguments.length?(l=a,y):l},y.animationDuration=function(a){return arguments.length?(f=a,g.animationDuration(f),y):f},y.data=function(a,b){return arguments.length?(b&&(d=!0,k={}),k=a,p(k),y):f},y.generate=function(a){d=!1,e.selectAll("*").remove(),e.container=e.append("div").attr("class","ad-dashboard ad-container"),e.container.header=e.container.append("div").attr("class","ad-header"),e.container.header.navigation=e.container.header.append("div").attr("class","ad-navigation"),e.container.header.navigation.home=e.container.header.navigation.append("div").attr("class","ad-navigation-home"),e.container.header.navigation.home.append("i").attr("class","fa fa-home"),e.container.header.navigation.arrows=e.container.header.navigation.append("div").attr("class","ad-navigation-arrows"),e.container.header.navigation.arrows.left=e.container.header.navigation.arrows.append("div").attr("id","ad-left-arrow"),e.container.header.navigation.arrows.right=e.container.header.navigation.arrows.append("div").attr("id","ad-right-arrow"),e.container.header.navigation.arrows.left.append("i").attr("class","fa fa-chevron-left"),e.container.header.navigation.arrows.right.append("i").attr("class","fa fa-chevron-right"),e.container.header.navigation.categoryTabs=e.container.header.navigation.append("ul").attr("class","ad-category-tabs"),e.container.sidebar=e.container.append("div").attr("class","ad-dashboard-sidebar"),e.container.sidebar.subSections=e.container.sidebar.append("ul").attr("class","ad-sub-sections"),e.container.sidebar.subSectionGroups=e.container.sidebar.append("ul").attr("class","ad-sub-section-groups"),e.container.content=e.container.append("div").attr("class","ad-dashboard-content"),e.container.content.breadcrumbs=e.container.content.append("div").attr("class","ad-navigation-breadcrumbs"),e.container.content.breadcrumbs.svg=e.container.content.breadcrumbs.append("svg").attr("class","ad-navigation-breadcrumbs-svg"),e.container.content.chartPage=e.container.content.append("div").attr("class","ad-dashboard-chart-page"),g.selection(e.container.content.chartPage),w(k.dashboard.topSection);return y.update(a),y},y.update=function(b){return d?y.generate(b):(e.container.content.style("width",c+"px"),i.section==k.dashboard.topSection?e.container.header.navigation.home.classed("ad-innactive",!0).on("click",function(){}):e.container.header.navigation.home.classed("ad-innactive",!1).on("click",function(){w(k.dashboard.topSection)}),h.position+1==h.array.length?e.container.header.navigation.arrows.right.classed("ad-innactive",!0).on("click",function(){}):e.container.header.navigation.arrows.right.classed("ad-innactive",!1).on("click",function(){h.position++,i={category:h.array[h.position].category,section:h.array[h.position].section},q(),g.animationType("forward").data({data:i.category}).update(),y.update()}),0==h.position?e.container.header.navigation.arrows.left.classed("ad-innactive",!0).on("click",function(){}):e.container.header.navigation.arrows.left.classed("ad-innactive",!1).on("click",function(){h.position--,i={category:h.array[h.position].category,section:h.array[h.position].section},q(),g.animationType("backward").data({data:i.category}).update(),y.update()}),e.container.transition().delay(f).duration(f).style("width",a+"px"),s(),r(),t(),u(),j&&(j=!1,g.update()),d3.timer.flush(),b&&b(),y)},y},d3.sankey=function(){function a(){n.forEach(function(a){a.sourceLinks=[],a.targetLinks=[]}),o.forEach(function(a){var b=a.source,c=a.target;"number"==typeof b&&(b=a.source=n[a.source]),"number"==typeof c&&(c=a.target=n[a.target]),b.sourceLinks.push(a),c.targetLinks.push(a)})}function b(){n.forEach(function(a){a.value=Math.max(d3.sum(a.sourceLinks,i),d3.sum(a.targetLinks,i))})}function c(){for(var a,b=n,c=0;b.length;)a=[],b.forEach(function(b){b.x=c,b.dx=k,b.sourceLinks.forEach(function(b){a.indexOf(b.target)<0&&a.push(b.target)})}),b=a,++c;d(c),e((m[0]-k)/(c-1))}function d(a){n.forEach(function(b){b.sourceLinks.length||(b.x=a-1)})}function e(a){n.forEach(function(b){b.x*=a})}function f(a){function b(){var a=d3.min(g,function(a){return(m[1]-(a.length-1)*l)/d3.sum(a,i)});g.forEach(function(b){b.forEach(function(b,c){b.y=c,b.dy=b.value*a})}),o.forEach(function(b){b.dy=b.value*a})}function c(a){function b(a){return h(a.source)*a.value}g.forEach(function(c){c.forEach(function(c){if(c.targetLinks.length){var d=d3.sum(c.targetLinks,b)/d3.sum(c.targetLinks,i);c.y+=(d-h(c))*a}})})}function d(a){function b(a){return h(a.target)*a.value}g.slice().reverse().forEach(function(c){c.forEach(function(c){if(c.sourceLinks.length){var d=d3.sum(c.sourceLinks,b)/d3.sum(c.sourceLinks,i);c.y+=(d-h(c))*a}})})}function e(){g.forEach(function(a){var b,c,d,e=0,g=a.length;for(a.sort(f),d=0;g>d;++d)b=a[d],c=e-b.y,c>0&&(b.y+=c),e=b.y+b.dy+l;if(c=e-l-m[1],c>0)for(e=b.y-=c,d=g-2;d>=0;--d)b=a[d],c=b.y+b.dy+l-e,c>0&&(b.y-=c),e=b.y})}function f(a,b){return a.y-b.y}var g=d3.nest().key(function(a){return a.x}).sortKeys(d3.ascending).entries(n).map(function(a){return a.values});b(),e();for(var j=1;a>0;--a)d(j*=.99),e(),c(j),e()}function g(){function a(a,b){return a.source.y-b.source.y}function b(a,b){return a.target.y-b.target.y}n.forEach(function(c){c.sourceLinks.sort(b),c.targetLinks.sort(a)}),n.forEach(function(a){var b=0,c=0;a.sourceLinks.forEach(function(a){a.sy=b,b+=a.dy}),a.targetLinks.forEach(function(a){a.ty=c,c+=a.dy})})}function h(a){return a.y+a.dy/2}function i(a){return a.value}var j={},k=24,l=8,m=[1,1],n=[],o=[];return j.nodeWidth=function(a){return arguments.length?(k=+a,j):k},j.nodePadding=function(a){return arguments.length?(l=+a,j):l},j.nodes=function(a){return arguments.length?(n=a,j):n},j.links=function(a){return arguments.length?(o=a,j):o},j.size=function(a){return arguments.length?(m=a,j):m},j.layout=function(d){return a(),b(),c(),f(d),g(),j},j.relayout=function(){return g(),j},j.link=function(){function a(a){var c=a.source.x+a.source.dx,d=a.target.x,e=d3.interpolateNumber(c,d),f=e(b),g=e(1-b),h=a.source.y+a.sy+a.dy/2,i=a.target.y+a.ty+a.dy/2;return"M"+c+","+h+"C"+f+","+h+" "+g+","+i+" "+d+","+i}var b=.5;return a.curvature=function(c){return arguments.length?(b=+c,a):b},a},j};