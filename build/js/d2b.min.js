"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},d2b=d2b||{};!function(){d2b.version="0.0.1",d2b.createNameSpace=function(t){var e=t.split("."),n=d2b;"d2b"===e[0]&&(e=e.slice(1));for(var a=0;a<e.length;a++){var r=e[a];"undefined"==typeof n[r]&&(n[r]={}),n=n[r]}return n},d2b.createNameSpace("d2b.core"),d2b.createNameSpace("d2b.model"),d2b.createNameSpace("d2b.CHARTS"),d2b.createNameSpace("d2b.chart"),d2b.createNameSpace("d2b.UTILS"),d2b.createNameSpace("d2b.UTILS.CHARTPAGE"),d2b.createNameSpace("d2b.utils"),d2b.createNameSpace("d2b.UTILS.AXISCHART.TYPES"),d2b.createNameSpace("d2b.SVG"),d2b.createNameSpace("d2b.svg"),d2b.createNameSpace("d2b.CONSTANTS"),d2b.CONSTANTS={DEFAULTWIDTH:function(){return 960},DEFAULTHEIGHT:function(){return 540},DEFAULTMARGIN:function(){return{left:0,right:0,top:0,bottom:0}},DEFAULTFORCEDMARGIN:function(){return{left:30,bottom:20,right:30,top:20}},DEFAULTCOLOR:function(){return d3.scale.category10()},DEFAULTEVENTS:function(){return{elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){}}},ANIMATIONLENGTHS:function(){return{normal:500,"short":200,"long":1e3}}},d2b.CHARTS.axisChart=function(){var t={};t.width=d2b.CONSTANTS.DEFAULTWIDTH(),t.height=d2b.CONSTANTS.DEFAULTHEIGHT(),t.innerHeight=t.height,t.innerWidth=t.width,t.outerHeight=t.height,t.outerWidth=t.width,t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.generateRequired=!0,t.selection=d3.select("body"),t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={types:[],labels:{}},t.xFormat=function(t){return t},t.yFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.legend=d2b.UTILS.LEGENDS.legend().active(!0).color(t.color),t.legendOrientation="bottom",t.legendData={data:{items:[]}},t.controls=d2b.UTILS.CONTROLS.controls(),t.rotate=!1,t.controlsData={hideLegend:{label:"Hide Legend",type:"checkbox",visible:!1,enabled:!1},lockYAxis:{label:"Lock Y-Axis",type:"checkbox",visible:!1,enabled:!1,domain:[0,1]},lockXAxis:{label:"Lock X-Axis",type:"checkbox",visible:!1,enabled:!1,domain:[0,1]}};for(var e in d2b.UTILS.AXISCHART.TYPES)if(d2b.UTILS.AXISCHART.TYPES[e].tools){var n=d2b.UTILS.AXISCHART.TYPES[e].tools();if(n&&n.controlsData)for(var a in n.controlsData)t.controlsData[a]=n.controlsData[a]}t.tooltipLayout=0,t.tooltip=d2b.SVG.tooltip(),t.tooltip.update=function(){t.rotate||t.axis.x().axis.scale().rangeBand||t.axis.y().axis.scale().rangeBand?t.tooltip.layout(0):t.tooltip.layout(t.tooltipLayout),t.tooltip.x(t.axis.scale("x")).y(t.axis.scale("y")).start()},t.axis=d2b.SVG.axis(),t.pGraphData={},t.pTypeData={},t.graphs={},t.graphs.planes=["foreground","background"],t.graphs.filterVisible=function(t){return t.p.visible},t.graphs.init=function(){this.planes.forEach(function(e){t.selection.types[e].type.graph=t.selection.types[e].type.selectAll("g.d2b-axis-chart-"+e+"-graph").data(function(e){return e.graphs.filter(t.graphs.filterVisible)},function(t){return t.p.key}),t.selection.types[e].type.graph.enter().append("g").attr("class","d2b-axis-chart-"+e+"-graph").each(function(t){t.p[e]=this}).style("opacity",0),t.selection.types[e].type.graph.transition().duration(t.animationDuration).style("opacity",1),t.selection.types[e].type.graph.exit().transition().duration(t.animationDuration).style("opacity",0).remove()})},t.types={},t.types.planes=["foreground","background","general"],t.types.setProperties=function(){t.currentChartData.types.forEach(function(e){var n=e.graphs.filter(t.graphs.filterVisible),a=d3.selectAll(n.map(function(t){return t.p.background})),r=d3.selectAll(n.map(function(t){return t.p.foreground}));d2b.UTILS.applyProperties.call(e.p.d2bType,e.properties),e.p.d2bType.animationDuration(t.animationDuration).x(t.axis.scale("x").reversed(t.rotate)).y(t.axis.scale("y").reversed(t.rotate)).width(t.innerWidth).height(t.innerHeight).color(t.color).tooltipSVG(t.tooltip).xFormat(t.xFormat).yFormat(t.yFormat).general(d3.select(e.p.general)).foreground(r).background(a).data(n)})},t.types.filterVisible=function(e){return e.graphs.filter(t.graphs.filterVisible).length>0},t.types.init=function(){var e={};this.planes.forEach(function(n){t.selection.types[n].type=t.selection.types[n].selectAll("g.d2b-axis-type-"+n).data(t.currentChartData.types.filter(t.types.filterVisible),function(t){return t.type}),e[n]=t.selection.types[n].type.enter().append("g").attr("class",function(t){return"d2b-axis-type-"+n+" d2b-"+t.type}).each(function(t){t.p[n]=this}),t.selection.types[n].type.exit().transition().duration(t.animationDuration).style("opacity",0).remove()}),e.general.each(function(e){e.p.d2bType=d2b.UTILS.AXISCHART.TYPES[e.type](e.type).axisChart(r).controls(t.controlsData),t.events.translateEvents(e.p.d2bType)}),t.graphs.init(),this.setProperties()},t.types.update=function(){t.currentChartData.types.forEach(function(t){t.p.d2bType.update()})},t.axes={},t.axes.update=function(){this.setLabels(),this.setDomain(),t.rotate&&this.rotate(),t.axis.width(t.innerWidth).height(t.innerHeight),t.selection.axes.transition().duration(t.animationDuration).call(t.axis),t.rotate&&this.rotate();var e=t.axis.box();t.forcedMargin.left+=e.padding.left,t.forcedMargin.right+=e.padding.right,t.selection.types.transition().duration(t.animationDuration).attr("transform","translate("+e.padding.left+","+e.padding.top+")"),t.selection.types.tracker.transition().duration(t.animationDuration).attr("width",e.innerWidth).attr("height",e.innerHeight),d2b.UTILS.CHARTS.HELPERS.updateDimensions(t)},t.axes.rotate=function(){var e=t.axis.x().orientation,n=t.axis.x2().orientation,a=t.axis.y().orientation,r=t.axis.y2().orientation;t.axis.x({orientation:a}),t.axis.y({orientation:e}),t.axis.x2({orientation:r}),t.axis.y2({orientation:n});var o=t.axis.x().axis.scale().domain;o(o().reverse())},t.axes.setDomain=function(){var e=[],n=[],a=t.axis.x().axis.scale(),r=t.axis.y().axis.scale();t.currentChartData.types.forEach(function(t){t.p.d2bType.xValues&&(e=e.concat(t.p.d2bType.xValues())),t.p.d2bType.yValues&&(n=n.concat(t.p.d2bType.yValues()))}),t.controlsData.lockXAxis.enabled?a.domain(t.controlsData.lockXAxis.domain):a.domain(d2b.UTILS.domain(e,a,t.xPadding)),t.controlsData.lockYAxis.enabled?r.domain(t.controlsData.lockYAxis.domain):r.domain(d2b.UTILS.domain(n,r,t.yPadding))},t.axes.setLabels=function(){t.axis.x({labelOutside:t.currentChartData.labels.x}),t.axis.y({labelOutside:t.currentChartData.labels.y})},t.legend.updateData=function(){t.controlsData.hideLegend.enabled?t.legendData={data:{items:[]}}:t.legendData.data.items=[].concat.apply([],t.currentChartData.types.map(function(t){return t.graphs.filter(function(t){return!t.notInLegend}).map(function(t,e){return t.open=!t.p.visible,t})})),d2b.UTILS.CHARTS.HELPERS.updateLegend(t),!t.legend.computedHeight()||"left"!=t.legendOrientation&&"right"!=t.legendOrientation||(t.forcedMargin[t.legendOrientation]+=10)},t.legend.mouseover=function(e,n){if(n.p.visible){var a=[];a.push(n.p.background),a.push(n.p.foreground),a.push(n.type.p.background),a.push(n.type.p.foreground),a.push(n.type.p.general),a.forEach(function(t){t&&t.parentNode&&t.parentNode.appendChild(t)}),t.selection.types.foreground.type.graph.transition().duration(t.animationDuration/2).style("opacity",.2),t.selection.types.background.type.graph.transition().duration(t.animationDuration/2).style("opacity",.2),d3.select(n.p.background).transition().duration(t.animationDuration/2).style("opacity",1),d3.select(n.p.foreground).transition().duration(t.animationDuration/2).style("opacity",1)}},t.legend.mouseout=function(){t.selection.types.foreground.type.graph.transition().duration(t.animationDuration/2).style("opacity",1),t.selection.types.background.type.graph.transition().duration(t.animationDuration/2).style("opacity",1)},t.legend.click=function(e,n){n.p.visible=!n.p.visible;var a=!0;t.currentChartData.types.forEach(function(t){t.graphs.forEach(function(t){a===!0&&t.p.visible&&(a=!1)})}),a&&t.legend.resetHidden(),r.update()},t.legend.dblClick=function(e,n){t.currentChartData.types.forEach(function(t){t.graphs.forEach(function(t){t.p.visible=t.p.key===n.p.key})}),r.update()},t.legend.resetHidden=function(){t.currentChartData.types.forEach(function(t){t.graphs.forEach(function(t){t.p.visible=!0})})},t.transformTypesContainers=function(){t.rotate?(t.selection.types.background.transition().duration(t.animationDuration).attr("transform","translate("+t.innerWidth+", 0),rotate(90)"),t.selection.types.foreground.transition().duration(t.animationDuration).attr("transform","translate("+t.innerWidth+", 0),rotate(90)")):(t.selection.types.background.transition().duration(t.animationDuration).attr("transform",""),t.selection.types.foreground.transition().duration(t.animationDuration).attr("transform",""))},t.initMargin=function(){t.padding?t.forcedMargin={top:d2b.UTILS.visualLength(t.padding.top,t.height),bottom:d2b.UTILS.visualLength(t.padding.bottom,t.height),left:d2b.UTILS.visualLength(t.padding.left,t.width),right:d2b.UTILS.visualLength(t.padding.right,t.width)}:t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN()};var r={};return r.select=d2b.UTILS.CHARTS.MEMBERS.select(r,t,function(){t.generateRequired=!0}),r.selection=d2b.UTILS.CHARTS.MEMBERS.prop(r,t,"selection",function(){t.generateRequired=!0}),r.width=d2b.UTILS.CHARTS.MEMBERS.prop(r,t,"width"),r.height=d2b.UTILS.CHARTS.MEMBERS.prop(r,t,"height"),r.tooltipLayout=d2b.UTILS.CHARTS.MEMBERS.prop(r,t,"tooltipLayout"),r.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(r,t,"animationDuration",function(){t.legend.animationDuration(t.animationDuration),t.controls.animationDuration(t.animationDuration);for(var e in t.pTypeData)t.pTypeData[e].d2bType&&t.pTypeData[e].d2bType.animationDuration(t.animationDuration)}),r.legendOrientation=d2b.UTILS.CHARTS.MEMBERS.prop(r,t,"legendOrientation"),r.axis=d2b.UTILS.CHARTS.MEMBERS.prop(r,t,"axis"),r.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(r,t,"xFormat"),r.yFormat=d2b.UTILS.CHARTS.MEMBERS.format(r,t,"yFormat"),r.pGraphData=d2b.UTILS.CHARTS.MEMBERS.prop(r,t,"persistentChartData"),r.padding=d2b.UTILS.CHARTS.MEMBERS.prop(r,t,"padding"),r.xPadding=d2b.UTILS.CHARTS.MEMBERS.prop(r,t,"xPadding"),r.yPadding=d2b.UTILS.CHARTS.MEMBERS.prop(r,t,"yPadding"),r.controls=d2b.UTILS.CHARTS.MEMBERS.controls(r,t),r.on=d2b.UTILS.CHARTS.MEMBERS.events(r,t),r.color=d2b.UTILS.CHARTS.MEMBERS.prop(r,t,"color",function(){t.legend.color(t.color)}),r.rotate=function(e){return t.rotate=e,r},r.data=function(e){return arguments.length?(t.currentChartData.types=e.data.types||t.currentChartData.types,t.currentChartData.labels=e.data.labels||t.currentChartData.labels,t.currentChartData.types.forEach(function(e){e.p=t.pTypeData[e.type]=t.pTypeData[e.type]||{key:e.type},e.graphs.forEach(function(n){var a;n.key=n.key||n.label,n.type=e,a=n.type.type+"-"+n.key,n.p=t.pGraphData[a]=t.pGraphData[a]||{key:a,visible:!0},"boolean"==typeof n.visible&&(n.p.visible=n.visible,n.visible=null)})}),r):t.currentChartData},r.generate=function(e){t.generateRequired=!1,d2b.UTILS.CHARTS.HELPERS.generateDefaultSVG(t),t.legend.selection(t.selection.legend),t.controls.selection(t.selection.controls).on("change.d2b-change",function(e,n){t.controlsData[e.key].enabled=e.state,r.update()}),t.selection.main=t.selection.group.append("g").attr("class","d2b-axis-chart"),t.selection.axes=t.selection.main.append("g").attr("class","d2b-axes"),t.selection.types=t.selection.main.append("g").attr("class","d2b-axis-types").call(t.tooltip.tracker),t.selection.types.tracker=t.selection.types.append("rect").style("fill-opacity",0),t.selection.types.background=t.selection.types.append("g").attr("class","d2b-axis-types-background"),t.selection.types.foreground=t.selection.types.append("g").attr("class","d2b-axis-types-foreground"),t.selection.types.general=t.selection.types.append("g").attr("class","d2b-axis-types-general"),t.selection.types.tooltip=t.selection.types.append("g").attr("class","d2b-axis-types-tooltip-area").style("opacity",0).call(t.tooltip.container),t.legend.on("element-mouseover",t.legend.mouseover).on("element-mouseout",t.legend.mouseout).on("element-click",t.legend.click).on("element-dblclick",t.legend.dblClick);var n=t.animationDuration;return r.animationDuration(0).update(e).animationDuration(n)},r.update=function(e){return t.generateRequired?r.generate(e):(t.initMargin(),t.outerWidth=t.width,t.outerHeight=t.height,t.selection.svg.attr("width",t.width).attr("height",t.height),t.selection.group.transition().duration(t.animationDuration).attr("transform","translate("+t.forcedMargin.left+","+t.forcedMargin.top+")"),d2b.UTILS.CHARTS.HELPERS.updateDimensions(t),d2b.UTILS.CHARTS.HELPERS.updateControls(t),t.legend.updateData(),t.selection.main.transition().duration(t.animationDuration).attr("transform","translate("+t.forcedMargin.left+","+t.forcedMargin.top+")"),d2b.UTILS.CHARTS.HELPERS.updateDimensions(t),t.tooltip.reset(),t.types.init(),t.axes.update(),t.types.update(),t.tooltip.update(),t.transformTypesContainers(),d3.timer.flush(),t.events.dispatch("update",t.selection),e&&e(),r)},r},d2b.CHARTS.bubbleChart=function(){var t={};t.width=d2b.CONSTANTS.DEFAULTWIDTH(),t.height=d2b.CONSTANTS.DEFAULTHEIGHT(),t.innerHeight=t.height,t.innerWidth=t.width,t.outerHeight=t.height,t.outerWidth=t.width,t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.generateRequired=!0,t.selection=d3.select("body"),t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.data={},t.xFormat=function(t){return t},t.dispatch=d3.dispatch("update","zoomIn","zoomOut"),t.tooltipContent=function(e){var n="<b>"+e.label+":</b> "+t.xFormat(e.value)+" ";return null===e.change||void 0===e.change?n:(e.change>0&&(n+="+"),n+=t.format.percent(e.change))},t.view="packs",t.format={general:d3.format(),percent:d3.format(".0%")},t.pack=d3.layout.pack().sort(function(t,e){return t.parent.parent&&e.parent.parent?d3.ascending(t.value,e.value):null}),t.xTickFormat=function(e){var n=t.axis._x.domain(),a=t.format.percent(e);return+e===n[0]?t.format.percent(n[0])+" or lower":+e===n[1]?t.format.percent(n[1])+" or higher":a},t.axis=d2b.SVG.axis(),t.axis._x=d3.scale.linear().domain([-.25,.25]),t.axis.x().axis.tickFormat(t.xTickFormat),t.axis._y=d3.scale.ordinal(),t.axis.x({scale:t.axis._x,orientation:"top-outside"}).y({scale:t.axis._y,orientation:"left-inside"}),t.r=d3.scale.linear().domain([0,1]),t.gridX=d3.scale.ordinal(),t.gridY=d3.scale.ordinal(),t.background={packs:function(){var e,n,a=this.selectAll(".d2b-pack-label").data(t.data.categories,function(t){return t.key||t.label}),e=Math.min(30,Math.max(16,Math.min(t.innerWidth,t.innerHeight)/(10*t.data.categories.length)));t.grid=d2b.UTILS.grid(t.outerWidth,t.outerHeight,t.data.categories.length),n=a.enter().append("text").style("opacity",0).attr("class","d2b-pack-label"),n.append("tspan").attr("class","d2b-pack-label-name"),n.append("tspan").attr("x",0).attr("class","d2b-pack-label-value"),t.gridX.rangeBands([0,t.outerWidth]).domain(d3.range(0,t.grid.columns)),t.gridY.rangeBands([0,t.outerHeight]).domain(d3.range(0,t.grid.rows)),a.each(function(e,n){e.center={x:t.gridX(n%t.grid.columns)+t.gridX.rangeBand()/2,y:t.gridY(Math.floor(n/t.grid.columns))+t.gridY.rangeBand()/2}}),n.attr("transform",function(e){var n=e.center.y-t.gridY.rangeBand()/3;return"translate("+e.center.x+","+n+")"}),a.transition().duration(t.animationDuration).style("opacity",1).attr("transform",function(e){var n=e.center.y-t.gridY.rangeBand()/3;return"translate("+e.center.x+","+n+")"}),a.select("tspan.d2b-pack-label-name").style("font-size",e+"px").text(function(t){return t.label}),a.select("tspan.d2b-pack-label-value").style("font-size",e+"px").attr("dy",e+5).text(function(e){return t.xFormat(e.value)}),a.exit().remove()},change:function(){var e,n=t.data.categories.map(function(t){return t.label});n=d3.set(n),t.axis.width(t.outerWidth).height(t.outerHeight),t.axis._y.domain(n.values().reverse()),e=this.selectAll(".d2b-bubble-axes").data([t.data]),e.enter().append("g").attr("class","d2b-bubble-axes"),e.transition().duration(t.animationDuration).call(t.axis)}},t.zoom={coefficient:1,elem:null,toggle:function(){t.zoom.elem===this?t.zoom.out():t.zoom["in"].call(this)},"in":function(){var e=this,n=d3.select(e),a=n.datum(),r=t.outerWidth/2-a.attrs.x,o=t.outerHeight/2-a.attrs.y,i=Math.min(t.outerWidth,t.outerHeight)/(2*a.attrs.r);return a.children&&a.children.length?(t.dispatch.zoomIn.call(this,a),t.zoom.elem=e,n.each(function(){this.parentNode.appendChild(this)}),i*=t.zoom.coefficient,t.selection.background.transition().duration(t.animationDuration).style("opacity",0),t.selection.bubbles.select(".d2b-bubbles-wrap").transition().duration(t.animationDuration).attr("transform","translate(0,0)"),t.selection.bubbles.selectAll(".d2b-bubble").each(function(e){e.zoom={x:(e.attrs.x-t.outerWidth/2+r)*i+t.outerWidth/2,y:(e.attrs.y-t.outerHeight/2+o)*i+t.outerHeight/2,r:e.attrs.r*i}}).classed("d2b-background-bubble",!0).transition().duration(t.animationDuration).call(t.bubbles.transition,!0),void n.classed("d2b-background-bubble",!1).each(t.bubbles.updateSubPack)):t.zoom.out()},out:function(){if(t.zoom.elem){var n,a=d3.select(t.zoom.elem),r=a.datum();t.dispatch.zoomOut.call(t.zoom.elem,r),t.zoom.elem=null,e.update(),n=2*r.attrs.r,t.pack.size([n,n])({children:r.children}),a.selectAll(".d2b-sub-bubble").transition().duration(t.animationDuration).style("opacity",0).call(t.bubbles.transition).remove(),t.selection.bubbles.selectAll(".d2b-bubble").classed("d2b-background-bubble",!1)}}},t.bubbles={getColor:function(e){for(var n,a=e;a.parent.parent;){if(null!==a.colorKey&&void 0!==a.colorKey){n=a.colorKey;break}a=a.parent}return t.color(n||a.label)},getSubColor:function(e,n){return null!==e.colorKey&&void 0!==e.colorKey?t.color(e.colorKey):e.children&&e.children.length?d3.rgb(n).brighter(e.depth/2):"white"},updateSubPack:function(e){var n,a,r,o=d3.select(this),i=2*e.attrs.r,c=2*e.zoom.r,s=e.attrs.color,l=t.pack.size([i,i])({children:e.children});l.shift(),n=d3.select(o.node()).selectAll(".d2b-sub-bubble").data(l,function(t){return t.key||t.label}),a=n.enter().append("g").attr("class","d2b-sub-bubble").style("opacity",0),r=a.append("circle").call(d2b.UTILS.bindTooltip,t.tooltipContent,function(t){return t},function(t){return t.attrs.color}),n.each(function(e){e.attrs={r:e.r,x:e.x-i/2,y:e.y-i/2,color:t.bubbles.getSubColor(e,s)}}),r.style("fill",function(t){return t.attrs.color}).style("stroke",function(t){return d3.rgb(t.attrs.color).darker(1)}),l=t.pack.size([c,c])({children:e.children}),l.shift(),n.each(function(t){t.zoom={r:t.r,x:t.x-c/2,y:t.y-c/2}}),a.call(t.bubbles.transition),n.transition().duration(t.animationDuration).style("opacity",1).call(t.bubbles.transition,!0)},transition:function(t,e){t.attr("transform",function(t){var n=e?t.zoom:t.attrs;return"translate("+n.x+", "+n.y+")"}).select("circle").style("fill",function(t){return t.attrs.color}).style("stroke",function(t){return d3.rgb(t.attrs.color).darker(1)}).attr("r",function(t){var n=e?t.zoom:t.attrs;return Math.max(0,n.r)})},packs:function(){var e=this.select(".d2b-bubbles-wrap"),n=this.selectAll(".d2b-bubble"),a=.9*Math.sqrt(t.data.categories.length)*Math.min(t.gridX.rangeBand(),t.gridY.rangeBand());e.transition().duration(t.animationDuration).attr("transform","translate(0,0)"),t.r.range([0,a]),n.each(function(e){e.attrs={x:e.parent.center.x+a*(e.x-e.parent.x),y:e.parent.center.y+a*(e.y-e.parent.y),color:t.bubbles.getColor(e),r:t.r(e.r)}})},change:function(){var e=t.axis.box(),n=t.axis.scale("x"),a=t.axis.scale("y"),r=function(t){return Math.min(Math.max(n(t),0),e.innerWidth)},o=this.select(".d2b-bubbles-wrap"),i=this.selectAll(".d2b-bubble");o.transition().duration(t.animationDuration).attr("transform","translate("+e.padding.left+", "+e.padding.top+")"),t.r.range([0,Math.min(e.innerWidth,e.innerHeight)/2]),i.each(function(e){e.attrs={x:r(e.change),y:a(e.parent.label),color:t.bubbles.getColor(e),r:t.r(e.r)}})}};var e={};return e.select=d2b.UTILS.CHARTS.MEMBERS.select(e,t,function(){t.generateRequired=!0}),e.selection=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"selection",function(){t.generateRequired=!0}),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration",function(){}),e.legendOrientation=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"legendOrientation"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(e,t,"xFormat"),e.view=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"view"),e.zoomCoefficient=function(n){return arguments.lenght?(t.zoom.coefficient=n,e):t.zoom.coefficient},e.zoom=function(n){var a=!1;return t.selection.bubbles.selectAll(".d2b-bubble").each(function(e){a||n!==e&&n!==this&&n!==e.label&&n!==e.key||(a=!0,t.zoom["in"].call(this))}),a||t.zoom.out(),e},e.on=function(n,a){return 1===arguments.length?t.dispatch.on(n):(t.dispatch.on(n,a),e)},e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color"),e.axis=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"axis",function(){t.axis._x=t.axis.x().axis.scale(),t.axis._y=d3.scale.ordinal(),t.axis.y({scale:t.axis._y}),t.axis.x().axis.tickFormat(t.xTickFormat)}),e.data=function(n){return arguments.length?(t.data=n.data,t.pack.size([1,1])({children:t.data.categories}),e):t.data},e.generate=function(n){t.generateRequired=!1,d2b.UTILS.CHARTS.HELPERS.generateDefaultSVG(t),t.selection.main=t.selection.group.append("g").attr("class","d2b-bubble-chart"),t.selection.bubbles=t.selection.main.append("g").attr("class","d2b-bubbles"),t.selection.bubbles.append("g").attr("class","d2b-bubbles-wrap"),t.selection.background=t.selection.main.append("g").attr("class","d2b-bubble-background");var a=t.animationDuration;return e.animationDuration(0).update(n).animationDuration(a),e},e.update=function(n){var a,r,o;if(t.generateRequired)return e.generate(n);t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.outerWidth=t.width,t.outerHeight=t.height,t.selection.svg.attr("width",t.width).attr("height",t.height),d2b.UTILS.CHARTS.HELPERS.updateDimensions(t),t.selection.main.transition().duration(t.animationDuration).attr("transform","translate("+t.forcedMargin.left+","+t.forcedMargin.top+")"),d2b.UTILS.CHARTS.HELPERS.updateDimensions(t),t.selection.background.transition().duration(t.animationDuration).style("opacity",1),a=t.selection.background.selectAll(".d2b-bubble-background-wrap").data([t.view],function(t){return t}),a.enter().append("g").attr("class","d2b-bubble-background-wrap"),a.exit().transition().duration(t.animationDuration).style("opacity",0).remove(),r=t.data.categories.map(function(t){return t.children}),r=[].concat.apply([],r).sort(function(t,e){return d3.descending(t.r,e.r)}),o=t.selection.bubbles.select(".d2b-bubbles-wrap").selectAll(".d2b-bubble").data(r,function(t){return t.key||t.label});var i=o.enter().append("g").attr("class","d2b-bubble");return i.append("circle").call(d2b.UTILS.bindTooltip,t.tooltipContent,function(t){return t},function(t){return t.attrs.color}),o.classed("d2b-zoomable",!1).on("click.d2b-bubble-zoom",null).each(function(){this.parentNode.appendChild(this)}).filter(function(t){return t.children&&t.children.length}).classed("d2b-zoomable",!0).on("click.d2b-bubble-zoom",t.zoom.toggle),o.exit().transition().duration(t.animationDuration).remove().select("circle").attr("r",0),a.call(t.background[t.view]),t.selection.bubbles.call(t.bubbles[t.view]),i.call(t.bubbles.transition).select("circle").attr("r",0),o.transition().duration(t.animationDuration).call(t.bubbles.transition),t.zoom.elem&&t.zoom["in"].call(t.zoom.elem),d3.timer.flush(),t.dispatch.update.call(t.selection),n&&n(),e},e},d2b.CHARTS.factChart=function(){var t={};t.width=d2b.CONSTANTS.DEFAULTWIDTH(),t.height=d2b.CONSTANTS.DEFAULTHEIGHT(),t.innerHeight=t.height,t.innerWidth=t.width,t.outerHeight=t.height,t.outerWidth=t.width,t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.generateRequired=!0,t.selection=d3.select("body"),t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={},t.xFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.selectedFact=null,t.x=d3.scale.ordinal(),t.y=d3.scale.ordinal(),t.textScale=d3.scale.linear().range([15,30]).domain([100,1e3]),t.textScale.custom=function(t){var e=this.range(),n=this(t);return n<e[0]?e[0]:n>e[1]?e[1]:n},t.updateFact=function(e,n){e.select("text.d2b-fact-label").style("font-size",n+"px").text(function(t){return t.label}).each(function(t){t.labelWidth=this.getComputedTextLength()}).transition().duration(t.animationDuration).attr("y",-.5*n);var a=3;e.select("rect").transition().duration(t.animationDuration).attr("width",function(t){return t.labelWidth}).attr("height",a).attr("x",function(t){return-t.labelWidth/2}).attr("y",-a/2).style("fill","#ccc"),e.select("text.d2b-fact-value").style("font-size",2*n+"px").text(function(e){return t.xFormat(e.value)}).transition().duration(t.animationDuration).attr("y",2*n)},t.showMainFacts=function(){t.selection.subFacts.style("pointer-events","none").selectAll("*").transition().duration(t.animationDuration).style("opacity",0).remove();var n=t.currentChartData.facts.length,a=t.textScale.custom(Math.min(t.innerWidth,t.innerHeight)/n),r=d2b.UTILS.grid(t.innerWidth,t.innerHeight,n);t.x.domain(d3.range(0,r.columns)).rangeBands([0,t.innerWidth]),t.y.domain(d3.range(0,r.rows)).rangeBands([0,t.innerHeight]),t.selection.fact=t.selection.main.selectAll("g.d2b-fact").data(t.currentChartData.facts);var o=t.selection.fact.enter().append("g").attr("class","d2b-fact").call(t.events.addElementDispatcher,"main","d2b-fact");o.append("text").attr("class","d2b-fact-label"),o.append("text").attr("class","d2b-fact-value"),o.append("rect").attr("class","d2b-fact-bar");t.selection.fact.style("pointer-events","all").transition().duration(t.animationDuration).style("opacity",1).attr("transform",function(e,n){return"translate("+(t.x(n%r.columns)+t.x.rangeBand()/2)+","+(t.y(Math.floor(n/r.columns))+t.y.rangeBand()/2)+")"});t.updateFact(t.selection.fact,a),t.selection.fact.exit().transition().duration(t.animationDuration).style("opacity",0).remove(),t.selection.fact.each(function(n){var a=d3.select(this);return!n.subFacts||n.subFacts.length<1?void a.style("cursor","auto").on("mouseover.d2b-mouseover",null).on("mouseout.d2b-mouseout",null).on("click.d2b-click",null):void a.style("cursor","pointer").on("mouseover.d2b-mouseover",function(){a.select("rect").transition().duration(t.animationDuration/2).style("fill","#333")}).on("mouseout.d2b-mouseout",function(){a.select("rect").transition().duration(t.animationDuration/2).style("fill","#ccc")}).on("click.d2b-click",function(){var a=d3.select(this);t.selectedFact?(t.selection.fact.style("pointer-events","all").transition().duration(t.animationDuration).style("opacity",1),t.selectedFact=null):(t.selection.fact.style("pointer-events","none").transition().duration(t.animationDuration).style("opacity",0),a.style("pointer-events","all").transition().duration(t.animationDuration).style("opacity",1),t.selectedFact=a,t.selectedFact.data=n),e.update()})})},t.showSubFacts=function(){var e=t.currentChartData.facts.length,n=t.textScale.custom(Math.min(t.innerWidth,t.innerHeight)/e);t.selectedFact.transition().duration(t.animationDuration).attr("transform","translate("+t.innerWidth/2+","+n+")"),t.updateFact(t.selectedFact,n);var a=3*n;t.forcedMargin.top+=a,t.innerHeight-=t.forcedMargin.top,t.selection.subFacts.style("pointer-events","all").transition().duration(t.animationDuration).style("opacity",1).attr("transform","translate(0,"+a+")");var r=t.selectedFact.data.subFacts.length,o=d2b.UTILS.grid(t.innerWidth,t.innerHeight,r);t.x.domain(d3.range(0,o.columns)).rangeBands([0,t.innerWidth]),t.y.domain(d3.range(0,o.rows)).rangeBands([0,t.innerHeight]),t.selection.subFact=t.selection.subFacts.selectAll("g.d2b-sub-fact").data(t.selectedFact.data.subFacts);var i=t.selection.subFact.enter().append("g").attr("class","d2b-sub-fact").style("opacity",0).attr("transform",function(e,n){return"translate("+t.x(n%o.columns)+","+t.y(Math.floor(n/o.columns))+")"});i.append("g").attr("class","d2b-sub-fact-chart").each(function(e){this.pieChart=new d2b.CHARTS.pieChart,this.pieChart.select(this).color(t.color).donutRatio(.6).controls({hideLegend:{enabled:!0}})}),i.append("text").attr("class","d2b-sub-fact-label"),t.selection.subFact.transition().duration(t.animationDuration).attr("transform",function(e,n){return"translate("+t.x(n%o.columns)+","+t.y(Math.floor(n/o.columns))+")"}).delay(t.animationDuration/1.5).style("opacity",.9),t.selection.subFact.select("g.d2b-sub-fact-chart").each(function(e){t.events.translateEvents(this.pieChart),this.pieChart.animationDuration(t.animationDuration).width(t.x.rangeBand()).height(t.y.rangeBand()).data({data:{values:e.values}}).update()}),t.selection.subFact.select("text.d2b-sub-fact-label").text(function(t){return t.label}).transition().duration(t.animationDuration).attr("x",t.x.rangeBand()/2).attr("y",t.y.rangeBand()/2)};var e={};return e.select=d2b.UTILS.CHARTS.MEMBERS.select(e,t,function(){t.generateRequired=!0}),e.selection=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"selection",function(){t.generateRequired=!0}),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(e,t,"xFormat"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color",function(){t.selection.subFact&&t.selection.subFact.each(function(e){this.pieChart.color(t.color)})}),e.data=function(n,a){return arguments.length?(a&&(t.currentChartData={}),t.currentChartData=n.data,e):t.currentChartData},e.generate=function(n){t.generateRequired=!1,t.selection.selectAll("*").remove(),t.selection.svg=t.selection.append("svg").attr("class","d2b-svg d2b-container"),t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.selection.group=t.selection.svg.append("g").attr("transform","translate("+t.forcedMargin.left+","+t.forcedMargin.top+")"),t.selection.main=t.selection.group.append("g").attr("class","d2b-fact-chart"),t.selection.subFacts=t.selection.main.append("g").attr("class","d2b-sub-facts");var a=t.animationDuration;return e.animationDuration(0).update(n).animationDuration(a),e},e.update=function(n){return t.generateRequired?e.generate(n):(t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.outerWidth=t.width,t.outerHeight=t.height,t.selection.svg.attr("width",t.width).attr("height",t.height),d2b.UTILS.CHARTS.HELPERS.updateDimensions(t),t.selectedFact?t.showSubFacts():t.showMainFacts(),d3.timer.flush(),t.events.dispatch("update",t.selection),n&&n(),e)},e},d2b.CHARTS.funnelChart=function(){var t={};t.width=d2b.CONSTANTS.DEFAULTWIDTH(),t.height=d2b.CONSTANTS.DEFAULTHEIGHT(),t.innerHeight=t.height,t.innerWidth=t.width,t.outerHeight=t.height,t.outerWidth=t.width,t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.generateRequired=!0,t.selection=d3.select("body"),t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={},t.xFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.coneHeight=d3.scale.linear(),t.coneCurve=15,t.heightCoeff=.9,t.funnel=function(){t.coneHeight.range([0,t.innerHeight*t.heightCoeff]).domain([0,d3.sum(t.currentChartData.values,function(t){return t.value})]);var e=t.innerWidth,n=t.innerWidth/4,a=(e-n)/(t.innerHeight*t.heightCoeff),r=e,o=0;return t.currentChartData.values.forEach(function(e){var n=t.coneHeight(e.value),i=r;e.pinched&&(r-=n*a);var c=r,s={start:t.innerWidth/2-i/2,end:t.innerWidth/2+i/2,mid:t.innerWidth/2};e.top="M"+s.start+",0 Q"+s.mid+","+t.coneCurve+" "+s.end+",0 M"+s.end+",0 Q"+s.mid+","+-t.coneCurve+" "+s.start+",0",s={start:t.innerWidth/2-c/2,end:t.innerWidth/2+c/2,
mid:t.innerWidth/2},e.bottom="M"+s.start+","+n+" Q"+s.mid+","+(n+t.coneCurve)+" "+s.end+","+n+" M"+s.end+","+n+" Q"+s.mid+","+(n-t.coneCurve)+" "+s.start+","+n,e.center=t.innerWidth/2-i/2+",0 "+(t.innerWidth/2-c/2)+","+n+" "+(t.innerWidth/2+c/2)+","+n+" "+(t.innerWidth/2+i/2)+",0 ",e.y=o,e.height=n,e.width=c,o+=n}),t.currentChartData.values},t.showText=function(e){this.select(".d2b-cone-note-group").style("opacity",0).attr("transform",function(e){return"translate("+t.innerWidth/2+","+e.height+")"}),this.select(".d2b-cone-text-group").style("opacity",1).attr("transform",function(e){return"translate("+t.innerWidth/2+","+(e.height/2+t.coneCurve-15)+")"})},t.showNote=function(e){this.select(".d2b-cone-note-group").style("opacity",1).attr("transform",function(e){return"translate("+t.innerWidth/2+","+(1.5*t.coneCurve+(e.height-e.noteHeight)/2)+")"}),this.select(".d2b-cone-text-group").style("opacity",0).attr("transform",function(e){return"translate("+t.innerWidth/2+",0)"})},t.coneMouseover=function(e){var n=this,a=!1,r=20;t.selection.funnel.cone.each(function(){var e=d3.select(this).transition().duration(2*d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]);this==n?(e.attr("transform",function(t){return"translate(0,"+t.y+")"}).call(t.showNote),a=!0):a?e.attr("transform",function(t){return"translate(0,"+(t.y-r)+")"}):e.attr("transform",function(t){return"translate(0,"+(t.y+r)+")"})})},t.coneMouseout=function(e){t.selection.funnel.cone.transition().duration(2*d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).call(t.showText).attr("transform",function(t){return"translate(0,"+t.y+")"})},t.enterCones=function(){var e=t.selection.funnel.cone.enter().append("g").attr("class","d2b-cone").style("opacity",0).call(t.events.addElementDispatcher,"main","d2b-cone").on("mouseout.d2b-mouseout",t.coneMouseout).on("mouseover.d2b-mouseover",t.coneMouseover);e.append("path").attr("class","d2b-cone-bottom"),e.append("polygon").attr("class","d2b-cone-center"),e.append("path").attr("class","d2b-cone-top");var n=e.append("g").attr("class","d2b-cone-note-group"),a=(n.append("text").attr("class","d2b-cone-note"),e.append("g").attr("class","d2b-cone-text-group")),r=a.append("text").attr("class","d2b-cone-text");r.append("tspan").attr("class","d2b-cone-label"),r.append("tspan").attr("class","d2b-cone-value").attr("x",0).attr("y",20),t.selection.funnel.cone.bottom=t.selection.funnel.cone.select(".d2b-cone-bottom"),t.selection.funnel.cone.top=t.selection.funnel.cone.select(".d2b-cone-top"),t.selection.funnel.cone.center=t.selection.funnel.cone.select(".d2b-cone-center"),t.selection.funnel.cone.textGroup=t.selection.funnel.cone.select(".d2b-cone-text-group"),t.selection.funnel.cone.text=t.selection.funnel.cone.select(".d2b-cone-text"),t.selection.funnel.cone.label=t.selection.funnel.cone.select(".d2b-cone-label"),t.selection.funnel.cone.value=t.selection.funnel.cone.select(".d2b-cone-value"),t.selection.funnel.cone.noteGroup=t.selection.funnel.cone.select(".d2b-cone-note-group"),t.selection.funnel.cone.note=t.selection.funnel.cone.select(".d2b-cone-note"),e.size()&&t.selection.funnel.cone.each(function(){this.parentNode.appendChild(this)})},t.updateCones=function(){t.selection.funnel.transition().duration(t.animationDuration).attr("transform",function(){return"translate(0,"+t.innerHeight*(1-t.heightCoeff)/2+")"});var e=t.selection.funnel.cone.transition().duration(t.animationDuration).attr("transform",function(t){return"translate(0,"+t.y+")"}).style("opacity",1).call(t.showText);t.selection.funnel.cone.note.attr("dy",0).attr("y",0).text(function(t){return t.note}).each(function(t){d3.select(this).call(d2b.UTILS.textWrap,t.width-10),t.noteHeight=this.getBBox().height}),e.select(".d2b-cone-label").text(function(t){return t.label}),e.select(".d2b-cone-value").text(function(e){return t.xFormat(e.value)}),e.select(".d2b-cone-bottom").attr("d",function(t){return t.bottom}).style("fill",function(e){return t.color(e.label)}),e.select(".d2b-cone-center").attr("points",function(t){return t.center}).style("fill",function(e){return t.color(e.label)}),e.select(".d2b-cone-top").attr("d",function(t){return t.top}).style("fill",function(e){return d3.rgb(t.color(e.label)).darker(1.2)})},t.exitCones=function(){t.selection.funnel.cone.exit().transition().duration(t.animationDuration).style("opacity",0).remove()};var e={};return e.select=d2b.UTILS.CHARTS.MEMBERS.select(e,t,function(){t.generateRequired=!0}),e.selection=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"selection",function(){t.generateRequired=!0}),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.coneCurve=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"coneCurve"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(e,t,"xFormat"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.data=function(n,a){return arguments.length?(a&&(t.currentChartData={}),t.currentChartData=n.data,e):t.currentChartData},e.generate=function(n){t.generateRequired=!1,t.selection.selectAll("*").remove(),t.selection.svg=t.selection.append("svg").attr("class","d2b-svg d2b-container"),t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.selection.group=t.selection.svg.append("g").attr("transform","translate("+t.forcedMargin.left+","+t.forcedMargin.top+")"),t.selection.main=t.selection.group.append("g").attr("class","d2b-funnel-chart"),t.selection.funnel=t.selection.main.append("g").attr("class","d2b-funnel");var a=t.animationDuration;return e.animationDuration(0).update(n).animationDuration(a),e},e.update=function(n){return t.generateRequired?e.generate(n):(t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.outerWidth=t.width,t.outerHeight=t.height,t.selection.svg.attr("width",t.width).attr("height",t.height),d2b.UTILS.CHARTS.HELPERS.updateDimensions(t),t.selection.funnel.cone=t.selection.funnel.selectAll("g.d2b-cone").data(t.funnel(t.currentChartData.values)._reverse(),function(t,e){return"unique"==t.key?Math.floor(65536*(1+Math.random())):t.key&&"auto"!=t.key?t.key:t.label}),t.enterCones(),t.updateCones(),t.exitCones(),d3.timer.flush(),t.events.dispatch("update",t.selection),n&&n(),e)},e},d2b.CHARTS.gaugeChart=function(){var t={};t.width=d2b.CONSTANTS.DEFAULTWIDTH(),t.height=d2b.CONSTANTS.DEFAULTHEIGHT(),t.innerHeight=t.height,t.innerWidth=t.width,t.outerHeight=t.height,t.outerWidth=t.width,t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.generateRequired=!0,t.selection=d3.select("body"),t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={},t.xFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.percentFormat=d2b.UTILS.numberFormat({precision:2,units:{after:"%"}}),t.percent=0,t.arc=d3.svg.arc().startAngle(function(t,e){return t.start}).endAngle(function(t,e){return t.end}).innerRadius(function(t,e){return t.inner}).outerRadius(function(t,e){return t.outer}),t.tooltip=function(e){return null!=e.value?"<b>"+e.label+":</b> "+t.xFormat(e.value)+" ("+100*e.percent+"%)":"<b>"+e.label+":</b> "+100*e.percent+"%"},t.getPercent=function(){return null!=t.currentChartData.percent?t.currentChartData.percent:null!=t.currentChartData.value&&null!=t.currentChartData.total?t.currentChartData.value/t.currentChartData.total:0},t.getData=function(){return[{label:t.currentChartData.label,value:t.currentChartData.value,percent:t.percent,start:-Math.PI/2,end:Math.PI*t.percent-Math.PI/2,color:d2b.UTILS.getColor(t.color,"label")(t.currentChartData),filled:!0},{percent:t.percent,start:Math.PI*t.percent-Math.PI/2,end:Math.PI/2,color:"#ddd",filled:!1}]},t.setNewArc=function(t,e,n){t.each(function(t){this.newArc={start:t.start,end:t.end,inner:e,outer:n}})},t.arcMouseover=function(e){var n=d3.select(this).select("path");n.call(t.setNewArc,t.radius.inner,1.03*t.radius.outer).transition().duration(t.animationDuration/4).call(d2b.UTILS.TWEENS.arcTween,t.arc)},t.arcMouseout=function(e){var n=d3.select(this).select("path");n.call(t.setNewArc,t.radius.inner,t.radius.outer).transition().duration(t.animationDuration/4).call(d2b.UTILS.TWEENS.arcTween,t.arc)};var e={};return e.select=d2b.UTILS.CHARTS.MEMBERS.select(e,t,function(){t.generateRequired=!0}),e.selection=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"selection",function(){t.generateRequired=!0}),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration"),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(e,t,"xFormat"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltip"),e.data=function(n,a){return arguments.length?(a&&(t.currentChartData={}),t.currentChartData=n.data,e):t.currentChartData},e.generate=function(n){t.generateRequired=!1,t.selection.selectAll("*").remove(),t.selection.svg=t.selection.append("svg").attr("class","d2b-template-chart d2b-svg d2b-container"),t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.selection.group=t.selection.svg.append("g"),t.selection.main=t.selection.group.append("g").attr("class","d2b-gauge-chart"),t.selection.arcs=t.selection.main.append("g"),t.selection.arcHeader=t.selection.main.append("text").attr("class","d2b-gauge-arc-header"),t.selection.arcLabels=t.selection.main.append("g").attr("class","d2b-gauge-arc-labels"),t.selection.arcLabels.start=t.selection.arcLabels.append("text").attr("y",20).text("0%"),t.selection.arcLabels.end=t.selection.arcLabels.append("text").attr("y",20).text("100%"),t.selection.arcLabels.percent=t.selection.arcLabels.append("text").attr("class","d2b-gauge-arc-percent").text("0%");var a=t.animationDuration;return e.animationDuration(0).update(n).animationDuration(a),e},e.update=function(n){if(t.generateRequired)return e.generate(n);t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.outerWidth=t.width,t.outerHeight=t.height,t.innerWidth=t.outerWidth-t.forcedMargin.left-t.forcedMargin.right,t.innerHeight=t.outerHeight-t.forcedMargin.top-t.forcedMargin.bottom,t.selection.svg.attr("width",t.width).attr("height",t.height);var a=t.currentChartData.label?20:0,r=20;t.radius={},t.radius.outer=Math.min(2*t.innerHeight-2*a-2*r,t.innerWidth)/2,t.radius.inner=.8*t.radius.outer,t.forcedMargin.top=t.forcedMargin.top+t.innerHeight/2+t.radius.outer/2-r/2+a/2,t.forcedMargin.left=t.forcedMargin.left+t.innerWidth/2,t.selection.group.transition().duration(t.animationDuration).attr("transform","translate("+t.forcedMargin.left+","+t.forcedMargin.top+")"),d2b.UTILS.CHARTS.HELPERS.updateDimensions(t),t.percent=t.getPercent(),t.selection.arcs.arc=t.selection.arcs.selectAll("g").data(t.getData());var o=t.selection.arcs.arc.enter().append("g");return o.append("path").style("fill",function(t){return t.color}),o.filter(function(t){return t.filled}).on("mouseover.d2b-mouseover",t.arcMouseover).on("mouseout.d2b-mouseout",t.arcMouseout).call(t.events.addElementDispatcher,"main","d2b-arc"),t.selection.arcs.arc.filter(function(t){return t.filled}).call(d2b.UTILS.bindTooltip,t.tooltip,function(t){return t}),t.selection.arcs.arc.path=t.selection.arcs.arc.select("path").call(t.setNewArc,t.radius.inner,t.radius.outer).transition().duration(t.animationDuration).call(d2b.UTILS.TWEENS.arcTween,t.arc).style("fill",function(t){return t.color}).attr("class","d2b-arc"),t.selection.arcLabels.percent.transition().duration(t.animationDuration).tween("text",function(e){var n=this;n._current||(n._current=0);var a=d3.interpolate(n._current,t.percent);return function(t){n._current=a(t),n.textContent=d3.format("%")(a(t))}}).attr("font-size",.5*t.radius.inner+"px"),t.selection.arcLabels.start.transition().duration(t.animationDuration).attr("x",-(t.radius.outer-(t.radius.outer-t.radius.inner)/2)),t.selection.arcLabels.end.transition().duration(t.animationDuration).attr("x",t.radius.outer-(t.radius.outer-t.radius.inner)/2),t.selection.arcHeader.text(t.currentChartData.label).transition().duration(t.animationDuration).attr("y",-t.radius.outer-10),d3.timer.flush(),t.events.dispatch("update",t.selection),n&&n(),e},e},d2b.CHARTS.iframeChart=function(){var t={};t.width=d2b.CONSTANTS.DEFAULTWIDTH(),t.height=d2b.CONSTANTS.DEFAULTHEIGHT(),t.generateRequired=!0,t.selection=d3.select("body"),t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={},t.events=d2b.UTILS.chartEvents();var e={};return e.select=d2b.UTILS.CHARTS.MEMBERS.select(e,t,function(){t.generateRequired=!0}),e.selection=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"selection",function(){t.generateRequired=!0}),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration"),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.data=function(n,a){return arguments.length?(a&&(t.currentChartData={}),t.generateRequired=!0,t.currentChartData=n.data,e):t.currentChartData},e.generate=function(n){t.generateRequired=!1,t.selection.selectAll("*").remove(),t.selection.div=t.selection.append("div").attr("class","d2b-iframe-chart d2b-container"),t.selection.div.iframe=t.selection.div.append("iframe").attr("class","d2b-iframe").attr("src",t.currentChartData.url);var a=t.animationDuration;return e.animationDuration(0).update(n).animationDuration(a),e},e.update=function(n){return t.generateRequired?e.generate(n):(t.selection.div.iframe.transition().duration(t.animationDuration).attr("width",t.width).attr("height",t.height),d3.timer.flush(),t.events.dispatch("update",t.selection),n&&n(),e)},e},d2b.CHARTS.mapChart=function(){var t={};t.width=d2b.CONSTANTS.DEFAULTWIDTH(),t.height=d2b.CONSTANTS.DEFAULTHEIGHT(),t.innerHeight=t.height,t.innerWidth=t.width,t.outerHeight=t.height,t.outerWidth=t.width,t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.generateRequired=!0,t.selection=d3.select("body"),t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={},t.xFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.legend=new d2b.UTILS.LEGENDS.legend,t.legendOrientation="bottom",t.legendData={data:{items:[]}},t.controls=new d2b.UTILS.CONTROLS.controls,t.controlsData={hideLegend:{label:"Hide Legend",type:"checkbox",visible:!1,enabled:!1}},t.filterSet={},t.topoPaths=[{key:"countries",file:"countries.topo.json"},{key:"states",file:"states.topo.json"}],t.topoData={},t.filteredTopoData={},t.topoDataReady=!1,t.projection="equirectangular",t.drawCountries=function(e){t.selection.countries.country=t.selection.countries.selectAll("g.d2b-country").data(t.filteredTopoData.countries.features,function(t){return t.properties.GU_A3}),t.selection.countries.country.enter().append("g").attr("class","d2b-country").style("opacity",0).append("path"),t.selection.countries.country.path=t.selection.countries.country.select("path"),t.selection.countries.country.transition().duration(t.animationDuration).style("opacity",1).select("path").attr("d",e).style("fill","black"),t.selection.countries.country.exit().transition().duration(t.animationDuration).style("opacity",0).remove()},t.pathFit=function(e){var n=d3.geo.centroid(e),a=150,r=[t.innerWidth/2,t.innerHeight/2],o=d3.geo[t.projection]().scale(a).translate(r);"albersUsa"!=t.projection&&o.center(n);var i=d3.geo.path().projection(o),c=i.bounds(e),s=a*t.innerWidth/(c[1][0]-c[0][0]),l=a*t.innerHeight/(c[1][1]-c[0][1]),a=l>s?s:l,r=[t.innerWidth-(c[0][0]+c[1][0])/2,t.innerHeight-(c[0][1]+c[1][1])/2];return o.scale(a).translate(r),"albersUsa"!=t.projection&&o.center(n),i=i.projection(o)},t.setTopoData=function(n){t.topoDataReady=!1,d2b.UTILS.load(t.topoPaths,function(a){t.topoData=a,t.filteredTopoData=JSON.parse(JSON.stringify(t.topoData)),t.filteredTopoData.states.objects.states_simplified.geometries=t.topoData.states.objects.states_simplified.geometries.filter(function(e){return Object.keys(t.filterSet.states||{}).map(function(n){return t.filterSet.states[n].split(",").indexOf(e.properties[n])>-1}).concat([!0]).every(function(t){return 1==t})}),t.filteredTopoData.states=topojson.feature(t.filteredTopoData.states,t.filteredTopoData.states.objects.states_simplified),t.filteredTopoData.countries.objects.countries_simplified.geometries=t.topoData.countries.objects.countries_simplified.geometries.filter(function(e){return Object.keys(t.filterSet.countries||{}).map(function(n){return t.filterSet.countries[n].split(",").indexOf(e.properties[n])>-1}).concat([!0]).every(function(t){return 1==t})}),t.filteredTopoData.countries=topojson.feature(t.filteredTopoData.countries,t.filteredTopoData.countries.objects.countries_simplified),t.topoDataReady=!0,t.updateRequired&&(e.update(),t.updateRequired=!1),n&&n()})};var e={};return e.select=d2b.UTILS.CHARTS.MEMBERS.select(e,t,function(){t.generateRequired=!0}),e.selection=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"selection",function(){t.generateRequired=!0}),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.projection=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"projection"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration",function(){t.legend.animationDuration(t.animationDuration),t.controls.animationDuration(t.animationDuration)}),e.legendOrientation=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"legendOrientation"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(e,t,"xFormat"),e.controls=d2b.UTILS.CHARTS.MEMBERS.controls(e,t),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.filter=function(n){return t.filterSet=n,t.setTopoData(),e},e.data=function(n,a){return arguments.length?(a&&(t.currentChartData={}),t.currentChartData=n.data,e):t.currentChartData},e.generate=function(n){return t.generateRequired=!1,d2b.UTILS.CHARTS.HELPERS.generateDefaultSVG(t),t.legend.color(t.color).selection(t.selection.legend),t.controls.selection(t.selection.controls).on("change",function(n,a){t.controlsData[n.key].enabled=n.state,e.update()}),t.selection.main=t.selection.group.append("g").attr("class","d2b-main-chart"),t.selection.countries=t.selection.main.append("g").attr("class","d2b-countries"),t.setTopoData(function(){var a=t.animationDuration;e.animationDuration(0).update(n).animationDuration(a)}),e},e.update=function(n){if(t.generateRequired)return e.generate(n);if(t.topoDataReady){t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.outerWidth=t.width,t.outerHeight=t.height,t.selection.svg.attr("width",t.width).attr("height",t.height),d2b.UTILS.CHARTS.HELPERS.updateDimensions(t),d2b.UTILS.CHARTS.HELPERS.updateControls(t),t.controlsData.hideLegend.enabled?t.legendData={data:{items:[]}}:t.legendData.data.items=[{label:"item 1"},{label:"item 2"},{label:"item 3"},{label:"item 4"},{label:"item 5"},{label:"item 6"}],d2b.UTILS.CHARTS.HELPERS.updateLegend(t);var a=t.pathFit(t.filteredTopoData.countries);t.selection.main.transition().duration(t.animationDuration).attr("transform","translate("+t.forcedMargin.left+","+t.forcedMargin.top+")"),d2b.UTILS.CHARTS.HELPERS.updateDimensions(t),t.drawCountries(a),d3.timer.flush()}else t.updateRequired=!0;return t.events.dispatch("update",t.selection),n&&n(),e},e},d2b.CHARTS.multiChart=function(){var t={};t.width=d2b.CONSTANTS.DEFAULTWIDTH(),t.height=d2b.CONSTANTS.DEFAULTHEIGHT(),t.generateRequired=!0,t.selection=d3.select("body"),t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.currentChartData={},t.current={chart:{}},t.previous={chart:null},t.d2bChart,t.events=d2b.UTILS.chartEvents();var e=function(e,n){t.previous.chart=t.current.chart,t.current.chart=e,o.update()},n=function(){t.selection.buttonsWrapper.buttons.button=t.selection.buttonsWrapper.buttons.selectAll("li").data(t.currentChartData.charts,function(t){return"unique"==t.key?Math.floor(65536*(1+Math.random())):t.key&&"auto"!=t.key?t.key:t.label}),t.selection.buttonsWrapper.buttons.button.enter().append("li").on("click.d2b-click",e),t.selection.buttonsWrapper.buttons.button.text(function(t){return t.label}).classed("d2b-selected",function(e){return e==t.current.chart}),t.selection.buttonsWrapper.buttons.button.exit().remove()},a=function(e){if(t.current.chart.properties)for(var n in t.current.chart.properties)e&&e.skip&&e.skip.indexOf(n)>-1||"data"!=n&&(t.current.chart.properties[n].args?t.d2bChart[n].apply(this,t.current.chart.properties[n].args):t.d2bChart[n](t.current.chart.properties[n]));t.events.translateEvents(t.d2bChart)},r=function(){t.selection.chartWrapper.chart?t.current.chart!=t.previous.chart&&(t.current.chart.type==t.previous.chart.type?(t.d2bChart.data(t.current.chart.properties.data),a({skip:["controls"]})):(t.selection.chartWrapper.chart.transition().duration(t.animationDuration).style("opacity",0).remove(),t.selection.chartWrapper.chart=t.selection.chartWrapper.append("div").attr("class","d2b-multi-chart-chart").style("opacity",0),t.d2bChart=t.current.chart.chart,t.d2bChart.selection(t.selection.chartWrapper.chart).data(JSON.parse(JSON.stringify(t.current.chart.data))),t.selection.chartWrapper.chart.transition().duration(t.animationDuration).style("opacity",1),a())):(t.selection.chartWrapper.chart=t.selection.chartWrapper.append("div").attr("class","d2b-multi-chart-chart").style("opacity",1),t.d2bChart=t.current.chart.chart,t.d2bChart.data(t.current.chart.properties.data).selection(t.selection.chartWrapper.chart),a()),t.d2bChart.width(t.innerWidth).height(t.innerHeight).update(),t.previous.chart=t.current.chart},o={};return o.select=d2b.UTILS.CHARTS.MEMBERS.select(o,t,function(){t.generateRequired=!0}),o.selection=d2b.UTILS.CHARTS.MEMBERS.prop(o,t,"selection",function(){t.generateRequired=!0}),o.width=d2b.UTILS.CHARTS.MEMBERS.prop(o,t,"width"),o.height=d2b.UTILS.CHARTS.MEMBERS.prop(o,t,"height"),o.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(o,t,"animationDuration"),o.on=d2b.UTILS.CHARTS.MEMBERS.events(o,t),o.data=function(e,n){if(!arguments.length)return t.currentChartData;n&&(t.currentChartData={});var a=!0;if(t.current.chart.key){var r=e.data.charts.filter(function(e){return t.current.chart.key==e.key})[0];r&&(a=!1,t.current.chart=r)}return a&&(t.current.chart=e.data.charts[0]),t.currentChartData=e.data,t.currentChartData.charts.forEach(function(t){t.chart=new d2b.CHARTS[t.type]}),o},o.generate=function(e){t.generateRequired=!1,t.selection.selectAll("*").remove(),t.selection.buttonsWrapper=t.selection.append("div").attr("class","d2b-multi-chart-buttons-wrapper"),t.selection.buttonsWrapper.buttons=t.selection.buttonsWrapper.append("ul").attr("class","d2b-buttons"),t.selection.chartWrapper=t.selection.append("div").attr("class","d2b-multi-chart d2b-container");var n=t.animationDuration;return o.animationDuration(0).update(e).animationDuration(n),o},o.update=function(e){return t.generateRequired?o.generate(e):(t.innerWidth=t.width,t.innerHeight=t.height-50,t.selection.chartWrapper.style("width",t.innerWidth+"px").style("height",t.innerHeight+"px"),n(),r(),d3.timer.flush(),e&&e(),o)},o},d2b.CHARTS.pieChart=function(){var t={};t.width=d2b.CONSTANTS.DEFAULTWIDTH(),t.height=d2b.CONSTANTS.DEFAULTHEIGHT(),t.innerHeight=t.height,t.innerWidth=t.width,t.outerHeight=t.height,t.outerWidth=t.width,t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.generateRequired=!0,t.selection=d3.select("body"),t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={},t.xFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.legend=new d2b.UTILS.LEGENDS.legend,t.legend.active(!0),t.legendOrientation="bottom",t.legendData={data:{items:[]}},t.controls=new d2b.UTILS.CONTROLS.controls,t.controlsData={hideLegend:{label:"Hide Legend",type:"checkbox",visible:!1,enabled:!1}},t.tooltipContent=function(e){return"<b>"+e.label+":</b> "+t.xFormat(e.value)+" ("+d3.round(100*e.value/t.pieTotal,1)+"%)"},t.donutRatio=0,t.arc=d3.svg.arc().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,t.start))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,t.end))}).outerRadius(function(t){return Math.max(0,t.outer)}).innerRadius(function(t){return Math.max(0,t.inner)}),t.arcText=d3.svg.arc(),t.pie=d3.layout.pie().value(function(e){var n=t.persistentData.hiddenArcs[e.key]?0:e.value;return t.pieTotal+=n,n}).sort(null),t.pieTotal=1,t.persistentData={focusedArc:null,hiddenArcs:{}},t.arcKey=function(t,e){return"unique"==t.key?Math.floor(65536*(1+Math.random())):t.key&&"auto"!=t.key?t.key:t.label},t.arcEnter=function(){t.r=.93*(Math.min(t.outerWidth,t.outerHeight)/2),t.pieTotal=0,t.selection.pie.datum(t.currentChartData.values),t.selection.pie.arc=t.selection.pie.selectAll("g").data(t.pie,function(t){return t.data.key});var e=t.selection.pie.arc.enter().append("g").attr("class","d2b-arc").style("opacity",0).call(t.events.addElementDispatcher,"main","d2b-arc");e.append("path").each(function(e){this.oldArc={start:e.startAngle,end:e.startAngle,inner:t.r*t.donutRatio,outer:t.r}}),e.append("text").attr("y",6).each(function(e){this.oldPosition={start:e.startAngle,end:e.startAngle,inner:t.r*t.donutRatio,outer:t.r}})},t.arcUpdate=function(){t.selection.pie.arc.call(d2b.UTILS.bindTooltip,t.tooltipContent,function(t){return t.data},function(e){return d2b.UTILS.getColor(t.color,"label")(e.data)}).transition().duration(t.animationDuration/1.5).style("opacity",1),t.selection.pie.arc.path=t.selection.pie.arc.select("path").each(function(e){this.newArc={start:e.startAngle,end:e.endAngle,inner:t.r*t.donutRatio,outer:e.data.key==t.persistentData.focusedArc?1.04*t.r:t.r}}).on("mouseover.d2b-mouseover",function(n){t.persistentData.focusedArc=n.data.key,e.update()}).on("mouseout.d2b-mouseover",function(n){t.persistentData.focusedArc=null,e.update()}),t.selection.pie.arc.path.transition=t.selection.pie.arc.path.transition().duration(t.animationDuration/1.5).style("opacity",1).style("fill",function(e){return d2b.UTILS.getColor(t.color,"label")(e.data)}).call(d2b.UTILS.TWEENS.arcTween,t.arc),t.selection.pie.arc.text=t.selection.pie.arc.select("text").transition().duration(t.animationDuration/1.5).tween("text",function(e){var n=this;n._current||(n._current=0);var a=d3.interpolate(n._current,e.data.value/t.pieTotal);return function(t){n._current=a(t),n.textContent=d3.format("%")(a(t))}}).style("opacity",function(e){return e.data.value/t.pieTotal<.03||t.persistentData.hiddenArcs[e.data.key]?0:1}).attrTween("transform",function(e){var n=this;n.newPosition={start:e.startAngle,end:e.endAngle,inner:t.r*t.donutRatio,outer:t.r};var a=d3.interpolate(n.oldPosition,n.newPosition);return function(e){return n.oldPosition=a(e),"translate("+t.arc.centroid(n.oldPosition)+")"}})},t.arcExit=function(){t.selection.pie.arc.exit().transition().duration(t.animationDuration).style("opacity",0).remove().select("path").each(function(e){this.newArc={start:e.endAngle,end:e.endAngle,inner:t.r*t.donutRatio,outer:t.r}}).call(d2b.UTILS.TWEENS.arcTween,t.arc)};var e={};return e.select=d2b.UTILS.CHARTS.MEMBERS.select(e,t,function(){t.generateRequired=!0}),e.selection=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"selection",function(){t.generateRequired=!0}),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration",function(){t.legend.animationDuration(t.animationDuration),t.controls.animationDuration(t.animationDuration)}),e.legendOrientation=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"legendOrientation"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(e,t,"xFormat"),e.controls=d2b.UTILS.CHARTS.MEMBERS.controls(e,t),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color",function(){t.legend.color(t.color)}),e.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltip"),e.donutRatio=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"donutRatio"),e.data=function(n,a){return arguments.length?(a&&(t.currentChartData={}),t.currentChartData=n.data,t.currentChartData.values.forEach(function(e){e.key=t.arcKey(e)}),e):t.currentChartData},e.generate=function(n){t.generateRequired=!1,d2b.UTILS.CHARTS.HELPERS.generateDefaultSVG(t),t.legend.color(t.color).selection(t.selection.legend).on("element-mouseover.d2b-mouseover",function(n,a){t.persistentData.focusedArc=a.key,e.update()}).on("element-mouseout.d2b-mouseover",function(n,a){t.persistentData.focusedArc=null,e.update()}).on("element-click",function(n,a){t.persistentData.hiddenArcs[a.key]=!t.persistentData.hiddenArcs[a.key];var r=!0;if(t.currentChartData.values.forEach(function(e){1!=r||t.persistentData.hiddenArcs[e.key]||(r=!1)}),r)for(var o in t.persistentData.hiddenArcs)t.persistentData.hiddenArcs[o]=!1;e.update()}).on("element-dblclick",function(n,a){t.currentChartData.values.forEach(function(e){t.persistentData.hiddenArcs[e.key]=e.key!=a.key}),e.update()}),t.controls.selection(t.selection.controls).on("change",function(n,a){t.controlsData[n.key].enabled=n.state,e.update()}),t.selection.pie=t.selection.group.append("g").attr("class","d2b-pie-chart");var a=t.animationDuration;return e.animationDuration(0).update(n).animationDuration(a),e},e.update=function(n){return t.generateRequired?e.generate(n):(t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.outerWidth=t.width,t.outerHeight=t.height,t.selection.svg.attr("width",t.width).attr("height",t.height),d2b.UTILS.CHARTS.HELPERS.updateDimensions(t),d2b.UTILS.CHARTS.HELPERS.updateControls(t),t.controlsData.hideLegend.enabled?t.legendData={data:{items:[]}}:t.legendData={data:{items:t.currentChartData.values.map(function(e){return e.open=t.persistentData.hiddenArcs[e.key],e})}},d2b.UTILS.CHARTS.HELPERS.updateLegend(t),t.selection.pie.transition().duration(t.animationDuration).attr("transform","translate("+(t.forcedMargin.left+t.innerWidth/2)+","+(t.forcedMargin.top+t.innerHeight/2)+")"),d2b.UTILS.CHARTS.HELPERS.updateDimensions(t),t.arcEnter(),t.arcUpdate(),t.arcExit(),d3.timer.flush(),t.events.dispatch("update",t.selection),n&&n(),e)},e},d2b.CHARTS.sankeyChart=function(){var t={};t.width=d2b.CONSTANTS.DEFAULTWIDTH(),t.height=d2b.CONSTANTS.DEFAULTHEIGHT(),t.innerHeight=t.height,t.innerWidth=t.width,t.generateRequired=!0,t.selection=d3.select("body"),t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.legend=new d2b.UTILS.LEGENDS.legend,t.controls=new d2b.UTILS.CONTROLS.controls,t.legendOrientation="bottom",t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.events=d2b.UTILS.chartEvents(),t.currentChartData={nodes:[],links:[]},t.sankey=d3.sankey(),t.nodePadding=30,t.nodeWidth=15,t.layout=20,t.minLinkWidth=1,t.controlsData={hideLegend:{label:"Hide Legend",type:"checkbox",visible:!1,enabled:!1}},t.xFormat=function(t){return t},t.nodeTooltip=function(e){return"<b>"+e.name+" : </b>"+t.xFormat(e.value)},t.linkTooltip=function(e){return"<b>"+e.source.name+' <i class="fa fa-arrow-right"></i> '+e.target.name+": </b>"+t.xFormat(e.value)};var e={};return e.select=d2b.UTILS.CHARTS.MEMBERS.select(e,t,function(){t.generateRequired=!0}),e.selection=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"selection",function(){t.generateRequired=!0}),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration",function(){t.legend.animationDuration(t.animationDuration),t.controls.animationDuration(t.animationDuration)}),e.legendOrientation=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"legendOrientation"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(e,t,"xFormat"),e.controls=d2b.UTILS.CHARTS.MEMBERS.controls(e,t),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color",function(){t.legend.color(t.color)}),e.nodePadding=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"nodePadding"),e.layout=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"layout"),e.minLinkWidth=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"minLinkWidth"),e.nodeTooltip=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"nodeTooltip"),e.linkTooltip=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"linkTooltip"),
e.data=function(n,a){return arguments.length?(a&&(t.currentChartData={nodes:[],links:[]},t.generateRequired=!0),n.data.nodes&&(t.currentChartData.nodes=n.data.nodes),n.data.links&&(t.currentChartData.links=n.data.links),n.data.labels&&(t.currentChartData.labels=n.data.labels),n.data.columnHeaders&&(t.currentChartData.columnHeaders=n.data.columnHeaders),e):t.currentChartData},e.generate=function(n){t.generateRequired=!1,t.selection.selectAll("*").remove(),t.selection.svg=t.selection.append("svg").attr("class","d2b-sankey-chart d2b-svg d2b-container"),t.selection.group=t.selection.svg.append("g"),t.selection.group.sankey=t.selection.group.append("g").attr("class","d2b-sankey"),t.selection.group.sankey.links=t.selection.group.sankey.append("g").attr("class","d2b-sankey-links"),t.selection.group.sankey.nodes=t.selection.group.sankey.append("g").attr("class","d2b-sankey-nodes"),t.selection.group.labels=t.selection.group.append("g").attr("class","d2b-sankey-labels"),t.selection.group.labels.source=t.selection.group.labels.append("g").attr("class","d2b-sankey-label-source"),t.selection.group.labels.source.text=t.selection.group.labels.source.append("text").attr("y",23),t.selection.group.labels.destination=t.selection.group.labels.append("g").attr("class","d2b-sankey-label-destination"),t.selection.group.labels.destination.text=t.selection.group.labels.destination.append("text").attr("y",23),t.selection.group.columnHeaders=t.selection.group.append("g").attr("class","d2b-sankey-column-headers"),t.selection.controls=t.selection.group.append("g").attr("class","d2b-controls"),t.controls.selection(t.selection.controls).on("change",function(n,a){t.controlsData[n.key].enabled=n.state,"sort"!=n.key&&"hideLegend"!=n.key||(newData=!0),e.update()}),t.selection.legend=t.selection.group.append("g").attr("class","d2b-legend"),t.legend.color(t.color).selection(t.selection.legend);var a=t.animationDuration;return e.animationDuration(0).update(n).animationDuration(a),e},e.update=function(n){if(t.generateRequired)return e.generate(n);t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.innerWidth=t.width-t.forcedMargin.right-t.forcedMargin.left,d2b.UTILS.CHARTS.HELPERS.updateControls(t),t.innerHeight=t.height-t.forcedMargin.top-t.forcedMargin.bottom,t.controlsData.hideLegend.enabled?t.legendData={data:{items:[]}}:t.legendData={data:{items:d3.set(t.currentChartData.nodes.map(function(t){return t.colorKey||t.name})).values().map(function(t){return{label:t}})}},d2b.UTILS.CHARTS.HELPERS.updateLegend(t),t.innerHeight=t.height-t.forcedMargin.top-t.forcedMargin.bottom,t.innerWidth=t.width-t.forcedMargin.left-t.forcedMargin.right;var a={source:t.selection.group.labels.source.transition().duration(t.animationDuration),destination:t.selection.group.labels.destination.transition().duration(t.animationDuration)};t.currentChartData.labels?(t.selection.group.labels.transition().duration(t.animationDuration).attr("transform","translate("+t.forcedMargin.left+","+t.forcedMargin.top+")"),t.currentChartData.labels.source?(a.source.style("opacity",1),t.selection.group.labels.source.text.text(t.currentChartData.labels.source)):a.source.style("opacity",0),t.currentChartData.labels.destination?(a.destination.style("opacity",1),t.selection.group.labels.destination.text.text(t.currentChartData.labels.destination)):a.destination.style("opacity",0),a.source.attr("transform","translate(0,0)"),a.destination.attr("transform","translate("+t.innerWidth+",0)"),t.forcedMargin.top+=35):(a.source.style("opacity",0),a.destination.style("opacity",0));var r,o;t.currentChartData.columnHeaders&&t.currentChartData.columnHeaders.length>0&&(o=d3.scale.linear().domain([0,t.currentChartData.columnHeaders.length-1]).range([0,t.innerWidth-t.nodeWidth]),t.selection.group.columnHeaders.transition().duration(t.animationDuration).attr("transform","translate("+t.forcedMargin.left+","+t.forcedMargin.top+")"),r=t.selection.group.columnHeaders.selectAll("g.d2b-sankey-column-header").data(t.currentChartData.columnHeaders),r.enter().append("g").style("opacity",0).attr("transform",function(e,n){return"translate("+(o(n)+t.nodeWidth/2)+",0)"}).attr("class","d2b-sankey-column-header").append("text").attr("y",16).attr("x",function(e,n){return 0==n?-t.nodeWidth/2:n==t.currentChartData.columnHeaders.length-1?t.nodeWidth/2:void 0}),r.select("text").text(function(t){return t}),r.transition().duration(t.animationDuration).style("opacity",1).attr("transform",function(e,n){return"translate("+(o(n)+t.nodeWidth/2)+",0)"}),r.exit().transition().duration(t.animationDuration).style("opacity",0).remove(),t.forcedMargin.top+=25),t.innerHeight=t.height-t.forcedMargin.top-t.forcedMargin.bottom,t.sankey.size([t.innerWidth,t.innerHeight]).nodeWidth(t.nodeWidth).nodePadding(t.nodePadding).nodes(t.currentChartData.nodes).links(t.currentChartData.links).layout(t.layout);var i=t.selection.group.sankey.nodes.selectAll("g.d2b-sankey-node").data(t.currentChartData.nodes.filter(function(t){return t.value}),function(t,e){return"unique"==t.key?Math.floor(65536*(1+Math.random())):t.key&&"auto"!=t.key?t.key:e}),c=i.enter().append("g").attr("class","d2b-sankey-node").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).style("opacity",0).call(t.events.addElementDispatcher,"main","d2b-sankey-node");c.append("rect"),c.append("text");var s=i.select("text").text(function(t){return t.shortName});i.call(d2b.UTILS.bindTooltip,t.nodeTooltip,function(t){return t}).transition().duration(t.animationDuration).attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).style("opacity",1),i.select("rect").transition().duration(t.animationDuration).attr("width",t.sankey.nodeWidth()).attr("height",function(t){return Math.max(0,t.dy)}),s.transition().duration(t.animationDuration).style("text-anchor",function(e){return e.x<t.innerWidth/2?"start":"end"}).attr("x",function(e){return e.x<t.innerWidth/2?t.sankey.nodeWidth()+5:-5}).attr("y",function(t){return t.dy/2+5});var l=t.selection.group.sankey.links.selectAll("g.d2b-sankey-link").data(t.currentChartData.links.filter(function(t){return t.value}),function(t,e){return"unique"==t.key?Math.floor(65536*(1+Math.random())):t.key&&"auto"!=t.key?t.key:e}),d=l.enter().append("g").attr("class","d2b-sankey-link").style("opacity",0).call(t.events.addElementDispatcher,"main","d2b-sankey-node");return d.append("path"),d.append("text"),l.exit().transition().duration(t.animationDuration).style("opacity",0).remove(),i.exit().transition().duration(t.animationDuration).style("opacity",0).remove(),l.call(d2b.UTILS.bindTooltip,t.linkTooltip,function(t){return t}).transition().duration(t.animationDuration).style("opacity",1),l.select("path").style("stroke",function(e){return e.colorBy?t.color(e[e.colorBy].colorKey?e[e.colorBy].colorKey:e[e.colorBy].name):"#777"}).transition().style("stroke-width",function(e){return Math.max(e.dy,t.minLinkWidth)}).duration(t.animationDuration).attr("d",t.sankey.link()),t.selection.svg.attr("width",t.width).attr("height",t.height),t.selection.group.sankey.transition().duration(t.animationDuration).attr("transform","translate("+t.forcedMargin.left+","+t.forcedMargin.top+")"),d3.timer.flush(),t.events.dispatch("update",t.selection),n&&n(),e},e},d2b.CHARTS.sunburstChart=function(){var t={};t.width=d2b.CONSTANTS.DEFAULTWIDTH(),t.height=d2b.CONSTANTS.DEFAULTHEIGHT(),t.innerHeight=t.height,t.innerWidth=t.width,t.outerHeight=t.height,t.outerWidth=t.width,t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.generateRequired=!0,t.selection=d3.select("body"),t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={data:{partition:{}}},t.xFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.legend=(new d2b.UTILS.LEGENDS.legend).color(t.color),t.legendOrientation="bottom",t.legendData={data:{items:[]}},t.controls=new d2b.UTILS.CONTROLS.controls,t.breadcrumbs=new d2b.UTILS.breadcrumbs,t.breadcrumbs.scale(6),t.partitionData,t.currentRoot,t.newData=!0,t.arc=d3.svg.arc().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,t.start))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,t.end))}).innerRadius(function(t){return Math.max(0,t.inner)}).outerRadius(function(t){return Math.max(0,t.outer)}),t.radius={},t.y={children:d3.scale.pow().exponent(.8),parents:d3.scale.linear()},t.x=d3.scale.linear().range([0,2*Math.PI]),t.controlsData={invert:{label:"Invert",type:"checkbox",visible:!1,enabled:!1},sort:{label:"Sort",type:"checkbox",visible:!1,enabled:!1},hideLegend:{label:"Hide Legend",type:"checkbox",visible:!1,enabled:!1}},t.getAncestors=function(t){for(var e=[],n=t;n.parent;)e.unshift(n),n=n.parent;return e.unshift(n),e},t.arcFill=function(e){var n=t.getAncestors(e).reverse();if(e.colorKey)return t.color(e.colorKey);for(var a=n.length,r=0;a>r;r++)if(n[r].top)return d3.rgb(d2b.UTILS.getColor(t.color,"name")(n[r])).brighter(.3*r);return t.color(e.name)},t.arcMouseover=function(e){var n=t.getAncestors(e);t.selection.arcs.arc.filter(function(t){return n.indexOf(t)>=0}).classed("d2b-transparent",!1),t.selection.arcs.arc.filter(function(t){return n.indexOf(t)<0}).classed("d2b-transparent",!0),t.updateBreadcrumbs(n)},t.arcMouseover.children=function(e){t.setSunburstTooltip(e,!0)},t.arcMouseover.parents=function(e){t.setSunburstTooltip(e,!1)},t.sunburstMouseout=function(e){t.resetBreadcrumbs(),t.selection.arcs.arc.classed("d2b-transparent",!1),t.resetSunburstTooltip()},t.resetSunburstTooltip=function(){t.setSunburstTooltip(t.currentRoot,!1)},t.setSunburstTooltip=function(e,n){var a=e.name,r=t.xFormat(e.value);n&&(r+=" / "+d3.format(".2%")(e.value/t.currentRoot.value)),t.selection.tooltip.text.selectAll("*").remove(),t.selection.tooltip.text.append("tspan").text(a),t.selection.tooltip.text.append("tspan").attr("y",30).attr("x",0).text(r)},t.arcClick=function(e){t.currentRoot=e,t.updateArcs()},t.getZoomParentDomain=function(t){var e=t,n=[1,0];do n[0]>e.y&&(n[0]=e.y),n[1]<e.y+e.dy&&(n[1]=e.y+e.dy),e=e.parent;while(e);return n},t.getZoomChildDomain=function(e,n){return n?(n[0]>e.y&&(n[0]=e.y),n[1]<e.y+e.dy&&(n[1]=e.y+e.dy)):n=[1,0],e.children&&e.children.forEach(function(e){return t.getZoomChildDomain(e,n)}),n},t.updateArcs=function(){var e=t.getAncestors(t.currentRoot),n={};n.parents=t.selection.arcs.arc.path.filter(function(t){return e.indexOf(t)>=0}).on("mouseover.updateTooltip",t.arcMouseover.parents),t.x.domain([t.currentRoot.x,t.currentRoot.x+t.currentRoot.dx]),t.y.parents.domain(t.getZoomParentDomain(t.currentRoot)),t.y.children.domain(t.getZoomChildDomain(t.currentRoot));n.parents.each(function(e){this.newArc={start:t.x(e.x),end:t.x(e.x+e.dx),inner:t.y.parents(e.y),outer:t.y.parents(e.y+e.dy)},this.oldArc||(this.oldArc={start:this.newArc.start,end:this.newArc.start,inner:this.newArc.inner,outer:this.newArc.outer})}),n.children=t.selection.arcs.arc.path.filter(function(t){return e.indexOf(t)<0}).on("mouseover.updateTooltip",t.arcMouseover.children),n.children.each(function(e){this.newArc={start:t.x(e.x),end:t.x(e.x+e.dx),inner:t.y.children(e.y),outer:t.y.children(e.y+e.dy)},this.oldArc||(this.oldArc={start:this.newArc.start,end:this.newArc.start,inner:this.newArc.inner,outer:this.newArc.outer})}),t.selection.arcs.arc.exit().transition().duration(1.5*t.animationDuration).style("opacity",0).remove().select("path").each(function(t){this.newArc={start:this.oldArc.start,end:this.oldArc.start,inner:this.oldArc.inner,outer:this.oldArc.outer}}).call(d2b.UTILS.TWEENS.arcTween,t.arc);var a=t.selection.arcs.arc.path.transition().duration(1.5*t.animationDuration).call(d2b.UTILS.TWEENS.arcTween,t.arc);a.each("end",function(t){this.oldArc=this.newArc})},t.setupNewData=function(){var e;t.newData=!1,e=t.controlsData.sort.enabled?d3.layout.partition().value(function(t){return t.size}):d3.layout.partition().value(function(t){return t.size}).sort(function(t,e){return t.index-e.index}),t.partitionData=e.nodes(t.currentChartData.partition);var n=t.partitionData.filter(function(t){return t.top});t.controlsData.hideLegend.enabled?t.legendData={data:{items:[]}}:t.legendData={data:{items:d3.set(n.map(function(t){return t.name})).values().map(function(t){return{label:t}})}}},t.resetBreadcrumbs=function(){var e={data:{items:[]}};t.breadcrumbs.data(e).update()},t.saveIndicies=function(e){var n=0;if(e.children)for(n=0;n<e.children.length;n++)e.children[n].index=n,t.saveIndicies(e.children[n])},t.updateBreadcrumbs=function(e){var n={data:{items:e.map(function(t,e){return{label:t.name,key:e+","+t.name,data:t}})}};t.breadcrumbs.data(n).update();var a=t.breadcrumbs.selection();a.breadcrumb.path.attr("stroke-width",1.5).style("fill-opacity",.2).style("stroke-opacity",.7).style("fill",function(e){return t.arcFill(e.data)}).style("stroke",function(e){return d3.rgb(t.arcFill(e.data)).darker(1)})};var e={};return e.select=d2b.UTILS.CHARTS.MEMBERS.select(e,t,function(){t.generateRequired=!0}),e.selection=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"selection",function(){t.generateRequired=!0}),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration",function(){t.legend.animationDuration(t.animationDuration),t.controls.animationDuration(t.animationDuration)}),e.legendOrientation=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"legendOrientation"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(e,t,"xFormat"),e.controls=d2b.UTILS.CHARTS.MEMBERS.controls(e,t),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color",function(){t.legend.color(t.color)}),e.data=function(n,a){return arguments.length?(a&&(t.currentChartData={},t.generateRequired=!0),t.newData=!0,t.currentChartData=n.data,t.saveIndicies(t.currentChartData.partition),t.currentRoot=t.currentChartData.partition,e):t.currentChartData},e.generate=function(n){t.generateRequired=!1,d2b.UTILS.CHARTS.HELPERS.generateDefaultSVG(t),t.selection.main=t.selection.group.append("g").attr("class","d2b-sunburst").on("mouseout.d2b-mouseout",t.sunburstMouseout),t.selection.arcs=t.selection.main.append("g").attr("class","d2b-sunburst-arcs"),t.selection.tooltip=t.selection.main.append("g").attr("class","d2b-sunburst-tooltip"),t.selection.tooltip.text=t.selection.tooltip.append("text"),t.selection.breadcrumbs=t.selection.group.append("g").attr("class","d2b-sunburst-breadcrumbs"),t.controls.selection(t.selection.controls).on("change",function(n,a){t.controlsData[n.key].enabled=n.state,"sort"!=n.key&&"hideLegend"!=n.key||(t.newData=!0),e.update()}),t.legend.selection(t.selection.legend),t.breadcrumbs.selection(t.selection.breadcrumbs);var a=t.animationDuration;return e.animationDuration(0).update(n).animationDuration(a),e},e.update=function(n){if(t.generateRequired)return e.generate(n);t.newData&&t.setupNewData(),t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.outerWidth=t.width,t.outerHeight=t.height,t.selection.svg.attr("width",t.width).attr("height",t.height),d2b.UTILS.CHARTS.HELPERS.updateDimensions(t),d2b.UTILS.CHARTS.HELPERS.updateControls(t),t.selection.breadcrumbs.transition().duration(t.animationDuration).attr("transform","translate("+t.forcedMargin.left+",0)"),t.breadcrumbs.width(t.innerWidth).update(),d2b.UTILS.CHARTS.HELPERS.updateLegend(t),t.selection.main.transition().duration(t.animationDuration).attr("transform","translate("+(t.forcedMargin.left+t.innerWidth/2)+","+(t.forcedMargin.top+t.innerHeight/2)+")"),t.radius.outer=Math.min(t.innerWidth,t.innerHeight)/2,t.radius.inner=t.radius.outer/3,t.controlsData.invert.enabled?(t.y.children.range([t.radius.outer-.17*(t.radius.outer-t.radius.inner),t.radius.inner]),t.y.parents.range([t.radius.outer,t.radius.outer-.13*(t.radius.outer-t.radius.inner)])):(t.y.children.range([t.radius.inner+.17*(t.radius.outer-t.radius.inner),t.radius.outer]),t.y.parents.range([t.radius.inner,t.radius.inner+.13*(t.radius.outer-t.radius.inner)])),t.selection.arcs.arc=t.selection.arcs.selectAll("g.d2b-sunburst-arc").data(t.partitionData,function(e,n){return"unique"==e.key?Math.floor(65536*(1+Math.random())):e.key&&"auto"!=e.key?e.key:t.getAncestors(e).map(function(t){return t.name}).join("-")});var a=t.selection.arcs.arc.enter().append("g").attr("class","d2b-sunburst-arc").style("opacity",0).call(t.events.addElementDispatcher,"main","d2b-arc");a.append("path").on("mouseover.d2b-mouseover",t.arcMouseover);return t.selection.arcs.arc.transition().duration(t.animationDuration).style("opacity",""),t.selection.arcs.arc.path=t.selection.arcs.arc.select("path").style("fill",t.arcFill),t.selection.arcs.arc.path.on("click.d2b-click",t.arcClick).classed("d2b-pointer-element",!0),t.updateArcs(),t.resetSunburstTooltip(),d3.timer.flush(),t.events.dispatch("update",t.selection),n&&n(),e},e},d2b.CHARTS.tableChart=function(){var t={};t.width=d2b.CONSTANTS.DEFAULTWIDTH(),t.height=d2b.CONSTANTS.DEFAULTHEIGHT(),t.innerHeight=t.height,t.innerWidth=t.width,t.outerHeight=t.height,t.outerWidth=t.width,t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.generateRequired=!0,t.selection=d3.select("body"),t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={},t.xFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.tooltip=function(e){return"<b>"+e.label+"</b>: "+t.xFormat(e.value)},t.selectedRow=null,t.updateSubFacts=function(e,n,a,r,o,i,c){var s=n.selectAll("g.d2b-table-subFact").data(a),l=s.enter().append("g").attr("class","d2b-table-subFact");return l.append("g").attr("class","d2b-table-subFact-chart"),l.append("text").attr("class","d2b-table-subFact-label"),t.updateSubFact(s,r,o,i,c),s.exit().transition().duration(t.animationDuration).style("opacity",0).remove(),s},t.updateSubFact=function(e,n,a,r,o){e.select("text.d2b-table-subFact-label").text(function(t){return t.label}).transition().duration(t.animationDuration).attr("y",-4).attr("x",(n.rangeBand()-a)/2),e.each(function(t){t.x=d3.scale.linear(),t.x.domain([0,d3.sum(t.values,function(t){return t.value})]).range([0,n.rangeBand()-a]);var e=0;t.values.forEach(function(n){n.xPos=e,n.width=t.x(n.value),e+=n.width})});var i=e.select("g").selectAll("g").data(function(t){return t.values}),c=i.enter().append("g").call(t.events.addElementDispatcher,"main","d2b-table-row-sub-fact");c.append("rect"),c.append("text").attr("class","d2b-subFact-value-label");var s=i.call(d2b.UTILS.bindTooltip,t.tooltip,function(t){return t}).transition().duration(t.animationDuration);s.select("rect").attr("x",function(t){return t.xPos}).attr("width",function(t){return t.width}).attr("height",r).style("fill",d2b.UTILS.getColor(t.color,"label")),s.select("text.d2b-subFact-value-label").style("opacity",+o).attr("y",r/2+4).attr("x",function(t){return t.xPos+t.width/2}).text(function(t){return t.label.substring(0,t.width/10)}),i.exit().transition().duration(t.animationDuration).style("opacity",0).remove()},t.showRow=function(){t.selection.table.row=t.selection.table.selectAll("g.d2b-table-row").data(t.currentChartData.rows),t.selection.table.row.select("tspan.d2b-label").text(function(t){return t.label+" "}),t.selection.table.row.select("tspan.d2b-value").text(function(e){return t.xFormat(e.value)}),t.selectedRow.data=t.selectedRow[0][0].__data__,t.forcedMargin.top+=20,t.innerHeight=t.outerHeight-t.forcedMargin.top;var e=t.selectedRow.transition().duration(t.animationDuration).style("opacity",1).attr("transform",function(e,n){return"translate(0,"+t.forcedMargin.top+")"});e.select("rect.d2b-row-border").attr("width",t.innerWidth),e.select("rect.d2b-row-background").attr("height",t.innerHeight);var n=t.selectedRow.select(".d2b-table-subFacts"),a=d3.scale.ordinal();a.domain([0]).rangeBands([0,t.innerWidth]);var r=d3.scale.ordinal();r.domain(d3.range(0,t.selectedRow.data.subFacts.length)).rangeBands([5,t.innerHeight]),t.updateSubFacts(t.selectedRow,n,t.selectedRow.data.subFacts,a,0,r.rangeBand()/2,!0).transition().duration(t.animationDuration).attr("transform",function(t,e){return"translate(0,"+(r(e)+r.rangeBand()/2)+")"})},t.showTable=function(){var n=.03*t.innerWidth,a=t.innerHeight/t.currentChartData.rows.length;t.selection.table.row=t.selection.table.selectAll("g.d2b-table-row").data(t.currentChartData.rows);var r=t.selection.table.row.enter().append("g").call(t.events.addElementDispatcher,"main","d2b-table-row").attr("class","d2b-table-row");r.append("rect").attr("class","d2b-row-background"),r.append("rect").attr("class","d2b-row-border");var o=r.append("text").attr("class","d2b-table-row-label");o.append("tspan").attr("class","d2b-label"),o.append("tspan").attr("class","d2b-value"),r.append("g").attr("class","d2b-table-subFacts");var i=t.selection.table.row.transition().duration(t.animationDuration).style("opacity",1).attr("transform",function(t,e){return"translate(0,"+(e*a+a/2)+")"});i.select("rect.d2b-row-border").attr("width",t.innerWidth).attr("height",1.5).attr("y",5),i.select("rect.d2b-row-background").attr("width",t.innerWidth).attr("height",30).attr("y",-22);var c=0;t.selection.table.row.select("tspan.d2b-label").text(function(t){return t.label+" "}),t.selection.table.row.select("tspan.d2b-value").text(function(e){return t.xFormat(e.value)}),t.selection.table.row.select("text.d2b-table-row-label").each(function(){c=Math.max(this.getComputedTextLength(),c)}),t.selection.table.row.style("pointer-events","all").each(function(e){var a=d3.select(this),r=d3.scale.ordinal(),o=a.select("text.d2b-table-row-label"),i=a.select("g.d2b-table-subFacts");e.subFacts.length>0?(o.transition().duration(t.animationDuration).style("text-anchor","start").attr("x",0),a.style("cursor","pointer")):(o.transition().duration(t.animationDuration).style("text-anchor","middle").attr("x",t.innerWidth/2),a.style("cursor","auto")),r.domain(d3.range(0,e.subFacts.length)).rangeBands([c+n,t.innerWidth+n]),t.updateSubFacts(a,i,e.subFacts,r,n,5,!1).transition().duration(t.animationDuration).attr("transform",function(t,e){return"translate("+r(e)+",-2)"})}).on("click.d2b-click",function(n,a){var r=d3.select(this);t.selectedRow?t.selectedRow=null:n.subFacts.length>0&&(t.selection.table.row.style("pointer-events","none").transition().duration(t.animationDuration).style("opacity",0),r.style("pointer-events","all"),t.selectedRow=r),e.update()})};var e={};return e.select=d2b.UTILS.CHARTS.MEMBERS.select(e,t,function(){t.generateRequired=!0}),e.selection=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"selection",function(){t.generateRequired=!0}),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(e,t,"xFormat"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltip"),e.data=function(n,a){return arguments.length?(a&&(t.currentChartData={}),t.currentChartData=n.data,t.currentChartData.rows.forEach(function(t){t.subFacts=t.subFacts||[]}),e):t.currentChartData},e.generate=function(n){t.generateRequired=!1,t.selection.selectAll("*").remove(),t.selection.svg=t.selection.append("svg").attr("class","d2b-svg d2b-container"),t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.selection.group=t.selection.svg.append("g").attr("transform","translate("+t.forcedMargin.left+","+t.forcedMargin.top+")"),t.selection.main=t.selection.group.append("g").attr("class","d2b-table-chart"),t.selection.table=t.selection.main.append("g").attr("class","d2b-table");var a=t.animationDuration;return e.animationDuration(0).update(n).animationDuration(a),e},e.update=function(n){return t.generateRequired?e.generate(n):(t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.outerWidth=t.width,t.outerHeight=t.height,t.selection.svg.attr("width",t.width).attr("height",t.height),d2b.UTILS.CHARTS.HELPERS.updateDimensions(t),t.selectedRow?t.showRow():t.showTable(),d3.timer.flush(),t.events.dispatch("update",t.selection),n&&n(),e)},e},d2b.chart.template=function(){function t(){}var e=d2b.model.chart({props:["axis"],events:["zoom"],update:t}),n=(e.internal,e["interface"]);return n};d3.sankey=function(){function t(){h.forEach(function(t){t.sourceLinks=[],t.targetLinks=[]}),b.forEach(function(t){var e=t.source,n=t.target;"number"==typeof e&&(e=t.source=h[t.source]),"number"==typeof n&&(n=t.target=h[t.target]),e.sourceLinks.push(t),n.targetLinks.push(t)})}function e(){h.forEach(function(t){t.value=Math.max(d3.sum(t.sourceLinks,s),d3.sum(t.targetLinks,s))})}function n(){for(var t,e=h,n=0;e.length;)t=[],e.forEach(function(e){e.x=n,e.dx=d,e.sourceLinks.forEach(function(e){t.indexOf(e.target)<0&&t.push(e.target)})}),e=t,++n;a(n),r((p[0]-d)/(n-1))}function a(t){h.forEach(function(e){e.sourceLinks.length||(e.x=t-1)})}function r(t){h.forEach(function(e){e.x*=t})}function o(t){function e(){var t=d3.min(i,function(t){return(p[1]-(t.length-1)*u)/d3.sum(t,s)});i.forEach(function(e){e.forEach(function(e,n){e.y=n,e.dy=e.value*t})}),b.forEach(function(e){e.dy=e.value*t})}function n(t){function e(t){return c(t.source)*t.value}i.forEach(function(n,a){n.forEach(function(n){if(n.targetLinks.length){var a=d3.sum(n.targetLinks,e)/d3.sum(n.targetLinks,s);n.y+=(a-c(n))*t}})})}function a(t){function e(t){return c(t.target)*t.value}i.slice().reverse().forEach(function(n){n.forEach(function(n){if(n.sourceLinks.length){var a=d3.sum(n.sourceLinks,e)/d3.sum(n.sourceLinks,s);n.y+=(a-c(n))*t}})})}function r(){i.forEach(function(t){var e,n,a,r=0,i=t.length;for(t.sort(o),a=0;i>a;++a)e=t[a],n=r-e.y,n>0&&(e.y+=n),r=e.y+e.dy+u;if(n=r-u-p[1],n>0)for(r=e.y-=n,a=i-2;a>=0;--a)e=t[a],n=e.y+e.dy+u-r,n>0&&(e.y-=n),r=e.y})}function o(t,e){return t.y-e.y}var i=d3.nest().key(function(t){return t.x}).sortKeys(d3.ascending).entries(h).map(function(t){return t.values});e(),r();for(var l=1;t>0;--t)a(l*=.99),r(),n(l),r()}function i(){function t(t,e){return t.source.y-e.source.y}function e(t,e){return t.target.y-e.target.y}h.forEach(function(n){n.sourceLinks.sort(e),n.targetLinks.sort(t)}),h.forEach(function(t){var e=0,n=0;t.sourceLinks.forEach(function(t){t.sy=e,e+=t.dy}),t.targetLinks.forEach(function(t){t.ty=n,n+=t.dy})})}function c(t){return t.y+t.dy/2}function s(t){return t.value}var l={},d=24,u=8,p=[1,1],h=[],b=[];return l.nodeWidth=function(t){return arguments.length?(d=+t,l):d},l.nodePadding=function(t){return arguments.length?(u=+t,l):u},l.nodes=function(t){return arguments.length?(h=t,l):h},l.links=function(t){return arguments.length?(b=t,l):b},l.size=function(t){return arguments.length?(p=t,l):p},l.layout=function(a){return t(),e(),n(),o(a),i(),l},l.relayout=function(){return i(),l},l.link=function(){function t(t){var n=t.source.x+t.source.dx,a=t.target.x,r=d3.interpolateNumber(n,a),o=r(e),i=r(1-e),c=t.source.y+t.sy+t.dy/2,s=t.target.y+t.ty+t.dy/2;return"M"+n+","+c+"C"+o+","+c+" "+i+","+s+" "+a+","+s}var e=.5;return t.curvature=function(n){return arguments.length?(e=+n,t):e},t},l},d2b.MATH={},d2b.MATH.mean=function(t,e,n){var a=0,r=0;return n=d3.functor(n||1),e=d3.functor(e||function(t){return t}),t.filter(function(t){return!isNaN(d2b.number(n(t)))&&!isNaN(d2b.number(e(t)))}).forEach(function(t){var o=n(t),i=e(t);a+=o,r+=i*o}),t.length&&a?r/a:void 0},d2b.MATH.median=function(t,e,n){n=d3.functor(n||1),e=d3.functor(e||function(t){return t});var a,r=[],o=t.filter(function(t){return 0!==n(t)&&!isNaN(d2b.number(n(t)))&&!isNaN(d2b.number(e(t)))}).sort(function(t,n){return d3.ascending(e(t),e(n))});a=Math.round(d3.sum(o,function(t){return n(t)})/2*1e12)/1e12;var i=0,c=!1;return o.forEach(function(t){c&&(r.push(e(t)),c=!1),i+=n(t),i===a&&(r.push(e(t)),c=!0),i>a&&0===r.length&&r.push(e(t))}),t.length?d2b.MATH.mean(r):void 0},d2b.MATH.mode=function(t,e,n){n=d3.functor(n||1),e=d3.functor(e||function(t){return t});var a=[],r=0,o={};return t.forEach(function(t){var i=d2b.number(e(t));isNaN(e(t))||(o[i]=o[i]||0,o[i]+=n(t),o[i]>r?(r=o[e(t)],a=[e(t)]):o[e(t)]==r&&a.push(e(t)))}),t.length?d2b.MATH.mean(a):void 0},d2b.MATH.midpoint=function(t,e){return e=d3.functor(e||function(t){return t}),t.length?d3.mean(d3.extent(t,e)):void 0},d2b.MATH.range=function(t,e){e=d3.functor(e||function(t){return t});var n=d3.extent(t,e);return t.length?n[1]-n[0]:void 0},d2b.MATH.toRadians=function(t){return t*(Math.PI/180)},d2b.MATH.toDegrees=function(t){return t*(180/Math.PI)},d2b.model.chart=function(t){var e=arguments,n={},a={duration:500,dispatch:d3.dispatch.apply(this,t.events)},r={};return t.events=["beforeUpdate","afterUpdate"].concat(t.events),a.dispatch=d3.dispatch.apply(this,t.events),r.select=function(t){return e.length?(a.selection=t,r):a.selection},r.update=function(e){return a.dispatch.beforeUpdate.call(a.selection),t.update(),d3.timer.flush(),a.dispatch.afterUpdate.call(a.selection),e&&e(),r},r.width=function(){return r},r.height=function(){return r},n.internal=function(){return a},n["interface"]=function(){return r},n},d2b.SVG.axis=function(){var t={};t.innerTickSize=5,t.padding={top:0,bottom:0,left:0,right:0},t.width=d2b.CONSTANTS.DEFAULTWIDTH(),t.height=d2b.CONSTANTS.DEFAULTHEIGHT(),t.x={key:"x",axis:d3.svg.axis(),orientation:"bottom-outside",hidden:!1,labelOrientation:"outside"},t.y={key:"y",axis:d3.svg.axis(),orientation:"left-outside",hidden:!1,labelOrientation:"outside"},t.x2={key:"x2",axis:d3.svg.axis(),orientation:"top-outside",hidden:!0,labelOrientation:"outside"},t.y2={key:"y2",axis:d3.svg.axis(),orientation:"right-outside",hidden:!0,labelOrientation:"outside"},t.axisKeys=["x","y","x2","y2"],t.events=d2b.UTILS.customEvents(),t.updateScaleRange=function(t,e){t.rangeBand?t.rangeBands(e):t.range(e)},t.getMaxTickBox=function(t){var e=d3.select("body").append("svg").attr("class","d2b-axis").style("opacity",0),n={width:0,height:0};return e.call(t).selectAll(".tick text").each(function(t){var e=this.getBBox();n.width=Math.max(n.width,e.width),n.height=Math.max(n.height,e.height)}),e.remove(),n},t.getLabelHeight=function(t){var e=d3.select("body").append("svg").attr("class","d2b-axis"),n=e.append("text").attr("class","d2b-axis-label "+t).text("Test").style("opacity",0),a=parseInt(window.getComputedStyle(n.node()).fontSize,10);return e.remove(),a},t.initOridinalRanges=function(){t.axisKeys.forEach(function(e){var n=t[e].axis.scale();n.rangeBand&&n.rangeBands([0,1])})},t.initOridinalRanges(),t.updateScale=function(e){var n=e.axis.scale(),a=e.orientation;a=a.split("-");var r=a[0];"right"===r||"left"===r?t.updateScaleRange(n,[t.innerHeight,0]):t.updateScaleRange(n,[0,t.innerWidth])},t.denoteOriginTicks=function(){this.selectAll(".tick text").each(function(t){0===parseFloat(this.textContent)?d3.select(this.parentNode).classed("d2b-origin-tick",!0):d3.select(this.parentNode).classed("d2b-origin-tick",!1)})},t.updateGrid=function(e){var n=d3.transition(d3.select(this)),a=e.axis,r=e.orientation;r=r.split("-");var o=r[0];a.scale();"top"===o||"bottom"===o?a.orient("top").tickSize(-t.innerHeight):a.orient("left").tickSize(-t.innerWidth),n.call(a).call(t.denoteOriginTicks).style("opacity",1)},t.updateAxis=function(e){var n=d3.transition(d3.select(this)),a=e.axis,r=t.innerWidth,o=t.innerHeight,i=(a.scale(),"translate(0,0)");a.tickSize(t.innerTickSize);switch(e.orientation){case"left-inside":a.orient("right");break;case"left-outside":a.orient("left");break;case"right-inside":a.orient("left"),i="translate("+r+",0)";break;case"right-outside":a.orient("right"),i="translate("+r+",0)";break;case"top-inside":a.orient("bottom");break;case"top-outside":a.orient("top");break;case"bottom-inside":a.orient("top"),i="translate(0,"+o+")";break;case"bottom-outside":a.orient("bottom"),i="translate(0,"+o+")";break;default:a.orient("bottom"),i="translate(0,"+o+")"}n.call(a).call(t.denoteOriginTicks).style("opacity",1).attr("transform",i)},t.updateLabelInside=function(e){var n=d3.select(this),a=d3.transition(n),r="",o=t.labelHeightInside;.75*t.labelHeightOutside;switch(e.orientation.split("-")[0]){case"left":r="translate("+o+",5), rotate(-90)";break;case"right":r="translate(-5,5), rotate(-90)";
break;case"top":r="translate("+(t.innerWidth-5)+","+o+")";break;case"bottom":r="translate("+(t.innerWidth-5)+",-5)";break;default:r="translate(0,0)"}a.attr("transform",r).text(e.labelInside||"")},t.updateLabelOutside=function(e){var n=d3.select(this),a=d3.transition(n),r="",o=(t.labelHeightInside,.75*t.labelHeightOutside),i=e.orientation.split("-")[0]+"-"+e.labelOrientation;switch(i){case"left-outside":r="translate("+(-t.padding.left+o)+","+t.innerHeight/2+"), rotate(-90)";break;case"right-outside":r="translate("+t.padding.right+","+t.innerHeight/2+"), rotate(-90)";break;case"top-outside":r="translate("+t.innerWidth/2+","+(-t.padding.top+o)+")";break;case"bottom-outside":r="translate("+t.innerWidth/2+","+t.padding.bottom+")";break;default:r="translate(0,0)"}a.attr("transform",r).text(e.labelOutside||"")},t.setPadding=function(e,n){t.padding[e]=Math.max(t.padding[e],n)},t.updatePadding=function(){var e,n,a=1.25;t.customPadding?t.padding=t.customPadding:(t.padding={top:0,bottom:0,left:0,right:0},t.axesVisible.forEach(function(r){e=r.orientation.split("-"),n=t.getMaxTickBox(r.axis),t.setPadding("top",n.height/2),t.setPadding("bottom",n.height/2),t.setPadding("left",n.width/2),t.setPadding("right",n.width/2),"outside"===e[1]&&("right"===e[0]||"left"===e[0]?t.setPadding(e[0],a*n.width+t.innerTickSize):"top"!==e[0]&&"bottom"!==e[0]||t.setPadding(e[0],n.height+t.innerTickSize)),r.labelOutside&&(t.padding[e[0]]+=1.1*t.labelHeightOutside)}))},t.updateTickCounts=function(e,n){var a;t.axesVisible.forEach(function(t){a=t.tickCountMultiplier||1,t.axis.scale().rangeBand||(t.tickCount?t.axis.ticks(t.tickCount):["right","left"].indexOf(t.orientation.split("-")[0])>-1?t.axis.ticks(a*n/60):t.axis.ticks(a*e/75))})};var e=function(e){t.initOridinalRanges(),t.axesAll=[t.x,t.y,t.x2,t.y2],t.axesVisible=t.axesAll.filter(function(t){return!t.hidden}),t.labelHeightOutside=t.labelHeightOutside||t.getLabelHeight("d2b-label-outside"),t.labelHeightInside=t.labelHeightInside||t.getLabelHeight("d2b-label-inside"),t.updatePadding(),t.innerWidth=t.width-t.padding.left-t.padding.right,t.innerHeight=t.height-t.padding.top-t.padding.bottom,t.updateTickCounts(t.innerWidth,t.innerHeight),t.axesAll.forEach(t.updateScale),e.each(function(e,n){var a=d3.select(this),r=a.selectAll("g.d2b-axis-container").data([0]);r._enter=r.enter().append("g").attr("class","d2b-axis-container"),r._update=d3.transition(r).attr("transform","translate("+t.padding.left+","+t.padding.top+")"),r.grid=r.selectAll("g.d2b-axis-grid").data(t.axesVisible,function(t){return t.key}),r.grid._enter=r.grid.enter().append("g").attr("class",function(t){return"d2b-axis-grid d2b-"+t.key}).style("opacity",0).each(t.updateGrid),r.grid._update=d3.transition(r.grid).each(t.updateGrid),r.grid._exit=d3.transition(r.grid.exit()).style("opacity",0).remove(),r.axis=r.selectAll("g.d2b-axis").data(t.axesVisible,function(t){return t.key}),r.axis._enter=r.axis.enter().append("g").style("opacity",0).attr("class",function(t){return"d2b-axis d2b-"+t.key}).each(t.updateAxis),r.axis._update=d3.transition(r.axis).each(t.updateAxis),r.axis._exit=d3.transition(r.axis.exit()).style("opacity",0).remove(),r.axis._enter.append("text").attr("class","d2b-axis-label d2b-label-outside"),r.axis._enter.append("text").attr("class","d2b-axis-label d2b-label-inside"),r.axis.labelOutside=r.axis.select(".d2b-axis-label.d2b-label-outside"),r.axis.labelInside=r.axis.select(".d2b-axis-label.d2b-label-inside"),d3.transition(r.axis.labelOutside).each(t.updateLabelOutside),d3.transition(r.axis.labelInside).each(t.updateLabelInside)})};return e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.width=function(n){return arguments.length?(t.width=n,e):t.width},e.height=function(n){return arguments.length?(t.height=n,e):t.height},e.customPadding=function(n){return arguments.length?("number"==typeof n?t.customPadding={left:n,right:n,top:n,bottom:n}:t.customPadding=n,e):t.customPadding},t.axisKeys.forEach(function(n){e[n]=function(a){return arguments.length?(t[n].labelOutside=a.labelOutside||t[n].labelOutside,t[n].labelInside=a.labelInside||t[n].labelInside,t[n].axis=a.axis||t[n].axis,t[n].tickCount=a.tickCount||t[n].tickCount,t[n].tickCountMultiplier=a.tickCountMultiplier||t[n].tickCountMultiplier,t[n].hidden=null!=a.hidden&&void 0!=a.hidden?a.hidden:t[n].hidden,a.orientation&&(a.orientation=a.orientation.split("-"),t[n].orientation=a.orientation[0]+"-"+a.orientation[1]||"outside"),a.scale&&(t[n].scale=a.scale,t[n].axis.scale(t[n].scale)),e):t[n]}}),e.scale=function(n){var a,n=n.toLowerCase()||"x",r=e[n]().axis,o=r.scale(),i=!1;return a=t.axisKeys.indexOf(n)>-1?function(t){var r,t;e[n]().orientation.split("-")[0];"object"===("undefined"==typeof t?"undefined":_typeof(t))&&n in t&&(t=t[n]),r=o(t)||0;var c=o.range();return i?r=d3.max(c)-r+d3.min(c)+a.rangeBand()/2:r+=a.rangeBand()/2,r}:function(){return null},a.range=function(){var t=[];return o.rangeBand?(t=o.range(),t=[t[0],t[t.length-1]+o.rangeBand()]):t=o.range(),t},a.domain=function(){return i?o.domain().slice().reverse():o.domain()},a.reversed=function(t){return i=t,a},a.invert=function(t){var e=(o.domain(),o.invert(t));return e=o.invert(t)},a.rangeBand=function(){return o.rangeBand?o.rangeBand():0},a.change=function(t){return n=t.toLowerCase()||"x",r=e[n]().axis,o=r.scale(),a},a},e.box=function(n){return arguments.length?(t.width=n.width||t.width,t.height=n.height||t.height,t.customPadding=n.padding||t.customPadding,e):{width:t.width,height:t.height,innerWidth:t.innerWidth,innerHeight:t.innerHeight,padding:t.padding}},e},d2b.SVG.point=function(){var t={};t.size=d3.functor(150),t.type=d3.functor("circle"),t.active=d3.functor(!1),t.stroke=d3.functor(null),t.strokeWidth=d3.functor("1px"),t.fill=d3.functor(null),t.symbol=d2b.SVG.symbol().type(t.type),t.mouseover=function(e,n){var a=t.size.call(this,e,n),r=t.type.call(this,e,n),o=t.strokeWidth.call(this,e,n);a=15*Math.pow(a,.5)+a*Math.pow(parseFloat(o),.2),t.symbol.size(a).type(r),d3.select(this).select("path.d2b-point-background").transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("d",t.symbol)},t.mouseout=function(e,n){var a=t.size.call(this,e,n),r=t.type.call(this,e,n);t.symbol.size(a).type(r),d3.select(this).select("path.d2b-point-background").transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("d",t.symbol)};var e=function(e){e.each(function(e,n){var a=d3.select(this),r=t.size.call(this,e,n),o=t.type.call(this,e,n),i=t.fill.call(this,e,n),c=t.stroke.call(this,e,n),s=t.strokeWidth.call(this,e,n),l=t.active.call(this,e,n);t.symbol.size(r).type(o);var d=a.selectAll("path.d2b-point-background").data([e]),u=d.enter().append("path").attr("class","d2b-point-background"),p=d3.transition(d),h=d3.transition(d.exit());u.attr("d",t.symbol).style("fill","rgba(255,255,255,0)").style("stroke-width",s).style("stroke",c),p.attr("d",t.symbol).style("stroke",c),h.style("opacity",0).remove();var b=a.selectAll("path.d2b-point-foreground").data([e]),f=b.enter().append("path").attr("class","d2b-point-foreground"),g=d3.transition(b),S=d3.transition(b.exit());f.attr("d",t.symbol).style("stroke-width",s).style("stroke",c).style("fill",i),g.attr("d",t.symbol).style("fill",i).style("stroke",c),S.style("opacity",0).remove(),l?a.on("mouseover.d2b-mouseover",t.mouseover).on("mouseout.d2b-mouseout",t.mouseout):a.on("mouseover.d2b-mouseover",null).on("mouseout.d2b-mouseout",null)})};return e.type=function(n){return arguments.length?(t.type=d3.functor(n),t.symbol.type(t.type),e):t.type},e.size=function(n){return arguments.length?(t.size=d3.functor(n),t.symbol.size(t.size),e):t.size},e.fill=function(n){return arguments.length?(t.fill=d3.functor(n),e):t.fill},e.stroke=function(n){return arguments.length?(t.stroke=d3.functor(n),e):t.stroke},e.strokeWidth=function(n){return arguments.length?(t.strokeWidth=d3.functor(n),e):t.strokeWidth},e.active=function(n){return arguments.length?(t.active=d3.functor(n),e):t.active},e},d2b.SVG.symbol=function(){var t={};t.size=d3.functor(150),t.type=d3.functor("circle"),t.d3Symbol=d3.svg.symbol().type(t.type),t.symbol=t.d3Symbol;var e=function(e,n){var a=t.type.call(this,e,n),r=t.size;return d3.svg.symbolTypes.indexOf(a)>-1?t.symbol=t.d3Symbol.type(a).size(r):d2b.SVG.symbolTypes.indexOf(a)>-1?t.symbol=d2b.SVG.symbols[a]:t.symbol=t.d3Symbol.type("circle").size(r),t.symbol(t.size.call(this,e,n))};return e.size=function(n){return arguments.length?(t.size=d3.functor(n),e):t.size},e.type=function(n){return arguments.length?(t.type=d3.functor(n),e):t.type},e},d2b.SVG.symbols={star:function(t){var e=Math.sin(d2b.MATH.toRadians(36)),n=Math.cos(d2b.MATH.toRadians(36)),a=Math.sin(d2b.MATH.toRadians(54)),r=Math.cos(d2b.MATH.toRadians(54)),o=Math.sin(d2b.MATH.toRadians(18)),i=Math.cos(d2b.MATH.toRadians(18)),c=Math.tan(d2b.MATH.toRadians(18)),s=Math.sqrt(t/(5*n*(e+n/c))),l=s*e+s*n/c;return"M0,"+-l+"L"+s*r+","+-s*a+" "+l*i+","+-l*o+" "+s*i+","+s*o+" "+l*e+","+l*n+" 0,"+s+" "+-l*e+","+l*n+" "+-s*i+","+s*o+" "+-l*i+","+-l*o+" "+-s*r+","+-s*a+" 0,"+-l+"Z"},mars:function(t){var e=Math.sqrt(t/(Math.PI+5/4)),n=Math.sqrt(8),a=Math.sqrt(2),r=.3125*e;return"M"+e/n+",0A"+e+","+e+" 0 1,1 0,"+-e/n+"L"+e*(5/4-1/a)+","+-e*(1/n+5/4-1/a)+" "+(e*(5/4-1/a)-r)+","+-e*(1/n+5/4-1/a)+" "+(e*(5/4-1/a)-r)+","+-e*(1/n+7/4-1/a)+" "+e*(7/4-1/a+1/n)+","+-e*(1/n+7/4-1/a)+" "+e*(7/4-1/a+1/n)+","+(-e*(5/4-1/a)+r)+" "+e*(5/4-1/a+1/n)+","+(-e*(5/4-1/a)+r)+" "+e*(5/4-1/a+1/n)+","+-e*(5/4-1/a)+"Z"},venus:function(t){var e=Math.sqrt(t/(Math.PI+5/4));return"M"+-e/4+","+e/4+"A"+e+","+e+" 0 1,1 "+e/4+","+e/4+"L"+e/4+","+3*e/4+" "+3*e/4+","+3*e/4+" "+3*e/4+","+5*e/4+" "+e/4+","+5*e/4+" "+e/4+","+7*e/4+" "+-e/4+","+7*e/4+" "+-e/4+","+5*e/4+" "+3*-e/4+","+5*e/4+" "+3*-e/4+","+3*e/4+" "+-e/4+","+3*e/4+"Z"},close:function(t){var e=Math.sqrt(t/5),n=Math.sqrt(e*e/2),a=Math.sqrt(.5)*e,r=n+a;return"M0,"+-a+"L"+n+","+-r+" "+r+","+-n+" "+a+",0 "+r+","+n+" "+n+","+r+" 0,"+a+" "+-n+","+r+" "+-r+","+n+" "+-a+",0 "+-r+","+-n+" "+-n+","+-r+" 0,"+-a+"Z"},hexagon:function(t){var e=Math.sqrt(2*t/(3*Math.sqrt(3))),n=Math.cos(d2b.MATH.toRadians(30))*e,a=Math.sin(d2b.MATH.toRadians(30))*e;return"M0,"+-e+"L"+n+","+-a+" "+n+","+a+" 0,"+e+" "+-n+","+a+" "+-n+","+-a+"Z"},"rect-horizontal":function(t){var e=3,n=Math.sqrt(t/e),a=n*e;return"M"+-a/2+","+-n/2+"L"+a/2+","+-n/2+" "+a/2+","+n/2+" "+-a/2+","+n/2+"Z"},"rect-vertical":function(t){var e=1/3,n=Math.sqrt(t/e),a=n*e;return"M"+-a/2+","+-n/2+"L"+a/2+","+-n/2+" "+a/2+","+n/2+" "+-a/2+","+n/2+"Z"},"arrow-right":function(t){var e=Math.sqrt(.8*t);return"M"+-e+","+-e/4+"L0,"+-e/4+" 0,"+-3*e/4+" "+e+",0 0,"+3*e/4+" 0,"+e/4+" "+-e+","+e/4+"Z"},"arrow-left":function(t){var e=Math.sqrt(.8*t);return"M"+e+","+-e/4+"L0,"+-e/4+" 0,"+-3*e/4+" "+-e+",0 0,"+3*e/4+" 0,"+e/4+" "+e+","+e/4+"Z"},"arrow-up":function(t){var e=Math.sqrt(.8*t);return"M"+-e/4+","+e+"L"+-e/4+",0 "+-3*e/4+",0 0,"+-e+" "+3*e/4+",0 "+e/4+",0 "+e/4+","+e+"Z"},"arrow-down":function(t){var e=Math.sqrt(.8*t);return"M"+-e/4+","+-e+"L"+-e/4+",0 "+-3*e/4+",0 0,"+e+" "+3*e/4+",0 "+e/4+",0 "+e/4+","+-e+"Z"}},d2b.SVG.symbols["cross-diagonal"]=d2b.SVG.symbols.close,d2b.SVG.symbols.x=d2b.SVG.symbols.close,d2b.SVG.symbolTypes=d3.svg.symbolTypes.concat(["star","close","rect-horizontal","rect-vertical","arrow-right","arrow-left","arrow-up","arrow-down","venus","mars","hexagon"]),d2b.UTILS.symbol=d2b.SVG.symbol,d2b.UTILS.symbolTypes=d2b.SVG.symbolTypes,d2b.SVG.tooltip=function(){var t={};t.layout=0,t.container=d3.select("body"),t.animationDuration=100,t.graph={},t.refreshLayout={},t.refreshLayout[0]=function(){for(var e in t.graph)t.graph[e].call(d2b.UTILS.bindTooltip,t.graph[e].config.content,t.graph[e].config.data,t.graph[e].config.fill)},t.refreshLayout[1]=function(){if(t.tracker&&t.container&&t.x&&t.y){var e=[];for(var n in t.graph)e.push(t.graph[n]);var a=t.container.selectAll(".d2b-tooltip").data(e,function(t){return t.config.key});a._update=a.transition().duration(t.animationDuration),a._enter=a.enter().append("g").attr("class","d2b-tooltip d2b-tooltip-layout-1"),a._enter.append("polyline").style("stroke-width","2px").style("fill","none"),a._enter.append("rect"),a._enter.append("circle").attr("r",3),a._enter.append("text").style("font-size","12px"),a._exit=a.exit().transition().duration(t.animationDuration).style("opacity",0).remove(),t.tracker.on("mouseenter.d2b-tooltip",function(){t.container.transition().duration(t.animationDuration).style("opacity",1)}),t.tracker.on("mouseleave.d2b-tooltip",function(){t.container.transition().duration(t.animationDuration).style("opacity",0)}),t.tracker.on("mousemove.d2b-tooltip",function(){t.mousemoveLayout1(this,a)})}},t.mousemoveLayout1=function(e,n){var a=t.x.range(),r=Math.abs(a[1]-a[0]),o=t.y.range(),i=(Math.abs(o[1]-o[0]),d3.mouse(e)),c=[t.x.invert(i[0]),t.y.invert(i[1])],s="right";r/2<i[0]&&(s="left");var l=t.initCellArray(d3.min(o),d3.max(o));n.each(function(e){var n,a,r,o,i=t.getClosestProperties(c,e),d=15,u=5,p=3,h=5;this.closest=i;var b=d3.select(this);b.update=b.transition().duration(t.animationDuration).ease("linear"),n=b.select("text"),n.update=n.transition().duration(t.animationDuration).ease("linear"),r=b.select("polyline"),r.update=r.transition().duration(t.animationDuration).ease("linear"),a=b.select("rect"),a.update=a.transition().duration(t.animationDuration).ease("linear"),o=b.select("circle"),n.text(this.closest.content);var f=n.node().getBBox();this.offsetY=t.offsetForCollisionResolution(l,t.y(this.closest.y),f.height+2*p+2*h),b.update.attr("transform","translate("+t.x(this.closest.x)+","+t.y(this.closest.y)+")"),a.attr("width",f.width+2*u).attr("height",f.height+2*p).style("stroke",this.closest.darkFill).style("fill",this.closest.fill),o.style("stroke",this.closest.darkFill),r.style("stroke",this.closest.darkFill),"right"===s?(n.update.attr("transform","translate("+(d+u)+","+(f.height/3.5+this.offsetY)+")").style("text-anchor","start"),a.update.attr("transform","translate("+d+","+(-f.height/2-p+this.offsetY)+")"),r.update.attr("points","0,0 0,"+this.offsetY+" "+d+","+this.offsetY)):(n.update.attr("transform","translate("+(-d-u)+","+(f.height/3.5+this.offsetY)+")").style("text-anchor","end"),a.update.attr("transform","translate("+(-f.width-d-2*u)+","+(-f.height/2-p+this.offsetY)+")"),r.update.attr("points","0,0 0,"+this.offsetY+" "+-d+","+this.offsetY))})},t.initCellArray=function(t,e){t=d3.round(t,0),e=d3.round(e,0),e=Math.max(e,t),t=Math.min(e,t);var n=[],a=t;for(n.top=e,n.bottom=t;e>a;a+=1)n[a]=!1;return n},t.offsetForCollisionResolution=function(e,n,a){var r=t.findClosestOpenOffset(e,n,a);return t.occupyPixels(e,n+r,a),r},t.findClosestOpenOffset=function(t,e,n){var a=0,r=0;e=d3.round(e,0),n=d3.round(n,0);for(var o=d3.round(n/2,0),i=o,c=-o;n>a&&i+e>t.bottom;)t[i+e]&&(a=-1),a+=1,i-=1;for(;n>r&&c+e<t.top;)t[c+e]&&(r=-1),r+=1,c+=1;return c-=o,i+=o,Math.abs(c)<Math.abs(i)&&r>=n?c:a>=n?i:r>a?c:i},t.occupyPixels=function(t,e,n){var a;e=d3.round(e,0);var r=d3.round(n/2,0);for(a=e-r;e+r>=a;a+=1)t[a]=!0},t.getClosestProperties=function(t,e){var n=1/0,a=1/0,r=null;return e.each(function(o,i){var c={};if(c.x="function"==typeof e.config.x?e.config.x.apply(this,arguments):e.config.x||null,c.y="function"==typeof e.config.y?e.config.y.apply(this,arguments):e.config.y||null,null!==c.y&&null!==c.x&&void 0!==c.y&&void 0!==c.x){var s=Math.abs(t[0]-c.x),l=Math.abs(t[1]-c.y);s>n||s===n&&l>a||(c.point=[c.x,c.y],c.data="function"==typeof e.config.data?e.config.data.apply(this,arguments):e.config.data||o,c.content="function"==typeof e.config.content?e.config.content.apply(this,[c.data,i]):o.config.content,c.fill="function"==typeof e.config.fill?e.config.fill.apply(this,arguments):e.config.fill||o,c.darkFill=d3.rgb(c.fill).darker(1),c.data=o,n=s,a=l,r=c)}}),r},t.stop=function(){t.tracker&&(t.tracker.on("mouseenter.d2b-tooltip",null),t.tracker.on("mousemove.d2b-tooltip",null),t.tracker.on("mouseout.d2b-tooltip",null));for(var e in t.graph)t.graph[e].call(d2b.UTILS.unbindTooltip);d2b.UTILS.removeTooltip(),t.container.selectAll(".d2b-tooltip").remove()};var e={};return e.container=function(n){return arguments.length?(t.container=n,t.container.transition().duration(t.animationDuration).style("opacity",0),e):t.container},e.tracker=function(n){return arguments.length?(t.tracker=n,e):t.tracker},e.graph=function(n,a){return arguments.length?(t.graph[a.key]=n,t.graph[a.key].config=a,e):t.graph},e.layout=function(n){return arguments.length?(t.layout=n+"",e):t.layout},e.animationDuration=function(n){return arguments.length?(t.animationDuration=n,e):t.animationDuration},e.start=function(){return t.refreshLayout[t.layout](),e},e.stop=function(){return t.stop(),e},e.reset=function(){return t.stop(),t.graph={},e},e.x=function(n){return arguments.length?(t.x=n,e):t.x},e.y=function(n){return arguments.length?(t.y=n,e):t.y},e},d2b.UTILS.breadcrumbs=function(){var t,e=d2b.CONSTANTS.DEFAULTWIDTH(),n=(d2b.CONSTANTS.DEFAULTCOLOR(),{items:[]}),a=0,r=0,o=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,c=5,s={elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){}},l={};return l.width=function(t){return arguments.length?(e=t,l):e},l.computedHeight=function(){return r},l.computedWidth=function(){return a},l.selection=function(e){return arguments.length?(t=e,l):t},l.scale=function(t){return arguments.length?(c=t,l):c},l.animationDuration=function(t){return arguments.length?(o=t,l):o},l.on=function(t,e){return t=t.split("."),arguments.length?1==arguments.length?t[1]?s[t[0]][t[1]]:s[t[0]]["default"]:(t[1]?s[t[0]][t[1]]=e:s[t[0]]["default"]=e,l):s},l.data=function(t,e){return arguments.length?(n=t.data,l):n},l.update=function(e){if(!t)return console.warn("breadcrumbs was not given a selection");t.breadcrumb=t.selectAll("g.d2b-breadcrumb").data(n.items,function(t){return t.key?t.key:i});var a=t.breadcrumb.enter().append("g").attr("class","d2b-breadcrumb").style("opacity",0);a.append("path"),a.append("text");var s=c,d=c,u=4*c;t.breadcrumb.text=t.breadcrumb.select("text").text(function(t){return t.label}).attr("x",function(t,e){return 0==e?d+s/2:d+s}).attr("y",2.9*c).style("font-size",2.5*c+"px"),t.breadcrumb.path=t.breadcrumb.select("path");var p=0;return t.breadcrumb.each(function(e,n){var a=d3.select(this);a.text=a.select("text"),a.path=a.select("path");var r=a.text.node().getComputedTextLength()+2*d+s,i=s,c=s;0==n&&(i=0),n==t.breadcrumb.size()-1&&(c=0),a.path.transition().duration(o/2).attr("d","M 0 0 L "+i+" "+u/2+" L 0 "+u+" L "+r+" "+u+" L "+(r+c)+" "+u/2+" L "+r+" 0 L 0 0 Z"),a.transition().duration(o/2).style("opacity",1).attr("transform","translate("+p+",0)"),p+=s+r}),r=u,t.breadcrumb.exit().transition().duration(o/4).style("opacity",0).remove(),l},l},d2b.UTILS.chartAdapter=function(t,e){if(e.chart=new d2b.CHARTS[t],e.properties)for(var n in e.properties)e.properties[n].args?e.chart[n].apply(this,e.properties[n].args):e.chart[n](e.properties[n])},d2b.UTILS.chartLayoutAdapter=function(t,e){if(e.chart=new d2b.CHARTS[t],e.chartLayoutData||(e.chartLayoutData={}),e.chartLayout=new d2b.UTILS.CHARTPAGE.chartLayout,e.chartLayout.chart(e.chart).data(e.chartLayoutData),e.properties)for(var n in e.properties)e.properties[n].args?e.chart[n].apply(this,e.properties[n].args):e.chart[n](e.properties[n])},d2b.createNameSpace("d2b.UTILS.CHARTS.HELPERS"),d2b.UTILS.CHARTS.HELPERS.updateLegend=function(t){var e=10;t.legend.orientation("right"==t.legendOrientation||"left"==t.legendOrientation?"vertical":"horizontal").data(t.legendData).height(t.innerHeight).width(t.innerWidth).update();var n;n="right"==t.legendOrientation?"translate("+(t.forcedMargin.left+t.innerWidth-t.legend.computedWidth())+","+((t.innerHeight-t.legend.computedHeight())/2+t.forcedMargin.top)+")":"left"==t.legendOrientation?"translate("+t.forcedMargin.left+","+((t.innerHeight-t.legend.computedHeight())/2+t.forcedMargin.top)+")":"top"==t.legendOrientation?"translate("+(t.forcedMargin.left+(t.innerWidth-t.legend.computedWidth())/2)+","+t.forcedMargin.top+")":"translate("+(t.forcedMargin.left+(t.innerWidth-t.legend.computedWidth())/2)+","+(t.innerHeight+t.forcedMargin.top-t.legend.computedHeight())+")",t.selection.legend.transition().duration(t.animationDuration).attr("transform",n);var a;a="right"==t.legendOrientation||"left"==t.legendOrientation?t.legend.computedWidth():t.legend.computedHeight(),a&&(a+=e),t.forcedMargin[t.legendOrientation]+=a,t.innerHeight=t.outerHeight-t.forcedMargin.top-t.forcedMargin.bottom,t.innerWidth=t.outerWidth-t.forcedMargin.left-t.forcedMargin.right},d2b.UTILS.CHARTS.HELPERS.updateControls=function(t){var e=10,n=d2b.UTILS.getValues(t.controlsData).filter(function(t){return t.visible});n.map(function(t){t.data={state:t.enabled,label:t.label,key:t.key}}),t.controls.data(n).width(t.innerWidth).update(),t.selection.controls.transition().duration(t.animationDuration).attr("transform","translate("+(t.forcedMargin.left+t.innerWidth-t.controls.computedWidth())+","+t.forcedMargin.top+")");var a=t.controls.computedHeight();a&&(a+=e),t.forcedMargin.top+=a,t.innerHeight=t.outerHeight-t.forcedMargin.top-t.forcedMargin.bottom},d2b.UTILS.CHARTS.HELPERS.updateDimensions=function(t){t.outerWidth=t.outerWidth-t.forcedMargin.right-t.forcedMargin.left,t.outerHeight=t.outerHeight-t.forcedMargin.top-t.forcedMargin.bottom,t.forcedMargin={top:0,bottom:0,left:0,right:0},t.innerWidth=t.outerWidth,t.innerHeight=t.outerHeight},d2b.UTILS.CHARTS.HELPERS.generateDefaultSVG=function(t){t.selection.selectAll("*").remove(),t.selection.svg=t.selection.append("svg").attr("class","d2b-svg d2b-container"),t.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),t.selection.group=t.selection.svg.append("g").attr("transform","translate("+t.forcedMargin.left+","+t.forcedMargin.top+")"),t.selection.legend=t.selection.group.append("g").attr("class","d2b-legend"),t.selection.controls=t.selection.group.append("g").attr("class","d2b-controls")},d2b.UTILS.CHARTPAGE.chartLayout=function(){var t,e,n=d2b.CONSTANTS.DEFAULTWIDTH(),a=d2b.CONSTANTS.DEFAULTHEIGHT(),r={chartLayout:{}},o=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,i=!0,c={};return c.chart=function(t){return arguments.length?(e=t,i=!0,c):e},c.width=function(t){return arguments.length?(n=t,c):n},c.height=function(t){return arguments.length?(a=t,c):a},c.selection=function(e){return arguments.length?(t=e,i=!0,c):t},c.select=function(e){return arguments.length?(t=d3.select(e),i=!0,c):t},c.animationDuration=function(t){return arguments.length?(o=t,e.animationDuration(o),c):o},c.data=function(t,e){return arguments.length?(e&&(r={chartLayout:{}},i=!0),t.data.chartLayout.footnote&&(r.chartLayout.footnote=t.data.chartLayout.footnote),t.data.chartLayout.rightNotes&&(r.chartLayout.rightNotes=t.data.chartLayout.rightNotes),t.data.chartLayout.leftNotes&&(r.chartLayout.leftNotes=t.data.chartLayout.leftNotes),t.data.chartLayout.title&&(r.chartLayout.title=t.data.chartLayout.title),t.data.chartLayout.titleAlt&&(r.chartLayout.titleAlt=t.data.chartLayout.titleAlt),t.data.chartCallback&&(r.chartCallback=t.data.chartCallback),t.data.chartLayout.info&&(r.chartLayout.info=t.data.chartLayout.info),c):r},c.generate=function(n){t.selectAll("*").remove(),t.wrapper=t.append("div").attr("class","d2b-chart-layout-wrapper"),t.container=t.wrapper.append("div").attr("class","d2b-chart-layout d2b-container"),t.container.header=t.container.append("div").attr("class","d2b-chart-layout-header"),t.container.header.title=t.container.header.append("div").attr("class","d2b-chart-layout-title"),t.container.header.titleAlt=t.container.header.append("div").attr("class","d2b-chart-layout-title-alt"),t.container.header.infoIcon=t.container.header.append("div").attr("class","d2b-chart-layout-info-icon"),t.container.info=t.container.append("div").attr("class","d2b-chart-layout-info"),t.container.chart=t.container.append("div").attr("class","d2b-chart-layout-chart"),e.selection(t.container.chart),t.container.rightNotes=t.container.append("div").attr("class","d2b-chart-layout-right-notes"),t.container.rightNotes.ul=t.container.rightNotes.append("ul"),t.container.leftNotes=t.container.append("div").attr("class","d2b-chart-layout-left-notes"),t.container.leftNotes.ul=t.container.leftNotes.append("ul"),t.container.footnote=t.container.append("div").attr("class","d2b-chart-layout-footnote"),t.container.footnote.div=t.container.footnote.append("div"),t.container.source=t.container.append("div").attr("class","d2b-chart-layout-source").append("ul"),i=!1;var a=o;return c.animationDuration(0).update(n).animationDuration(a),c},c.update=function(s){if(!t)return console.warn("chartLayout was not given a selection");if(!e)return console.warn("chartLayout was not given a chart");if(i)return c.generate(s);var l={top:10,bottom:0,left:0,right:0};t.wrapper.style("width",n+"px").style("height",a+"px"),t.container.header.title.text(r.chartLayout.title),t.container.header.titleAlt.text(r.chartLayout.titleAlt);var d=t.container.header.node().getBoundingClientRect().height;r.chartLayout.title?(t.container.header.style("opacity",1),l.top+=d):t.container.header.style("opacity","0"),r.chartLayout.info?(t.container.header.infoIcon.html('<i class="fa fa-info-circle"></i>').on("click",function(){t.container.info.classed("d2b-visible",!t.container.info.classed("d2b-visible"))}),t.container.info.html(r.chartLayout.info).style("top",d+"px").style("height",a-d+"px")):(t.container.header.infoIcon.selectAll("*").on("click.d2b-click",null).remove(),t.container.info.selectAll("*").remove()),t.container.footnote.div.text(r.chartLayout.footnote),l.bottom+=t.container.footnote.node().getBoundingClientRect().height,t.container.footnote.style("top",a-l.bottom+"px"),!r.chartLayout.rightNotes||r.chartLayout.rightNotes.length<1?r.chartLayout.rightNotes=[]:l.right+=.2*n+5;var u=t.container.rightNotes.ul.selectAll("li.d2b-chart-layout-note").data(r.chartLayout.rightNotes);u.enter().append("li").attr("class","d2b-chart-layout-note").append("div");var p=0;u.select("div").text(function(t){return t}).each(function(t){p+=this.getBoundingClientRect().height}),u.exit().style("opacity",0).remove(),t.container.rightNotes.style("width",.2*n+"px").style("height",a-l.top+"px").style("left",.8*n-5+"px"),u.style("padding-top",Math.max(10,(a-p)/(1.8*u.size()))+"px"),!r.chartLayout.leftNotes||r.chartLayout.leftNotes.length<1?r.chartLayout.leftNotes=[]:l.left+=.2*n;var h=t.container.leftNotes.ul.selectAll("li.d2b-chart-layout-note").data(r.chartLayout.leftNotes);h.enter().append("li").attr("class","d2b-chart-layout-note").append("div");var b=0;h.select("div").text(function(t){return t}).each(function(t){b+=this.getBoundingClientRect().height}),h.exit().style("opacity",0).remove(),t.container.leftNotes.style("width",.2*n+"px").style("left","5px"),h.style("padding-top",Math.max(10,(a-b)/(1.8*h.size()))+"px");var f=n-l.left-l.right-10,g=a-l.top-l.bottom;return t.container.chart.style("left",l.left+5+"px").style("top",l.top+"px").style("width",f+"px").style("height",g+"px"),e.width(f).height(g).animationDuration(o).update(r.chartCallback),d3.timer.flush(),s&&s(),c},c},d2b.createNameSpace("d2b.UTILS.CHARTS.MEMBERS"),d2b.UTILS.CHARTS.MEMBERS.events=function(t,e,n){return function(a,r){var o=a.split("-");return"element"==o[0]?e.events.addElementListener("main",a,r):e.events.addListener(a,r),n&&n(a,r),t}},d2b.UTILS.CHARTS.MEMBERS.select=function(t,e,n){return function(a){return e.selection=d3.select(a),n&&n(a),t}},d2b.UTILS.CHARTS.MEMBERS.prop=function(t,e,n,a){return function(r){return arguments.length?(e[n]=r,a&&a(r),t):e[n]}},d2b.UTILS.CHARTS.MEMBERS.format=function(t,e,n,a){return function(r){return arguments.length?(e[n]=d2b.UTILS.numberFormat(r),a&&a(r),t):e[n]}},d2b.UTILS.CHARTS.MEMBERS.controls=function(t,e,n){return function(a){if(!arguments.length)return e.controlsData;for(var r in a)for(var o in a[r])e.controlsData[r][o]=a[r][o];return n&&n(a),t}},d2b.createNameSpace("d2b.UTILS.CONTROLS"),d2b.UTILS.CONTROLS.checkbox=function(){var t={};t.scale=5,t.selection,t.container,t.computedWidth=0,t.computedHeight=0,t.currentData={label:"",state:!1},t.events=d2b.UTILS.chartEvents();var e={};return e.scale=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"scale"),e.select=d2b.UTILS.CHARTS.MEMBERS.select(e,t),e.selection=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"selection"),e.container=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"container"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.checked=function(n){return arguments.length?(t.currentData.state=n,e.update()):t.currentData.state},e.computedHeight=function(){return t.computedHeight},e.computedWidth=function(){return t.computedWidth},e.data=function(n,a){return arguments.length?(t.currentData=n,e):t.currentData},e.update=function(n){if(!t.selection&&!t.container)return console.warn("checkbox was not given a selection or html container"),e;if(!t.currentData)return console.warn("checkbox data is null"),e;t.selection||(t.selection=t.container.append("svg"),t.container.svg=t.selection);var a=t.selection.selectAll("g.d2b-checkbox-container").data([t.currentData]),r=a.enter().append("g").attr("class","d2b-checkbox-container").on("click.d2b-click",function(n,a){t.currentData.state=!t.currentData.state,t.events.dispatch("change",this,[n,a]),e.update()}).call(t.events.addElementDispatcher,"main","d2b-checkbox");r.append("rect").attr("rx",1),r.append("path"),r.append("text").text(function(t){return t.label});var o="translate("+.4*t.scale+","+.4*t.scale+")",i=a.select("path").attr("transform",o).attr("d","M"+.38*t.scale+","+1.06*t.scale+" l"+.7*t.scale+","+.5*t.scale+" l"+.58*t.scale+","+-1.19*t.scale).style("stroke-width",.25*t.scale).attr("stroke-dasharray",2.2*t.scale);i.transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("stroke-dashoffset",t.currentData.state?0:2.2*t.scale);var c=(a.select("rect").attr("width",2.1*t.scale+"px").attr("height",2.1*t.scale+"px").attr("transform",o).style("stroke-width",.25*t.scale),a.select("text").attr("y",2.4*t.scale).attr("x",3.2*t.scale).style("font-size",2.5*t.scale+"px")),s=c.node().getComputedTextLength(),l=t.scale;return s+=l,t.computedWidth=s+2.5*t.scale,t.computedHeight=2.9*t.scale,t.container&&t.container.svg&&t.container.svg.attr("width",t.computedWidth).attr("height",t.computedHeight),n&&n(),e},e},d2b.UTILS.CONTROLS.radioButtons=function(){var t={};t.scale=5,t.container,t.selection,t.computedWidth=0,t.computedHeight=0,t.currentData={label:"",values:[],selected:null},t.events=d2b.UTILS.chartEvents(),t.resetValues=function(){t.currentData.values.forEach(function(t){t.selected=!1})};var e={};return e.scale=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"scale"),e.select=d2b.UTILS.CHARTS.MEMBERS.select(e,t),e.selection=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"selection"),e.container=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"container"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.computedHeight=function(){return t.computedHeight},e.computedWidth=function(){return t.computedWidth},e.data=function(n,a){if(!arguments.length)return t.currentData;t.currentData=n;var r=!1;return t.currentData.values.forEach(function(e){r&&(e.selected=!1),e.selected&&(t.currentData.selected=e,r=!0)}),r||(t.currentData.selected=t.currentData.values[0],t.currentData.values[0].selected=!0),e},e.update=function(n){if(!t.selection&&!t.container)return console.warn("radio buttons was not given a selection or html container"),e;if(!t.currentData)return console.warn("radio buttons data is null"),e;t.selection||(t.selection=t.container.append("svg"),t.container.svg=t.selection);var a=t.selection.selectAll("g.d2b-radio-button-container").data(t.currentData.values,function(t){return t.label}),r=a.enter().append("g").attr("class","d2b-radio-button-container").on("click.d2b-click",function(n,a){t.resetValues(),n.selected=!0,t.currentData.selected=n,t.events.dispatch("change",t.selection.node(),[t.currentData,a]),e.update()}).call(t.events.addElementDispatcher,"main","d2b-radio-button");a.attr("transform",function(e,n){return"translate(0,"+3.3*n*t.scale+")"}),r.append("circle").attr("class","d2b-radio-button-inner").style("fill-opacity",0),r.append("circle").attr("class","d2b-radio-button-outer"),
r.append("text").text(function(t){return t.label});var o=a.select("circle.d2b-radio-button-inner").attr("cy",1.4*t.scale).attr("cx",1.4*t.scale);a.select("circle.d2b-radio-button-outer").attr("r",1*t.scale+"px").attr("cy",1.4*t.scale).attr("cx",1.4*t.scale).style("stroke-width",.25*t.scale);o.transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).style("fill-opacity",function(t){return t.selected?1:0}).attr("r",function(e){return e.selected?.5*t.scale:0});var i=a.select("text").attr("y",2.4*t.scale).attr("x",3.2*t.scale).style("font-size",2.5*t.scale+"px"),c=0;return i.each(function(){c=Math.max(c,this.getComputedTextLength())}),t.computedWidth=c+3.4*t.scale,t.computedHeight=t.currentData.values.length*t.scale*3.2,t.container&&t.container.svg&&t.container.svg.attr("width",t.computedWidth).attr("height",t.computedHeight),n&&n(),e},e},d2b.UTILS.CONTROLS.htmlControls=function(){var t={};t.maxWidth=d2b.CONSTANTS.DEFAULTWIDTH(),t.currentData,t.computedWidth=0,t.computedHeight=0,t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.controlsHash={},t.selection,t.scale=5,t.makeControlsHash=function(){t.controlsHash={},t.currentData.controls.forEach(function(e){t.controlsHash[e.key]=e})},t.events=d2b.UTILS.chartEvents();var e={};return e.select=d2b.UTILS.CHARTS.MEMBERS.select(e,t),e.width=function(n){return arguments.length?(t.maxWidth=n,e):t.maxWidth},e.computedHeight=function(){return t.computedHeight},e.computedWidth=function(){return t.computedWidth},e.selection=function(n){return arguments.length?(t.selection=n,e):t.selection},e.scale=function(n){return arguments.length?(t.scale=n,e):t.scale},e.animationDuration=function(n){return arguments.length?(t.animationDuration=n,e):t.animationDuration},e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.data=function(n,a){return arguments.length?(t.currentData=n,t.makeControlsHash(),e):t.currentData},e.update=function(n){if(!t.selection)return console.warn("controls was not given a selection");t.selection.controlContainer=t.selection.selectAll("div.d2b-control-container").data(t.currentData.controls,function(t){return t.type+"-"+t.key});var a=t.selection.controlContainer.enter().append("div").attr("class","d2b-control-container");return a.append("div").attr("class","d2b-control-label").text(function(t){return t.label+":"}),a.append("div").attr("class","d2b-control").each(function(t){this.control=new d2b.UTILS.CONTROLS[t.type],this.control.container(d3.select(this))}),t.selection.controlContainer.control=t.selection.controlContainer.select(".d2b-control").each(function(e){this.control.scale(t.scale).data(e).on("change.d2b-change",function(e,n){t.events.dispatch("change",t.selection,[t.controlsHash,e,n])}).update()}),t.selection.controlContainer.exit().remove(),e},e},d2b.UTILS.CONTROLS.controls=function(){var t={};t.maxWidth=d2b.CONSTANTS.DEFAULTWIDTH(),t.currentData,t.computedWidth=0,t.computedHeight=0,t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.events=d2b.UTILS.chartEvents(),t.selection,t.scale=5;var e={};return e.scale=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"scale"),e.select=d2b.UTILS.CHARTS.MEMBERS.select(e,t),e.selection=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"selection"),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.computedHeight=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"computedHeight"),e.computedWidth=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"computedWidth"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.data=function(n,a){return arguments.length?(t.currentData=n,e):t.currentData},e.update=function(e){if(!t.selection)return console.warn("controls was not given a $$.selection");var n=3*t.scale,a=t.scale;if(t.computedHeight=0,t.computedWidth=0,t.currentData.length>0){var r=t.selection.selectAll("g.d2b-control").data(t.currentData,function(t){return t.label+","+t.type});r.enter().append("g").attr("class","d2b-control").each(function(e){e.control=(new d2b.UTILS.CONTROLS[e.type]).selection(d3.select(this)),t.events.translateEvents(e.control)});var o=0,i=0;r.each(function(e){e.control.scale(t.scale).data(e.data).update(),t.computedWidth+e.control.computedWidth()>t.maxWidth&&(t.computedWidth=0,t.computedHeight+=o+a,o=0),d3.select(this).transition().duration(t.animationDuration).style("opacity",1).attr("transform","translate("+t.computedWidth+","+t.computedHeight+")"),t.computedWidth+=e.control.computedWidth()+n,o<e.control.computedHeight()&&(o=e.control.computedHeight()),i<t.computedWidth&&(i=t.computedWidth)}),t.computedWidth=i-n,t.computedHeight+=o,r.exit().transition().duration(t.animationDuration).style("opacity",0).remove()}return r},e},d2b.UTILS.customEvents=function(){var t={};return t.events={},{addListener:function(e,n){var e=e.split("."),a=e[0],r=e[1];t.events[a]||(t.events[a]={}),t.events[a][r]=n},dispatch:function(e,n,a){for(var r in t.events[e])t.events[e][r]&&t.events[e][r].apply(n,a)},events:function(){return t.events}}},d2b.UTILS.chartEvents=function(){var t={};t.elementDispatchers={},t.elementListeners={},t.setElementEvents=function(t,e,n,a,r){var o;o=n?function(){var t=Array.prototype.slice.call(arguments);t.unshift(r),n.apply(this,t)}:null,t.on(e.split("-")[1]+"."+a+".d2b-element-event",o)};var e=d2b.UTILS.customEvents();return e.addElementListener=function(e,n,a){t.elementListeners[n]=a;for(var r in t.elementDispatchers[e])t.setElementEvents(t.elementDispatchers[e][r].selection,n,a,e,t.elementDispatchers[e][r].type)},e.addElementDispatcher=function(e,n,a){t.elementDispatchers[n]=t.elementDispatchers[n]||{},t.elementDispatchers[n][a]={selection:e,type:a.split(".")[0]};for(var r in t.elementListeners)t.setElementEvents(e,r,t.elementListeners[r],n,t.elementDispatchers[n][a].type)},e.allEvents=function(n){var a=[],r=e.events();for(var o in r)for(var i in r[o])a.push({key:o+"."+i,listener:r[o][i]});for(var o in t.elementListeners)a.push({key:o,listener:t.elementListeners[o]});return a},e.translateEvents=function(t){e.allEvents().forEach(function(e){t.on(e.key,e.listener)})},e},Function.prototype.clone=function(){var t=this,e=function(){return t.apply(this,arguments)};for(var n in this)this.hasOwnProperty(n)&&(e[n]=this[n]);return e},d2b.number=function(t){return null===t?NaN:+t},d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},Array.prototype._reverse=function(){var t=[];return Array.prototype.push.apply(t,this),t.reverse()},d2b.UTILS.visualLength=function(t,e){return t.toString().indexOf("%")>-1?e*parseFloat(t)/100:parseFloat(t)},d2b.UTILS.defined=function(t){return null!=t&&void 0!=t},d2b.UTILS.applyProperties=function(t){for(var e in t)this[e](t[e]);for(e in t)null!=t[e]&&t[e].args?this[e].apply(this,t[e].args):this[e](t[e])},d2b.UTILS.checkNested=function(t){for(var e=Array.prototype.slice.call(arguments,1),n=0;n<e.length;n++){if(!t||!t.hasOwnProperty(e[n]))return!1;t=t[e[n]]}return!0},d2b.UTILS.getColor=function(t,e,n,a){return n=n||[],function(r){var o=n.slice(0);o.push(r),a||(o=o.reverse());for(var i=0;i<o.length;i++)if(null!==o[i].colorKey&&void 0!==o[i].colorKey)return t(o[i].colorKey);return t(o[o.length-1][e])}},d2b.UTILS.scrollOffset=function(){var t=document.documentElement,e=(window.pageXOffset||t.scrollLeft)-(t.clientLeft||0),n=(window.pageYOffset||t.scrollTop)-(t.clientTop||0);return{top:n,left:e}},d2b.UTILS.getValues=function(t){var e=[];for(var n in t)t[n].key=n,e.push(t[n]);return e},d2b.UTILS.niceFormat=function(t,e){e||(e=0);var n=d3.format("."+e+"f"),a=Math.abs(t);return isNaN(t)?t:a<Math.pow(10,3)?n(a):a<Math.pow(10,6)?n(a/Math.pow(10,3))+" thousand":a<Math.pow(10,9)?n(a/Math.pow(10,6))+" million":a<Math.pow(10,12)?n(a/Math.pow(10,9))+" billion":a<Math.pow(10,15)?n(a/Math.pow(10,12))+" trillion":a<Math.pow(10,18)?n(a/Math.pow(10,15))+" quadrillion":a<Math.pow(10,21)?n(a/Math.pow(10,18))+" quintillion":a<Math.pow(10,24)?n(a/Math.pow(10,21))+" sextillion":a<Math.pow(10,27)?n(a/Math.pow(10,24))+" septillion":a<Math.pow(10,30)?n(a/Math.pow(10,27))+" octillion":a<Math.pow(10,33)?n(a/Math.pow(10,30))+" nonillion":a<Math.pow(10,36)?n(a/Math.pow(10,33))+" decillion":a<Math.pow(10,39)?n(a/Math.pow(10,36))+" undecillion":a<Math.pow(10,42)?n(a/Math.pow(10,39))+" duodecillion":a<Math.pow(10,45)?n(a/Math.pow(10,42))+" tredecillion":a<Math.pow(10,48)?n(a/Math.pow(10,45))+" quattuordecillion":a<Math.pow(10,51)?n(a/Math.pow(10,48))+" quindecillion":a<Math.pow(10,54)?n(a/Math.pow(10,51))+" sexdecillion":a<Math.pow(10,57)?n(a/Math.pow(10,54))+" septendecillion":a<Math.pow(10,60)?n(a/Math.pow(10,57))+" octdecillion":a<Math.pow(10,63)?n(a/Math.pow(10,60))+" novemdecillion":a<Math.pow(10,303)?n(a/Math.pow(10,63))+" vigintillion":n(a/Math.pow(10,303))+" centillion"},d2b.UTILS.numberFormat=function(t){var e,n,a="";return n=t.units?{before:t.units.before?t.units.before:"",after:t.units.after?t.units.after:""}:{before:"",after:""},t.nice?function(e){return n.before+d2b.UTILS.niceFormat(e,t.precision)+n.after}:(t.siPrefixed?(t.precision>-1&&(a+="."+t.precision),a+="s"):(t.separateThousands&&(a+=","),t.precision>-1&&(a+="."+t.precision+"f")),e=d3.format(a),function(t){return isNaN(t)?n.before+t+n.after:n.before+e(t)+n.after})},d2b.UTILS.textWrap=function(t,e){t.each(function(){for(var t,n=d3.select(this),a=n.text().split(/\s+/).reverse(),r=[],o=0,i=1.1,c=n.attr("y"),s=parseFloat(n.attr("dy"))||0,l=n.text(null).append("tspan").attr("x",0).attr("y",c).attr("dy",s+"em");t=a.pop();)r.push(t),l.text(r.join(" ")),l.node().getComputedTextLength()>e&&(r.pop(),l.text(r.join(" ")),r=[t],l=n.append("tspan").attr("x",0).attr("y",c).attr("dy",++o*i+s+"em").text(t))})},d2b.createNameSpace("d2b.UTILS.TWEENS"),d2b.UTILS.TWEENS.arcTween=function(t,e){t.attrTween("d",function(t){function n(t){return a.oldArc=r(t),e(a.oldArc)}var a=this;a.oldArc=a.oldArc||a.newArc;var r=d3.interpolate(a.oldArc,a.newArc);return n})},d2b.UTILS.grid=function(t,e,n){var a=t/e,r={};return r.columns=Math.min(n,Math.max(1,Math.round(Math.sqrt(n)*a))),r.rows=Math.ceil(n/r.columns),r},d2b.UTILS.domain=function(t,e,n){var a=[];return e&&e.rangeBand?(a=d3.set(t).values(),n=null):a=0==t.length?[0,1]:1==t.length?[t[0]/2,1.5*t[0]]:d3.extent(t),n&&(a[0]-=n[0],a[1]+=n[1]),a},d2b.createNameSpace("d2b.UTILS.LAYOUTS"),d2b.UTILS.LAYOUTS.partition=function(){var t={};t.group=function(e,n){var a,r=n.shift(),o=[],i=d3.nest().key(function(t){return t[r.column]}).entries(e);return i.forEach(function(e){a={allChildren:e.values,name:e.key,top:r.top},n.length?a.children=t.group(a.allChildren,n.slice(0)):a.size=d3.sum(a.allChildren,function(t){return t.count}),-1===["null","undefined"].indexOf(a.name)?o.push(a):o=o.concat(a.children)}),o};var e=function(e,n,a){return{name:a,top:!0,children:t.group(e,n.slice(0))}};return e},d2b.createNameSpace("d2b.UTILS.LEGENDS"),d2b.UTILS.LEGENDS.legend=function(){var t={};t.maxWidth=d2b.CONSTANTS.DEFAULTWIDTH(),t.maxHeight=d2b.CONSTANTS.DEFAULTHEIGHT(),t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentLegendData,t.computedWidth=0,t.computedHeight=0,t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.orientation="horizontal",t.padding=5,t.active=!1,t.scale=5,t.events=d2b.UTILS.chartEvents(),t.getPathForeground=function(e){var n=Math.pow(t.scale/1.7,1.5);return e.open?e.path.size(4*n)(e):e.path.size(15*n)(e)},t.getPathBackground=function(e){var n=Math.pow(t.scale/1.7,1.5);return e.open||!e.hovered?e.path.size(15*n)(e):e.hovered?e.path.size(35*n)(e):void 0},t.enterElements=function(){t.computedHeight=0,t.computedWidth=0,t.innerMaxHeight=t.maxHeight-2*t.padding,t.innerMaxWidth=t.maxWidth-2*t.padding,t.selection.item=t.selection.selectAll("g.d2b-legend-item").data(t.currentLegendData.items,function(t){return t.label});var e=t.selection.item.enter().append("g").attr("class","d2b-legend-item").style("opacity",0).on("mouseover.d2b-mouseover",function(e,n){e.hovered=!0;var a=d3.select(this);t.active&&(e.open?a.select("path.d2b-legend-symbol-foreground").transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).style("fill-opacity",.4):a.select("path.d2b-legend-symbol-background").transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("d",t.getPathBackground(e)))}).on("mouseout.d2b-mouseout",function(e,n){e.hovered=!1;var a=d3.select(this);a.select("path.d2b-legend-symbol-foreground").transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).style("fill-opacity",function(t){return t.open?0:.8}),a.select("path.d2b-legend-symbol-background").transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("d",t.getPathBackground(e))}).call(t.events.addElementDispatcher,"main","d2b-legend-item");e.append("path").attr("class","d2b-legend-symbol-background").style("stroke",d2b.UTILS.getColor(t.color,"label")),e.append("path").attr("class","d2b-legend-symbol-foreground").style("fill",d2b.UTILS.getColor(t.color,"label")),e.append("text").text(function(t){return t.label})},t.updateElements=function(){var e=t.selection.item.select("path.d2b-legend-symbol-background");e.transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).style("stroke",d2b.UTILS.getColor(t.color,"label")).style("stroke-width",1).attr("transform","translate(0,"+t.scale/10+")").attr("d",function(e){return t.getPathBackground(e)});var n=t.selection.item.select("path.d2b-legend-symbol-foreground");n.transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("transform","translate(0,"+t.scale/10+")").style("fill",d2b.UTILS.getColor(t.color,"label")).style("fill-opacity",function(t){return t.open?t.hovered?.4:0:.8}).attr("d",function(e){return t.getPathForeground(e)}),t.selection.item.classed("d2b-active",!!t.active),t.selection.item.text=t.selection.item.select("text").style("font-size",2.5*t.scale+"px").attr("x",2*t.scale).attr("y",t.scale)},t.updatePositions=function(){var e=t.scale+t.padding,n=t.scale+t.padding,a=0,r=0;if(t.currentLegendData.items.length>0)if("vertical"==t.orientation)t.selection.item.transition().duration(t.animationDuration).style("opacity",1).attr("transform",function(o,i){var c="translate("+e+","+n+")";return n>r&&(r=n),n+=4*t.scale,a=Math.max(a,d3.select(this).select("text").node().getComputedTextLength()),n+t.scale>t.innerMaxHeight&&(n=t.scale+t.padding,e+=a+6*t.scale,a=0),c}),t.computedWidth=e+a+2*t.scale+t.padding,t.computedHeight=r+t.scale+t.padding;else{var a=0;t.selection.item.text.each(function(t){var e=this.getComputedTextLength();e>a&&(a=e)}),a+=6*t.scale;var o=Math.floor((t.innerMaxWidth+3*t.scale)/a);t.selection.item.transition().duration(t.animationDuration).style("opacity",1).attr("transform",function(r,i){i%o==0&&i>0&&(e=t.scale+t.padding,n+=4*t.scale);var c="translate("+e+","+n+")";return e+=a,c}),t.computedHeight=n+t.scale+t.padding,t.computedWidth=t.selection.item.size()>o?a*o-3*t.scale+2*t.padding:a*t.selection.item.size()-3*t.scale+2*t.padding}},t.exitElements=function(){t.selection.item.exit().transition().duration(t.animationDuration).style("opacity",0).remove()};var e={};return e.select=d2b.UTILS.CHARTS.MEMBERS.select(e,t,function(){t.generateRequired=!0}),e.selection=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"selection",function(){t.generateRequired=!0}),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"maxWidth"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"maxHeight"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration"),e.legendOrientation=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"legendOrientation"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color"),e.padding=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"padding"),e.scale=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"scale"),e.orientation=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"orientation"),e.active=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"active"),e.computedHeight=function(){return t.computedHeight},e.computedWidth=function(){return t.computedWidth},e.data=function(n,a){return arguments.length?(t.currentLegendData=n.data,t.currentLegendData.items.forEach(function(t){t.path=d2b.UTILS.symbol().type(t.symbol||"circle")}),e):t.currentLegendData},e.update=function(n){return t.selection?(t.enterElements(),t.updateElements(),t.updatePositions(),t.exitElements(),t.events.dispatch("update",t.selection),n&&n(),e):console.warn("legend was not given a selection")},e},d2b.UTILS.loader=function(){var t={};t.inProgress=0,t.files={},t.stack=[],t.flushStack=function(){if(0!=t.stack.length){var e=t.stack.shift(),n={};"all"===e.paths?n=t.files:e.paths.forEach(function(e){n[e.key]=t.files[e.key]}),e.callback&&e.callback(n),t.flushStack()}};var e=function n(e,a){return t.stack.push({callback:a,paths:e}),e.forEach(function(e){var n=e.file.split(".");e.key=e.key||e.file,e.path=e.path||"http://d2b.s3-website-us-west-2.amazonaws.com/",e.type=e.type||n[n.length-1],t.files[e.key]||(t.files[e.key]=!0,t.inProgress++,d3[e.type](e.path+e.file,function(n){t.inProgress--,t.files[e.key]=n,t.inProgress||t.flushStack()}))}),t.inProgress||t.flushStack(),n};return e.loadAll=function(e){t.stack.push({callback:e,paths:"all"}),t.inProgress||t.flushStack()},e},d2b.UTILS.load=new d2b.UTILS.loader,d2b.UTILS.bindTooltip=function(t,e,n,a){e?t.on("mouseover.d2b-mouseover-tooltip",function(t,r){var o="function"==typeof n?n.apply(this,arguments):n||t,i="function"==typeof e?e.apply(this,[o,r]):e,c="function"==typeof a?a.apply(this,arguments):a;d2b.UTILS.createTooltip(d3.select(this),i,c)}).on("mouseout.d2b-mouseout-tooltip",function(t,e){d2b.UTILS.removeTooltip()}):d2b.UTILS.unbindTooltip()},d2b.UTILS.unbindTooltip=function(t){d2b.UTILS.removeTooltip(),t.on("mouseover.d2b-mouseover-tooltip",null).on("mouseout.d2b-mouseout-tooltip",null).on("mousemove.d2b-mousemove-tooltip",null)},d2b.UTILS.createTooltip=function(t,e,n){n=n||"#555",d3.selectAll(".d2b-general-tooltip").remove();var a=d3.select("body"),r=a.append("div").attr("class","d2b-general-tooltip").html(e).style("color",function(t){return d3.hsl(n).l>.75?"black":"white"}).style("background",n).style("border-color",d3.rgb(n).darker(1)).style("opacity",0);return r.transition().duration(50).style("opacity",1),r.call(d2b.UTILS.moveTooltip),t.on("mousemove.d2b-mousemove-tooltip",function(){r.transition().duration(50).ease("linear").call(d2b.UTILS.moveTooltip)}),r},d2b.UTILS.removeTooltip=function(){d3.selectAll(".d2b-general-tooltip").remove()},d2b.UTILS.moveTooltip=function(t){var e=d3.select("body"),n=15,a=d2b.UTILS.scrollOffset(),r=e.node().getBoundingClientRect().width,o=a.left+d3.event.clientX<r/2,i=t.node().getBoundingClientRect(),c=o?a.left+d3.event.clientX+n:a.left+d3.event.clientX-i.width-n,s=a.top+d3.event.clientY-i.height/2;t.each(function(t){var e=d3.select(this),n=d3.transition(e);e.classed("d2b-general-tooltip-left",!o).classed("d2b-general-tooltip-right",o),n.style("opacity",1).style("top",s+"px").style("left",c+"px")}),d3.timer.flush()},d2b.UTILS.AXISCHART.TYPES.area=function(){var t={};t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={},t.xFormat=function(t){return t},t.yFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.x=d3.scale.linear(),t.y=d3.scale.linear(),t.area=d3.svg.area().x(function(e){return t.x(e.x)}).y1(function(e){return t.y(e.yComputed+e.y0Computed)}).y0(function(e){return t.y(e.y0Computed)}),t.point=d2b.SVG.point().size(40).active(!0).fill("white"),t.tooltip=function(e){return t.xFormat(e.data.x)+" : "+t.yFormat(e.data.y)},t.initYComputed=function(t){t.forEach(function(t){t.values.forEach(function(t){t.y0Computed=0,t.yComputed=t.y})})},t.tooltipSVG=d2b.SVG.tooltip();var e={};return e.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"foreground"),e.background=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"background"),e.general=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"general"),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration"),e.x=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"x"),e.y=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"y"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"xFormat"),e.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"yFormat"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color"),e.controls=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"controlsData"),e.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"axisChart"),e.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltip"),e.tooltipSVG=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltipSVG"),e.offset=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"offset"),t.updatePoints=function(e,n){t.foreground.point=n.selectAll("g.d2b-point").data(function(t){return t.values});t.foreground.point.enter().append("g").attr("class","d2b-point").attr("transform",function(e){return"translate("+t.x(e.x)+","+t.y(e.yComputed+e.y0Computed)+")"}).call(t.events.addElementDispatcher,"main","d2b-area-point");t.point.type(function(t,n){return t.symbol||e.symbol||"circle"}).stroke(d2b.UTILS.getColor(t.color,"label",[e])),t.foreground.point.call(t.point),t.foreground.point.call(t.tooltipSVG.graph,{key:e.label,content:t.tooltip,data:function(t){return{data:t,graph:e}},x:function(t){return t.x},y:function(t){return t.yComputed+t.y0Computed},fill:d2b.UTILS.getColor(t.color,"label",[e])}).transition().duration(t.animationDuration).attr("transform",function(e){return"translate("+t.x(e.x)+","+t.y(e.yComputed+e.y0Computed)+")"}),t.foreground.point.exit().transition().duration(t.animationDuration).style("opacity",0).remove()},t.stack=function(e){t.controlsData.stackAreas.enabled?d3.layout.stack().out(function(t,e,n){t.y0Computed=e,t.yComputed=n}).offset(t.offset||t.controlsData.stackAreas.offset||"zero").values(function(t){return t.values})(e):t.initYComputed(e)},e.xValues=function(){var e=[];return t.currentChartData.forEach(function(t){e=e.concat(t.values.map(function(t){return t.x}))}),e},e.yValues=function(){t.stack(t.currentChartData);var e=[];return t.currentChartData.forEach(function(t){e=e.concat(t.values.map(function(t){return t.yComputed+t.y0Computed})),e=e.concat(t.values.map(function(t){return t.y0Computed}))}),e},e.data=function(n,a){return arguments.length?(a&&(t.currentChartData={}),t.currentChartData=n,e):t.currentChartData},e.update=function(n){return t.stack(t.currentChartData),t.background.each(function(e){var n=d3.select(this),a=n.select("path");0==a.size()&&(a=n.append("path").call(t.events.addElementDispatcher,"main","d2b-area")),t.area.interpolate(e.interpolate||"linear").tension(e.tension||0),a.datum(function(t){return e.values}).style("fill",d2b.UTILS.getColor(t.color,"label",[e])).style("stroke",d2b.UTILS.getColor(t.color,"label",[e])).transition().duration(t.animationDuration).attr("d",t.area)}),t.foreground.each(function(e){var n=d3.select(this);t.updatePoints(e,n)}),d3.timer.flush(),n&&n(),e},e},d2b.UTILS.AXISCHART.TYPES.area.tools=function(){return{controlsData:{stackAreas:{label:"Stack Areas",type:"checkbox",visible:!1,enabled:!1}}}},d2b.UTILS.AXISCHART.TYPES.bar=function(){var t={};t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={},t.xFormat=function(t){return t},t.yFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.groupScale=d3.scale.ordinal(),t.padding="10%",t.updateStackedVals=function(e,n){return t.barSignedHeight(n)<0?(e+=t.barHeight(n),{newValue:e,modifier:-t.barHeight(n)}):(e-=t.barHeight(n),{newValue:e,modifier:0})},t.getLinearRangeBand=function(){var e=t.currentChartData.map(function(t){return t.values.map(function(t){return t.x}).sort()}),n=1/0;return e.forEach(function(t){for(var e=0;e<t.length-1;e++)n=Math.min(Math.abs(t[e+1]-t[e]),n)}),n==1/0?t.width:t.x(Math.min.apply(null,t.x.domain())+n)},t.tooltip=function(e){return t.xFormat(e.data.x)+" : "+t.yFormat(e.data.y)},t.barSignedHeight=function(e){var n,a;return n=t.y(0),a=t.y(e.y),n-a},t.barHeight=function(e){return Math.abs(t.barSignedHeight(e))},t.barY=function(e){var n,a;return n=t.y(0),a=t.y(e.y),Math.min(n,a)},t.buildOut=function(t){var e=[],n=0;return function(a,r,o){n++%t===0&&(e=[0,0]),o>=0?(a.y0=e[1],a.y=o,e[1]+=o):(a.y0=e[0],a.y=o,e[0]+=o)}},t.resetY0=function(){t.currentChartData.forEach(function(t){t.values.forEach(function(t){t.y0=0})})};var e={};return e.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"foreground"),e.background=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"background"),e.general=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"general"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration"),e.x=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"x"),e.y=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"y"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"xFormat"),e.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"yFormat"),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color"),e.controls=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"controlsData"),e.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"axisChart"),e.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltip"),e.tooltipSVG=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltipSVG"),e.padding=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"padding"),e.xValues=function(){var e=[];return t.currentChartData.forEach(function(t){e=e.concat(t.values.map(function(t){return t.x}))}),e},e.yValues=function(){t.controlsData.stackBars.enabled?d3.layout.stack().values(function(t){return t.values}).out(t.buildOut(t.currentChartData.length))(t.currentChartData):t.resetY0();var e=[0];return t.currentChartData.forEach(function(t){e=e.concat(t.values.map(function(t){return t.y+t.y0}))}),e},e.data=function(n){return arguments.length?(t.currentChartData=n,e):t.currentChartData},e.update=function(n){t.controlsData.stackBars.enabled?d3.layout.stack().values(function(t){return t.values}).out(t.buildOut(t.currentChartData.length))(t.currentChartData):t.resetY0();var a=t.x.rangeBand();0===t.x.rangeBand()&&(a=t.getLinearRangeBand());var r=d2b.UTILS.visualLength(t.padding,a),o=t.currentChartData.filter(function(t){return!t.center}).map(function(t){return t.label});t.groupScale.domain(o).rangeBands([0+r,a-r]);var i=.01*t.groupScale.rangeBand();return t.background.each(function(e){var n=d3.select(this),o=n.selectAll("rect").data(e.values,function(t,e){return t.x}),c=o.enter().append("rect").style("fill",d2b.UTILS.getColor(t.color,"label",[e])).call(t.events.addElementDispatcher,"main","d2b-bar");o.each(function(n){n.placement={},t.controlsData.stackBars.enabled?(n.placement.x=t.x(n.x)-a/2+r,n.y>=0?n.placement.y=t.y(n.y+n.y0):n.placement.y=t.y(n.y0),n.placement.dx=a-2*r):n.center||e.center?(n.placement.x=t.x(n.x)-a/2+r,n.placement.y=t.barY(n),n.placement.dx=a-2*r):(n.placement.x=t.x(n.x)-a/2+t.groupScale(e.label)+i,n.placement.y=t.barY(n),n.placement.dx=Math.max(0,t.groupScale.rangeBand()-2*i)),n.placement.dy=t.barHeight(n)}),c.attr("y",t.y(0)).attr("height",0),o.call(t.tooltipSVG.graph,{key:e.label,content:t.tooltip,data:function(t){return{data:t,graph:e}},x:function(e){return t.x.invert(e.placement.x+e.placement.dx/2)},y:function(t){return t.y+t.y0},fill:d2b.UTILS.getColor(t.color,"label",[e])}).transition().duration(t.animationDuration).style("fill",d2b.UTILS.getColor(t.color,"label",[e])).attr("x",function(t){return t.placement.x}).attr("y",function(t){return t.placement.y}).attr("width",function(t){return t.placement.dx}).attr("height",function(t){return t.placement.dy}),o.exit().transition().duration(t.animationDuration).attr("y",t.y(0)).attr("height",0)}),d3.timer.flush(),n&&n(),e},e},d2b.UTILS.AXISCHART.TYPES.bar.tools=function(){return{controlsData:{stackBars:{label:"Stack Bars",type:"checkbox",visible:!1,enabled:!1}}}},d2b.UTILS.AXISCHART.TYPES.bubblePack=function(){var t={};t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.positionType="mean",t.positionTypeX=t.positionType,t.positionTypeY=t.positionType,t.reformatRequired=!0,t.xFormat=function(t){return t},t.yFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.expandedNodes={},t.sizeScale=[1,1],t.size=d3.scale.linear(),t.tooltip=function(e){return""+t.xFormat(e.data.xComputed)+" : "+t.yFormat(e.data.yComputed)+" ("+e.data.sizeComputed+")"},t.breadcrumbs=d2b.UTILS.breadcrumbs().scale(5.5),t.breadcrumbs.reset=function(){var e={data:{items:[]}};t.breadcrumbs.data(e).update()},t.breadcrumbs.set=function(e){var n={data:{items:e.map(function(t,e){return{label:t.name,key:e+","+t.name,data:t}})}};t.breadcrumbs.data(n).update();var a=t.breadcrumbs.selection();a.breadcrumb.path.attr("stroke-width",1.5).style("fill-opacity",.2).style("stroke-opacity",.7).style("fill",function(e){return t.node.fill(e.data)}).attr("stroke",function(e){return t.node.fillDark(e.data)})},t.node={},t.node.getAncestors=function(t){for(var e=[],n=t;n.parent;)e.unshift(n),n=n.parent;return e.unshift(n),e},t.node.resetExpanded=function(e){t.expandedNodes[e.key]=!1,e.children&&e.children.forEach(function(e){t.node.resetExpanded(e)})},t.node.formKey=function(e,n){return e.key=n+e.name,e.parent&&(e.key+=t.node.formKey(e.parent,n)),e.key},t.node.toggleExpanded=function(e){t.breadcrumbs.reset(),t.expandedNodes[e.key]=!t.expandedNodes[e.key],t.expandedNodes[e.key]||t.node.resetExpanded(e),t.axisChart.update()},t.node.mouseover=function(e){t.breadcrumbs.set(t.node.getAncestors(e))},t.node.mouseout=function(e){t.breadcrumbs.reset()},t.node.fill=function(e){return t.color(e.fill)},t.node.fillDark=function(e){return d3.rgb(t.node.fill(e)).darker(1)},t.node.symbol=function(t){return t.symbolType},t.node.getSymbolPathSmall=function(t){return d2b.UTILS.symbol().type(t.symbolType).size(75)(t)},t.point=d2b.SVG.point().type(t.node.symbol).size(function(e){return t.size(e.sizeComputed)}).active(function(t){return t.children&&t.children.length}).fill(t.node.fill).stroke(t.node.fillDark).strokeWidth(function(t){return t.children&&t.children.length?"1.5px":"0px"}),t.bubble={},t.bubble.visibility=function(e){var n=d3.select(this),a=d3.transition(n);n.classed("d2b-hidden",t.expandedNodes[e.key]),a.style("opacity",t.expandedNodes[e.key]?0:.7)},t.bubble.bindClick=function(e){var n=d3.select(this);e.children?n.on("click",t.node.toggleExpanded).style("cursor","pointer"):n.on("click",null).style("cursor","auto")},t.bubble.transform=function(e){return"translate("+t.x(e.xComputed)+","+t.y(e.yComputed)+")"},t.bubble.enterTransform=function(e){return e.parent?e.parent.bubble.attr("transform"):t.bubble.transform(e)},t.bubble.updateChildren=function(e){var n=d3.select(this),a=d3.transition(n);t.expandedNodes[e.key]&&e.children&&e.children.length?t.bubble.update(d3.select(this),e.children):a.selectAll(".d2b-bubble-group").style("opacity",0).remove().selectAll(".d2b-bubble").attr("transform",t.bubble.transform(e))},t.bubble.update=function(e,n){var a=e.selectAll("g.d2b-bubble-group").data(n,t.bubbleKey),r=a.enter().append("g").attr("class","d2b-bubble-group");r.append("g").call(t.events.addElementDispatcher,"main","d2b-bubble").attr("class","d2b-bubble").attr("transform",t.bubble.enterTransform).on("mouseover.d2b-node-mouseover",t.node.mouseover).on("mouseout.d2b-node-mouseout",t.node.mouseout);a.select(".d2b-bubble").each(function(t){t.bubble=d3.select(this)}).each(t.bubble.bindClick).transition().duration(t.animationDuration).call(t.point).attr("transform",t.bubble.transform).each(t.bubble.visibility);a.transition().duration(t.animationDuration).each(t.bubble.updateChildren)},t.expandedBubbleIndicator={},t.expandedBubbleIndicator.enter=function(e){var n=e.enter().append("g").attr("class","d2b-expanded-bubble-indicator").on("click.d2b-click",t.node.toggleExpanded).on("mouseover.d2b-node-mouseover",t.node.mouseover).on("mouseout.d2b-mouseout",t.node.mouseout).call(t.events.addElementDispatcher,"main","d2b-expanded-bubble-indicator");n.append("rect").style("fill",t.node.fill).style("stroke",t.node.fillDark).attr("height",20),n.append("path").style("fill",t.node.fill).attr("transform","translate(10, 10)"),n.append("text").attr("x",20).attr("y",15).text(function(t){
return t.name.substring(0,4).trim()})},t.expandedBubbleIndicator.update=function(e,n){var a=e.attr("transform",function(e){var a=d3.select(this),r=a.select("text").node().getComputedTextLength()+30;return a.select("rect").each(function(){this.indicatorWidth=r}),r+=5,n.x+=r,n.x>t.width-20&&(n.y+=25,n.x=r+10),"translate("+(n.x-r)+","+n.y+")"});a.select("rect").attr("width",function(){return this.indicatorWidth}).style("fill",t.node.fill).style("stroke",t.node.fillDark),a.select("path").attr("d",t.node.getSymbolPathSmall).style("fill",t.node.fill),t.breadcrumbsContainer.attr("transform","translate(10,"+(n.y+30)+")")},t.expandedBubbleIndicator.exit=function(t){t.exit().transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).style("opacity",0).remove()},t.cleanSizeScale=function(t){return t?1===t.length?[t[0],t[0]]:t:null===t?[1,1]:void 0},t.getValues=function(e){return e.children?[].concat.apply([],e.children.map(function(e,n){return t.getValues(e)})):e.values?e.values:[e]},t.traverseTree=function(t,e){function n(t){var a=this,r=e.call(a,t);a.children&&"break"!==r&&a.children.forEach(function(t,e){n.call(t,a)})}n.call(t,null)},t.formatData=function(){t.currentChartData&&t.reformatRequired&&(t.currentChartData.forEach(function(e,n){t.traverseTree(e.pack,function(n){this.parent=n,this.key=t.node.formKey(this,e.label),this.values=t.getValues(this),this.sizeComputed=d3.sum(this.values,function(t){return t.size||1}),this.xComputed=d2b.MATH[t.positionTypeX](this.values,function(t){return t.x||0},function(t){return t.size||1}),this.yComputed=d2b.MATH[t.positionTypeY](this.values,function(t){return t.y||0},function(t){return t.size||1}),this.fill=this.colorKey||e.colorKey||e.label,this.symbolType=this.symbol||e.symbol||"circle"})}),t.reformatRequired=!1)},t.sortPack=function(e){var n={expanded:[],visible:[]};return t.traverseTree(e,function(){this.bubble&&this.bubble.classed("d2b-visible",!1).classed("d2b-expanded",!1)}),t.traverseTree(e,function(){return t.expandedNodes[this.key]?(n.expanded.push(this),void(this.bubble&&this.bubble.classed("d2b-expanded",!0))):(n.visible.push(this),this.bubble&&this.bubble.classed("d2b-visible",!0),"break")}),n},t.bubbleKey=function(t){return t.key};var e={};return e.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"foreground"),e.background=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"background"),e.general=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"general"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration"),e.x=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"x"),e.y=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"y"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"xFormat"),e.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"yFormat"),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color"),e.controls=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"controlsData"),e.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"axisChart"),e.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltip"),e.tooltipSVG=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltipSVG"),e.sizeScale=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"sizeScale",function(){t.sizeScale=t.cleanSizeScale(t.sizeScale)}),e.positionType=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"positionType",function(){t.positionTypeX=t.positionType,t.positionTypeY=t.positionType,t.reformatRequired=!0}),e.positionTypeX=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"positionTypeX",function(){t.reformatRequired=!0}),e.positionTypeY=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"positionTypeY",function(){t.reformatRequired=!0}),e.xValues=function(){var e=[];return t.formatData(),t.currentChartData.forEach(function(n){t.traverseTree(n.pack,function(){return t.expandedNodes[this.key]?void 0:(e.push(this.xComputed),"break")})}),e},e.yValues=function(){var e=[];return t.formatData(),t.currentChartData.forEach(function(n){t.traverseTree(n.pack,function(n){return t.expandedNodes[this.key]?void 0:(e.push(this.yComputed),"break")})}),e},e.data=function(n){return arguments.length?(t.currentChartData=n,t.reformatRequired=!0,e):t.currentChartData},e.update=function(n){t.formatData(),t.size.domain([0,d3.max(t.currentChartData,function(t){return t.pack.sizeComputed})]),t.breadcrumbsContainer=t.general.select("g.d2b-breadcrumbs"),t.breadcrumbsContainer.size()||(t.breadcrumbsContainer=t.general.append("g").attr("class","d2b-breadcrumbs"),t.breadcrumbs.selection(t.breadcrumbsContainer)),t.breadcrumbs.width(t.width),t.size.range([10*t.sizeScale[0],t.sizeScale[1]*Math.min(t.width,t.height)*10]);var a={x:10,y:10};return t.foreground.each(function(e){var n=d3.select(this);t.bubble.update(n,[e.pack]);var r=t.sortPack(e.pack);n.selectAll(".d2b-visible").call(t.tooltipSVG.graph,{key:e.label,content:t.tooltip,data:function(t){return{data:t,graph:e}},x:function(t){return t.xComputed},y:function(t){return t.yComputed},fill:t.node.fill});var o=n.selectAll("g.d2b-expanded-bubble-indicator").data(r.expanded,function(t){return t.key});t.expandedBubbleIndicator.enter(o),t.expandedBubbleIndicator.update(o,a),t.expandedBubbleIndicator.exit(o),o.call(d2b.UTILS.bindTooltip,t.tooltip,function(t){return{data:t,graph:e}},t.node.fill)}),d3.timer.flush(),n&&n(),e},e},d2b.UTILS.AXISCHART.TYPES.gridMarker=function(){var t={};t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={},t.xFormat=function(t){return t},t.yFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.labelOffset=3,t.point=d2b.SVG.point().size(40).active(!0).fill("white"),t.newGroup=function(e,n){var a=e.append("g").attr("class","d2b-grid-marker-x").call(t.updateMarkers,n,"x",!1);a.append("line").attr("class","d2b-grid-marker-line"),a.append("text").attr("class","d2b-grid-marker-coordinate").attr("transform","rotate(-90)").attr("y",7+t.labelOffset);var r=e.append("g").attr("class","d2b-grid-marker-y").call(t.updateMarkers,n,"y",!1);r.append("line").attr("class","d2b-grid-marker-line"),r.append("text").attr("class","d2b-grid-marker-coordinate").attr("y",7+t.labelOffset);e.append("g").attr("class","d2b-grid-marker-center").call(t.updateCenter,n,!1).call(t.events.addElementDispatcher,"main","d2b-grid-marker");e.append("g").attr("class","d2b-grid-marker-label").call(t.updateLabel,n,!1).append("text")},t.updateMarker={},t.updateMarker.x=function(e,n,a){e.style("opacity",1).attr("transform",function(e){return"translate("+t.x(e.x)+",0)"}).select("line").attr("x1",0).attr("x2",0).attr("y1",n[0]).attr("y2",n[1]).style("stroke",d2b.UTILS.getColor(t.color,"label",[a])),e.select(".d2b-grid-marker-coordinate").attr("x",function(e){return e.invert?-n[0]+t.labelOffset:-t.labelOffset})},t.updateMarker.y=function(e,n,a){e.style("opacity",1).attr("transform",function(e){return"translate("+n[1]+","+t.y(e.y)+")"}).select("line").attr("x1",n[0]).attr("x2",-n[1]).attr("y1",0).attr("y2",0).style("stroke",d2b.UTILS.getColor(t.color,"label",[a])),e.select(".d2b-grid-marker-coordinate").attr("x",function(e){return e.invert?-n[1]+t.labelOffset:-t.labelOffset})},t.updateMarkers=function(e,n,a,r){var o="x",i="y";"y"==a&&(o="y",i="x");var c=t[i].range();e.each(function(e){var a=d3.select(this);r&&(a=a.transition().duration(t.animationDuration)),e[o]?a.call(t.updateMarker[o],c,n):a.style("opacity",0)}),e.select("line").classed("d2b-dashed",function(t){return t.dashed}),e.select("text.d2b-grid-marker-coordinate").classed("d2b-inverted",function(t){return t.invert}).text(function(e){return t[o+"Format"](e[o])})},t.updateLabel=function(e,n,a){var r=t.x.range(),o=t.y.range();this.each(function(e){var n=d3.select(this),i=n.select("text");a&&(n=n.transition().duration(t.animationDuration),i=i.transition().duration(t.animationDuration)),i.text(function(t){return t.label}).attr("y",-t.labelOffset).attr("transform","rotate(0)"),null!=e.x&&null!=e.y?t.x(e.x)>t.width/2?(n.attr("transform","translate("+t.x(e.x)+","+t.y(e.y)+")"),i.style("text-anchor","end").attr("x",t.labelOffset)):(n.attr("transform","translate("+t.x(e.x)+","+t.y(e.y)+")"),i.style("text-anchor","start").attr("x",t.labelOffset)):null!=e.y?e.invert?(n.attr("transform","translate("+r[0]+","+t.y(e.y)+")"),i.style("text-anchor","start").attr("x",t.labelOffset)):(n.attr("transform","translate("+r[1]+","+t.y(e.y)+")"),i.style("text-anchor","end").attr("x",-t.labelOffset)):e.invert?(n.attr("transform","translate("+t.x(e.x)+","+o[0]+")"),i.style("text-anchor","start").attr("x",t.labelOffset).attr("transform","rotate(-90)")):(n.attr("transform","translate("+t.x(e.x)+","+o[1]+")"),i.style("text-anchor","end").attr("x",-t.labelOffset).attr("transform","rotate(-90)"))})},t.updateCenter=function(e,n,a){e.each(function(e){var r=d3.select(this);a&&(r=r.transition().duration(t.animationDuration)),null!=e.y&&null!=e.x?(t.point.type(function(t,e){return t.symbol||n.symbol||"circle"}).stroke(d2b.UTILS.getColor(t.color,"label",[n])),r.style("opacity",1).call(t.point).attr("transform","translate("+t.x(e.x)+","+t.y(e.y)+")")):r.style("opacity",0)})};var e={};return e.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"foreground"),e.background=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"background"),e.general=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"general"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration"),e.x=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"x"),e.y=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"y"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"xFormat"),e.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"yFormat"),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color"),e.controls=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"controlsData"),e.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"axisChart"),e.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltip"),e.tooltipSVG=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltipSVG"),e.xValues=function(){var e=[];return t.currentChartData.forEach(function(t){t.values?t.values.forEach(function(t){t.x&&e.push(t.x)}):t.x&&e.push(t.x)}),e},e.yValues=function(){var e=[];return t.currentChartData.forEach(function(t){t.values?t.values.forEach(function(t){t.y&&e.push(t.y)}):t.y&&e.push(t.y)}),e},e.data=function(n){return arguments.length?(t.currentChartData=n,e):t.currentChartData},e.update=function(n){return t.foreground.each(function(e){var n=d3.select(this),a=e.values||[e],r=n.selectAll("g.d2b-grid-marker").data(a);r.enter().append("g").attr("class","d2b-grid-marker").call(t.newGroup,e);r.select("g.d2b-grid-marker-x").call(t.updateMarkers,e,"x",!0),r.select("g.d2b-grid-marker-y").call(t.updateMarkers,e,"y",!0),r.select("g.d2b-grid-marker-label").call(t.updateLabel,e,"y",!0);var o=r.select("g.d2b-grid-marker-center");o.call(t.updateCenter,e,!0),r.exit().transition().duration(t.animationDuration).style("opacity",0).remove()}),d3.timer.flush(),n&&n(),e},e},d2b.UTILS.AXISCHART.TYPES.heatPoints=function(){var t={};t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={},t.xFormat=function(t){return t},t.yFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.layout="square",t.sortBy="name",t.symbol=d2b.SVG.symbol(),t.tooltip=function(e){return t.xFormat(e.data.x)+" : "+t.yFormat(e.data.y)},t.key=function(t){return t.x+"-"+t.y},t.renderLayout={},t.renderLayout.square=function(e){var n="right",a={x:0,y:0},r=1,o=0,i=1.5,c=Math.sqrt(t.symbolSize)+i,s=t.animationDuration/(2*e.length);e.forEach(function(e,i){var l=e.elem;if(l.transition().duration(t.animationDuration/2).delay(s*i).attr("d",t.symbol),0===i)return l.attr("transform","translate(0,0)");switch(n){case"right":a.x+=c,o+=1,o===r&&(n="up",o=0);break;case"up":a.y-=c,o+=1,o===r&&(n="left",r+=1,o=0);break;case"left":a.x-=c,o+=1,o===r&&(n="down",o=0);break;case"down":a.y+=c,o+=1,o===r&&(n="right",r+=1,o=0)}l.attr("transform",function(t,e){return"translate("+a.x+","+a.y+")"})})},t.renderLayout.hexagon=function(e){var n=6,a={x:0,y:0,side:0,move:0,moves:1},r=1.5,o=Math.sqrt(2*t.symbolSize/(3*Math.sqrt(3)))+r,i=2*Math.sin(Math.PI/6)*o+o,c=2*Math.cos(Math.PI/6)*o,s=t.animationDuration/(2*e.length);e.forEach(function(e,r){var l=e.elem;if(l.transition().duration(t.animationDuration/2).delay(s*r).attr("d",t.symbol),0===r)return l.attr("transform","translate(0,0)");switch(0===a.move&&0===a.side&&(a.x+=c),a.side){case 0:a.x-=c/2,a.y+=o+(i-o)/2;break;case 1:a.x-=c;break;case 2:a.x-=c/2,a.y-=o+(i-o)/2;break;case 3:a.x+=c/2,a.y-=o+(i-o)/2;break;case 4:a.x+=c;break;case 5:a.x+=c/2,a.y+=o+(i-o)/2}a.move+=1,a.move===a.moves&&(a.move=0,a.side+=1,a.side===n&&(a.side=0,a.moves+=1)),l.attr("transform",function(t,e){return"translate("+a.x+","+a.y+")"})})},t.renderLayout.circle=function(e){var n=1.5,a=Math.sqrt(t.symbolSize/Math.PI)+n/2,r=2*a,o={moves:0,move:0,r:0},i=t.animationDuration/(2*e.length);e.forEach(function(e,n){var a=e.elem;return a.transition().duration(t.animationDuration/2).delay(i*n).attr("d",t.symbol),0===n?a.attr("transform","translate(0,0)"):(o.moves<=o.move&&(o.r+=r,o.circum=2*Math.PI*o.r,o.moves=Math.floor(o.circum/r),o.theta=2*Math.PI/o.moves,o.move=0),o.x=Math.cos(o.move*o.theta)*o.r,o.y=Math.sin(o.move*o.theta)*o.r,a.attr("transform",function(t,e){return"translate("+o.x+","+o.y+")"}),void(o.move+=1))})},t.eachPointSet=function(e){var n=t.sortBy.replace("!",""),a=d3.ascending;-1!==t.sortBy.indexOf("!")&&(a=d3.descending),e=e.sort(function(t,e){return a(t[n],e[n])}),t.renderLayout[t.layout](e)};var e={};return e.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"foreground"),e.background=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"background"),e.general=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"general"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration"),e.x=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"x"),e.y=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"y"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"xFormat"),e.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"yFormat"),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color"),e.controls=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"controlsData"),e.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"axisChart"),e.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltip"),e.tooltipSVG=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltipSVG"),e.layout=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"layout"),e.sortBy=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"sortBy"),e.size=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"size"),e.xValues=function(){var e=[];return t.currentChartData.forEach(function(t){e=e.concat(t.values.map(function(t){return t.x}))}),e},e.yValues=function(){var e=[];return t.currentChartData.forEach(function(t){e=e.concat(t.values.map(function(t){return t.y}))}),e},e.data=function(n){return arguments.length?(t.currentChartData=n,e):t.currentChartData},e.update=function(n){var a={},r={},o={};maxPoints=0,t.symbol.type(t.layout),t.background.each(function(e,n){var i=d3.select(this),c=i.selectAll(".d2b-heat-point-set").data(e.values,t.key);c.enter().append("g").attr("class","d2b-heat-point-set").attr("transform",function(e){return"translate("+t.x(e.x)+","+t.y(e.y)+")"}),c.transition().duration(t.animationDuration).attr("transform",function(e){return"translate("+t.x(e.x)+","+t.y(e.y)+")"}).style("opacity",1).each(function(e){var n=t.key(e);a[n]?a[n]=a[n].concat(e.points):a[n]=e.points||[],r[e.x]=1,o[e.y]=1,maxPoints=Math.max(maxPoints,a[n].length)}),c.exit().transition().duration(t.animationDuration).style("opacity",0).remove();var s=c.selectAll(".d2b-heat-point").data(function(t){return t.points});s.enter().append("path").attr("d",t.symbol.size(0)).attr("class","d2b-heat-point"),s.style("opacity",1).each(function(t){t.elem=d3.select(this)}),s.exit().transition().duration(t.animationDuration).style("opacity",0).remove()});var i=Math.min(t.width/Object.keys(r).length,t.height/Object.keys(o).length);t.size?t.symbolSize=t.size:(t.symbolSize=Math.pow(i/Math.sqrt(maxPoints),2),"circle"==t.layout?t.symbolSize*=.3:t.symbolSize*=.5),t.symbol.size(t.symbolSize);var c;for(var c in a)a.hasOwnProperty(c)&&t.eachPointSet(a[c]);return t.background.selectAll(".d2b-heat-point").style("fill",d2b.UTILS.getColor(t.color,"name")).style("stroke",d2b.UTILS.getColor(t.color,"name")),d3.timer.flush(),n&&n(),e},e},d2b.UTILS.AXISCHART.TYPES.histogram=function(){var t={};t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={},t.xFormat=function(t){return t},t.yFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.hist=d3.layout.histogram(),t.padding="0",t.tooltip=function(e){return t.xFormat(e.data.x)+" - "+t.xFormat(e.data.x+e.data.dx)+": "+t.yFormat(e.data.y)},t.barSignedHeight=function(e){var n,a;return n=t.y(0),a=t.y(e.y),n-a},t.barHeight=function(e){return Math.abs(t.barSignedHeight(e))},t.barY=function(e){var n,a;return n=t.y(0),a=t.y(e.y),Math.min(n,a)};var e={};return e.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"foreground"),e.background=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"background"),e.general=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"general"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration"),e.x=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"x"),e.y=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"y"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"xFormat"),e.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"yFormat"),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color"),e.controls=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"controlsData"),e.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"axisChart"),e.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltip"),e.tooltipSVG=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltipSVG"),e.padding=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"padding"),e.xValues=function(){var e=[];return t.currentChartData.forEach(function(t){e=e.concat(t.histData.map(function(t){return t.x}))}),e},e.yValues=function(){var e=[];return t.currentChartData.forEach(function(t){e=e.concat(t.histData.map(function(t){return t.y}))}),e},e.data=function(n){return arguments.length?(t.currentChartData=n,t.currentChartData.forEach(function(e){e.histData=t.hist.bins(e.bins)(e.values)}),e):t.currentChartData},e.update=function(n){return t.background.each(function(e){var n=d3.select(this),a=e.histData.map(function(t){return t.x}),r=[t.x(d3.min(a)),t.x(d3.max(a))],o=1.03*Math.abs(r[0]-r[1])/e.histData.length,i=d2b.UTILS.visualLength(t.padding,o);o-=1*i,n.selectAll("rect");var c=n.selectAll("rect").data(e.histData,function(t,e){return t.x});c.enter().append("rect").style("fill",d2b.UTILS.getColor(t.color,"label",[e])).attr("y",t.y(0)).attr("height",0).call(t.events.addElementDispatcher,"main","d2b-histogram-bar");c.call(t.tooltipSVG.graph,{key:e.label,content:t.tooltip,data:function(t){return{data:t,graph:e}},x:function(e){return t.x.invert(t.x(e.x)-i+o/2)},y:function(t){return t.y},fill:d2b.UTILS.getColor(t.color,"label",[e])}).transition().duration(t.animationDuration).style("fill",d2b.UTILS.getColor(t.color,"label",[e])).attr("x",function(e){return t.x(e.x)-i}).attr("width",function(t){return Math.max(0,o)}).attr("y",t.barY).attr("height",t.barHeight),c.exit().transition().duration(t.animationDuration).attr("y",t.y(0)).attr("height",0)}),d3.timer.flush(),n&&n(),e},e},d2b.UTILS.AXISCHART.TYPES.line=function(){var t={};t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={},t.xFormat=function(t){return t},t.yFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.point=d2b.SVG.point().size(40).active(!0).fill("white"),t.line=d3.svg.line().x(function(e){return t.x(e.x)}).y(function(e){return t.y(e.y)}),t.tooltip=function(e){return t.xFormat(e.data.x)+" : "+t.yFormat(e.data.y)};var e={};return e.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"foreground"),e.background=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"background"),e.general=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"general"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration"),e.x=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"x"),e.y=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"y"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"xFormat"),e.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"yFormat"),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color"),e.controls=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"controlsData"),e.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"axisChart"),e.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltip"),e.tooltipSVG=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltipSVG"),e.xValues=function(){var e=[];return t.currentChartData.forEach(function(t){e=e.concat(t.values.map(function(t){return t.x}))}),e},e.yValues=function(){var e=[];return t.currentChartData.forEach(function(t){e=e.concat(t.values.map(function(t){return t.y}))}),e},e.data=function(n){return arguments.length?(t.currentChartData=n,e):t.currentChartData},e.update=function(n){return t.background.each(function(e,n){var a=d3.select(this),r=a.select("path");0===r.size()&&(r=a.append("path").call(t.events.addElementDispatcher,"main","d2b-line")),t.line.interpolate(e.interpolate||"linear").tension(e.tension||0),r.style("stroke",d2b.UTILS.getColor(t.color,"label",[e])).datum(function(t){return e.values}).transition().duration(t.animationDuration).attr("d",t.line)}),t.foreground.each(function(e){var n=d3.select(this),a=n.selectAll("g").data(function(t){return t.values}),r=(a.enter().append("g").attr("transform",function(e){return"translate("+t.x(e.x)+","+t.y(e.y)+")"}),d2b.UTILS.getColor(t.color,"label",[e]));t.point.type(function(t,n){return t.symbol||e.symbol||"circle"}).stroke(r),a.call(t.point).call(t.events.addElementDispatcher,"main","d2b-line-point").call(t.tooltipSVG.graph,{key:e.label,content:t.tooltip,data:function(t){return{data:t,graph:e}},x:function(t){return t.x},y:function(t){return t.y},fill:d2b.UTILS.getColor(t.color,"label",[e])}),a.transition().duration(t.animationDuration).attr("transform",function(e){return"translate("+t.x(e.x)+","+t.y(e.y)+")"}),a.exit().transition().duration(t.animationDuration).style("opacity",0).remove()}),d3.timer.flush(),n&&n(),e},e},d2b.UTILS.AXISCHART.TYPES.scatter=function(){var t={};t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={},t.xFormat=function(t){return t},t.yFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.point=d2b.SVG.point().size(function(t){return t.size||40}).active(!0),t.tooltip=function(e){return t.xFormat(e.data.x)+" : "+t.yFormat(e.data.y)};var e={};return e.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"foreground"),e.background=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"background"),e.general=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"general"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration"),e.x=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"x"),e.y=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"y"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"xFormat"),e.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"yFormat"),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color"),e.controls=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"controlsData"),e.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"axisChart"),e.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltip"),e.tooltipSVG=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltipSVG"),e.xValues=function(){var e=[];return t.currentChartData.forEach(function(t){e=e.concat(t.values.map(function(t){return t.x}))}),e},e.yValues=function(){var e=[];return t.currentChartData.forEach(function(t){e=e.concat(t.values.map(function(t){return t.y}))}),e},e.data=function(n){return arguments.length?(t.currentChartData=n,e):t.currentChartData},e.update=function(n){return t.foreground.each(function(e){var n=d3.select(this),a=n.selectAll("g").data(function(t){return t.values},function(t){return t.key||t.x+"-"+t.y}),r=d2b.UTILS.getColor(t.color,"label",[e]);t.point.stroke(r).fill(r).type(function(t,n){return t.symbol||e.symbol||"circle"});a.enter().append("g").call(t.point.size(0)).attr("transform",function(e){return"translate("+t.x(e.x)+","+t.y(e.y)+")"});t.point.size(function(t){return t.size||40}),a.call(t.events.addElementDispatcher,"main","d2b-scatter-point").call(t.tooltipSVG.graph,{key:e.label,content:t.tooltip,data:function(t){return{data:t,graph:e}},x:function(t){return t.x},y:function(t){return t.y},fill:r}),a.transition().duration(t.animationDuration).style("opacity",1).call(t.point).attr("transform",function(e){return"translate("+t.x(e.x)+","+t.y(e.y)+")"}),a.exit().transition().duration(t.animationDuration).style("opacity",0).remove()}),d3.timer.flush(),n&&n(),e},e},d2b.UTILS.AXISCHART.TYPES.template=function(){var t={};t.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,t.color=d2b.CONSTANTS.DEFAULTCOLOR(),t.currentChartData={},t.xFormat=function(t){return t},t.yFormat=function(t){return t},t.events=d2b.UTILS.chartEvents(),t.tooltip=function(e){return"<u><b>"+e.graph.label+"</b></u> <br />						<b>x:</b> "+t.xFormat(e.data.x)+"<br />						<b>y:</b> "+t.yFormat(e.data.y)};var e={};return e.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"foreground"),e.background=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"background"),e.general=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"general"),e.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"animationDuration"),e.x=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"x"),e.y=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"y"),e.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"xFormat"),e.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"yFormat"),e.width=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"width"),e.height=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"height"),e.on=d2b.UTILS.CHARTS.MEMBERS.events(e,t),e.color=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"color"),e.controls=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"controlsData"),e.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"axisChart"),e.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(e,t,"tooltip"),e.xValues=function(){var t=[];return t},e.yValues=function(){var t=[];return t},e.data=function(n){return arguments.length?(t.currentChartData=n,e):t.currentChartData},e.update=function(n){return t.background.each(function(t){d3.select(this)}),t.foreground.each(function(t){d3.select(this)}),d3.timer.flush(),n&&n(),e},e},d2b.UTILS.AXISCHART.TYPES.template=function(t){var e={};e.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,e.color=d2b.CONSTANTS.DEFAULTCOLOR(),e.currentChartData={},e.xFormat=function(t){return t},e.yFormat=function(t){return t},e.events=d2b.UTILS.chartEvents(),e.tooltip=function(t){return"<u><b>"+t.graph.label+"</b></u> <br />						<b>x:</b> "+e.xFormat(t.data.x)+"<br />						<b>y:</b> "+e.yFormat(t.data.y)};var n={};return n.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(n,e,"foreground"),n.background=d2b.UTILS.CHARTS.MEMBERS.prop(n,e,"background"),n.general=d2b.UTILS.CHARTS.MEMBERS.prop(n,e,"general"),n.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(n,e,"animationDuration"),n.x=d2b.UTILS.CHARTS.MEMBERS.prop(n,e,"x"),n.y=d2b.UTILS.CHARTS.MEMBERS.prop(n,e,"y"),n.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(n,e,"xFormat"),n.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(n,e,"yFormat"),n.width=d2b.UTILS.CHARTS.MEMBERS.prop(n,e,"width"),n.height=d2b.UTILS.CHARTS.MEMBERS.prop(n,e,"height"),n.on=d2b.UTILS.CHARTS.MEMBERS.events(n,e),n.color=d2b.UTILS.CHARTS.MEMBERS.prop(n,e,"color"),n.controls=d2b.UTILS.CHARTS.MEMBERS.prop(n,e,"controlsData"),n.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(n,e,"axisChart"),n.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(n,e,"tooltip"),n.xValues=function(){if(t&&d2b.UTILS.AXISCHART.TYPES[t].xValues)return d2b.UTILS.AXISCHART.TYPES[t].xValues.call(e,n);var a=[];return a},n.yValues=function(){if(t&&d2b.UTILS.AXISCHART.TYPES[t].yValues)return d2b.UTILS.AXISCHART.TYPES[t].yValues.call(e,n);var a=[];return a},n.data=function(t){return arguments.length?(e.currentChartData=t,n):e.currentChartData},n.update=function(a){return t&&d2b.UTILS.AXISCHART.TYPES[t].update?(d2b.UTILS.AXISCHART.TYPES[t].update.call(e,n),a&&a(),n):(e.background.each(function(t){d3.select(this)}),e.foreground.each(function(t){d3.select(this)}),d3.timer.flush(),a&&a(),n)},n}}();